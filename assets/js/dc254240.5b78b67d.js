"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1401],{68475:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>x,frontMatter:()=>t,metadata:()=>l,toc:()=>h});var d=s(74848),r=s(28453);const t={sidebar_position:15},i="K230 nncase\u5f00\u53d1\u6307\u5357",l={id:"CanaanK230/part6/K230nncaseDeveloperGuide",title:"K230 nncase\u5f00\u53d1\u6307\u5357",description:"1. \u6982\u8ff0",source:"@site/docs/CanaanK230/part6/15_K230nncaseDeveloperGuide.md",sourceDirName:"CanaanK230/part6",slug:"/CanaanK230/part6/K230nncaseDeveloperGuide",permalink:"/docs/CanaanK230/part6/K230nncaseDeveloperGuide",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part6/15_K230nncaseDeveloperGuide.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"canaanK230Sidebar",previous:{title:"K230 SDK IoT WiFi AiW4211LV10\u9a71\u52a8\u5f00\u53d1\u6307\u5357",permalink:"/docs/CanaanK230/part6/K230SDKIoTWiFiAiW4211LV10DriverDevelopmentGuide"},next:{title:"K230 SDK \u66f4\u65b0nncase\u8fd0\u884c\u65f6\u5e93\u6307\u5357",permalink:"/docs/CanaanK230/part6/K230SteckupdatedtheEncasRuntimeLibraryGuide"}},c={},h=[{value:"1. \u6982\u8ff0",id:"1-\u6982\u8ff0",level:2},{value:"1.1 \u4ec0\u4e48\u662fnncase",id:"11-\u4ec0\u4e48\u662fnncase",level:3},{value:"1.2 nncase\u67b6\u6784",id:"12-nncase\u67b6\u6784",level:3},{value:"1.3 \u5f00\u53d1\u73af\u5883",id:"13-\u5f00\u53d1\u73af\u5883",level:3},{value:"1.3.1 \u64cd\u4f5c\u7cfb\u7edf",id:"131-\u64cd\u4f5c\u7cfb\u7edf",level:4},{value:"1.3.2 \u8f6f\u4ef6\u73af\u5883",id:"132-\u8f6f\u4ef6\u73af\u5883",level:4},{value:"1.3.3 \u786c\u4ef6\u73af\u5883",id:"133-\u786c\u4ef6\u73af\u5883",level:4},{value:"2. \u7f16\u8bd1\u6a21\u578bAPIs(Python)",id:"2-\u7f16\u8bd1\u6a21\u578bapispython",level:2},{value:"2.1 \u652f\u6301\u7684\u7b97\u5b50",id:"21-\u652f\u6301\u7684\u7b97\u5b50",level:3},{value:"2.1.1 tflite\u7b97\u5b50",id:"211-tflite\u7b97\u5b50",level:4},{value:"2.1.2 onnx\u7b97\u5b50",id:"212-onnx\u7b97\u5b50",level:4},{value:"2.2 APIs",id:"22-apis",level:3},{value:"2.2.1 CompileOptions",id:"221-compileoptions",level:4},{value:"2.2.1.1 \u524d\u5904\u7406\u6d41\u7a0b\u8bf4\u660e",id:"2211-\u524d\u5904\u7406\u6d41\u7a0b\u8bf4\u660e",level:5},{value:"2.2.1.2 \u52a8\u6001shape\u53c2\u6570\u8bf4\u660e",id:"2212-\u52a8\u6001shape\u53c2\u6570\u8bf4\u660e",level:5},{value:"2.2.1.3 \u53c2\u6570\u914d\u7f6e\u793a\u4f8b",id:"2213-\u53c2\u6570\u914d\u7f6e\u793a\u4f8b",level:5},{value:"2.2.2 ImportOptions",id:"222-importoptions",level:4},{value:"2.2.3 PTQTensorOptions",id:"223-ptqtensoroptions",level:4},{value:"2.2.4 set_tensor_data",id:"224-set_tensor_data",level:4},{value:"2.2.5 Compiler",id:"225-compiler",level:4},{value:"2.2.6 import_tflite",id:"226-import_tflite",level:4},{value:"2.2.7 import_onnx",id:"227-import_onnx",level:4},{value:"2.2.8 use_ptq",id:"228-use_ptq",level:4},{value:"2.2.9 compile",id:"229-compile",level:4},{value:"2.2.10 gencode_tobytes",id:"2210-gencode_tobytes",level:4},{value:"2.3 \u793a\u4f8b",id:"23-\u793a\u4f8b",level:3},{value:"2.3.1 \u7f16\u8bd1tflite\u6a21\u578b",id:"231-\u7f16\u8bd1tflite\u6a21\u578b",level:4},{value:"2.3.2 \u7f16\u8bd1onnx\u6a21\u578b",id:"232-\u7f16\u8bd1onnx\u6a21\u578b",level:4},{value:"3. \u6a21\u62df\u5668APIs(Python)",id:"3-\u6a21\u62df\u5668apispython",level:2},{value:"3.1 APIs",id:"31-apis",level:3},{value:"3.1.1 MemoryRange",id:"311-memoryrange",level:4},{value:"3.1.2 RuntimeTensor",id:"312-runtimetensor",level:4},{value:"3.1.3 from_numpy",id:"313-from_numpy",level:4},{value:"3.1.4 copy_to",id:"314-copy_to",level:4},{value:"3.1.5 to_numpy",id:"315-to_numpy",level:4},{value:"3.1.6 Simulator",id:"316-simulator",level:4},{value:"3.1.7 load_model",id:"317-load_model",level:4},{value:"3.1.8 get_input_desc",id:"318-get_input_desc",level:4},{value:"3.1.9 get_output_desc",id:"319-get_output_desc",level:4},{value:"3.1.10 get_input_tensor",id:"3110-get_input_tensor",level:4},{value:"3.1.11 set_input_tensor",id:"3111-set_input_tensor",level:4},{value:"3.1.12 get_output_tensor",id:"3112-get_output_tensor",level:4},{value:"3.1.13 set_output_tensor",id:"3113-set_output_tensor",level:4},{value:"3.1.14 run",id:"3114-run",level:4},{value:"3.2 \u793a\u4f8b",id:"32-\u793a\u4f8b",level:3},{value:"4. KPU\u8fd0\u884c\u65f6APIs(C++)",id:"4-kpu\u8fd0\u884c\u65f6apisc",level:2},{value:"4.1 \u7b80\u4ecb",id:"41-\u7b80\u4ecb",level:3},{value:"4.2 APIs",id:"42-apis",level:3},{value:"4.2.1 hrt::create",id:"421-hrtcreate",level:4},{value:"4.2.2 hrt::sync",id:"422-hrtsync",level:4},{value:"4.2.3 interpreter::load_model",id:"423-interpreterload_model",level:4},{value:"4.2.4 interpreter::inputs_size",id:"424-interpreterinputs_size",level:4},{value:"4.2.5 interpreter::outputs_size",id:"425-interpreteroutputs_size",level:4},{value:"4.2.6 interpreter:: input_shape",id:"426-interpreter-input_shape",level:4},{value:"4.2.7 interpreter:: output_shape",id:"427-interpreter-output_shape",level:4},{value:"4.2.8 interpreter:: input_tensor",id:"428-interpreter-input_tensor",level:4},{value:"4.2.9 interpreter:: output_tensor",id:"429-interpreter-output_tensor",level:4},{value:"4.2.10 interpreter:: run",id:"4210-interpreter-run",level:4},{value:"4.3 \u793a\u4f8b",id:"43-\u793a\u4f8b",level:3},{value:"5. AI2D \u8fd0\u884c\u65f6APIs(C++)",id:"5-ai2d-\u8fd0\u884c\u65f6apisc",level:2},{value:"5.1 \u7b80\u4ecb",id:"51-\u7b80\u4ecb",level:3},{value:"5.1.1 \u652f\u6301\u7684\u683c\u5f0f\u8f6c\u6362",id:"511-\u652f\u6301\u7684\u683c\u5f0f\u8f6c\u6362",level:4},{value:"5.1.2 \u529f\u80fd\u63cf\u8ff0",id:"512-\u529f\u80fd\u63cf\u8ff0",level:4},{value:"5.2 APIs",id:"52-apis",level:3},{value:"5.2.1 ai2d_format",id:"521-ai2d_format",level:4},{value:"5.2.2 ai2d_interp_method",id:"522-ai2d_interp_method",level:4},{value:"5.2.3 ai2d_interp_mode",id:"523-ai2d_interp_mode",level:4},{value:"5.2.4 ai2d_pad_mode",id:"524-ai2d_pad_mode",level:4},{value:"5.2.5 ai2d_datatype_t",id:"525-ai2d_datatype_t",level:4},{value:"5.2.6 ai2d_crop_param_t",id:"526-ai2d_crop_param_t",level:4},{value:"5.2.7 ai2d_shift_param_t",id:"527-ai2d_shift_param_t",level:4},{value:"5.2.8 ai2d_pad_param_t",id:"528-ai2d_pad_param_t",level:4},{value:"5.2.9 ai2d_resize_param_t",id:"529-ai2d_resize_param_t",level:4},{value:"5.2.10 ai2d_affine_param_t",id:"5210-ai2d_affine_param_t",level:4},{value:"5.2.11 ai2d_builder:: ai2d_builder",id:"5211-ai2d_builder-ai2d_builder",level:4},{value:"5.2.12 ai2d_builder:: build_schedule",id:"5212-ai2d_builder-build_schedule",level:4},{value:"5.2.13 ai2d_builder:: invoke",id:"5213-ai2d_builder-invoke",level:4},{value:"5.3 \u793a\u4f8b",id:"53-\u793a\u4f8b",level:3},{value:"5.4 \u6ce8\u610f\u4e8b\u9879",id:"54-\u6ce8\u610f\u4e8b\u9879",level:3}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"k230-nncase\u5f00\u53d1\u6307\u5357",children:"K230 nncase\u5f00\u53d1\u6307\u5357"})}),"\n",(0,d.jsx)(n.h2,{id:"1-\u6982\u8ff0",children:"1. \u6982\u8ff0"}),"\n",(0,d.jsx)(n.h3,{id:"11-\u4ec0\u4e48\u662fnncase",children:"1.1 \u4ec0\u4e48\u662fnncase"}),"\n",(0,d.jsx)(n.p,{children:"nncase\u662f\u4e00\u4e2a\u4e3a AI \u52a0\u901f\u5668\u8bbe\u8ba1\u7684\u795e\u7ecf\u7f51\u7edc\u7f16\u8bd1\u5668, \u76ee\u524d\u652f\u6301\u7684 target\u6709cpu/K210/K510/K230\u7b49."}),"\n",(0,d.jsx)(n.p,{children:"nncase\u63d0\u4f9b\u7684\u529f\u80fd"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u652f\u6301\u591a\u8f93\u5165\u591a\u8f93\u51fa\u7f51\u7edc\uff0c\u652f\u6301\u591a\u5206\u652f\u7ed3\u6784"}),"\n",(0,d.jsx)(n.li,{children:"\u9759\u6001\u5185\u5b58\u5206\u914d\uff0c\u4e0d\u9700\u8981\u5806\u5185\u5b58"}),"\n",(0,d.jsx)(n.li,{children:"\u7b97\u5b50\u5408\u5e76\u548c\u4f18\u5316"}),"\n",(0,d.jsx)(n.li,{children:"\u652f\u6301 float \u548cuint8/int8\u91cf\u5316\u63a8\u7406"}),"\n",(0,d.jsx)(n.li,{children:"\u652f\u6301\u8bad\u7ec3\u540e\u91cf\u5316\uff0c\u4f7f\u7528\u6d6e\u70b9\u6a21\u578b\u548c\u91cf\u5316\u6821\u51c6\u96c6"}),"\n",(0,d.jsx)(n.li,{children:"\u5e73\u5766\u6a21\u578b\uff0c\u652f\u6301\u96f6\u62f7\u8d1d\u52a0\u8f7d"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"nncase\u652f\u6301\u7684\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\u683c\u5f0f"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"tflite"}),"\n",(0,d.jsx)(n.li,{children:"onnx"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"12-nncase\u67b6\u6784",children:"1.2 nncase\u67b6\u6784"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"nncase\u67b6\u6784",src:s(30293).A+"",width:"1281",height:"1509"})}),"\n",(0,d.jsx)(n.p,{children:"nncase\u8f6f\u4ef6\u6808\u5305\u62eccompiler\u548cruntime\u4e24\u90e8\u5206\u3002"}),"\n",(0,d.jsx)(n.p,{children:"Compiler: \u7528\u4e8e\u5728PC\u4e0a\u7f16\u8bd1\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\uff0c\u6700\u7ec8\u751f\u6210kmodel\u6587\u4ef6\u3002\u4e3b\u8981\u5305\u62ecimporter, IR, Evaluator, Quantize, Transform\u4f18\u5316, Tiling, Partition, Schedule, Codegen\u7b49\u6a21\u5757\u3002"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Importer: \u5c06\u5176\u5b83\u795e\u7ecf\u7f51\u7edc\u6846\u67b6\u7684\u6a21\u578b\u5bfc\u5165\u5230nncase\u4e2d"}),"\n",(0,d.jsx)(n.li,{children:"IR: \u4e2d\u95f4\u8868\u793a, \u5206\u4e3aimporter\u5bfc\u5165\u7684Neutral IR(\u8bbe\u5907\u65e0\u5173)\u548cNeutral IR\u7ecflowering\u8f6c\u6362\u751f\u6210\u7684Target IR(\u8bbe\u5907\u76f8\u5173)"}),"\n",(0,d.jsx)(n.li,{children:"Evaluator: Evaluator\u63d0\u4f9bIR\u7684\u89e3\u91ca\u6267\u884c\u80fd\u529b\uff0c\u5e38\u88ab\u7528\u4e8eConstant Folding/PTQ Calibration\u7b49\u573a\u666f"}),"\n",(0,d.jsx)(n.li,{children:"Transform: \u7528\u4e8eIR\u8f6c\u6362\u548c\u56fe\u7684\u904d\u5386\u4f18\u5316\u7b49"}),"\n",(0,d.jsx)(n.li,{children:"Quantize: \u8bad\u7ec3\u540e\u91cf\u5316, \u5bf9\u8981\u91cf\u5316\u7684tensor\u52a0\u5165\u91cf\u5316\u6807\u8bb0, \u6839\u636e\u8f93\u5165\u7684\u6821\u6b63\u96c6, \u8c03\u7528 Evaluator\u8fdb\u884c\u89e3\u91ca\u6267\u884c, \u6536\u96c6tensor\u7684\u6570\u636e\u8303\u56f4, \u63d2\u5165\u91cf\u5316/\u53cd\u91cf\u5316\u7ed3\u70b9, \u6700\u540e\u4f18\u5316\u6d88\u9664\u4e0d\u5fc5\u8981\u7684\u91cf\u5316/\u53cd\u91cf\u5316\u7ed3\u70b9\u7b49"}),"\n",(0,d.jsx)(n.li,{children:"Tiling: \u53d7\u9650\u4e8eNPU\u8f83\u4f4e\u7684\u5b58\u50a8\u5668\u5bb9\u91cf\uff0c\u9700\u8981\u5c06\u5927\u5757\u8ba1\u7b97\u8fdb\u884c\u62c6\u5206. \u53e6\u5916, \u8ba1\u7b97\u5b58\u5728\u5927\u91cf\u6570\u636e\u590d\u7528\u65f6\u9009\u62e9Tiling\u53c2\u6570\u4f1a\u5bf9\u65f6\u5ef6\u548c\u5e26\u5bbd\u4ea7\u751f\u5f71\u54cd"}),"\n",(0,d.jsx)(n.li,{children:"Partition: \u5c06\u56fe\u6309ModuleType\u8fdb\u884c\u5207\u5206, \u5207\u5206\u540e\u7684\u6bcf\u4e2a\u5b50\u56fe\u4f1a\u5bf9\u5e94RuntimeModule, \u4e0d\u540c\u7c7b\u578b\u7684RuntimeModule\u5bf9\u5e94\u4e0d\u540c\u7684Device(cpu/K230)"}),"\n",(0,d.jsx)(n.li,{children:"Schedule: \u6839\u636e\u4f18\u5316\u540e\u56fe\u4e2d\u7684\u6570\u636e\u4f9d\u8d56\u5173\u7cfb\u751f\u6210\u8ba1\u7b97\u987a\u5e8f\u5e76\u5206\u914dBuffer"}),"\n",(0,d.jsx)(n.li,{children:"Codegen: \u5bf9\u6bcf\u4e2a\u5b50\u56fe\u5206\u522b\u8c03\u7528ModuleType\u5bf9\u5e94\u7684codegen\uff0c\u751f\u6210RuntimeModule"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Runtime: \u96c6\u6210\u4e8e\u7528\u6237App\uff0c \u63d0\u4f9b\u52a0\u8f7dkmodel/\u8bbe\u7f6e\u8f93\u5165\u6570\u636e/KPU\u6267\u884c/\u83b7\u53d6\u8f93\u51fa\u6570\u636e\u7b49\u529f\u80fd."}),"\n",(0,d.jsx)(n.h3,{id:"13-\u5f00\u53d1\u73af\u5883",children:"1.3 \u5f00\u53d1\u73af\u5883"}),"\n",(0,d.jsx)(n.h4,{id:"131-\u64cd\u4f5c\u7cfb\u7edf",children:"1.3.1 \u64cd\u4f5c\u7cfb\u7edf"}),"\n",(0,d.jsx)(n.p,{children:"\u652f\u6301\u7684\u64cd\u4f5c\u7cfb\u7edf\u5305\u62ecUbuntu 18.04/Ubuntu 20.04"}),"\n",(0,d.jsx)(n.h4,{id:"132-\u8f6f\u4ef6\u73af\u5883",children:"1.3.2 \u8f6f\u4ef6\u73af\u5883"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u5e8f\u53f7"}),(0,d.jsx)(n.th,{children:"\u8f6f\u4ef6"}),(0,d.jsx)(n.th,{children:"\u7248\u672c\u53f7"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"1"}),(0,d.jsx)(n.td,{children:"python"}),(0,d.jsx)(n.td,{children:"3.6/3.7/3.8/3.9/3.10"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"2"}),(0,d.jsx)(n.td,{children:"pip"}),(0,d.jsx)(n.td,{children:">=20.3"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"3"}),(0,d.jsx)(n.td,{children:"numpy"}),(0,d.jsx)(n.td,{children:"1.19.5"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"4"}),(0,d.jsx)(n.td,{children:"onnx"}),(0,d.jsx)(n.td,{children:"1.9.0"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"5"}),(0,d.jsx)(n.td,{children:"onnx-simplifier"}),(0,d.jsx)(n.td,{children:"0.3.6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"6"}),(0,d.jsx)(n.td,{children:"Onnxoptimizer"}),(0,d.jsx)(n.td,{children:"0.2.6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"7"}),(0,d.jsx)(n.td,{children:"Onnxruntime"}),(0,d.jsx)(n.td,{children:"1.8.0"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"8"}),(0,d.jsx)(n.td,{children:"dotnet-runtime"}),(0,d.jsx)(n.td,{children:"7.0"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"133-\u786c\u4ef6\u73af\u5883",children:"1.3.3 \u786c\u4ef6\u73af\u5883"}),"\n",(0,d.jsx)(n.p,{children:"K230 evb"}),"\n",(0,d.jsx)(n.h2,{id:"2-\u7f16\u8bd1\u6a21\u578bapispython",children:"2. \u7f16\u8bd1\u6a21\u578bAPIs(Python)"}),"\n",(0,d.jsx)(n.p,{children:"nncase\u63d0\u4f9b\u4e86Python APIs, \u7528\u4e8e\u5728PC\u4e0a\u7f16\u8bd1\u795e\u7ecf\u7f51\u7edc\u6a21\u578b"}),"\n",(0,d.jsx)(n.h3,{id:"21-\u652f\u6301\u7684\u7b97\u5b50",children:"2.1 \u652f\u6301\u7684\u7b97\u5b50"}),"\n",(0,d.jsx)(n.h4,{id:"211-tflite\u7b97\u5b50",children:"2.1.1 tflite\u7b97\u5b50"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Operator"}),(0,d.jsx)(n.th,{children:"Is Supported"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ABS"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ADD"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ARG_MAX"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ARG_MIN"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"AVERAGE_POOL_2D"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"BATCH_MATMUL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CAST"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CEIL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CONCATENATION"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CONV_2D"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"COS"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CUSTOM"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"DEPTHWISE_CONV_2D"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"DIV"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"EQUAL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"EXP"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"EXPAND_DIMS"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FLOOR"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FLOOR_DIV"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FLOOR_MOD"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FULLY_CONNECTED"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GREATER"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GREATER_EQUAL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"L2_NORMALIZATION"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LEAKY_RELU"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LESS"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LESS_EQUAL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LOG"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LOGISTIC"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MAX_POOL_2D"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MAXIMUM"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MEAN"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MINIMUM"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MUL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"NEG"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"NOT_EQUAL"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"PAD"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"PADV2"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MIRROR_PAD"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"PACK"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"POW"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"REDUCE_MAX"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"REDUCE_MIN"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"REDUCE_PROD"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RELU"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"PRELU"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RELU6"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RESHAPE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RESIZE_BILINEAR"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RESIZE_NEAREST_NEIGHBOR"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ROUND"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RSQRT"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SHAPE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SIN"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SLICE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SOFTMAX"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SPACE_TO_BATCH_ND"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SQUEEZE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"BATCH_TO_SPACE_ND"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"STRIDED_SLICE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SQRT"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SQUARE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SUB"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SUM"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TANH"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TILE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TRANSPOSE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TRANSPOSE_CONV"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"QUANTIZE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"FAKE_QUANT"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"DEQUANTIZE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GATHER"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GATHER_ND"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ONE_HOT"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SQUARED_DIFFERENCE"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LOG_SOFTMAX"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SPLIT"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"HARD_SWISH"}),(0,d.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"212-onnx\u7b97\u5b50",children:"2.1.2 onnx\u7b97\u5b50"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Operator"}),(0,d.jsx)(n.th,{children:"Is Supported"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Abs"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Acos"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Acosh"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"And"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ArgMax"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ArgMin"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Asin"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Asinh"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Add"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"AveragePool"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"BatchNormalization"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cast"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Ceil"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Celu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Clip"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Compress"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Concat"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Constant"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ConstantOfShape"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Conv"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ConvTranspose"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cos"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Cosh"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"CumSum"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"DepthToSpace"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"DequantizeLinear"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Div"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Dropout"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Elu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Exp"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Expand"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Equal"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Erf"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Flatten"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Floor"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Gather"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GatherElements"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GatherND"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Gemm"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GlobalAveragePool"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GlobalMaxPool"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Greater"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GreaterOrEqual"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"GRU"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Hardmax"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"HardSigmoid"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"HardSwish"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Identity"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"InstanceNormalization"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LayerNormalization"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LpNormalization"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LeakyRelu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Less"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LessOrEqual"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Log"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LogSoftmax"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LRN"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"LSTM"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MatMul"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"MaxPool"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Max"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Min"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Mul"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Neg"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Not"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"OneHot"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Pad"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Pow"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"PRelu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"QuantizeLinear"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RandomNormal"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RandomNormalLike"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RandomUniform"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RandomUniformLike"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceL1"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceL2"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceLogSum"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceLogSumExp"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceMax"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceMean"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceMin"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceProd"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceSum"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReduceSumSquare"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Relu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Reshape"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Resize"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ReverseSequence"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RoiAlign"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Round"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Rsqrt"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Selu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Shape"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sign"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sin"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sinh"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sigmoid"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Size"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Slice"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Softmax"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Softplus"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Softsign"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"SpaceToDepth"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Split"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sqrt"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Squeeze"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sub"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Sum"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Tanh"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Tile"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"TopK"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Transpose"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Trilu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ThresholdedRelu"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Upsample"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Unsqueeze"}),(0,d.jsx)(n.td,{children:"Yes"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Where"}),(0,d.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"22-apis",children:"2.2 APIs"}),"\n",(0,d.jsx)(n.p,{children:"\u76ee\u524d\u7f16\u8bd1\u6a21\u578bAPIs\u652f\u6301tflite/onnx\u7b49\u683c\u5f0f\u7684\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u3002"}),"\n",(0,d.jsx)(n.h4,{id:"221-compileoptions",children:"2.2.1 CompileOptions"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"CompileOptions\u7c7b, \u7528\u4e8e\u914d\u7f6enncase\u7f16\u8bd1\u9009\u9879\uff0c\u5404\u5c5e\u6027\u8bf4\u660e\u5982\u4e0b"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u5c5e\u6027\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u662f\u5426\u5fc5\u987b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"target"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u7f16\u8bd1\u76ee\u6807, \u5982\u2019cpu\u2019, \u2018k230\u2019"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dump_ir"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u662f\u5426dump IR, \u9ed8\u8ba4\u4e3aFalse"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dump_asm"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u662f\u5426dump asm\u6c47\u7f16\u6587\u4ef6, \u9ed8\u8ba4\u4e3aFalse"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dump_dir"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u524d\u9762\u6307\u5b9adump_ir\u7b49\u5f00\u5173\u540e, \u8fd9\u91cc\u6307\u5b9adump\u7684\u76ee\u5f55, \u9ed8\u8ba4\u4e3a\u201d\u201d"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_file"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"onnx\u6a21\u578b\u8d85\u8fc72GB\u65f6\uff0c\u7528\u4e8e\u6307\u5b9a\u53c2\u6570\u6587\u4ef6\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a\u201d\u201d"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"preprocess"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsxs)(n.td,{children:["\u662f\u5426\u5f00\u542f\u524d\u5904\u7406\uff0c\u9ed8\u8ba4\u4e3aFalse\u3002\u4ee5\u4e0b\u53c2\u6570\u4ec5\u5728 ",(0,d.jsx)(n.code,{children:"preprocess=True"}),"\u65f6\u751f\u6548"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_type"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsxs)(n.td,{children:["\u5f00\u542f\u524d\u5904\u7406\u65f6\u6307\u5b9a\u8f93\u5165\u6570\u636e\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3a\u201dfloat\u201d\u3002\u5f53 ",(0,d.jsx)(n.code,{children:"preprocess"}),"\u4e3a ",(0,d.jsx)(n.code,{children:"True"}),"\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u4e3a\u201duint8\u201d\u6216\u8005\u201dfloat32\u201d"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_shape"}),(0,d.jsx)(n.td,{children:"list[int]"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsxs)(n.td,{children:["\u5f00\u542f\u524d\u5904\u7406\u65f6\u6307\u5b9a\u8f93\u5165\u6570\u636e\u7684shape\uff0c\u9ed8\u8ba4\u4e3a[]\u3002\u5f53 ",(0,d.jsx)(n.code,{children:"preprocess"}),"\u4e3a ",(0,d.jsx)(n.code,{children:"True"}),"\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_range"}),(0,d.jsx)(n.td,{children:"list[float]"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsxs)(n.td,{children:["\u5f00\u542f\u524d\u5904\u7406\u65f6\u6307\u5b9a\u8f93\u5165\u6570\u636e\u53cd\u91cf\u5316\u540e\u7684\u6d6e\u70b9\u6570\u8303\u56f4\uff0c\u9ed8\u8ba4\u4e3a[ ]\u3002\u5f53 ",(0,d.jsx)(n.code,{children:"preprocess"}),"\u4e3a ",(0,d.jsx)(n.code,{children:"True"}),"\u4e14 ",(0,d.jsx)(n.code,{children:"input_type"}),"\u4e3a ",(0,d.jsx)(n.code,{children:"uint8"}),"\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_layout"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u8f93\u5165\u6570\u636e\u7684layout\uff0c\u9ed8\u8ba4\u4e3a\u201d\u201d"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"swapRB"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsxs)(n.td,{children:["\u662f\u5426\u5728 ",(0,d.jsx)(n.code,{children:"channel"}),"\u7ef4\u5ea6\u53cd\u8f6c\u6570\u636e\uff0c\u9ed8\u8ba4\u4e3aFalse"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"mean"}),(0,d.jsx)(n.td,{children:"list[float]"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u524d\u5904\u7406\u6807\u51c6\u5316\u53c2\u6570\u5747\u503c\uff0c\u9ed8\u8ba4\u4e3a[0,0,0]"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"std"}),(0,d.jsx)(n.td,{children:"list[float]"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u524d\u5904\u7406\u6807\u51c6\u5316\u53c2\u6570\u65b9\u5dee\uff0c\u9ed8\u8ba4\u4e3a[1,1,1]"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"letterbox_value"}),(0,d.jsx)(n.td,{children:"float"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u524d\u5904\u7406letterbox\u7684\u586b\u5145\u503c\uff0c\u9ed8\u8ba4\u4e3a0"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"output_layout"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u6307\u5b9a\u8f93\u51fa\u6570\u636e\u7684layout, \u9ed8\u8ba4\u4e3a\u201d\u201d"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape_bucket_enable"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsxs)(n.td,{children:["\u662f\u5426\u5f00\u542fShapeBucket\u529f\u80fd\uff0c\u9ed8\u8ba4\u4e3aFalse\u3002\u5728 ",(0,d.jsx)(n.code,{children:"dump_ir=True"}),"\u65f6\u751f\u6548"]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape_bucket_range_info"}),(0,d.jsx)(n.td,{children:"Dict[str, [int, int]]"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:"\u6bcf\u4e2a\u8f93\u5165shape\u7ef4\u5ea6\u4fe1\u606f\u4e2d\u7684\u53d8\u91cf\u7684\u8303\u56f4\uff0c\u6700\u5c0f\u503c\u5fc5\u987b\u5927\u4e8e\u7b49\u4e8e1"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape_bucket_segments_count"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u662f"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u53d8\u91cf\u7684\u8303\u56f4\u5212\u5206\u4e3a\u51e0\u6bb5"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape_bucket_fix_var_map"}),(0,d.jsx)(n.td,{children:"Dict[str, int]"}),(0,d.jsx)(n.td,{children:"\u5426"}),(0,d.jsx)(n.td,{children:"\u56fa\u5b9ashape\u7ef4\u5ea6\u4fe1\u606f\u4e2d\u7684\u53d8\u91cf\u4e3a\u7279\u5b9a\u7684\u503c"})]})]})]}),"\n",(0,d.jsx)(n.h5,{id:"2211-\u524d\u5904\u7406\u6d41\u7a0b\u8bf4\u660e",children:"2.2.1.1 \u524d\u5904\u7406\u6d41\u7a0b\u8bf4\u660e"}),"\n",(0,d.jsx)(n.p,{children:"\u76ee\u524d\u6682\u4e0d\u652f\u6301\u81ea\u5b9a\u4e49\u524d\u5904\u7406\u987a\u5e8f\uff0c\u53ef\u4ee5\u6839\u636e\u4ee5\u4e0b\u6d41\u7a0b\u793a\u610f\u56fe\uff0c\u9009\u62e9\u6240\u9700\u8981\u7684\u524d\u5904\u7406\u53c2\u6570\u8fdb\u884c\u914d\u7f6e\u3002"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"image-20240722090355852",src:s(13085).A+"",width:"768",height:"2346"})}),"\n",(0,d.jsx)(n.p,{children:"\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"input_range"}),"\u4e3a\u8f93\u5165\u6570\u636e\u7c7b\u578b\u4e3a\u5b9a\u70b9\u65f6\uff0c\u53cd\u91cf\u5316\u540e\u7684\u6d6e\u70b9\u6570\u8303\u56f4\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["a. \u8f93\u5165\u6570\u636e\u7c7b\u578b\u4e3auint8\uff0crange\u4e3a[0,255]\uff0c",(0,d.jsx)(n.code,{children:"input_range"}),"\u4e3a[0,255]\uff0c\u5219\u53cd\u91cf\u5316\u7684\u4f5c\u7528\u53ea\u662f\u8fdb\u884c\u7c7b\u578b\u8f6c\u5316\uff0c\u5c06uint8\u7684\u6570\u636e\u8f6c\u5316\u4e3afloat32\uff0c",(0,d.jsx)(n.code,{children:"mean"}),"\u548c ",(0,d.jsx)(n.code,{children:"std"}),"\u53c2\u6570\u4ecd\u7136\u6309\u7167[0,255]\u7684\u6570\u636e\u8fdb\u884c\u6307\u5b9a\u3002"]}),"\n",(0,d.jsxs)(n.p,{children:["b. \u8f93\u5165\u6570\u636e\u7c7b\u578b\u4e3auint8\uff0crange\u4e3a[0,255]\uff0c",(0,d.jsx)(n.code,{children:"input_range"}),"\u4e3a[0,1]\uff0c\u5219\u53cd\u91cf\u5316\u4f1a\u5c06\u5b9a\u70b9\u6570\u8f6c\u5316\u4e3a\u6d6e\u70b9\u6570[0,1]\uff0c",(0,d.jsx)(n.code,{children:"mean"}),"\u548c ",(0,d.jsx)(n.code,{children:"std"}),"\u53c2\u6570\u9700\u8981\u6309\u71670~1\u7684\u6570\u636e\u8fdb\u884c\u6307\u5b9a\u3002"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"image-20240722090502269",src:s(46699).A+"",width:"1006",height:"431"})}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"input_shape"}),"\u4e3a\u8f93\u5165\u6570\u636e\u7684shape\uff0clayout\u4e3a ",(0,d.jsx)(n.code,{children:"input_layout"}),"\uff0c\u73b0\u5728\u652f\u6301\u5b57\u7b26\u4e32\uff08",(0,d.jsx)(n.code,{children:'"NHWC"'}),"\u3001",(0,d.jsx)(n.code,{children:'"NCHW"'}),"\uff09\u548cindex\u4e24\u79cd\u65b9\u5f0f\u4f5c\u4e3a ",(0,d.jsx)(n.code,{children:"input_layout"}),"\uff0c\u5e76\u4e14\u652f\u6301\u975e4D\u7684\u6570\u636e\u5904\u7406\u3002 \u5f53\u6309\u7167\u5b57\u7b26\u4e32\u5f62\u5f0f\u914d\u7f6e ",(0,d.jsx)(n.code,{children:"input_layout"}),"\u65f6\uff0c\u8868\u793a\u8f93\u5165\u6570\u636e\u7684layout\uff1b\u5f53\u6309\u7167index\u5f62\u5f0f\u914d\u7f6e",(0,d.jsx)(n.code,{children:"input_layout"}),"\u65f6\uff0c\u8868\u793a\u8f93\u5165\u6570\u636e\u4f1a\u6309\u7167\u5f53\u524d\u914d\u7f6e\u7684 ",(0,d.jsx)(n.code,{children:"input_layout"}),"\u8fdb\u884c\u6570\u636e\u8f6c\u7f6e\uff0c\u5373 ",(0,d.jsx)(n.code,{children:"input_layout"}),"\u4e3a ",(0,d.jsx)(n.code,{children:"Transpose"}),"\u7684 ",(0,d.jsx)(n.code,{children:"perm"}),"\u53c2\u6570\u3002"]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"image-20240722090529929",src:s(15891).A+"",width:"1036",height:"398"})}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.code,{children:"output_layout"}),"\u540c\u7406\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002"]}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.img,{alt:"image-20240722090551002",src:s(86116).A+"",width:"1020",height:"385"})}),"\n",(0,d.jsx)(n.h5,{id:"2212-\u52a8\u6001shape\u53c2\u6570\u8bf4\u660e",children:"2.2.1.2 \u52a8\u6001shape\u53c2\u6570\u8bf4\u660e"}),"\n",(0,d.jsx)(n.p,{children:"ShapeBucket\u662f\u9488\u5bf9\u52a8\u6001shape\u7684\u4e00\u79cd\u89e3\u51b3\u65b9\u6848\uff0c\u4f1a\u6839\u636e\u8f93\u5165\u957f\u5ea6\u7684\u8303\u56f4\u4ee5\u53ca\u6307\u5b9a\u7684\u6bb5\u7684\u6570\u91cf\u6765\u5bf9\u52a8\u6001shape\u8fdb\u884c\u4f18\u5316\u3002\u8be5\u529f\u80fd\u9ed8\u8ba4\u4e3afalse\uff0c\u9700\u8981\u6253\u5f00\u5bf9\u5e94\u7684option\u624d\u80fd\u751f\u6548\uff0c\u9664\u4e86\u6307\u5b9a\u5bf9\u5e94\u7684\u5b57\u6bb5\u4fe1\u606f\uff0c\u5176\u4ed6\u6d41\u7a0b\u4e0e\u7f16\u8bd1\u9759\u6001\u6a21\u578b\u6ca1\u6709\u533a\u522b\u3002"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"onnx"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u5728\u6a21\u578b\u7684shape\u4e2d\u4f1a\u6709\u4e9b\u7ef4\u5ea6\u4e3a\u53d8\u91cf\u540d\u5b57\uff0c\u8fd9\u91cc\u4ee5\u4e00\u4e2aonnx\u6a21\u578b\u7684\u8f93\u5165\u4e3a\u4f8b"}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"tokens: int64[batch_size, tgt_seq_len] step: float32[seq_len, batch_size]"}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["shape\u7684\u7ef4\u5ea6\u4fe1\u606f\u4e2d\u5b58\u5728seq_len\uff0ctgt_seq_len\uff0cbatch_size\u8fd9\u4e09\u4e2a\u53d8\u91cf\u3002 \u9996\u5148\u662fbatch_size\uff0c\u867d\u7136\u662f\u53d8\u91cf\u7684\u4f46\u5b9e\u9645\u5e94\u7528\u7684\u65f6\u5019\u56fa\u5b9a\u4e3a3\uff0c\u56e0\u6b64\u5728",(0,d.jsx)(n.strong,{children:"fix_var_map"}),"\u4e2d\u6dfb\u52a0batch_size = 3\uff0c\u5728\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u5c06\u8fd9\u4e2a\u7ef4\u5ea6\u56fa\u5b9a\u4e3a3\u3002 seq_len\uff0ctgt_seq_len\u4e24\u4e2a\u662f\u5b9e\u9645\u4f1a\u53d1\u751f\u6539\u53d8\u7684\uff0c\u56e0\u6b64\u9700\u8981\u914d\u7f6e\u8fd9\u4e24\u4e2a\u53d8\u91cf\u7684\u5b9e\u9645\u8303\u56f4\uff0c\u4e5f\u5c31\u662f",(0,d.jsx)(n.strong,{children:"range_info"}),"\u7684\u4fe1\u606f\u3002",(0,d.jsx)(n.strong,{children:"segments_count"}),"\u662f\u5b9e\u9645\u5206\u6bb5\u7684\u6570\u91cf\uff0c\u4f1a\u6839\u636e\u8303\u56f4\u7b49\u5206\u4e3a\u51e0\u4efd\uff0c\u5bf9\u5e94\u7684\u7f16\u8bd1\u65f6\u95f4\u4e5f\u4f1a\u76f8\u5e94\u589e\u52a0\u51e0\u500d\u3002"]}),"\n",(0,d.jsx)(n.p,{children:"\u4ee5\u4e0b\u4e3a\u5bf9\u5e94\u7684\u7f16\u8bd1\u53c2\u6570\u793a\u4f8b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'compile_options = nncase.CompileOptions()\ncompile_options.shape_bucket_enable = True\ncompile_options.shape_bucket_range_info = {"seq_len": [1, 100], "tgt_seq_len": [1, 100]}\ncompile_options.shape_bucket_segments_count = 2\ncompile_options.shape_bucket_fix_var_map = {"batch_size": 3}\n'})}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"tflite"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"tflite\u7684\u6a21\u578b\u4e0eonnx\u4e0d\u540c\uff0cshape\u4e0a\u6682\u672a\u6807\u6ce8\u7ef4\u5ea6\u7684\u540d\u79f0\uff0c\u76ee\u524d\u53ea\u652f\u6301\u8f93\u5165\u4e2d\u5177\u6709\u4e00\u4e2a\u7ef4\u5ea6\u662f\u52a8\u6001\u7684\uff0c\u5e76\u4e14\u540d\u79f0\u7edf\u4e00\u914d\u7f6e\u4e3a-1\uff0c\u914d\u7f6e\u65b9\u5f0f\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'compile_options = nncase.CompileOptions()\ncompile_options.shape_bucket_enable = True\ncompile_options.shape_bucket_range_info = {"-1":[1, 100]}\ncompile_options.shape_bucket_segments_count = 2\ncompile_options.shape_bucket_fix_var_map = {"batch_size" : 3}\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u914d\u7f6e\u5b8c\u8fd9\u4e9b\u9009\u9879\u540e\u6574\u4e2a\u7f16\u8bd1\u7684\u6d41\u7a0b\u548c\u9759\u6001shape\u4e00\u81f4\u3002"}),"\n",(0,d.jsx)(n.h5,{id:"2213-\u53c2\u6570\u914d\u7f6e\u793a\u4f8b",children:"2.2.1.3 \u53c2\u6570\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,d.jsx)(n.p,{children:"\u5b9e\u4f8b\u5316CompileOptions\uff0c\u914d\u7f6e\u5404\u5c5e\u6027\u7684\u503c\u3002"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'compile_options = nncase.CompileOptions()\n\ncompile_options.target = "cpu" #"k230"\ncompile_options.dump_ir = True  # if False, will not dump the compile-time result.\ncompile_options.dump_asm = True\ncompile_options.dump_dir = "dump_path"\ncompile_options.input_file = ""\n\n# preprocess args\ncompile_options.preprocess = False\nif compile_options.preprocess:\n    compile_options.input_type = "uint8"  # "uint8" "float32"\n    compile_options.input_shape = [1,224,320,3]\n    compile_options.input_range = [0,1]\n    compile_options.input_layout = "NHWC" # "NHWC" \u201dNCHW\u201c\n    compile_options.swapRB = False\n    compile_options.mean = [0,0,0]\n    compile_options.std = [1,1,1]\n    compile_options.letterbox_value = 0\n    compile_options.output_layout = "NHWC" # "NHWC" "NCHW"\n\n# Dynamic shape args\ncompile_options.shape_bucket_enable = False\nif compile_options.shape_bucket_enable:\n    compile_options.shape_bucket_range_info = {"seq_len": [1, 100], "tgt_seq_len": [1, 100]}\n    compile_options.shape_bucket_segments_count = 2\n    compile_options.shape_bucket_fix_var_map = {"batch_size": 3}\n'})}),"\n",(0,d.jsx)(n.h4,{id:"222-importoptions",children:"2.2.2 ImportOptions"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ImportOptions\u7c7b, \u7528\u4e8e\u914d\u7f6enncase\u5bfc\u5165\u9009\u9879"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"class ImportOptions:\n    def __init__(self) -> None:\n        pass\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u5b9e\u4f8b\u5316ImportOptions, \u914d\u7f6e\u5404\u5c5e\u6027\u7684\u503c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"#import_options\nimport_options = nncase.ImportOptions()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"223-ptqtensoroptions",children:"2.2.3 PTQTensorOptions"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"PTQTensorOptions\u7c7b, \u7528\u4e8e\u914d\u7f6enncase PTQ\u9009\u9879"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"calibrate_method"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"samples_count"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"finetune_weights_method"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"quant_type"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"w_quant_type"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"quant_scheme"}),(0,d.jsx)(n.td,{children:"string"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"quant_scheme_strict_mode"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"export_quant_scheme"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"export_weight_range_by_channel"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u5426"})]})]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u6df7\u5408\u91cf\u5316\u53c2\u6570\u8bf4\u660e","\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"quant_scheme\uff1a\u5bfc\u5165\u91cf\u5316\u53c2\u6570\u914d\u7f6e\u6587\u4ef6\u7684\u8def\u5f84"}),"\n",(0,d.jsx)(n.li,{children:"quant_scheme_strict_mode\uff1a\u662f\u5426\u4e25\u683c\u6309\u7167quant_scheme\u6267\u884c\u91cf\u5316"}),"\n",(0,d.jsx)(n.li,{children:"export_quant_scheme\uff1a\u662f\u5426\u5bfc\u51fa\u91cf\u5316\u53c2\u6570\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,d.jsxs)(n.li,{children:["export_weight_range_by_channel\uff1a\u662f\u5426\u5bfc\u51fa ",(0,d.jsx)(n.code,{children:"bychannel"}),"\u5f62\u5f0f\u7684weights\u91cf\u5316\u53c2\u6570\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u91cf\u5316\u6548\u679c\uff0c\u8be5\u53c2\u6570\u5efa\u8bae\u8bbe\u7f6e\u4e3a ",(0,d.jsx)(n.code,{children:"True"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.p,{children:["\u5177\u4f53\u4f7f\u7528\u6d41\u7a0b\u89c1 ",(0,d.jsx)(n.a,{href:"https://github.com/kendryte/nncase/blob/release/2.0/docs/MixQuant.md",children:"MixQuant\u8bf4\u660e"})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'# ptq_options\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 6\nptq_options.finetune_weights_method = "NoFineTuneWeights"\nptq_options.quant_type = "uint8"\nptq_options.w_quant_type = "uint8"\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n\nptq_options.quant_scheme = ""\nptq_options.quant_scheme_strict_mode = False\nptq_options.export_quant_scheme = True\nptq_options.export_weight_range_by_channel = True\n\ncompiler.use_ptq(ptq_options)\n'})}),"\n",(0,d.jsx)(n.h4,{id:"224-set_tensor_data",children:"2.2.4 set_tensor_data"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u8bbe\u7f6etensor\u6570\u636e"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"    def set_tensor_data(self, data: List[List[np.ndarray]]) -> None:\n        reshape_data = list(map(list, zip(*data)))\n        self.cali_data = [RuntimeTensor.from_numpy(\n            d) for d in itertools.chain.from_iterable(reshape_data)]\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"data"}),(0,d.jsx)(n.td,{children:"List[List[np.ndarray]"}),(0,d.jsx)(n.td,{children:"\u8bfb\u53d6\u7684\u6821\u51c6\u6570\u636e"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"# ptq_options\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 6\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\ncompiler.use_ptq(ptq_options)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"225-compiler",children:"2.2.5 Compiler"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"Compiler\u7c7b, \u7528\u4e8e\u7f16\u8bd1\u795e\u7ecf\u7f51\u7edc\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"class Compiler:\n    _target: _nncase.Target\n    _session: _nncase.CompileSession\n    _compiler: _nncase.Compiler\n    _compile_options: _nncase.CompileOptions\n    _quantize_options: _nncase.QuantizeOptions\n    _module: IRModule\n"})}),"\n",(0,d.jsx)(n.h4,{id:"226-import_tflite",children:"2.2.6 import_tflite"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u5bfc\u5165tflite\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'def import_tflite(self, model_content: bytes, options: ImportOptions) -> None:\n    self._compile_options.input_format = "tflite"\n    self._import_module(model_content)\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"model_content"}),(0,d.jsx)(n.td,{children:"byte[]"}),(0,d.jsx)(n.td,{children:"\u8bfb\u53d6\u7684\u6a21\u578b\u5185\u5bb9"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"import_options"}),(0,d.jsx)(n.td,{children:"ImportOptions"}),(0,d.jsx)(n.td,{children:"\u5bfc\u5165\u9009\u9879"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"model_content = read_model_file(model)\ncompiler.import_tflite(model_content, import_options)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"227-import_onnx",children:"2.2.7 import_onnx"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u5bfc\u5165onnx\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'def import_onnx(self, model_content: bytes, options: ImportOptions) -> None:\n    self._compile_options.input_format = "onnx"\n    self._import_module(model_content)\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"model_content"}),(0,d.jsx)(n.td,{children:"byte[]"}),(0,d.jsx)(n.td,{children:"\u8bfb\u53d6\u7684\u6a21\u578b\u5185\u5bb9"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"import_options"}),(0,d.jsx)(n.td,{children:"ImportOptions"}),(0,d.jsx)(n.td,{children:"\u5bfc\u5165\u9009\u9879"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"model_content = read_model_file(model)\ncompiler.import_onnx(model_content, import_options)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"228-use_ptq",children:"2.2.8 use_ptq"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u8bbe\u7f6ePTQ\u914d\u7f6e\u9009\u9879."}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"K230\u9ed8\u8ba4\u5fc5\u987b\u4f7f\u7528\u91cf\u5316\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"use_ptq(ptq_options)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ptq_options"}),(0,d.jsx)(n.td,{children:"PTQTensorOptions"}),(0,d.jsx)(n.td,{children:"PTQ\u914d\u7f6e\u9009\u9879"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"compiler.use_ptq(ptq_options)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"229-compile",children:"2.2.9 compile"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u7f16\u8bd1\u795e\u7ecf\u7f51\u7edc\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"compile()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"compiler.compile()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"2210-gencode_tobytes",children:"2.2.10 gencode_tobytes"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u751f\u6210kmodel\u5b57\u8282\u6d41"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"gencode_tobytes()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"bytes[]\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"kmodel = compiler.gencode_tobytes()\nwith open(os.path.join(infer_dir, 'test.kmodel'), 'wb') as f:\n    f.write(kmodel)\n"})}),"\n",(0,d.jsx)(n.h3,{id:"23-\u793a\u4f8b",children:"2.3 \u793a\u4f8b"}),"\n",(0,d.jsx)(n.p,{children:"\u4e0b\u9762\u793a\u4f8b\u4e2d\u4f7f\u7528\u5230\u7684\u6a21\u578b\u548cpython\u7f16\u8bd1\u811a\u672c"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u539f\u59cb\u6a21\u578b\u6587\u4ef6\u4f4d\u4e8e/path/to/k230_sdk/src/big/nncase/examples/models\u76ee\u5f55"}),"\n",(0,d.jsx)(n.li,{children:"python\u7f16\u8bd1\u811a\u672c\u4f4d\u4e8e/path/to/k230_sdk/src/big/nncase/examples/scripts\u76ee\u5f55"}),"\n"]}),"\n",(0,d.jsx)(n.h4,{id:"231-\u7f16\u8bd1tflite\u6a21\u578b",children:"2.3.1 \u7f16\u8bd1tflite\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"mbv2_tflite.py\u811a\u672c\u5982\u4e0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"import os\nimport argparse\nimport numpy as np\nfrom PIL import Image\nimport nncase\n\ndef read_model_file(model_file):\n    with open(model_file, 'rb') as f:\n        model_content = f.read()\n    return model_content\n\ndef generate_data(shape, batch, calib_dir):\n    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]\n    data = []\n    for i in range(batch):\n        assert i < len(img_paths), \"calibration images not enough.\"\n        img_data = Image.open(img_paths[i]).convert('RGB')\n        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)\n        img_data = np.asarray(img_data, dtype=np.uint8)\n        img_data = np.transpose(img_data, (2, 0, 1))\n        data.append([img_data[np.newaxis, ...]])\n    return data\n\ndef main():\n    parser = argparse.ArgumentParser(prog=\"nncase\")\n    parser.add_argument(\"--target\", type=str, help='target to run')\n    parser.add_argument(\"--model\", type=str, help='model file')\n    parser.add_argument(\"--dataset\", type=str, help='calibration_dataset')\n    args = parser.parse_args()\n\n    input_shape = [1, 3, 224, 224]\n    dump_dir = 'tmp/mbv2_tflite'\n\n    # compile_options\n    compile_options = nncase.CompileOptions()\n    compile_options.target = args.target\n    compile_options.preprocess = True\n    compile_options.swapRB = False\n    compile_options.input_shape = input_shape\n    compile_options.input_type = 'uint8'\n    compile_options.input_range = [0, 255]\n    compile_options.mean = [127.5, 127.5, 127.5]\n    compile_options.std = [127.5, 127.5, 127.5]\n    compile_options.input_layout = 'NCHW'\n    compile_options.dump_ir = True\n    compile_options.dump_asm = True\n    compile_options.dump_dir = dump_dir\n\n    # compiler\n    compiler = nncase.Compiler(compile_options)\n\n    # import\n    model_content = read_model_file(args.model)\n    import_options = nncase.ImportOptions()\n    compiler.import_tflite(model_content, import_options)\n\n    # ptq_options\n    ptq_options = nncase.PTQTensorOptions()\n    ptq_options.samples_count = 6\n    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n    compiler.use_ptq(ptq_options)\n\n    # compile\n    compiler.compile()\n\n    # kmodel\n    kmodel = compiler.gencode_tobytes()\n    with open(os.path.join(dump_dir, 'test.kmodel'), 'wb') as f:\n        f.write(kmodel)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u7f16\u8bd1mobilenetv2\u7684tflite\u6a21\u578b, target\u4e3ak230"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"root@c285a41a7243:/mnt/# cd src/big/nncase/examples\nroot@c285a41a7243:/mnt/src/big/nncase/examples# python3 ./scripts/mbv2_tflite.py --target k230 --model models/mbv2.tflite --dataset calibration_dataset\n"})}),"\n",(0,d.jsx)(n.h4,{id:"232-\u7f16\u8bd1onnx\u6a21\u578b",children:"2.3.2 \u7f16\u8bd1onnx\u6a21\u578b"}),"\n",(0,d.jsxs)(n.p,{children:["\u9488\u5bf9onnx\u6a21\u578b, \u5efa\u8bae\u5148\u4f7f\u7528",(0,d.jsx)(n.a,{href:"https://github.com/daquexian/onnx-simplifier",children:"ONNX Simplifier"}),"\u8fdb\u884c\u7b80\u5316, \u7136\u540e\u518d\u4f7f\u7528nncase\u7f16\u8bd1."]}),"\n",(0,d.jsx)(n.p,{children:"yolov5s_onnx.py \u811a\u672c\u5982\u4e0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"import os\nimport argparse\nimport numpy as np\nfrom PIL import Image\nimport onnxsim\nimport onnx\nimport nncase\n\ndef parse_model_input_output(model_file):\n    onnx_model = onnx.load(model_file)\n    input_all = [node.name for node in onnx_model.graph.input]\n    input_initializer = [node.name for node in onnx_model.graph.initializer]\n    input_names = list(set(input_all) - set(input_initializer))\n    input_tensors = [\n        node for node in onnx_model.graph.input if node.name in input_names]\n\n    # input\n    inputs = []\n    for _, e in enumerate(input_tensors):\n        onnx_type = e.type.tensor_type\n        input_dict = {}\n        input_dict['name'] = e.name\n        input_dict['dtype'] = onnx.mapping.TENSOR_TYPE_TO_NP_TYPE[onnx_type.elem_type]\n        input_dict['shape'] = [(i.dim_value if i.dim_value != 0 else d) for i, d in zip(\n            onnx_type.shape.dim, [1, 3, 224, 224])]\n        inputs.append(input_dict)\n\n    return onnx_model, inputs\n\n\ndef onnx_simplify(model_file, dump_dir):\n    onnx_model, inputs = parse_model_input_output(model_file)\n    onnx_model = onnx.shape_inference.infer_shapes(onnx_model)\n    input_shapes = {}\n    for input in inputs:\n        input_shapes[input['name']] = input['shape']\n\n    onnx_model, check = onnxsim.simplify(onnx_model, input_shapes=input_shapes)\n    assert check, \"Simplified ONNX model could not be validated\"\n\n    model_file = os.path.join(dump_dir, 'simplified.onnx')\n    onnx.save_model(onnx_model, model_file)\n    return model_file\n\n\ndef read_model_file(model_file):\n    with open(model_file, 'rb') as f:\n        model_content = f.read()\n    return model_content\n\ndef generate_data_ramdom(shape, batch):\n    data = []\n    for i in range(batch):\n        data.append([np.random.randint(0, 256, shape).astype(np.uint8)])\n    return data\n\n\ndef generate_data(shape, batch, calib_dir):\n    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]\n    data = []\n    for i in range(batch):\n        assert i < len(img_paths), \"calibration images not enough.\"\n        img_data = Image.open(img_paths[i]).convert('RGB')\n        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)\n        img_data = np.asarray(img_data, dtype=np.uint8)\n        img_data = np.transpose(img_data, (2, 0, 1))\n        data.append([img_data[np.newaxis, ...]])\n    return data\n\ndef main():\n    parser = argparse.ArgumentParser(prog=\"nncase\")\n    parser.add_argument(\"--target\", type=str, help='target to run')\n    parser.add_argument(\"--model\", type=str, help='model file')\n    parser.add_argument(\"--dataset\", type=str, help='calibration_dataset')\n\n    args = parser.parse_args()\n\n    input_shape = [1, 3, 320, 320]\n\n    dump_dir = 'tmp/yolov5s_onnx'\n    if not os.path.exists(dump_dir):\n        os.makedirs(dump_dir)\n\n    # onnx simplify\n    model_file = onnx_simplify(args.model, dump_dir)\n\n    # compile_options\n    compile_options = nncase.CompileOptions()\n    compile_options.target = args.target\n    compile_options.preprocess = True\n    compile_options.swapRB = False\n    compile_options.input_shape = input_shape\n    compile_options.input_type = 'uint8'\n    compile_options.input_range = [0, 255]\n    compile_options.mean = [0, 0, 0]\n    compile_options.std = [255, 255, 255]\n    compile_options.input_layout = 'NCHW'\n    compile_options.output_layout = 'NCHW'\n    compile_options.dump_ir = True\n    compile_options.dump_asm = True\n    compile_options.dump_dir = dump_dir\n\n    # compiler\n    compiler = nncase.Compiler(compile_options)\n\n    # import\n    model_content = read_model_file(model_file)\n    import_options = nncase.ImportOptions()\n    compiler.import_onnx(model_content, import_options)\n\n    # ptq_options\n    ptq_options = nncase.PTQTensorOptions()\n    ptq_options.samples_count = 6\n    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n    compiler.use_ptq(ptq_options)\n\n    # compile\n    compiler.compile()\n\n    # kmodel\n    kmodel = compiler.gencode_tobytes()\n    with open(os.path.join(dump_dir, 'test.kmodel'), 'wb') as f:\n        f.write(kmodel)\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u7f16\u8bd1onnx\u6a21\u578b, target\u4e3ak230"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"root@c285a41a7243:/mnt/# cd src/big/nncase/examples\nroot@c285a41a7243: /mnt/src/big/nncase/examples # python3 ./scripts/yolov5s_onnx.py --target k230 --model models/yolov5s.onnx --dataset calibration_dataset\n"})}),"\n",(0,d.jsx)(n.h2,{id:"3-\u6a21\u62df\u5668apispython",children:"3. \u6a21\u62df\u5668APIs(Python)"}),"\n",(0,d.jsx)(n.p,{children:"\u9664\u4e86\u7f16\u8bd1\u6a21\u578bAPIs, nncase\u8fd8\u63d0\u4f9b\u4e86\u63a8\u7406\u6a21\u578b\u7684APIs, \u5728PC\u4e0a\u53ef\u63a8\u7406\u7f16\u8bd1\u6a21\u578b\u751f\u6210\u7684kmodel, \u7528\u6765\u9a8c\u8bc1nncase\u63a8\u7406\u7ed3\u679c\u548c\u76f8\u5e94\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u7684runtime\u7684\u7ed3\u679c\u662f\u5426\u4e00\u81f4\u7b49."}),"\n",(0,d.jsx)(n.h3,{id:"31-apis",children:"3.1 APIs"}),"\n",(0,d.jsx)(n.h4,{id:"311-memoryrange",children:"3.1.1 MemoryRange"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"MemoryRange\u7c7b, \u7528\u4e8e\u8868\u793a\u5185\u5b58\u8303\u56f4"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'py::class_<memory_range>(m, "MemoryRange")\n    .def_readwrite("location", &memory_range::memory_location)\n    .def_property(\n        "dtype", [](const memory_range &range) { return to_dtype(range.datatype); },\n        [](memory_range &range, py::object dtype) { range.datatype = from_dtype(py::dtype::from_args(dtype)); })\n    .def_readwrite("start", &memory_range::start)\n    .def_readwrite("size", &memory_range::size);\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5c5e\u6027\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"location"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5185\u5b58\u4f4d\u7f6e, 0\u8868\u793ainput, 1\u8868\u793aoutput, 2\u8868\u793ardata, 3\u8868\u793adata, 4\u8868\u793ashared_data"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dtype"}),(0,d.jsx)(n.td,{children:"python\u6570\u636e\u7c7b\u578b"}),(0,d.jsx)(n.td,{children:"\u6570\u636e\u7c7b\u578b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"start"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5185\u5b58\u8d77\u59cb\u5730\u5740"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Size"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5185\u5b58\u5927\u5c0f"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"mr = nncase.MemoryRange()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"312-runtimetensor",children:"3.1.2 RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"RuntimeTensor\u7c7b, \u7528\u4e8e\u8868\u793a\u8fd0\u884c\u65f6tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'py::class_<runtime_tensor>(m, "RuntimeTensor")\n    .def_static("from_numpy", [](py::array arr) {\n        auto src_buffer = arr.request();\n        auto datatype = from_dtype(arr.dtype());\n        auto tensor = host_runtime_tensor::create(\n            datatype,\n            to_rt_shape(src_buffer.shape),\n            to_rt_strides(src_buffer.itemsize, src_buffer.strides),\n            gsl::make_span(reinterpret_cast<gsl::byte *>(src_buffer.ptr), src_buffer.size * src_buffer.itemsize),\n            [=](gsl::byte *) { arr.dec_ref(); })\n                          .unwrap_or_throw();\n        arr.inc_ref();\n        return tensor;\n    })\n    .def("copy_to", [](runtime_tensor &from, runtime_tensor &to) {\n        from.copy_to(to).unwrap_or_throw();\n    })\n    .def("to_numpy", [](runtime_tensor &tensor) {\n        auto host = tensor.as_host().unwrap_or_throw();\n        auto src_map = std::move(hrt::map(host, hrt::map_read).unwrap_or_throw());\n        auto src_buffer = src_map.buffer();\n        return py::array(\n            to_dtype(tensor.datatype()),\n            tensor.shape(),\n            to_py_strides(runtime::get_bytes(tensor.datatype()), tensor.strides()),\n            src_buffer.data());\n    })\n    .def_property_readonly("dtype", [](runtime_tensor &tensor) {\n        return to_dtype(tensor.datatype());\n    })\n    .def_property_readonly("shape", [](runtime_tensor &tensor) {\n        return to_py_shape(tensor.shape());\n    });\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5c5e\u6027\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dtype"}),(0,d.jsx)(n.td,{children:"python\u6570\u636e\u7c7b\u578b"}),(0,d.jsx)(n.td,{children:"Tensor\u7684\u6570\u636e\u7c7b\u578b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape"}),(0,d.jsx)(n.td,{children:"list"}),(0,d.jsx)(n.td,{children:"tensor\u7684\u5f62\u72b6"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"313-from_numpy",children:"3.1.3 from_numpy"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u4ecenumpy.ndarray\u6784\u9020RuntimeTensor\u5bf9\u8c61"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"from_numpy(py::array arr)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Arr"}),(0,d.jsx)(n.td,{children:"numpy.ndarray"}),(0,d.jsx)(n.td,{children:"numpy.ndarray\u5bf9\u8c61"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"tensor = nncase.RuntimeTensor.from_numpy(self.inputs[i]['data'])\n"})}),"\n",(0,d.jsx)(n.h4,{id:"314-copy_to",children:"3.1.4 copy_to"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u62f7\u8d1dRuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"copy_to(RuntimeTensor to)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"to"}),(0,d.jsx)(n.td,{children:"RuntimeTensor"}),(0,d.jsx)(n.td,{children:"RuntimeTensor\u5bf9\u8c61"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim.get_output_tensor(i).copy_to(to)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"315-to_numpy",children:"3.1.5 to_numpy"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u5c06RuntimeTensor\u8f6c\u6362\u4e3anumpy.ndarray\u5bf9\u8c61"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"to_numpy()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"numpy.ndarray\u5bf9\u8c61"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"arr = sim.get_output_tensor(i).to_numpy()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"316-simulator",children:"3.1.6 Simulator"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"Simulator\u7c7b, \u7528\u4e8e\u5728PC\u4e0a\u63a8\u7406kmodel"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'py::class_<interpreter>(m, "Simulator")\n    .def(py::init())\n    .def("load_model", [](interpreter &interp, gsl::span<const gsl::byte> buffer) { interp.load_model(buffer).unwrap_or_throw(); })\n    .def_property_readonly("inputs_size", &interpreter::inputs_size)\n    .def_property_readonly("outputs_size", &interpreter::outputs_size)\n    .def("get_input_desc", &interpreter::input_desc)\n    .def("get_output_desc", &interpreter::output_desc)\n    .def("get_input_tensor", [](interpreter &interp, size_t index) { return interp.input_tensor(index).unwrap_or_throw(); })\n    .def("set_input_tensor", [](interpreter &interp, size_t index, runtime_tensor tensor) { return interp.input_tensor(index, tensor).unwrap_or_throw(); })\n    .def("get_output_tensor", [](interpreter &interp, size_t index) { return interp.output_tensor(index).unwrap_or_throw(); })\n    .def("set_output_tensor", [](interpreter &interp, size_t index, runtime_tensor tensor) { return interp.output_tensor(index, tensor).unwrap_or_throw(); })\n    .def("run", [](interpreter &interp) { interp.run().unwrap_or_throw(); });\n'})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5c5e\u6027\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"inputs_size"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u4e2a\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"outputs_size"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u4e2a\u6570"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim = nncase.Simulator()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"317-load_model",children:"3.1.7 load_model"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u52a0\u8f7dkmodel"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"load_model(model_content)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"model_content"}),(0,d.jsx)(n.td,{children:"byte[]"}),(0,d.jsx)(n.td,{children:"kmodel\u5b57\u8282\u6d41"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim.load_model(kmodel)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"318-get_input_desc",children:"3.1.8 get_input_desc"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u5165\u7684\u63cf\u8ff0\u4fe1\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"get_input_desc(index)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"MemoryRange"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"input_desc_0 = sim.get_input_desc(0)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"319-get_output_desc",children:"3.1.9 get_output_desc"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u51fa\u7684\u63cf\u8ff0\u4fe1\u606f"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"get_output_desc(index)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"MemoryRange"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"output_desc_0 = sim.get_output_desc(0)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"3110-get_input_tensor",children:"3.1.10 get_input_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u5165\u7684RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"get_input_tensor(index)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165tensor\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"input_tensor_0 = sim.get_input_tensor(0)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"3111-set_input_tensor",children:"3.1.11 set_input_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u8bbe\u7f6e\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u5165\u7684RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"set_input_tensor(index, tensor)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165tensor\u7684\u7d22\u5f15"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tensor"}),(0,d.jsx)(n.td,{children:"RuntimeTensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165tensor"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(self.inputs[0]['data']))\n"})}),"\n",(0,d.jsx)(n.h4,{id:"3112-get_output_tensor",children:"3.1.12 get_output_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u51fa\u7684RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"get_output_tensor(index)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fatensor\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"output_arr_0 = sim.get_output_tensor(0).to_numpy()\n"})}),"\n",(0,d.jsx)(n.h4,{id:"3113-set_output_tensor",children:"3.1.13 set_output_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u8bbe\u7f6e\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u51fa\u7684RuntimeTensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"set_output_tensor(index, tensor)\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fatensor\u7684\u7d22\u5f15"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tensor"}),(0,d.jsx)(n.td,{children:"RuntimeTensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fatensor"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim.set_output_tensor(0, tensor)\n"})}),"\n",(0,d.jsx)(n.h4,{id:"3114-run",children:"3.1.14 run"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u8fd0\u884ckmodel\u63a8\u7406"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"run()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"sim.run()\n"})}),"\n",(0,d.jsx)(n.h3,{id:"32-\u793a\u4f8b",children:"3.2 \u793a\u4f8b"}),"\n",(0,d.jsxs)(n.p,{children:[(0,d.jsx)(n.strong,{children:"\u524d\u7f6e\u6761\u4ef6"}),": yolov5s_onnx.py\u811a\u672c\u5df2\u7f16\u8bd1\u8fc7yolov5s.onnx\u6a21\u578b"]}),"\n",(0,d.jsx)(n.p,{children:"yolov5s_onnx_simu.py\u4f4d\u4e8e/path/to/k230_sdk/src/big/nncase/examples/scripts\u5b50\u76ee\u5f55\uff0c \u5185\u5bb9\u5982\u4e0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"import os\nimport copy\nimport argparse\nimport numpy as np\nimport onnx\nimport onnxruntime as ort\nimport nncase\n\ndef read_model_file(model_file):\n    with open(model_file, 'rb') as f:\n        model_content = f.read()\n    return model_content\n\ndef cosine(gt, pred):\n    return (gt @ pred) / (np.linalg.norm(gt, 2) * np.linalg.norm(pred, 2))\n\ndef main():\n    parser = argparse.ArgumentParser(prog=\"nncase\")\n    parser.add_argument(\"--model\", type=str, help='original model file')\n    parser.add_argument(\"--model_input\", type=str, help='input bin file for original model')\n    parser.add_argument(\"--kmodel\", type=str, help='kmodel file')\n    parser.add_argument(\"--kmodel_input\", type=str, help='input bin file for kmodel')\n    args = parser.parse_args()\n\n    # cpu inference\n    ort_session = ort.InferenceSession(args.model)\n    output_names = []\n    model_outputs = ort_session.get_outputs()\n    for i in range(len(model_outputs)):\n        output_names.append(model_outputs[i].name)\n    model_input = ort_session.get_inputs()[0]\n    model_input_name = model_input.name\n    model_input_type = np.float32\n    model_input_shape = model_input.shape\n    model_input_data = np.fromfile(args.model_input, model_input_type).reshape(model_input_shape)\n    cpu_results = []\n    cpu_results = ort_session.run(output_names, { model_input_name : model_input_data })\n\n    # create simulator\n    sim = nncase.Simulator()\n\n    # read kmodel\n    kmodel = read_model_file(args.kmodel)\n\n    # load kmodel\n    sim.load_model(kmodel)\n\n    # read input.bin\n    # input_tensor=sim.get_input_tensor(0).to_numpy()\n    dtype = sim.get_input_desc(0).dtype\n    input = np.fromfile(args.kmodel_input, dtype).reshape([1, 3, 320, 320])\n\n    # set input for simulator\n    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(input))\n\n    # simulator inference\n    nncase_results = []\n    sim.run()\n    for i in range(sim.outputs_size):\n        nncase_result = sim.get_output_tensor(i).to_numpy()\n        nncase_results.append(copy.deepcopy(nncase_result))\n\n    # compare\n    for i in range(sim.outputs_size):\n        cos = cosine(np.reshape(nncase_results[i], (-1)), np.reshape(cpu_results[i], (-1)))\n        print('output {0} cosine similarity : {1}'.format(i, cos))\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884c\u63a8\u7406\u811a\u672c"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"root@5f718e19f8a7:/mnt/# cd src/big/nncase/examples\nroot@5f718e19f8a7:/mnt/src/big/nncase/examples # export PATH=$PATH:/usr/local/lib/python3.8/dist-packages/\nroot@5f718e19f8a7:/mnt/src/big/nncase/examples # python3 scripts/yolov5s_onnx_simu.py --model models/yolov5s.onnx --model_input object_detect/data/input_fp32.bin --kmodel tmp/yolov5s_onnx/test.kmodel --kmodel_input object_detect/data/input_uint8.bin\n"})}),"\n",(0,d.jsx)(n.p,{children:"nncase simulator\u548ccpu\u63a8\u7406\u7ed3\u679c\u5bf9\u6bd4\u5982\u4e0b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"output 0 cosine similarity : 0.9997244477272034\noutput 1 cosine similarity : 0.999757707118988\noutput 2 cosine similarity : 0.9997308850288391\n"})}),"\n",(0,d.jsx)(n.h2,{id:"4-kpu\u8fd0\u884c\u65f6apisc",children:"4. KPU\u8fd0\u884c\u65f6APIs(C++)"}),"\n",(0,d.jsx)(n.h3,{id:"41-\u7b80\u4ecb",children:"4.1 \u7b80\u4ecb"}),"\n",(0,d.jsx)(n.p,{children:"KPU\u8fd0\u884c\u65f6APIs\u7528\u4e8e\u5728AI\u8bbe\u5907\u52a0\u8f7dkmodel\uff0c\u8bbe\u7f6e\u8f93\u5165\u6570\u636e\uff0c\u6267\u884ckpu/cpu\u8ba1\u7b97\uff0c \u83b7\u53d6\u8f93\u51fa\u6570\u636e\u7b49."}),"\n",(0,d.jsx)(n.p,{children:"\u76ee\u524d\u53ea\u63d0\u4f9bC++ APIs, \u76f8\u5173\u7684\u5934\u6587\u4ef6\u548c\u9759\u6001\u5e93\u5728/path/to/k230_sdk/src/big/nncase/riscv64\u76ee\u5f55\u4e0b."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"$ tree -L 3 riscv64/\nriscv64/\n\u251c\u2500\u2500 gsl\n\u2502   \u2514\u2500\u2500 gsl-lite.hpp\n\u251c\u2500\u2500 nncase\n\u2502   \u251c\u2500\u2500 include\n\u2502   \u2502   \u2514\u2500\u2500 nncase\n\u2502   \u2514\u2500\u2500 lib\n\u2502       \u251c\u2500\u2500 cmake\n\u2502       \u251c\u2500\u2500 libfunctional_k230.a\n\u2502       \u251c\u2500\u2500 libnncase.rt_modules.k230.a\n\u2502       \u2514\u2500\u2500 libNncase.Runtime.Native.a\n\u2514\u2500\u2500 rvvlib\n    \u251c\u2500\u2500 include\n    \u2502   \u251c\u2500\u2500 k230_math.h\n    \u2502   \u251c\u2500\u2500 nms.h\n    \u2502   \u2514\u2500\u2500 rvv_math.h\n    \u2514\u2500\u2500 librvv.a\n\n8 directories, 8 files\n"})}),"\n",(0,d.jsx)(n.h3,{id:"42-apis",children:"4.2 APIs"}),"\n",(0,d.jsx)(n.h4,{id:"421-hrtcreate",children:"4.2.1 hrt::create"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u521b\u5efaruntime_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"(1) NNCASE_API result<runtime_tensor> create(typecode_t datatype, dims_t shape, memory_pool_t pool = pool_shared_first) noexcept;\n(2) NNCASE_API result<runtime_tensor> create(typecode_t datatype, dims_t shape, gsl::span<gsl::byte> data, bool copy,\n       memory_pool_t pool = pool_shared_first) noexcept;\n(3)NNCASE_API result<runtime_tensor>create(typecode_t datatype, dims_t shape, strides_t strides, gsl::span<gsl::byte> data, bool copy, memory_pool_t pool = pool_shared_first, uintptr_t physical_address = 0) noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"datatype"}),(0,d.jsx)(n.td,{children:"typecode_t"}),(0,d.jsx)(n.td,{children:"\u6570\u636e\u7c7b\u578b, \u5982dt_float32, dt_uint8\u7b49"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shape"}),(0,d.jsx)(n.td,{children:"dims_t"}),(0,d.jsx)(n.td,{children:"tensor\u7684\u5f62\u72b6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"data"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"gsl::span<gsl::byte>"})}),(0,d.jsx)(n.td,{children:"\u7528\u6237\u6001\u6570\u636ebuffer"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"copy"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u62f7\u8d1d"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"pool"}),(0,d.jsx)(n.td,{children:"memory_pool_t"}),(0,d.jsx)(n.td,{children:"\u5185\u5b58\u6c60\u7c7b\u578b, \u9ed8\u8ba4\u503c\u4e3apool_shared_first"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"physical_address"}),(0,d.jsx)(n.td,{children:"uintptr_t"}),(0,d.jsx)(n.td,{children:"\u7528\u6237\u6307\u5b9abuffer\u7684\u7269\u7406\u5730\u5740"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<runtime_tensor>\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'// create input tensor\nauto input_desc = interp.input_desc(0);\nauto input_shape = interp.input_shape(0);\nauto input_tensor = host_runtime_tensor::create(input_desc.datatype, input_shape, hrt::pool_shared).expect("cannot create input tensor");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"422-hrtsync",children:"4.2.2 hrt::sync"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u540c\u6b65tensor\u7684cache\u3002"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u5bf9\u7528\u6237\u7684\u8f93\u5165\u6570\u636e\uff0c \u9700\u8981\u8c03\u7528 \u6b64\u63a5\u53e3\u7684sync_write_back\u786e\u4fdd\u6570\u636e\u5df2\u5237\u5165ddr."}),"\n",(0,d.jsx)(n.li,{children:"\u5bf9gnne/ai2d\u8ba1\u7b97\u540e\u8f93\u51fa\u6570\u636e\uff0c\u9ed8\u8ba4gnne/ai2d runtime\u5df2\u505a\u4e86sync_invalidate\u5904\u7406\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"NNCASE_API result<void> sync(runtime_tensor &tensor, sync_op_t op, bool force = false) noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tensor"}),(0,d.jsx)(n.td,{children:"runtime_tensor"}),(0,d.jsx)(n.td,{children:"\u8981\u64cd\u4f5c\u7684tensor"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"op"}),(0,d.jsx)(n.td,{children:"sync_op_t"}),(0,d.jsx)(n.td,{children:"sync_invalidate(\u5c06tensor\u7684cache invalidate)\u6216sync_write_back(\u5c06tensor\u7684cache\u5199\u5165ddr)"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"force"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f3a\u5236\u6267\u884c"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void>\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("sync write_back failed");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"423-interpreterload_model",children:"4.2.3 interpreter::load_model"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u52a0\u8f7dkmodel\u6a21\u578b"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"NNCASE_NODISCARD result<void> load_model(gsl::span<const gsl::byte> buffer) noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"buffer"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"gsl::span <const gsl::byte>"})}),(0,d.jsx)(n.td,{children:"kmodel buffer"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void>\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'interpreter interp;\nauto model = read_binary_file<unsigned char>(kmodel);\ninterp.load_model({(const gsl::byte *)model.data(), model.size()}).expect("cannot load model.");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"424-interpreterinputs_size",children:"4.2.4 interpreter::inputs_size"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6a21\u578b\u8f93\u5165\u7684\u4e2a\u6570"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"size_t inputs_size() const noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"size_t\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"auto inputs_size = interp.inputs_size();\n"})}),"\n",(0,d.jsx)(n.h4,{id:"425-interpreteroutputs_size",children:"4.2.5 interpreter::outputs_size"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6a21\u578b\u8f93\u51fa\u7684\u4e2a\u6570"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"size_t outputs_size() const noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"size_t\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"auto outputs_size = interp.outputs_size();\n"})}),"\n",(0,d.jsx)(n.h4,{id:"426-interpreter-input_shape",children:"4.2.6 interpreter:: input_shape"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6a21\u578b\u6307\u5b9a\u8f93\u5165\u7684\u5f62\u72b6"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"const runtime_shape_t &input_shape(size_t index) const noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"size_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"runtime_shape_t\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"auto shape = interp.input_shape(0);\n"})}),"\n",(0,d.jsx)(n.h4,{id:"427-interpreter-output_shape",children:"4.2.7 interpreter:: output_shape"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6\u6a21\u578b\u6307\u5b9a\u8f93\u51fa\u7684\u5f62\u72b6"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"const runtime_shape_t &output_shape(size_t index) const noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsx)(n.tbody,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"size_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u7684\u7d22\u5f15"})]})})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"runtime_shape_t\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"auto shape = interp.output_shape(0);\n"})}),"\n",(0,d.jsx)(n.h4,{id:"428-interpreter-input_tensor",children:"4.2.8 interpreter:: input_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6/\u8bbe\u7f6e\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u5165 tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"(1) result<runtime_tensor> input_tensor(size_t index) noexcept;\n(2) result<void> input_tensor(size_t index, runtime_tensor tensor) noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"size_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u7684\u7d22\u5f15"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tensor"}),(0,d.jsx)(n.td,{children:"runtime_tensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u5bf9\u5e94\u7684runtime tensor"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'(1) result<runtime_tensor>\n(2) result<void>\n```cpp\n\n\u3010\u793a\u4f8b\u3011\n\n```cpp\n// set input\ninterp.input_tensor(0, input_tensor).expect("cannot set input tensor");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"429-interpreter-output_tensor",children:"4.2.9 interpreter:: output_tensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u83b7\u53d6/\u8bbe\u7f6e\u6307\u5b9a\u7d22\u5f15\u7684\u8f93\u51fatensor"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"(1) result<runtime_tensor> output_tensor(size_t index) noexcept;\n(2) result<void> output_tensor(size_t index, runtime_tensor tensor) noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"index"}),(0,d.jsx)(n.td,{children:"size_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u7684\u7d22\u5f15"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"tensor"}),(0,d.jsx)(n.td,{children:"runtime_tensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u5bf9\u5e94\u7684runtime tensor"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"(1) result<runtime_tensor>\n(2) result<void>\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'// get output\nauto output_tensor = interp.output_tensor(0).expect("cannot get output tensor");\n'})}),"\n",(0,d.jsx)(n.h4,{id:"4210-interpreter-run",children:"4.2.10 interpreter:: run"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u6267\u884ckpu\u8ba1\u7b97"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void> run() noexcept;\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsxs)(n.p,{children:["\u8fd4\u56de",(0,d.jsx)(n.code,{children:"result <void>"})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'// run\ninterp.run().expect("error occurred in running model");\n'})}),"\n",(0,d.jsx)(n.h3,{id:"43-\u793a\u4f8b",children:"4.3 \u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'#include <chrono>\n#include <fstream>\n#include <iostream>\n#include <nncase/runtime/interpreter.h>\n#include <nncase/runtime/runtime_op_utility.h>\n\n#define USE_OPENCV 1\n#define preprocess 1\n\n#if USE_OPENCV\n#include <opencv2/highgui.hpp>\n#include <opencv2/imgcodecs.hpp>\n#include <opencv2/imgproc.hpp>\n#endif\n\nusing namespace nncase;\nusing namespace nncase::runtime;\nusing namespace nncase::runtime::detail;\n\n#define INTPUT_HEIGHT 224\n#define INTPUT_WIDTH 224\n#define INTPUT_CHANNELS 3\n\ntemplate <class T>\nstd::vector<T> read_binary_file(const std::string &file_name)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    std::vector<T> vec(len / sizeof(T), 0);\n    ifs.seekg(0, ifs.beg);\n    ifs.read(reinterpret_cast<char *>(vec.data()), len);\n    ifs.close();\n    return vec;\n}\n\nvoid read_binary_file(const char *file_name, char *buffer)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    ifs.seekg(0, ifs.beg);\n    ifs.read(buffer, len);\n    ifs.close();\n}\n\nstatic std::vector<std::string> read_txt_file(const char *file_name)\n{\n    std::vector<std::string> vec;\n    vec.reserve(1024);\n\n    std::ifstream fp(file_name);\n    std::string label;\n\n    while (getline(fp, label))\n    {\n        vec.push_back(label);\n    }\n\n    return vec;\n}\n\ntemplate<typename T>\nstatic int softmax(const T* src, T* dst, int length)\n{\n    const T alpha = *std::max_element(src, src + length);\n    T denominator{ 0 };\n\n    for (int i = 0; i < length; ++i) {\n        dst[i] = std::exp(src[i] - alpha);\n        denominator += dst[i];\n    }\n\n    for (int i = 0; i < length; ++i) {\n        dst[i] /= denominator;\n    }\n\n    return 0;\n}\n\n#if USE_OPENCV\nstd::vector<uint8_t> hwc2chw(cv::Mat &img)\n{\n    std::vector<uint8_t> vec;\n    std::vector<cv::Mat> rgbChannels(3);\n    cv::split(img, rgbChannels);\n    for (auto i = 0; i < rgbChannels.size(); i++)\n    {\n        std::vector<uint8_t> data = std::vector<uint8_t>(rgbChannels[i].reshape(1, 1));\n        vec.insert(vec.end(), data.begin(), data.end());\n    }\n\n    return vec;\n}\n#endif\n\nstatic int inference(const char *kmodel_file, const char *image_file, const char *label_file)\n{\n    // load kmodel\n    interpreter interp;\n    \n    // \u4ece\u5185\u5b58\u52a0\u8f7dkmodel\n    auto kmodel = read_binary_file<unsigned char>(kmodel_file);\n    interp.load_model({ (const gsl::byte *)kmodel.data(), kmodel.size() }).expect("cannot load kmodel.");\n    // \u4ece\u6587\u4ef6\u6d41\u52a0\u8f7dkmodel\n    std::ifstream ifs(kmodel_file, std::ios::binary);\n    interp.load_model(ifs).expect("cannot load kmodel");\n    \n\n    // create input tensor\n    auto input_desc = interp.input_desc(0);\n    auto input_shape = interp.input_shape(0);\n    auto input_tensor = host_runtime_tensor::create(input_desc.datatype, input_shape, hrt::pool_shared).expect("cannot create input tensor");\n    interp.input_tensor(0, input_tensor).expect("cannot set input tensor");\n\n    // create output tensor\n    // auto output_desc = interp.output_desc(0);\n    // auto output_shape = interp.output_shape(0);\n    // auto output_tensor = host_runtime_tensor::create(output_desc.datatype, output_shape, hrt::pool_shared).expect("cannot create output tensor");\n    // interp.output_tensor(0, output_tensor).expect("cannot set output tensor");\n\n    // set input data\n    auto dst = input_tensor.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();\n#if USE_OPENCV\n    cv::Mat img = cv::imread(image_file);\n    cv::resize(img, img, cv::Size(INTPUT_WIDTH, INTPUT_HEIGHT), cv::INTER_NEAREST);\n    auto input_vec = hwc2chw(img);\n    memcpy(reinterpret_cast<char *>(dst.data()), input_vec.data(), input_vec.size());\n#else\n    read_binary_file(image_file, reinterpret_cast<char *>(dst.data()));\n#endif\n    hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect("sync write_back failed");\n\n    // run\n    size_t counter = 1;\n    auto start = std::chrono::steady_clock::now();\n    for (size_t c = 0; c < counter; c++)\n    {\n        interp.run().expect("error occurred in running model");\n    }\n    auto stop = std::chrono::steady_clock::now();\n    double duration = std::chrono::duration<double, std::milli>(stop - start).count();\n    std::cout << "interp.run() took: " << duration / counter << " ms" << std::endl;\n\n    // get output data\n    auto output_tensor = interp.output_tensor(0).expect("cannot set output tensor");\n    dst = output_tensor.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n    float *output_data = reinterpret_cast<float *>(dst.data());\n    auto out_shape = interp.output_shape(0);\n    auto size = compute_size(out_shape);\n\n    // postprogress softmax by cpu\n    std::vector<float> softmax_vec(size, 0);\n    auto buf = softmax_vec.data();\n    softmax(output_data, buf, size);\n    auto it = std::max_element(buf, buf + size);\n    size_t idx = it - buf;\n\n    // load label\n    auto labels = read_txt_file(label_file);\n    std::cout << "image classify result: " << labels[idx] << "(" << *it << ")" << std::endl;\n\n    return 0;\n}\n\nint main(int argc, char *argv[])\n{\n    std::cout << "case " << argv[0] << " built at " << __DATE__ << " " << __TIME__ << std::endl;\n    if (argc != 4)\n    {\n        std::cerr << "Usage: " << argv[0] << " <kmodel> <image> <label>" << std::endl;\n        return -1;\n    }\n\n    int ret = inference(argv[1], argv[2], argv[3]);\n    if (ret)\n    {\n        std::cerr << "inference failed: ret = " << ret << std::endl;\n        return -2;\n    }\n\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(n.h2,{id:"5-ai2d-\u8fd0\u884c\u65f6apisc",children:"5. AI2D \u8fd0\u884c\u65f6APIs(C++)"}),"\n",(0,d.jsx)(n.h3,{id:"51-\u7b80\u4ecb",children:"5.1 \u7b80\u4ecb"}),"\n",(0,d.jsxs)(n.p,{children:["AI2D\u8fd0\u884c\u65f6APIs\u7528\u4e8e\u5728AI\u8bbe\u5907\u914d\u7f6eAI2D\u7684\u53c2\u6570\uff0c\u751f\u6210\u76f8\u5173\u5bc4\u5b58\u5668\u914d\u7f6e\uff0c\u6267\u884cAI2D\u8ba1\u7b97\u7b49\u3002\u8bf7\u5728\u4f7f\u7528\u524d\u9605\u8bfb\u6700\u540e\u4e00\u90e8\u5206",(0,d.jsx)(n.a,{href:"https://developer.canaan-creative.com/k230/zh/dev/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.html#id24",children:"\u6ce8\u610f\u4e8b\u9879"}),"\u3002"]}),"\n",(0,d.jsx)(n.h4,{id:"511-\u652f\u6301\u7684\u683c\u5f0f\u8f6c\u6362",children:"5.1.1 \u652f\u6301\u7684\u683c\u5f0f\u8f6c\u6362"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u8f93\u5165\u683c\u5f0f"}),(0,d.jsx)(n.th,{children:"\u8f93\u51fa\u683c\u5f0f"}),(0,d.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"YUV420_NV12"}),(0,d.jsx)(n.td,{children:"RGB_planar/YUV420_NV12"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"YUV420_NV21"}),(0,d.jsx)(n.td,{children:"RGB_planar/YUV420_NV21"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"YUV420_I420"}),(0,d.jsx)(n.td,{children:"RGB_planar/YUV420_I420"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"YUV400"}),(0,d.jsx)(n.td,{children:"YUV400"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"NCHW(RGB_planar)"}),(0,d.jsx)(n.td,{children:"NCHW(RGB_planar)"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RGB_packed"}),(0,d.jsx)(n.td,{children:"RGB_planar/RGB_packed"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"RAW16"}),(0,d.jsx)(n.td,{children:"RAW16/8"}),(0,d.jsx)(n.td,{children:"\u6df1\u5ea6\u56fe\uff0c\u6267\u884cshift\u64cd\u4f5c"})]})]})]}),"\n",(0,d.jsx)(n.h4,{id:"512-\u529f\u80fd\u63cf\u8ff0",children:"5.1.2 \u529f\u80fd\u63cf\u8ff0"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u529f\u80fd"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"}),(0,d.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u4eff\u5c04\u53d8\u6362"}),(0,d.jsx)(n.td,{children:"\u652f\u6301\u8f93\u5165\u683c\u5f0fYUV420\u3001YUV400\u3001RGB\uff08planar/packed\uff09 \u652f\u6301\u6df1\u5ea6\u56feRAW16\u683c\u5f0f \u652f\u6301\u8f93\u51fa\u683c\u5f0fYUV400\u3001RGB\u3001\u6df1\u5ea6\u56fe"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Crop/Resize/Padding"}),(0,d.jsx)(n.td,{children:"\u652f\u6301\u8f93\u5165YUV420\u3001YUV400\u3001RGB \u652f\u6301\u6df1\u5ea6\u56feRAW16\u683c\u5f0f Resize\u652f\u6301\u4e2d\u95f4NCHW\u7684\u6392\u5217\u683c\u5f0f \u652f\u6301\u8f93\u51fa\u683c\u5f0fYUV420\u3001YUV400\u3001RGB"}),(0,d.jsx)(n.td,{children:"\u53ea\u652f\u6301padding\u5e38\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Shift"}),(0,d.jsx)(n.td,{children:"\u652f\u6301\u8f93\u5165\u683c\u5f0fRaw16 \u652f\u6301\u8f93\u51fa\u683c\u5f0fRaw8"}),(0,d.jsx)(n.td,{})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u7b26\u53f7\u4f4d"}),(0,d.jsx)(n.td,{children:"\u652f\u6301\u6709\u7b26\u53f7\u548c\u65e0\u7b26\u53f7\u8f93\u5165"}),(0,d.jsx)(n.td,{})]})]})]}),"\n",(0,d.jsx)(n.h3,{id:"52-apis",children:"5.2 APIs"}),"\n",(0,d.jsx)(n.h4,{id:"521-ai2d_format",children:"5.2.1 ai2d_format"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_format\u7528\u4e8e\u914d\u7f6e\u8f93\u5165\u8f93\u51fa\u7684\u53ef\u9009\u6570\u636e\u683c\u5f0f."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"enum class ai2d_format\n{\n    YUV420_NV12 = 0,\n    YUV420_NV21 = 1,\n    YUV420_I420 = 2,\n    NCHW_FMT = 3,\n    RGB_packed = 4,\n    RAW16 = 5,\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"522-ai2d_interp_method",children:"5.2.2 ai2d_interp_method"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_interp_method\u7528\u4e8e\u914d\u7f6e\u53ef\u9009\u7684\u63d2\u503c\u65b9\u5f0f."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:" enum class ai2d_interp_method\n{\n    tf_nearest = 0,\n    tf_bilinear = 1,\n    cv2_nearest = 2,\n    cv2_bilinear = 3,\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"523-ai2d_interp_mode",children:"5.2.3 ai2d_interp_mode"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_interp_mode \u7528\u4e8e\u914d\u7f6e\u53ef\u9009\u7684\u63d2\u503c\u6a21\u5f0f."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"enum class ai2d_interp_mode\n{\n    none = 0,\n    align_corner = 1,\n    half_pixel = 2,\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"524-ai2d_pad_mode",children:"5.2.4 ai2d_pad_mode"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_pad_mode\u7528\u4e8e\u914d\u7f6e\u53ef\u9009\u7684padding\u6a21\u5f0f\uff0c \u76ee\u524d\u53ea\u652f\u6301\u5e38\u6570padding."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"enum class ai2d_pad_mode\n{\n    constant = 0,\n    copy = 1,\n    mirror = 2,\n}\n"})}),"\n",(0,d.jsx)(n.h4,{id:"525-ai2d_datatype_t",children:"5.2.5 ai2d_datatype_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_datatype_t \u7528\u4e8e\u8bbe\u7f6eAI2D\u8ba1\u7b97\u8fc7\u7a0b\u4e2d\u7684\u6570\u636e\u7c7b\u578b."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_datatype_t\n{\n    ai2d_format src_format;\n    ai2d_format dst_format;\n    datatype_t src_type;\n    datatype_t dst_type;\n    ai2d_data_loc src_loc = ai2d_data_loc::ddr;\n    ai2d_data_loc dst_loc = ai2d_data_loc::ddr;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"src_format"}),(0,d.jsx)(n.td,{children:"ai2d_format"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u6570\u636e\u683c\u5f0f"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dst_format"}),(0,d.jsx)(n.td,{children:"ai2d_format"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u6570\u636e\u683c\u5f0f"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"src_type"}),(0,d.jsx)(n.td,{children:"datatype_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u6570\u636e\u7c7b\u578b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dst_type"}),(0,d.jsx)(n.td,{children:"datatype_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u6570\u636e\u7c7b\u578b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"src_loc"}),(0,d.jsx)(n.td,{children:"ai2d_data_loc"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u6570\u636e\u4f4d\u7f6e\uff0c\u9ed8\u8ba4ddr"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"dst_loc"}),(0,d.jsx)(n.td,{children:"ai2d_data_loc"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u6570\u636e\u4f4d\u7f6e\uff0c\u9ed8\u8ba4ddr"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_datatype_t ai2d_dtype { ai2d_format::RAW16, ai2d_format::NCHW_FMT, datatype_t::dt_uint16, datatype_t::dt_uint8 };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"526-ai2d_crop_param_t",children:"5.2.6 ai2d_crop_param_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_crop_param_t\u7528\u4e8e\u914d\u7f6ecrop\u76f8\u5173\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_crop_param_t\n{\n    bool crop_flag = false;\n    int32_t start_x = 0;\n    int32_t start_y = 0;\n    int32_t width = 0;\n    int32_t height = 0;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"crop_flag"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f00\u542fcrop\u529f\u80fd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"start_x"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5bbd\u5ea6\u65b9\u5411\u7684\u8d77\u59cb\u50cf\u7d20"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"start_y"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u9ad8\u5ea6\u65b9\u5411\u7684\u8d77\u59cb\u50cf\u7d20"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"width"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u5bbd\u5ea6\u65b9\u5411\u7684crop\u957f\u5ea6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"height"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u9ad8\u5ea6\u65b9\u5411\u7684crop\u957f\u5ea6"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_crop_param_t crop_param { true, 40, 30, 400, 600 };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"527-ai2d_shift_param_t",children:"5.2.7 ai2d_shift_param_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_shift_param_t\u7528\u4e8e\u914d\u7f6eshift\u76f8\u5173\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_shift_param_t\n{\n    bool shift_flag = false;\n    int32_t shift_val = 0;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shift_flag"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f00\u542fshift\u529f\u80fd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shift_val"}),(0,d.jsx)(n.td,{children:"int"}),(0,d.jsx)(n.td,{children:"\u53f3\u79fb\u7684\u6bd4\u7279\u6570"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_shift_param_t shift_param { true, 2 };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"528-ai2d_pad_param_t",children:"5.2.8 ai2d_pad_param_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_pad_param_t \u7528\u4e8e\u914d\u7f6epad\u76f8\u5173\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_pad_param_t\n{\n    bool pad_flag = false;\n    runtime_paddings_t paddings;\n    ai2d_pad_mode pad_mode = ai2d_pad_mode::constant;\n    std::vector<int32_t> pad_val; // by channel\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"pad_flag"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f00\u542fpad\u529f\u80fd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"paddings"}),(0,d.jsx)(n.td,{children:"runtime_paddings_t"}),(0,d.jsxs)(n.td,{children:["\u5404\u4e2a\u7ef4\u5ea6\u7684padding, shape=",(0,d.jsx)(n.code,{children:"[4, 2]"}),"\uff0c\u5206\u522b\u8868\u793adim0\u5230dim4\u7684\u524d\u540epadding\u7684\u4e2a\u6570\uff0c\u5176\u4e2ddim0/dim1\u56fa\u5b9a\u914d\u7f6e",0]})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"pad_mode"}),(0,d.jsx)(n.td,{children:"ai2d_pad_mode"}),(0,d.jsx)(n.td,{children:"padding\u6a21\u5f0f\uff0c\u53ea\u652f\u6301constant padding"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"pad_val"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"std::vector<int32_t>"})}),(0,d.jsx)(n.td,{children:"\u6bcf\u4e2achannel\u7684padding value"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_pad_param_t pad_param { false, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 60, 60 } }, ai2d_pad_mode::constant, { 255 } };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"529-ai2d_resize_param_t",children:"5.2.9 ai2d_resize_param_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_resize_param_t \u7528\u4e8e\u914d\u7f6eresize\u76f8\u5173\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_resize_param_t\n{\n    bool resize_flag = false;\n    ai2d_interp_method interp_method = ai2d_interp_method::tf_bilinear;\n    ai2d_interp_mode interp_mode = ai2d_interp_mode::none;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"resize_flag"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f00\u542fresize\u529f\u80fd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"interp_method"}),(0,d.jsx)(n.td,{children:"ai2d_interp_method"}),(0,d.jsx)(n.td,{children:"resize\u63d2\u503c\u65b9\u6cd5"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"interp_mode"}),(0,d.jsx)(n.td,{children:"ai2d_interp_mode"}),(0,d.jsx)(n.td,{children:"resize\u6a21\u5f0f"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_resize_param_t resize_param { true, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"5210-ai2d_affine_param_t",children:"5.2.10 ai2d_affine_param_t"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_affine_param_t \u7528\u4e8e\u914d\u7f6eaffine\u76f8\u5173\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"struct ai2d_affine_param_t\n{\n    bool affine_flag = false;\n    ai2d_interp_method interp_method = ai2d_interp_method::cv2_bilinear;\n    uint32_t cord_round = 0;\n    uint32_t bound_ind = 0;\n    int32_t bound_val = 0;\n    uint32_t bound_smooth = 0;\n    std::vector<float> M;\n}\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"affine_flag"}),(0,d.jsx)(n.td,{children:"bool"}),(0,d.jsx)(n.td,{children:"\u662f\u5426\u5f00\u542faffine\u529f\u80fd"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"interp_method"}),(0,d.jsx)(n.td,{children:"ai2d_interp_method"}),(0,d.jsx)(n.td,{children:"Affine\u91c7\u7528\u7684\u63d2\u503c\u65b9\u6cd5"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"cord_round"}),(0,d.jsx)(n.td,{children:"uint32_t"}),(0,d.jsx)(n.td,{children:"\u6574\u6570\u8fb9\u754c0\u6216\u80051"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"bound_ind"}),(0,d.jsx)(n.td,{children:"uint32_t"}),(0,d.jsx)(n.td,{children:"\u8fb9\u754c\u50cf\u7d20\u6a21\u5f0f0\u6216\u80051"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"bound_val"}),(0,d.jsx)(n.td,{children:"uint32_t"}),(0,d.jsx)(n.td,{children:"\u8fb9\u754c\u586b\u5145\u503c"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"bound_smooth"}),(0,d.jsx)(n.td,{children:"uint32_t"}),(0,d.jsx)(n.td,{children:"\u8fb9\u754c\u5e73\u6ed10\u6216\u80051"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"M"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"std::vector<float>"})}),(0,d.jsxs)(n.td,{children:["\u4eff\u5c04\u53d8\u6362\u77e9\u9635\u5bf9\u5e94\u7684vector\uff0c\u4eff\u5c04\u53d8\u6362\u4e3a$",(0,d.jsx)(n.code,{children:"Y=[a_0, a_1; a_2, a_3] \\cdot X + [b_0, b_1] $, \u5219 $ M={a_0,a_1,b_0,a_2,a_3,b_1} "}),"$"]})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_affine_param_t affine_param { true, ai2d_interp_method::cv2_bilinear, 0, 0, 127, 1, { 0.5, 0.1, 0.0, 0.1, 0.5, 0.0 } };\n"})}),"\n",(0,d.jsx)(n.h4,{id:"5211-ai2d_builder-ai2d_builder",children:"5.2.11 ai2d_builder:: ai2d_builder"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"ai2d_builder\u7684\u6784\u9020\u51fd\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_builder(dims_t &input_shape, dims_t &output_shape, ai2d_datatype_t ai2d_dtype, ai2d_crop_param_t crop_param, ai2d_shift_param_t shift_param, ai2d_pad_param_t pad_param, ai2d_resize_param_t resize_param, ai2d_affine_param_t affine_param);\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input_shape"}),(0,d.jsx)(n.td,{children:"dims_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165\u5f62\u72b6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"output_shape"}),(0,d.jsx)(n.td,{children:"dims_t"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fa\u5f62\u72b6"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"ai2d_dtype"}),(0,d.jsx)(n.td,{children:"ai2d_datatype_t"}),(0,d.jsx)(n.td,{children:"ai2d\u6570\u636e\u7c7b\u578b"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"crop_param"}),(0,d.jsx)(n.td,{children:"ai2d_crop_param_t"}),(0,d.jsx)(n.td,{children:"crop\u76f8\u5173\u53c2\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"shift_param"}),(0,d.jsx)(n.td,{children:"ai2d_shift_param_t"}),(0,d.jsx)(n.td,{children:"shift\u76f8\u5173\u53c2\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"pad_param"}),(0,d.jsx)(n.td,{children:"ai2d_pad_param_t"}),(0,d.jsx)(n.td,{children:"pad\u76f8\u5173\u53c2\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"resize_param"}),(0,d.jsx)(n.td,{children:"ai2d_resize_param_t"}),(0,d.jsx)(n.td,{children:"resize\u76f8\u5173\u53c2\u6570"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"affine_param"}),(0,d.jsx)(n.td,{children:"ai2d_affine_param_t"}),(0,d.jsx)(n.td,{children:"affine\u76f8\u5173\u53c2\u6570"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c \u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"dims_t in_shape { 1, ai2d_input_c_, ai2d_input_h_, ai2d_input_w_ };          \nauto out_span = ai2d_out_tensor_.shape();                                    \ndims_t out_shape { out_span.begin(), out_span.end() };                       \nai2d_datatype_t ai2d_dtype { ai2d_format::NCHW_FMT, ai2d_format::NCHW_FMT, typecode_t::dt_uint8, typecode_t::dt_uint8 };\nai2d_crop_param_t crop_param { false, 0, 0, 0, 0 };                          \nai2d_shift_param_t shift_param { false, 0 };                                 \nai2d_pad_param_t pad_param { true, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 70, 70 } }, ai2d_pad_mode::constant, { 0, 0, 0 } };\nai2d_resize_param_t resize_param { true, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };\nai2d_affine_param_t affine_param { false };                                  \nai2d_builder_.reset(new ai2d_builder(in_shape, out_shape, ai2d_dtype, crop_param, shift_param, pad_param, resize_param, affine_param));\n"})}),"\n",(0,d.jsx)(n.h4,{id:"5212-ai2d_builder-build_schedule",children:"5.2.12 ai2d_builder:: build_schedule"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u751f\u6210AI2D\u8ba1\u7b97\u9700\u8981\u7684\u53c2\u6570."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void> build_schedule();\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void>\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"ai2d_builder_->build_schedule();\n"})}),"\n",(0,d.jsx)(n.h4,{id:"5213-ai2d_builder-invoke",children:"5.2.13 ai2d_builder:: invoke"}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u63cf\u8ff0\u3011"}),"\n",(0,d.jsx)(n.p,{children:"\u914d\u7f6e\u5bc4\u5b58\u5668\u5e76\u542f\u52a8AI2D\u7684\u8ba1\u7b97."}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u5b9a\u4e49\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:"result<void> invoke(runtime_tensor &input, runtime_tensor &output);\n"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u53c2\u6570\u3011"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u540d\u79f0"}),(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"input"}),(0,d.jsx)(n.td,{children:"runtime_tensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u5165tensor"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"output"}),(0,d.jsx)(n.td,{children:"runtime_tensor"}),(0,d.jsx)(n.td,{children:"\u8f93\u51fatensor"})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u8fd4\u56de\u503c \u3011"}),"\n",(0,d.jsx)(n.p,{children:(0,d.jsx)(n.code,{children:"result<void>"})}),"\n",(0,d.jsx)(n.p,{children:"\u3010\u793a\u4f8b\u3011"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'// run ai2d                                                                  \nai2d_builder_->invoke(ai2d_in_tensor, ai2d_out_tensor_).expect("error occurred in ai2d running");\n'})}),"\n",(0,d.jsx)(n.h3,{id:"53-\u793a\u4f8b",children:"5.3 \u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{children:'static void test_pad_mini_test(const char *gmodel_file, const char *expect_file)\n{\n    // input tensor\n    dims_t in_shape { 1, 100, 150, 3 };\n    auto in_tensor = host_runtime_tensor::create(dt_uint8, in_shape, hrt::pool_shared).expect("cannot create input tensor");\n    auto mapped_in_buf = std::move(hrt::map(in_tensor, map_access_t::map_write).unwrap());\n    read_binary_file(gmodel_file, reinterpret_cast<char *>(mapped_in_buf.buffer().data()));\n    mapped_in_buf.unmap().expect("unmap input tensor failed");\n    hrt::sync(in_tensor, sync_op_t::sync_write_back, true).expect("write back input failed");\n\n    // output tensor\n    dims_t out_shape { 1, 100, 160, 3 };\n    auto out_tensor = host_runtime_tensor::create(dt_uint8, out_shape, hrt::pool_shared).expect("cannot create output tensor");\n\n    // config ai2d\n    ai2d_datatype_t ai2d_dtype { ai2d_format::RGB_packed, ai2d_format::RGB_packed, dt_uint8, dt_uint8 };\n    ai2d_crop_param_t crop_param { false, 0, 0, 0, 0 };\n    ai2d_shift_param_t shift_param { false, 0 };\n    ai2d_pad_param_t pad_param { true, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 10, 0 } }, ai2d_pad_mode::constant, { 255, 10, 5 } };\n    ai2d_resize_param_t resize_param { false, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };\n    ai2d_affine_param_t affine_param { false };\n\n    // run\n    ai2d_builder builder { in_shape, out_shape, ai2d_dtype, crop_param, shift_param, pad_param, resize_param, affine_param };\n    auto start = std::chrono::steady_clock::now();\n    builder.build_schedule().expect("error occurred in ai2d build_schedule");\n    builder.invoke(in_tensor, out_tensor).expect("error occurred in ai2d invoke");\n    auto stop = std::chrono::steady_clock::now();\n    double duration = std::chrono::duration<double, std::milli>(stop - start).count();\n    std::cout << "ai2d run: duration = " << duration << " ms, fps = " << 1000 / duration << std::endl;\n\n    // compare\n    auto mapped_out_buf = std::move(hrt::map(out_tensor, map_access_t::map_read).unwrap());\n    auto actual = mapped_out_buf.buffer().data();\n    auto expected = read_binary_file<unsigned char>(expect_file);\n    int ret = memcmp(reinterpret_cast<void *>(actual), reinterpret_cast<void *>(expected.data()), expected.size());\n    if (!ret)\n    {\n        std::cout << "compare output succeed!" << std::endl;\n    }\n    else\n    {\n        auto cos = cosine(reinterpret_cast<const uint8_t *>(actual), reinterpret_cast<const uint8_t *>(expected.data()), expected.size());\n        std::cerr << "compare output failed: cosine similarity = " << cos << std::endl;\n    }\n}\n'})}),"\n",(0,d.jsx)(n.h3,{id:"54-\u6ce8\u610f\u4e8b\u9879",children:"5.4 \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"Affine\u548cResize\u529f\u80fd\u662f\u4e92\u65a5\u7684\uff0c\u4e0d\u80fd\u540c\u65f6\u5f00\u542f"}),"\n",(0,d.jsx)(n.li,{children:"Shift\u529f\u80fd\u7684\u8f93\u5165\u683c\u5f0f\u53ea\u80fd\u662fRaw16"}),"\n",(0,d.jsx)(n.li,{children:"Pad value\u662f\u6309\u901a\u9053\u914d\u7f6e\u7684\uff0c\u5bf9\u5e94\u7684list\u5143\u7d20\u4e2a\u6570\u8981\u4e0echannel\u6570\u76f8\u7b49"}),"\n",(0,d.jsx)(n.li,{children:"\u5f53\u524d\u7248\u672c\u4e2d\uff0c\u5f53\u53ea\u9700\u8981AI2D\u7684\u4e00\u4e2a\u529f\u80fd\u65f6\uff0c\u5176\u4ed6\u53c2\u6570\u4e5f\u9700\u8981\u914d\u7f6e\uff0cflag\u7f6e\u4e3afalse\u5373\u53ef\uff0c\u5176\u4ed6\u5b57\u6bb5\u4e0d\u7528\u914d\u7f6e\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u5f53\u914d\u7f6e\u4e86\u591a\u4e2a\u529f\u80fd\u65f6\uff0c\u6267\u884c\u987a\u5e8f\u662fCrop->Shift->Resize/Affine->Pad, \u914d\u7f6e\u53c2\u6570\u65f6\u6ce8\u610f\u8981\u5339\u914d\u3002"}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(o,{...e})}):o(e)}},30293:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/185762ac17039d6c4961faa2fba0d66e-70391ad602c2659081de0c06ff3ae6d1.png"},13085:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/image-20240722090355852-9079f93d3141fb6f5e57ce93a48d2fc5.png"},46699:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/image-20240722090502269-61285da6cf7adec94861a7d29e48a815.png"},15891:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/image-20240722090529929-e8dbffbcc063a6fbbe94570fe9d9a98c.png"},86116:(e,n,s)=>{s.d(n,{A:()=>d});const d=s.p+"assets/images/image-20240722090551002-73a7795449dcd6a9003b2398e3bd60d5.png"},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var d=s(96540);const r={},t=d.createContext(r);function i(e){const n=d.useContext(t);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),d.createElement(t.Provider,{value:n},e.children)}}}]);