"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6739],{39383:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var r=i(74848),s=i(28453);const t={sidebar_position:5},a="4.ramdisk\u4f7f\u7528\u8bf4\u660e",o={id:"CanaanK230/part5/ramdiskinstructionsforuse",title:"4.ramdisk\u4f7f\u7528\u8bf4\u660e",description:"1. \u8bf4\u660e",source:"@site/docs/CanaanK230/part5/05_ramdiskinstructionsforuse.md",sourceDirName:"CanaanK230/part5",slug:"/CanaanK230/part5/ramdiskinstructionsforuse",permalink:"/docs/CanaanK230/part5/ramdiskinstructionsforuse",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part5/05_ramdiskinstructionsforuse.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"canaanK230Sidebar",previous:{title:"3.nncase_runtime\u6a21\u5757",permalink:"/docs/CanaanK230/part5/nncase_runtimemodule"},next:{title:"AI Demo\u8bf4\u660e\u6587\u6863",permalink:"/docs/CanaanK230/part5/AIDemodocumentation"}},d={},c=[{value:"1. \u8bf4\u660e",id:"1-\u8bf4\u660e",level:2},{value:"2. \u4e3b\u8981\u811a\u672c\u4ecb\u7ecd",id:"2-\u4e3b\u8981\u811a\u672c\u4ecb\u7ecd",level:2},{value:"2.1initramfs\u751f\u6210\u811a\u672c",id:"21initramfs\u751f\u6210\u811a\u672c",level:3},{value:"2.2\u8bbe\u5907\u6811\u5173\u4e8einitramfs\u4fee\u6539",id:"22\u8bbe\u5907\u6811\u5173\u4e8einitramfs\u4fee\u6539",level:3},{value:"3.\u9a8c\u8bc1",id:"3\u9a8c\u8bc1",level:2},{value:"4.\u53c2\u8003\u8d44\u6599",id:"4\u53c2\u8003\u8d44\u6599",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"4ramdisk\u4f7f\u7528\u8bf4\u660e",children:"4.ramdisk\u4f7f\u7528\u8bf4\u660e"})}),"\n",(0,r.jsx)(n.h2,{id:"1-\u8bf4\u660e",children:"1. \u8bf4\u660e"}),"\n",(0,r.jsxs)(n.p,{children:["canmv\u7684rtt\u5927\u6838\u4f7f\u7528sd\u5361\u5b58\u50a8micopython\u7a0b\u5e8f\uff0c\u5c0f\u6838linux\u6839\u6587\u4ef6\u7cfb\u7edf\u4f7f\u7528initramfs\u683c\u5f0f\u3002initramfs \u662f\u4e00\u79cd\u5185\u5b58\u4e2d\u7684",(0,r.jsx)(n.a,{href:"https://www.zhihu.com/search?q=%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2947632316%7D",children:"\u6587\u4ef6\u7cfb\u7edf"}),"\uff0c\u7528\u4e8e\u5728 Linux \u5185\u6838\u542f\u52a8\u65f6\u63d0\u4f9b\u4e00\u4e2a",(0,r.jsx)(n.a,{href:"https://www.zhihu.com/search?q=%E8%BD%BB%E9%87%8F%E7%BA%A7&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2947632316%7D",children:"\u8f7b\u91cf\u7ea7"}),"\u7684\u4e34\u65f6",(0,r.jsx)(n.a,{href:"https://www.zhihu.com/search?q=%E6%A0%B9%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2947632316%7D",children:"\u6839\u6587\u4ef6\u7cfb\u7edf"}),"\uff0c\u4ee5\u4fbf\u80fd\u591f\u5728\u6839\u6587\u4ef6\u7cfb\u7edf\u53ef\u7528\u4e4b\u524d\u6267\u884c\u4e00\u4e9b\u5fc5\u8981\u7684\u64cd\u4f5c\u3002initramfs \u901a\u5e38\u4f7f\u7528 cpio \u5de5\u5177\u521b\u5efa\u6210\u4e00\u4e2a cpio ",(0,r.jsx)(n.a,{href:"https://www.zhihu.com/search?q=%E5%BD%92%E6%A1%A3%E6%96%87%E4%BB%B6&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22%3A%22answer%22%2C%22sourceId%22%3A2947632316%7D",children:"\u5f52\u6863\u6587\u4ef6"}),"\uff0cLinux \u5185\u6838\u4f1a\u8bfb\u53d6\u8be5\u6587\u4ef6\u5e76\u5c06\u5176\u89e3\u538b\u7f29\u5230\u5185\u5b58\u4e2d\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"ramdisk\u57fa\u672c\u88abinitramfs\u53d6\u4ee3\uff0c\u56e0\u4e3aramdisk\u9700\u8981ext2\u7b49\u6587\u4ef6\u7cfb\u7edf\u652f\u6301\uff0c\u5b98\u65b9\u539f\u56e0\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"initrd usually functions as a block device, and compiling it into the kernel requires a file system driver such as ext2, ext3, or ext4."}),"\n",(0,r.jsx)(n.p,{children:"For the kernel to successfully detect the file system of initrd, it must have at least one built-in module available."}),"\n",(0,r.jsx)(n.p,{children:"All of the common operations of reading and writing on an initrd image are buffered inefficiently to our system\u2019s main memory because the initrd disk has a fixed size."}),"\n",(0,r.jsx)(n.p,{children:"NOTE: initrd was deprecated and replaced by initramfs."}),"\n",(0,r.jsx)(n.h2,{id:"2-\u4e3b\u8981\u811a\u672c\u4ecb\u7ecd",children:"2. \u4e3b\u8981\u811a\u672c\u4ecb\u7ecd"}),"\n",(0,r.jsx)(n.h3,{id:"21initramfs\u751f\u6210\u811a\u672c",children:"2.1initramfs\u751f\u6210\u811a\u672c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"#\u8be6\u89c1tools/mkcpio-rootfs.sh  \ncat tools/mkcpio-rootfs.sh \n#!/bin/bash\n\nfind . | cpio -o -H newc > ../rootfs-final.cpio\ngzip -f ../rootfs-final.cpio\n"})}),"\n",(0,r.jsx)(n.h3,{id:"22\u8bbe\u5907\u6811\u5173\u4e8einitramfs\u4fee\u6539",children:"2.2\u8bbe\u5907\u6811\u5173\u4e8einitramfs\u4fee\u6539"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'#k230_sdk_overlay/board/common/gen_image_script/gen_image.sh\nROOTFS_BASE="${RAMDISK_ADDR}"\nROOTFS_SIZE=`ls -lt rootfs-final.cpio.gz | awk \'{print $5}\'`\n((ROOTFS_END= $ROOTFS_BASE + $ROOTFS_SIZE))\nROOTFS_END=`printf "0x%x" $ROOTFS_END`\nsed -i "s/linux,initrd-end = <0x0 .*/linux,initrd-end = <0x0 $ROOTFS_END>;/g" hw/k230.dts.txt\n#linux,initrd-start = <0x0 0xa100000>;\nsed -i "s/linux,initrd-start = <0x0 .*/linux,initrd-start = <0x0  $ROOTFS_BASE>;/g" hw/k230.dts.txt\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'chosen {\n        bootargs = "console=ttyS0,115200  crashkernel=256M-:128M earlycon=sbi";\n        stdout-path = "/soc/serial@91400000:115200";\n        linux,initrd-start = <0x00 0xa100000>;\n        linux,initrd-end = <0x00 0xaa8b186>;\n};\n'})}),"\n",(0,r.jsx)(n.h2,{id:"3\u9a8c\u8bc1",children:"3.\u9a8c\u8bc1"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"#mount\n rootfs on / type rootfs (rw,size=48000k,nr_inodes=12000)\n devtmpfs on /dev type devtmpfs (rw,relatime,size=48000k,nr_inodes=12000,mode=755)\n proc on /proc type proc (rw,relatime)\n devpts on /dev/pts type devpts (rw,relatime,gid=5,mode=620,ptmxmode=666)\n tmpfs on /dev/shm type tmpfs (rw,relatime,mode=777)\n tmpfs on /tmp type tmpfs (rw,relatime)\n tmpfs on /run type tmpfs (rw,nosuid,nodev,relatime,mode=755)\n sysfs on /sys type sysfs (rw,relatime)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u51fa\u6839\u6587\u4ef6\u7cfb\u7edf\u4e0d\u662fext4\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"4\u53c2\u8003\u8d44\u6599",children:"4.\u53c2\u8003\u8d44\u6599"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.zhihu.com/question/558974598/answer/2712616024",children:"https://www.zhihu.com/question/558974598/answer/2712616024"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.baeldung.com/linux/initrd-vs-initramfs",children:"https://www.baeldung.com/linux/initrd-vs-initramfs"})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>o});var r=i(96540);const s={},t=r.createContext(s);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);