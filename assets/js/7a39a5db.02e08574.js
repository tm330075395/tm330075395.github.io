"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1931],{10856:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>o,toc:()=>l});var s=i(74848),t=i(28453);const r={sidebar_position:6},d="6.\u6df1\u5165\u89e3\u6790AI\u5f00\u53d1\u6d41\u7a0b",o={id:"CanaanK230/part4/In-depthanalysisoftheAIdevelopmentprocess",title:"6.\u6df1\u5165\u89e3\u6790AI\u5f00\u53d1\u6d41\u7a0b",description:"\u672c\u7ae0\u6559\u5b66\u89c6\u9891\uff1a\u52d8\u667aK230\u5f00\u53d1\u677f\u6559\u7a0b-\u6df1\u5165\u89e3\u6790AI\u5f00\u53d1\u6d41\u7a0b\u54d4\u54e9\u54d4\u54e9bilibili",source:"@site/docs/CanaanK230/part4/06-In-depthanalysisoftheAIdevelopmentprocess.md",sourceDirName:"CanaanK230/part4",slug:"/CanaanK230/part4/In-depthanalysisoftheAIdevelopmentprocess",permalink:"/docs/CanaanK230/part4/In-depthanalysisoftheAIdevelopmentprocess",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part4/06-In-depthanalysisoftheAIdevelopmentprocess.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"canaanK230Sidebar",previous:{title:"5. \u5feb\u901f\u5165\u95e8k230 AI\u63a8\u7406\u6d41\u7a0b",permalink:"/docs/CanaanK230/part4/Getstartedquicklyk230AIInferenceflow"},next:{title:"7. \u5f00\u53d1\u5de5\u5177\u7b80\u4ecb",permalink:"/docs/CanaanK230/part4/Introductiontodevelopmenttools"}},c={},l=[{value:"6.1 \u6982\u8ff0",id:"61-\u6982\u8ff0",level:2},{value:"1.\u5e38\u89c4AI\u5f00\u53d1\u6d41\u7a0b",id:"1\u5e38\u89c4ai\u5f00\u53d1\u6d41\u7a0b",level:3},{value:"2.\u57fa\u4e8eK230\u7684AI\u5f00\u53d1\u6d41\u7a0b",id:"2\u57fa\u4e8ek230\u7684ai\u5f00\u53d1\u6d41\u7a0b",level:3},{value:"6.2 \u73af\u5883\u642d\u5efa",id:"62-\u73af\u5883\u642d\u5efa",level:2},{value:"6.2.1 \u5feb\u901f\u4e0a\u624b",id:"621-\u5feb\u901f\u4e0a\u624b",level:3},{value:"6.2.1.1 CanMV-K230\u63a5\u53e3\u8bf4\u660e",id:"6211-canmv-k230\u63a5\u53e3\u8bf4\u660e",level:4},{value:"6.2.1.2 CanMV-K230\u8fde\u63a5\u793a\u4f8b",id:"6212-canmv-k230\u8fde\u63a5\u793a\u4f8b",level:4},{value:"6.2.1.3 \u955c\u50cf\u70e7\u5f55",id:"6213-\u955c\u50cf\u70e7\u5f55",level:4},{value:"6.2.1.4 \u4e32\u53e3\u9a71\u52a8\u5b89\u88c5\u53ca\u4e0a\u7535\u9a8c\u8bc1",id:"6214-\u4e32\u53e3\u9a71\u52a8\u5b89\u88c5\u53ca\u4e0a\u7535\u9a8c\u8bc1",level:4},{value:"6.2.1.5 \u4e32\u53e3\u8c03\u8bd5",id:"6215-\u4e32\u53e3\u8c03\u8bd5",level:4},{value:"6.2.2 \u7f16\u8bd1\u73af\u5883\u642d\u5efa",id:"622-\u7f16\u8bd1\u73af\u5883\u642d\u5efa",level:3},{value:"6.2.2.1 docker\u5bb9\u5668\u6784\u5efa",id:"6221-docker\u5bb9\u5668\u6784\u5efa",level:4},{value:"6.2.2.2 nncase\u5b89\u88c5",id:"6222-nncase\u5b89\u88c5",level:4},{value:"6.3 demo\u6784\u5efa\u6d41\u7a0b\u89e3\u6790",id:"63-demo\u6784\u5efa\u6d41\u7a0b\u89e3\u6790",level:2},{value:"6.3.1 \u4eba\u8138\u68c0\u6d4bdemo",id:"631-\u4eba\u8138\u68c0\u6d4bdemo",level:3},{value:"6.3.1.1 PyTorch\u5230ONNX\u8f6c\u6362",id:"6311-pytorch\u5230onnx\u8f6c\u6362",level:4},{value:"6.3.1.2 \u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406",id:"6312-\u4f7f\u7528onnxruntime\u8fdb\u884c\u63a8\u7406",level:4},{value:"6.3.1.2.1 \u8bfb\u53d6\u56fe\u50cf",id:"63121-\u8bfb\u53d6\u56fe\u50cf",level:5},{value:"6.3.1.2.2 \u56fe\u50cf\u9884\u5904\u7406",id:"63122-\u56fe\u50cf\u9884\u5904\u7406",level:5},{value:"6.3.1.2.3 onnx run",id:"63123-onnx-run",level:5},{value:"6.3.1.2.4 \u540e\u5904\u7406",id:"63124-\u540e\u5904\u7406",level:5},{value:"6.3.1.2.5 \u663e\u793a\u7ed3\u679c",id:"63125-\u663e\u793a\u7ed3\u679c",level:5},{value:"6.3.1.2.6 \u7f16\u8bd1\u6267\u884c",id:"63126-\u7f16\u8bd1\u6267\u884c",level:5},{value:"6.3.1.3 ONNX\u5230kmodel\u8f6c\u6362",id:"6313-onnx\u5230kmodel\u8f6c\u6362",level:4},{value:"6.3.1.3.1 \u914d\u7f6e\u751f\u6210kmodel\u53c2\u6570",id:"63131-\u914d\u7f6e\u751f\u6210kmodel\u53c2\u6570",level:5},{value:"1.\u7f16\u8bd1\u53c2\u6570\uff1aCompileOptions",id:"1\u7f16\u8bd1\u53c2\u6570compileoptions",level:6},{value:"2.\u5bfc\u5165\u53c2\u6570\uff1aImportOptions",id:"2\u5bfc\u5165\u53c2\u6570importoptions",level:6},{value:"3.\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570\uff1aPTQTensorOptions",id:"3\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570ptqtensoroptions",level:6},{value:"6.3.1.3.2 \u6821\u6b63\u96c6\u51c6\u5907",id:"63132-\u6821\u6b63\u96c6\u51c6\u5907",level:5},{value:"6.3.1.3.3 \u751f\u6210kmodel",id:"63133-\u751f\u6210kmodel",level:5},{value:"6.3.1.4 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406",id:"6314-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",level:4},{value:"6.3.1.4.1 \u4f7f\u7528Simulator\u9a8c\u8bc1kmodel",id:"63141-\u4f7f\u7528simulator\u9a8c\u8bc1kmodel",level:5},{value:"1.\u751f\u6210input.bin",id:"1\u751f\u6210inputbin",level:6},{value:"2.Simulator\u9a8c\u8bc1",id:"2simulator\u9a8c\u8bc1",level:6},{value:"6.3.1.4.2 \u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",id:"63142-\u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",level:5},{value:"6.3.1.4.3 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406",id:"63143-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",level:5},{value:"1.\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27",id:"1\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27",level:6},{value:"2.\u9884\u5904\u7406",id:"2\u9884\u5904\u7406",level:6},{value:"3.kmodel run",id:"3kmodel-run",level:6},{value:"4.\u540e\u5904\u7406",id:"4\u540e\u5904\u7406",level:6},{value:"5.\u663e\u793a\u7ed3\u679c",id:"5\u663e\u793a\u7ed3\u679c",level:6},{value:"6.\u7f16\u8bd1\u3001\u6267\u884c",id:"6\u7f16\u8bd1\u6267\u884c",level:6},{value:"6.3.2 \u4eba\u8138\u8bc6\u522bdemo",id:"632-\u4eba\u8138\u8bc6\u522bdemo",level:3},{value:"6.3.2.1 PyTorch\u5230ONNX\u8f6c\u6362",id:"6321-pytorch\u5230onnx\u8f6c\u6362",level:4},{value:"6.3.2.2 \u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406",id:"6322-\u4f7f\u7528onnxruntime\u8fdb\u884c\u63a8\u7406",level:4},{value:"6.3.2.2.1 \u4eba\u8138\u5bf9\u9f50",id:"63221-\u4eba\u8138\u5bf9\u9f50",level:5},{value:"6.3.2.2.2 \u56fe\u50cf\u9884\u5904\u7406",id:"63222-\u56fe\u50cf\u9884\u5904\u7406",level:5},{value:"6.3.1.2.3 onnx run",id:"63123-onnx-run-1",level:5},{value:"6.3.1.2.4 \u540e\u5904\u7406",id:"63124-\u540e\u5904\u7406-1",level:5},{value:"6.3.1.2.5 \u4eba\u8138\u5bf9\u6bd4\u7ed3\u679c",id:"63125-\u4eba\u8138\u5bf9\u6bd4\u7ed3\u679c",level:5},{value:"6.3.2.3 ONNX\u5230kmodel\u8f6c\u6362",id:"6323-onnx\u5230kmodel\u8f6c\u6362",level:4},{value:"6.3.2.3.1 \u914d\u7f6ekmodel\u751f\u6210\u53c2\u6570",id:"63231-\u914d\u7f6ekmodel\u751f\u6210\u53c2\u6570",level:5},{value:"1.\u7f16\u8bd1\u53c2\u6570\uff1aCompileOptions",id:"1\u7f16\u8bd1\u53c2\u6570compileoptions-1",level:6},{value:"2.\u5bfc\u5165\u53c2\u6570\uff1aImportOptions",id:"2\u5bfc\u5165\u53c2\u6570importoptions-1",level:6},{value:"3.\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570\uff1aPTQTensorOptions",id:"3\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570ptqtensoroptions-1",level:6},{value:"6.3.2.3.2 \u6821\u6b63\u96c6\u51c6\u5907",id:"63232-\u6821\u6b63\u96c6\u51c6\u5907",level:5},{value:"6.3.2.3.3 \u751f\u6210kmodel",id:"63233-\u751f\u6210kmodel",level:5},{value:"6.3.2.4 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406",id:"6324-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",level:4},{value:"6.3.2.4.1 Simulator\u9a8c\u8bc1kmodel",id:"63241-simulator\u9a8c\u8bc1kmodel",level:5},{value:"1.\u751f\u6210input.bin",id:"1\u751f\u6210inputbin-1",level:6},{value:"2.Simulator\u9a8c\u8bc1",id:"2simulator\u9a8c\u8bc1-1",level:6},{value:"6.3.2.4.2 \u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",id:"63242-\u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",level:5},{value:"6.3.2.4.3 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406",id:"63243-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",level:5},{value:"1.\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27",id:"1\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27-1",level:6},{value:"2.\u9884\u5904\u7406",id:"2\u9884\u5904\u7406-1",level:6},{value:"3.kmodel run",id:"3kmodel-run-1",level:6},{value:"4.\u540e\u5904\u7406",id:"4\u540e\u5904\u7406-1",level:6},{value:"5.\u663e\u793a\u7ed3\u679c",id:"5\u663e\u793a\u7ed3\u679c-1",level:6},{value:"6.\u7f16\u8bd1\u3001\u6267\u884c",id:"6\u7f16\u8bd1\u6267\u884c-1",level:6},{value:"6.4 \u5e38\u7528\u8c03\u8bd5\u6280\u5de7",id:"64-\u5e38\u7528\u8c03\u8bd5\u6280\u5de7",level:2},{value:"6.4.1 \u6280\u5de7\u4e00\uff1atarget = \u2018cpu\u2019",id:"641-\u6280\u5de7\u4e00target--cpu",level:3},{value:"6.4.2 \u6280\u5de7\u4e8c\uff1aint16\u91cf\u5316",id:"642-\u6280\u5de7\u4e8cint16\u91cf\u5316",level:3},{value:"6.4.3 \u6280\u5de7\u4e09\uff1ainput.bin\u751f\u6210",id:"643-\u6280\u5de7\u4e09inputbin\u751f\u6210",level:3}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"6\u6df1\u5165\u89e3\u6790ai\u5f00\u53d1\u6d41\u7a0b",children:"6.\u6df1\u5165\u89e3\u6790AI\u5f00\u53d1\u6d41\u7a0b"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["\u672c\u7ae0\u6559\u5b66\u89c6\u9891\uff1a",(0,s.jsx)(e.a,{href:"https://www.bilibili.com/video/BV1um411k7qd/?spm_id_from=333.999.0.0&vd_source=44017c249f4b4c572672eb7cd1c45d17",children:"\u52d8\u667aK230\u5f00\u53d1\u677f\u6559\u7a0b-\u6df1\u5165\u89e3\u6790AI\u5f00\u53d1\u6d41\u7a0b_\u54d4\u54e9\u54d4\u54e9_bilibili"})]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"61-\u6982\u8ff0",children:"6.1 \u6982\u8ff0"}),"\n",(0,s.jsx)(e.h3,{id:"1\u5e38\u89c4ai\u5f00\u53d1\u6d41\u7a0b",children:"1.\u5e38\u89c4AI\u5f00\u53d1\u6d41\u7a0b"}),"\n",(0,s.jsxs)(e.p,{children:["AI\u5f00\u53d1\u6d41\u7a0b\u53ef\u5206\u4e3a",(0,s.jsx)(e.strong,{children:"\u8bad\u7ec3\u8fed\u4ee3"}),"\u548c",(0,s.jsx)(e.strong,{children:"\u90e8\u7f72\u4e0a\u7ebf"}),"\u4e24\u4e2a\u65b9\u9762\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u8bad\u7ec3\u8fed\u4ee3"}),"\uff0c\u5373\u4ece\u9009\u5b9a\u7279\u5b9a\u6570\u636e\u96c6\u3001\u6a21\u578b\u7ed3\u6784\u3001\u635f\u5931\u51fd\u6570\u548c\u8bc4\u4ef7\u6307\u6807\u5165\u624b\uff0c\u901a\u8fc7\u6a21\u578b\u53c2\u6570\u7684\u4e0d\u65ad\u4f18\u5316\uff0c\u81f4\u529b\u4e8e\u5b9e\u73b0\u5c3d\u53ef\u80fd\u63a5\u8fd1\u6216\u8d85\u8d8a\u9886\u57df\u5185\u6700\u5148\u8fdb\u6280\u672f\uff08SOTA\uff09\u7684\u7ed3\u679c\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u90e8\u7f72\u4e0a\u7ebf"}),"\uff0c\u5373\u628a\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u5728\u7279\u5b9a\u73af\u5883\u4e2d\u63a8\u7406\u8fd0\u884c\u7684\u8fc7\u7a0b\uff0c\u66f4\u591a\u5173\u6ce8\u4e8e\u90e8\u7f72\u573a\u666f\u3001\u90e8\u7f72\u65b9\u5f0f\u3001\u541e\u5410\u7387\u548c\u5ef6\u8fdf\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"AI\u6a21\u578b\u901a\u5e38\u901a\u8fc7PyTorch\u3001TensorFlow\u3001\u98de\u6868\u7b49\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u8bad\u7ec3\u5b8c\u6210\uff0c\u4f46\u76f4\u63a5\u4f7f\u7528\u8bad\u7ec3\u6a21\u578b\u63a8\u7406\u6709\u4e24\u4e2a\u95ee\u9898\uff1a\u76f4\u63a5\u901a\u8fc7\u8fd9\u4e9b\u6a21\u578b\u6765\u8fdb\u884c\u63a8\u7406\u9700\u8981\u4f9d\u8d56\u8fd9\u4e9b\u8bad\u7ec3\u6846\u67b6\uff0c\u7528\u8d77\u6765\u6bd4\u8f83\u590d\u6742\uff1b\u4e0d\u540c\u7684\u786c\u4ef6\u7684\u5bf9\u7b97\u5b50\u7684\u5e95\u5c42\u4f18\u5316\u65b9\u5f0f\u53ef\u80fd\u4e0d\u540c\uff0c\u76f8\u540c\u6a21\u578b\u8fd0\u884c\u5728\u4e0d\u540c\u786c\u4ef6\u4e0a\u6548\u7387\u5e76\u4e0d\u9ad8\uff0c\u7279\u522b\u662f\u5bf9\u5ef6\u65f6\u8981\u6c42\u4e25\u683c\u7684\u7ebf\u4e0a\u573a\u666f\uff1b\u7531\u6b64\uff0c\u7ecf\u8fc7\u5de5\u4e1a\u754c\u548c\u5b66\u672f\u754c\u6570\u5e74\u7684\u63a2\u7d22\uff0cAI\u5f00\u53d1\u6d41\u7a0b\u6709\u4e86\u4e00\u6761\u4e3b\u6d41\u7684\u6d41\u6c34\u7ebf\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240228110135631",src:i(46648).A+"",width:"532",height:"310"})}),"\n",(0,s.jsxs)(e.p,{children:["\u8fd9\u4e00\u6761\u6d41\u6c34\u7ebf\u89e3\u51b3\u4e86\u6a21\u578b\u90e8\u7f72\u4e2d\u7684\u4e24\u5927\u95ee\u9898\uff1a\u4f7f\u7528\u5bf9\u63a5\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u548c\u63a8\u7406\u5f15\u64ce\u7684",(0,s.jsx)(e.strong,{children:"\u4e2d\u95f4\u8868\u793a"}),"\uff0c\u5f00\u53d1\u8005\u4e0d\u5fc5\u62c5\u5fc3\u5982\u4f55\u5728\u65b0\u73af\u5883\u4e2d\u8fd0\u884c\u5404\u4e2a\u590d\u6742\u7684\u6846\u67b6\uff1b\u901a\u8fc7\u4e2d\u95f4\u8868\u793a\u7684\u7f51\u7edc\u7ed3\u6784\u4f18\u5316\u3001\u63a8\u7406\u5f15\u64ce\u5bf9\u8fd0\u7b97\u7684\u5e95\u5c42\u4f18\u5316\uff0c\u6a21\u578b\u7684\u8fd0\u7b97\u6548\u7387\u5927\u5e45\u63d0\u5347\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"2\u57fa\u4e8ek230\u7684ai\u5f00\u53d1\u6d41\u7a0b",children:"2.\u57fa\u4e8eK230\u7684AI\u5f00\u53d1\u6d41\u7a0b"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240228-095423",src:i(98501).A+"",width:"995",height:"260"})}),"\n",(0,s.jsxs)(e.p,{children:["\u57fa\u4e8eK230\u7684AI\u5f00\u53d1\u6d41\u7a0b\u4e0e\u4e3b\u6d41AI\u5f00\u53d1\u6d41\u7a0b\u7c7b\u4f3c\uff0c\u4e5f\u662f\u5148\u8bad\u7ec3\uff0c\u518d\u90e8\u7f72\u3002\u8bad\u7ec3\u65f6\u5f00\u53d1\u8005\u53ef\u4ee5\u4f7f\u7528",(0,s.jsx)(e.strong,{children:"\u5e38\u89c1\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6"}),"\uff0ceg\uff1aPytorch\u3001TensorFlow\u3001\u98de\u6868\u7b49\u6765\u5b9a\u4e49\u7f51\u7edc\u7ed3\u6784\uff0c\u5e76\u901a\u8fc7\u8bad\u7ec3\u786e\u5b9a\u7f51\u7edc\u4e2d\u7684\u53c2\u6570\u3002\u4e4b\u540e\uff0c\u6a21\u578b\u7684\u7ed3\u6784\u548c\u53c2\u6570\u4f1a\u88ab\u8f6c\u6362\u6210\u4e00\u79cd\u53ea\u63cf\u8ff0\u7f51\u7edc\u7ed3\u6784\u7684",(0,s.jsx)(e.strong,{children:"\u4e2d\u95f4\u8868\u793a"}),"\uff0ceg\uff1aonnx\u3001tflite\uff0c\u4e00\u4e9b\u9488\u5bf9\u7f51\u7edc\u7ed3\u6784\u7684\u4f18\u5316\u4f1a\u5728\u4e2d\u95f4\u8868\u793a\u4e0a\u8fdb\u884c\u3002\u6700\u7ec8\uff0c\u5c06\u4e2d\u95f4\u8868\u793a\u8f6c\u6362\u6210\u7279\u5b9a\u7684\u6587\u4ef6\u683c\u5f0f\uff08kmodel\uff09\uff0c\u5e76\u5229\u7528\u9762\u5411K230\u7684\u63a8\u7406\u5f15\u64ce\uff08K230Runtime\uff09\uff0c\u5728K230\u786c\u4ef6\u5e73\u53f0\u4e0a\u5b9e\u73b0\u6a21\u578b\u7684\u9ad8\u6548\u8fd0\u884c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u76f8\u4fe1\u5927\u5bb6\u90fd\u5bf9\u8bad\u7ec3\u8fc7\u7a0b\u975e\u5e38\u719f\u6089\uff0c\u56e0\u6b64\u672c\u6587\u7740\u91cd\u4ecb\u7ecd\u90e8\u7f72\u8fc7\u7a0b\u3002\u9009\u62e9\u5f00\u6e90repo",(0,s.jsx)(e.a,{href:"https://github.com/biubug6/Pytorch_Retinaface",children:"\u4eba\u8138\u68c0\u6d4b"}),"\u3001",(0,s.jsx)(e.a,{href:"https://github.com/Xiaoccer/MobileFaceNet_Pytorch",children:"\u4eba\u8138\u8bc6\u522b"}),"\uff08\u7a0d\u540e\u4f1a\u8be6\u7ec6\u89e3\u91ca\u4e24\u8005\u542b\u4e49\uff09\uff0c\u8fd9\u4e24\u4e2a\u5f00\u6e90repo\u90fd\u63d0\u4f9b\u4e86\u57fa\u4e8ePytorch\u8bad\u7ec3\u597d\u7684\u6a21\u578b\uff1b\u56e0\u6b64\uff0c\u672c\u6587\u4ee5Pytorch\u6a21\u578b\u4e3a\u4f8b\uff0c\u5bf9AI\u6a21\u578b\u5728K230\u7684\u90e8\u7f72\u8fc7\u7a0b\u5c55\u5f00\u53d9\u8ff0\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"pytorch2onnx2kmodel",src:i(74379).A+"",width:"809",height:"191"})}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8ePytorch\u6a21\u578b\u6765\u8bf4\uff0c\u4ece\u8bad\u7ec3\u597d\u5230\u90e8\u7f72\u5230K230\u4e0a\uff0c\u4f1a\u7ecf\u8fc7\u4e09\u79cd\u6587\u4ef6\u683c\u5f0f\uff1apth/ckpt->onnx->kmodel\uff0c\u6bcf\u8f6c\u6210\u65b0\u7684\u6587\u4ef6\u683c\u5f0f\u4e4b\u540e\uff0c\u6211\u4eec\u90fd\u9700\u8981\u9a8c\u8bc1\u8f6c\u6362\u6a21\u578b\u7684\u6b63\u786e\u6027\uff0c\u4ee5\u4fdd\u8bc1\u6210\u529f\u90e8\u7f72\u3002"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u5df2\u7ecf\u8bad\u7ec3\u597d\u7684Pytorch\u6a21\u578b\uff0c\u6211\u4eec\u4f1a\u7528pth\u63a8\u7406\u811a\u672c\u9a8c\u8bc1\u5b83\u7684\u6b63\u786e\u6027\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u9a8c\u8bc1pth/ckpt\u6ca1\u6709\u95ee\u9898\u540e\uff0c\u8f6connx\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u8f6connx\u540e\uff0c\u9a8c\u8bc1onnx\u6a21\u578b\u7684\u6b63\u786e\u6027\uff0c\u9700\u8981\u4f7f\u7528ONNXRuntime\u6765\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u6d41\u7a0b\u4e0ePytorch\u63a8\u7406\u6d41\u7a0b\u7c7b\u4f3c\uff0c\u5305\u62ec\u52a0\u8f7donnx\u3001\u8bfb\u53d6\u56fe\u50cf/\u89c6\u9891\u6d41\u3001\u56fe\u50cf/\u89c6\u9891\u5e27\u9884\u5904\u7406\u3001onnx run\u3001\u540e\u5904\u7406\u3001\u663e\u793a\u7ed3\u679c\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u9a8c\u8bc1onnx\u6ca1\u6709\u95ee\u9898\uff0c\u5c06\u5176\u8f6c\u6362\u4e3akmodel\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u6b64\u65f6\u4f7f\u7528K230Runtime\u6765\u9a8c\u8bc1kmodel\u7684\u6b63\u786e\u6027\uff0c\u9a8c\u8bc1\u6d41\u7a0b\u4e0eONNXRuntime\u63a8\u7406\u6d41\u7a0b\u7c7b\u4f3c\uff0c\u5305\u62ec\u52a0\u8f7dkmodel\u3001\u8bfb\u53d6\u56fe\u50cf/\u89c6\u9891\u6d41\u3001\u56fe\u50cf/\u89c6\u9891\u5e27\u9884\u5904\u7406\u3001kmodel run\u3001\u540e\u5904\u7406\u3001\u663e\u793a\u7ed3\u679c\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"kmodel\u63a8\u7406\u6d41\u7a0b\u6b63\u786e\u4e86\uff0c\u6211\u4eecAI\u6a21\u578b\u5c31\u53ef\u4ee5\u6210\u529f\u90e8\u7f72\u4e86\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"PyTorch\u6a21\u578b\u4ece\u8bad\u7ec3\u5230\u5728K230\u4e0a\u90e8\u7f72\u7ecf\u8fc7\u4e09\u4e2a\u9636\u6bb5\uff1apth/ckpt\u9a8c\u8bc1\uff08\u901a\u5e38\u5df2\u9a8c\u8bc1\uff09\u3001onnx\u9a8c\u8bc1\uff08\u4f7f\u7528ONNXRuntime\uff09\uff0c\u6700\u540e\u662fkmodel\u9a8c\u8bc1\uff08\u4f7f\u7528K230Runtime\uff09\u3002\u6bcf\u4e2a\u9636\u6bb5\u90fd\u9700\u8981\u786e\u4fdd\u6a21\u578b\u7684\u6b63\u786e\u6027\uff0c\u4ee5\u4fdd\u8bc1\u6210\u529f\u90e8\u7f72\u3002\u9a8c\u8bc1\u6d41\u7a0b\u5305\u62ec\u52a0\u8f7d\u6a21\u578b\u3001\u5904\u7406\u8f93\u5165\u6570\u636e\u3001\u8fd0\u884c\u63a8\u7406\u3001\u5904\u7406\u8f93\u51fa\u7ed3\u679c\uff0c\u6700\u7ec8\u786e\u4fddK230\u4e0a\u7684AI\u6a21\u578b\u90e8\u7f72\u6210\u529f\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"62-\u73af\u5883\u642d\u5efa",children:"6.2 \u73af\u5883\u642d\u5efa"}),"\n",(0,s.jsx)(e.h3,{id:"621-\u5feb\u901f\u4e0a\u624b",children:"6.2.1 \u5feb\u901f\u4e0a\u624b"}),"\n",(0,s.jsx)(e.p,{children:"\u4ee5Windows\u73af\u5883\u4e3a\u4f8b\uff0c\u8fdb\u884c\u5feb\u901f\u4e0a\u624b\u8bf4\u660e\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"6211-canmv-k230\u63a5\u53e3\u8bf4\u660e",children:"6.2.1.1 CanMV-K230\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,s.jsx)(e.p,{children:"\u8bf4\u660e\uff1aCanMV-K230\u4e3b\u677f\u7535\u6e90\u548c\u4e32\u53e3(\u4e0e\u7535\u8111\u901a\u8baf)\u5171\u7528\u4e00\u4e2aTypeC\u53e3\uff0c\u5982\u56fe\u4e2d\u2464\u6240\u793a\uff1a"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"canmv_board",src:i(86101).A+"",width:"1879",height:"807"})}),"\n",(0,s.jsx)(e.h4,{id:"6212-canmv-k230\u8fde\u63a5\u793a\u4f8b",children:"6.2.1.2 CanMV-K230\u8fde\u63a5\u793a\u4f8b"}),"\n",(0,s.jsx)(e.p,{children:"\u8bf7\u51c6\u5907\u5982\u4e0b\u786c\u4ef6\uff0c\u7136\u540e\u6309\u7167\u4e0b\u56fe\u8fde\u63a5\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"CanMV-K230"}),"\n",(0,s.jsx)(e.li,{children:"TypeC USB\u7ebf \u81f3\u5c111\u6839"}),"\n",(0,s.jsx)(e.li,{children:"\u7f51\u7ebf\u4e00\u6839(\u53ef\u9009)"}),"\n",(0,s.jsx)(e.li,{children:"HDMI\u7ebf\u4e00\u6839"}),"\n",(0,s.jsx)(e.li,{children:"SD\u5361\uff08\u82e5\u662fPC\u6ca1\u6709SD\u5361\u63d2\u69fd\uff0c\u5219\u9700\u8981SD\u5361\u8bfb\u5361\u5668\uff09"}),"\n",(0,s.jsx)(e.li,{children:"\u652f\u6301HDMI\u7684\u663e\u793a\u5668"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"canmv_connect_demo.png",src:i(19529).A+"",width:"1584",height:"944"})}),"\n",(0,s.jsx)(e.p,{children:"\u6309\u7167\u4e0a\u56fe\u8fde\u63a5\u4e4b\u540e\uff0c\u9700\u8981\u5728SD\u5361\u4e2d\u70e7\u5f55\u955c\u50cf\uff0c\u4e0b\u4e00\u5c0f\u8282\u5c06\u4f1a\u4ecb\u7ecd\u5982\u4f55\u70e7\u5f55\u955c\u50cf\u3002"}),"\n",(0,s.jsx)(e.h4,{id:"6213-\u955c\u50cf\u70e7\u5f55",children:"6.2.1.3 \u955c\u50cf\u70e7\u5f55"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Linux:"})}),"\n",(0,s.jsx)(e.p,{children:"\u5728TF\u5361\u63d2\u5230\u5bbf\u4e3b\u673a\u4e4b\u524d\uff0c\u8f93\u5165\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"ls -l /dev/sd\\*\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u67e5\u770b\u5f53\u524d\u7684\u5b58\u50a8\u8bbe\u5907\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5c06TF\u5361\u63d2\u5165\u5bbf\u4e3b\u673a\u540e\uff0c\u518d\u6b21\u8f93\u5165\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"ls -l /dev/sd\\*\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u67e5\u770b\u6b64\u65f6\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u65b0\u589e\u52a0\u7684\u5c31\u662fTF\u5361\u8bbe\u5907\u8282\u70b9\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u8bbe/dev/sdc\u5c31\u662fTF\u5361\u8bbe\u5907\u8282\u70b9\uff0c\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u70e7\u5f55TF\u5361\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"sudo dd if=sysimage-sdcard.img of=/dev/sdc bs=1M oflag=sync\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Windows:"})}),"\n",(0,s.jsxs)(e.p,{children:["Windows\u4e0b\u53ef\u901a\u8fc7rufus\u5de5\u5177\u5bf9TF\u5361\u8fdb\u884c\u70e7\u5f55\uff0c",(0,s.jsx)(e.a,{href:"http://rufus.ie/downloads/",children:"rufus\u5de5\u5177\u4e0b\u8f7d\u5730\u5740"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"1\uff09\u5c06TF\u5361\u63d2\u5165PC\uff0c\u7136\u540e\u542f\u52a8rufus\u5de5\u5177\uff0c\u70b9\u51fb\u5de5\u5177\u754c\u9762\u7684\u201d\u9009\u62e9\u201d\u6309\u94ae\uff0c\u9009\u62e9\u5f85\u70e7\u5199\u7684\u56fa\u4ef6\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"rufus-flash-from-file",src:i(88021).A+"",width:"1533",height:"806"})}),"\n",(0,s.jsx)(e.p,{children:"2\uff09\u70b9\u51fb\u201c\u5f00\u59cb\u201d\u6309\u94ae\u5f00\u59cb\u70e7\u5199\uff0c\u70e7\u5199\u8fc7\u7a0b\u6709\u8fdb\u5ea6\u6761\u5c55\u793a\uff0c\u70e7\u5199\u7ed3\u675f\u540e\u4f1a\u63d0\u793a\u201c\u51c6\u5907\u5c31\u7eea\u201d\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"rufus-flash",src:i(32045).A+"",width:"591",height:"792"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"rufus-sure",src:i(44806).A+"",width:"682",height:"259"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"rufus-warning",src:i(44577).A+"",width:"685",height:"284"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"rufus_finish",src:i(26284).A+"",width:"593",height:"804"})}),"\n",(0,s.jsxs)(e.blockquote,{children:["\n",(0,s.jsxs)(e.p,{children:["\u8bf4\u660e1\uff1a",(0,s.jsx)(e.code,{children:"sysimage-sdcard.img.gz"}),"\u6587\u4ef6\u65f6\u6700\u597d\u5148\u89e3\u538b\u7f29\uff0c\u70e7\u5f55\u89e3\u538b\u7f29\u540e\u7684\u6587\u4ef6\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.h4,{id:"6214-\u4e32\u53e3\u9a71\u52a8\u5b89\u88c5\u53ca\u4e0a\u7535\u9a8c\u8bc1",children:"6.2.1.4 \u4e32\u53e3\u9a71\u52a8\u5b89\u88c5\u53ca\u4e0a\u7535\u9a8c\u8bc1"}),"\n",(0,s.jsxs)(e.p,{children:["K230 \u4e3b\u677f\u901a\u8fc7USB\u63d0\u4f9b\u4e24\u8def\u8c03\u8bd5\u4e32\u53e3\uff0cwindows\u4e0b\u4f7f\u7528\u8c03\u8bd5\u4e32\u53e3\uff0c\u9700\u8981\u5b89\u88c5USB\u8f6c\u4e32\u53e3\u9a71\u52a8\u7a0b\u5e8f\uff0c\u9a71\u52a8",(0,s.jsx)(e.a,{href:"https://ftdichip.com/wp-content/uploads/2021/11/CDM-v2.12.36.4.U-WHQL-Certified.zip",children:"\u4e0b\u8f7d\u94fe\u63a5"}),"\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"\u5b89\u88c5\u9a71\u52a8\u4e4b\u540e\uff0c\u5982\u4f55\u9a8c\u8bc1\u9a71\u52a8\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1f\u5148\u5c06CanMV-K230\u5f00\u53d1\u677f\u6309\u71676.2.1.2\u56fe\u793a\u8fde\u63a5\uff0c\u7136\u540e\u5c06\u8fde\u63a5\u7535\u6e90\u7684type c\u8fde\u63a5\u7ebf\u8fde\u63a5\u5230PC USB\u53e3\uff0c\u53ef\u4ee5\u53d1\u73b0\u4e24\u4e2aUSB\u4e32\u53e3\u8bbe\u5907\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240131110201060",src:i(79657).A+"",width:"1125",height:"783"})}),"\n",(0,s.jsx)(e.p,{children:"\u540c\u65f6HDMI\u8fde\u63a5\u7684\u663e\u793a\u5668\u4f1a\u663e\u793a\u4eba\u8138\u68c0\u6d4b\u7ed3\u679c\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240131112814667",src:i(52350).A+"",width:"1137",height:"759"})}),"\n",(0,s.jsx)(e.h4,{id:"6215-\u4e32\u53e3\u8c03\u8bd5",children:"6.2.1.5 \u4e32\u53e3\u8c03\u8bd5"}),"\n",(0,s.jsxs)(e.p,{children:["\u5b89\u88c5\u5b8c\u9a71\u52a8\u4e4b\u540e\uff0c",(0,s.jsx)(e.a,{href:"https://mobaxterm.mobatek.net/download.html",children:"\u4e0b\u8f7d"}),"\u4e32\u53e3\u8c03\u8bd5\u5de5\u5177\uff0c\u5b89\u88c5\u4e4b\u540e\uff0c\u521b\u5efa\u4e32\u53e3\u7a97\u53e3\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8fde\u63a5\u5c0f\u6838"}),"\uff1a\u5bf9\u4e8eAI Demo\u6765\u8bf4\uff0c\u5c0f\u6838\u4e3b\u8981\u8d1f\u8d23\u7f51\u7edc\u76f8\u5173\u5de5\u4f5c\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240201141045153",src:i(39496).A+"",width:"1920",height:"1020"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240201141234952",src:i(40479).A+"",width:"1920",height:"1020"})}),"\n",(0,s.jsx)(e.p,{children:"\u8f93\u5165root\u767b\u5f55\uff0c\u8fdb\u5165\u5c0f\u6838"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8fde\u63a5\u5927\u6838"}),"\uff1a\u5927\u6838\u4e3b\u8981\u8d1f\u8d23\u548cAI\u76f8\u5173\u5de5\u4f5c"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240201141139709",src:i(22687).A+"",width:"1920",height:"1020"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240201140752999",src:i(18350).A+"",width:"1920",height:"1020"})}),"\n",(0,s.jsx)(e.p,{children:"\u6309q\uff0c\u56de\u8f66\uff0c\u9000\u51fa\u5f53\u524d\u4eba\u8138\u68c0\u6d4bdemo\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u5982\u4f55\u91cd\u65b0\u542f\u52a8\u4eba\u8138\u68c0\u6d4bdemo?"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240201143138314",src:i(45964).A+"",width:"1154",height:"384"})}),"\n",(0,s.jsx)(e.h3,{id:"622-\u7f16\u8bd1\u73af\u5883\u642d\u5efa",children:"6.2.2 \u7f16\u8bd1\u73af\u5883\u642d\u5efa"}),"\n",(0,s.jsxs)(e.p,{children:["\u7f16\u8bd1\u73af\u5883\u642d\u5efa\u6d89\u53ca",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_sdk",children:"sdk"}),"\u3001",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/nncase",children:"nncase"}),"\uff0csdk\u548cnncase\u6709\u4e00\u5b9a\u7684\u5bf9\u5e94\u5173\u7cfb\u3002\u6211\u4eec\u4eca\u5929\u4ee5sdk v1.3.0\uff0cnncase v2.7.0\u4e3a\u4f8b\uff0c\u8fdb\u884c\u8bb2\u89e3\u3002k230 sdk\u548cnncase\u7248\u672c\u7684\u5bf9\u5e94\u5173\u7cfb\u8bf7\u53c2\u8003\u4e0b\u8ff0\u94fe\u63a5\uff1a"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://developer.canaan-creative.com/k230/dev/zh/03_other/K230_SDK_nncase%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E5%85%B3%E7%B3%BB.html",children:(0,s.jsx)(e.strong,{children:"K230 SDK nncase\u7248\u672c\u5bf9\u5e94\u5173\u7cfb \u2014 K230 \u6587\u6863 (canaan-creative.com)"})})}),"\n",(0,s.jsx)(e.h4,{id:"6221-docker\u5bb9\u5668\u6784\u5efa",children:"6.2.2.1 docker\u5bb9\u5668\u6784\u5efa"}),"\n",(0,s.jsxs)(e.p,{children:["\u53c2\u8003\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/K230_SDK_%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E.md",children:"K230_SDK_\u4f7f\u7528\u8bf4\u660e.md"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u4ee5sdk v1.3\u4e3a\u4f8b\uff0c\u642d\u5efa\u8f6f\u4ef6\u73af\u5883\ngit clone -b v1.3 https://github.com/kendryte/k230_sdk\ncd k230_sdk\nmake prepare_sourcecode\n#\u624b\u52a8\u6784\u5efa\u540d\u4e3av1.3_0219\u7684docker image\ndocker build -f tools/docker/Dockerfile -t v1.3_0219 tools/docker\n#\u521b\u5efa\u540d\u4e3av1.3_0219_lj\u7684docker\u5bb9\u5668\ndocker run -u root --name v1.3_0219_lj -it -v $(pwd):$(pwd) -v $(pwd)/toolchain:/opt/toolchain -w $(pwd) v1.3_0219 /bin/bash\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6ce8\u610f\uff1a"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.code,{children:"make prepare_sourcecode"})," \u4f1a\u81ea\u52a8\u4e0b\u8f7dLinux\u548cRT-Smart toolchain, buildroot package, AI package\u7b49. \u8bf7\u786e\u4fdd\u8be5\u547d\u4ee4\u6267\u884c\u6210\u529f\u5e76\u6ca1\u6709Error\u4ea7\u751f\uff0c\u4e0b\u8f7d\u65f6\u95f4\u548c\u901f\u5ea6\u4ee5\u5b9e\u9645\u7f51\u901f\u4e3a\u51c6\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4ee5CanMV-K230\u5f00\u53d1\u677f\u4e3a\u4f8b\uff0c\u624b\u52a8\u6784\u5efa\u955c\u50cf\uff08\u6216\u76f4\u63a5\u7528\u5b98\u7f51\u63d0\u4f9b",(0,s.jsx)(e.a,{href:"https://kendryte-download.canaan-creative.com/developer/k230/k230_canmv_sdcard_v1.3_nncase_v2.7.0.img.gz",children:"v1.3 CanMV-K230\u955c\u50cf"}),"\uff09\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"make CONF=k230_canmv_defconfig            #\u751f\u6210\u955c\u50cfsysimage-sdcard.img.gz\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#ls k230_sdk/output/k230_canmv_defconfig/images/\ndrwxr-xr-x 4 root root       169 Feb 21 14:57 ./\ndrwxr-xr-x 6 root root        79 Feb 20 11:53 ../\ndrwxr-xr-x 5 root root       138 Feb 21 14:57 big-core/\nlrwxrwxrwx 1 root root        22 Feb 21 14:57 k230_canmv_sdcard_v1.3_nncase_v2.7.0.img.gz -> sysimage-sdcard.img.gz\ndrwxr-xr-x 7 root root      4096 Feb 21 14:57 little-core/\n-rw-rw-rw- 1 root root 486556160 Feb 21 14:57 sysimage-sdcard.img\n-rw-rw-rw- 1 root root  56831464 Feb 21 14:57 sysimage-sdcard.img.gz\n"})}),"\n",(0,s.jsx)(e.h4,{id:"6222-nncase\u5b89\u88c5",children:"6.2.2.2 nncase\u5b89\u88c5"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"nncase"}),"\u662f\u4e00\u4e2a\u4e3a AI \u52a0\u901f\u5668\u8bbe\u8ba1\u7684\u795e\u7ecf\u7f51\u7edc\u7f16\u8bd1\u5668, \u76ee\u524d\u652f\u6301\u7684AI\u8bbe\u5907\uff08 target\uff09\u6709K230/k210/k510\u7b49\u3002nncase\u4e3b\u8981\u75314\u90e8\u5206\u7ec4\u6210\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u7f16\u8bd1\u6a21\u578bAPIs(Python)"}),"\uff1a\u7528\u4e8e\u5728PC\u4e0a\u5c06\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\uff08onnx\u3001tflite\u7b49\uff09\u7f16\u8bd1\u4e3akmodel\uff0c\u5373",(0,s.jsx)(e.strong,{children:"\u751f\u6210kmodel"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u6a21\u62df\u5668APIs(Python)"}),"\uff1a\u7528\u4e8e\u5728PC\u4e0a\u6a21\u62df\u63a8\u7406kmodel\uff0c\u9a8c\u8bc1nncase\u6a21\u62df\u63a8\u7406\u7ed3\u679c\u548c\u539f\u6a21\u578b\uff08onnx\u3001tflite\uff09\u7684\u63a8\u7406\u7ed3\u679c\u662f\u5426\u4e00\u81f4\uff0c\u5373",(0,s.jsx)(e.strong,{children:"Simulator\u9a8c\u8bc1"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"KPU\u8fd0\u884c\u65f6APIs(C++)"}),"\uff1a\u7528\u4e8e\u5728AI\u8bbe\u5907\u52a0\u8f7dkmodel\uff0c\u4f7f\u7528KPU Runtime\u8fdb\u884c\u63a8\u7406\uff0c \u83b7\u53d6\u8f93\u51fa\u6570\u636e\u7b49\uff0c\u5373",(0,s.jsx)(e.strong,{children:"\u4e0a\u677f\u63a8\u7406\u9a8c\u8bc1"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"AI2D \u8fd0\u884c\u65f6APIs(C++)"}),"\uff1a\u7528\u4e8e\u5728AI\u8bbe\u5907\u914d\u7f6eAI2D\u7684\u53c2\u6570\uff0c\u751f\u6210\u76f8\u5173\u5bc4\u5b58\u5668\u914d\u7f6e\uff0c\u6267\u884cAI2D\u8ba1\u7b97\u7b49\uff1b\u5e38\u7528AI2D\u8ba1\u7b97\u5305\u62ecAffine\u3001Crop\u3001Resize\u3001Padding\u7b49\uff0c\u53ef\u4ee5\u52a0\u901f\u56fe\u50cf\u7684\u9884\u5904\u7406\u64cd\u4f5c\uff0c\u5373",(0,s.jsx)(e.strong,{children:"\u4e0a\u677f\u9884\u5904\u7406"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u4ee5sdk v1.3\u4e3a\u4f8b\n#nncase\u53d1\u5e03\u7248\u672c\uff1ahttps://github.com/kendryte/nncase/releases\n#\u5728docker\u5bb9\u5668\u4e2d\uff0c\u67e5\u770bsdk\u5bf9\u5e94\u7684nncase\u7248\u672c\ncat src/big/nncase/riscv64/nncase/include/nncase/version.h\n#\u5b89\u88c5\u5bf9\u5e94\u7248\u672cnncase\npip install -i https://pypi.org/simple nncase==2.7.0\npip install nncase-kpu==2.7.0\n"})}),"\n",(0,s.jsx)(e.h2,{id:"63-demo\u6784\u5efa\u6d41\u7a0b\u89e3\u6790",children:"6.3 demo\u6784\u5efa\u6d41\u7a0b\u89e3\u6790"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0a\u4e00\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c55\u793a\u4e86\u4eba\u8138\u68c0\u6d4bdemo\uff0c\u90a3\u5982\u4f55\u57fa\u4e8eK230\u5f00\u53d1\u81ea\u5df1\u7684AI Demo\u3002\u63a5\u4e0b\u6765\u4ee5\u4eba\u8138\u68c0\u6d4b\u3001\u4eba\u8138\u8bc6\u522bDemo\u4e3a\u4f8b\uff0c\u5bf9\u57fa\u4e8eK230\u7684AI\u5f00\u53d1\u6d41\u7a0b\u8fdb\u884c\u8be6\u7ec6\u7684\u63cf\u8ff0\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u7531\u4e8e\u6211\u627e\u7684\u8fd9\u4e24\u4e2aDemo\u662f\u57fa\u4e8ePytorch\u8bad\u7ec3\u7684\uff0c\u56e0\u6b64\u6574\u4f53\u7684\u6d41\u7a0b\u4ee5Pytorch\u4e3a\u4f8b\uff0c\u8fdb\u884c\u5c55\u5f00\u3002\u9488\u5bf9Pytorch\uff0c\u57fa\u4e8eK230\u7684AI\u5f00\u53d1\u6d41\u7a0b\u7531\u8bad\u7ec3\u548c\u90e8\u7f72\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\uff0c\u5176\u4e2d\u8bad\u7ec3\u5305\u62ecPytorch\u8bad\u7ec3\u6a21\u578b\uff0c\u90e8\u7f72\u5305\u62ecPyTorch\u5230ONNX\u8f6c\u6362\u3001\u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406\u3001ONNX\u5230kmodel\u8f6c\u6362\u3001\u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406\u3002"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"PyTorch\u8bad\u7ec3\u6a21\u578b\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u4f7f\u7528PyTorch\u6846\u67b6\u5b9a\u4e49\u5e76\u8bad\u7ec3\u4eba\u8138\u68c0\u6d4b\u548c\u4eba\u8138\u8bc6\u522b\u6a21\u578b\u3002\u8bad\u7ec3\u5b8c\u6210\u540e\uff0c\u4fdd\u5b58\u6a21\u578b\u53c2\u6570\u5230.pth\u6587\u4ef6\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"PyTorch\u5230ONNX\u8f6c\u6362\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5229\u7528PyTorch\u5de5\u5177\uff0c\u5c06\u8bad\u7ec3\u597d\u7684\u6a21\u578b\u8f6c\u6362\u4e3aONNX\u683c\u5f0f\u3002\u8fd9\u4e00\u6b65\u4f1a\u9488\u5bf9\u7f51\u7edc\u7ed3\u6784\u8fdb\u884c\u4e00\u4e9b\u4f18\u5316\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728PC\u4e0a\u52a0\u8f7dONNX\u6a21\u578b\uff0c\u5e76\u5229\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406\uff0c\u4ee5\u9a8c\u8bc1onnx\u6a21\u578b\u7684\u6b63\u786e\u6027\u548c\u6027\u80fd\u3002ONNXRuntime\u63a8\u7406\u7684\u4e3b\u8981\u6d41\u7a0b\u5305\u62ec\u9884\u5904\u7406\u3001\u8fd0\u884c\u3001\u540e\u5904\u7406\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"ONNX\u5230kmodel\u8f6c\u6362\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5229\u7528K230\u652f\u6301\u7684\u8f6c\u6362\u5de5\u5177\uff0c\u5c06ONNX\u6a21\u578b\u8f6c\u6362\u4e3aK230\u53ef\u7528\u7684kmodel\u683c\u5f0f\u3002\u8fd9\u4e00\u6b65\u4f1a\u4f18\u5316\u6a21\u578b\u4ee5\u9002\u5e94K230\uff0c\u751f\u6210\u5728K230\u4e0a\u80fd\u9ad8\u6548\u8fd0\u884c\u7684\u6a21\u578b\u3002"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728K230\u4e0a\u52a0\u8f7dkmodel\uff0c\u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406\u3002\u8fd9\u786e\u4fdd\u6a21\u578b\u5728K230\u7684\u8fd0\u884c\u6548\u679c\u3002K230Runtime\u63a8\u7406\u7684\u4e3b\u8981\u6d41\u7a0b\u5305\u62ec\u9884\u5904\u7406\u3001\u8fd0\u884c\u3001\u540e\u5904\u7406\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://developer.canaan-creative.com/ai_docs/zh/main/_images/pytorch2onnx2kmodel.png",alt:"pytorch2onnx2kmodel"})}),"\n",(0,s.jsx)(e.p,{children:"\u6574\u4e2a\u6d41\u7a0b\u901a\u8fc7\u5c06PyTorch\u6a21\u578b\u7ecf\u7531ONNX\u4e2d\u95f4\u683c\u5f0f\uff0c\u6700\u7ec8\u4f18\u5316\u4e3a\u9002\u5408K230\u7684kmodel\u683c\u5f0f\uff0c\u5b9e\u73b0\u4e86\u4ecePC\u7aef\u5230K230\u7684\u65e0\u7f1d\u90e8\u7f72\u3002\u4ecepth/ckpt->onnx->kmodel\uff0c\u6a21\u578b\u6587\u4ef6\u67093\u79cd\u6587\u4ef6\u683c\u5f0f\uff0c\u5404\u79cd\u6587\u4ef6\u683c\u5f0f\u63a8\u7406\u6d41\u7a0b\u4e00\u4e00\u5bf9\u5e94\uff0c\u56e0\u6b64\u8f6c\u6362\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u9700\u8981\u5728\u5bf9\u5e94\u7684\u63a8\u7406\u6d41\u7a0b\u4e0b\uff0c\u9a8c\u8bc1\u8f6c\u6362\u6a21\u578b\u7684\u51c6\u786e\u6027\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"demo\u6784\u5efa\u7684\u5b8c\u6574\u4ee3\u7801"}),"\u5df2\u53d1\u5e03\u5230github\u4e0a\uff0c\u611f\u5174\u8da3\u8005\u53ef\u4ee5\u81ea\u884c\u4e0b\u8f7d\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u8fd0\u884c\u73af\u5883\uff1a\u5e38\u89c4pc\u73af\u5883\n\u251c\u2500\u2500 onnx_related               \n    \u251c\u2500\u2500 onnx_export            #\u5bfc\u51faonnx\n    \u2502   \u251c\u2500\u2500 face_detection_convert_to_onnx.py       #\u5bf9\u5e943.1.1\n    \u2502   \u251c\u2500\u2500 face_recognition_convert_to_onnx.py\n    \u2502   \u2514\u2500\u2500 readme.txt\n    \u2514\u2500\u2500 onnx_inference         #onnx\u63a8\u7406\u6d41\u7a0b\n        \u251c\u2500\u2500 face_detection     #\u4eba\u8138\u68c0\u6d4bonnx\u63a8\u7406\u6d41\u7a0b   #\u5bf9\u5e943.1.2\n        \u2514\u2500\u2500 face_recognition   #\u4eba\u8138\u8bc6\u522bonnx\u63a8\u7406\u6d41\u7a0b\n# \u7f16\u8bd1\u73af\u5883\uff1ak230 docker\u7f16\u8bd1\u73af\u5883\uff0c\u8fd0\u884c\u73af\u5883\uff1aK230\u5f00\u53d1\u677f\n\u251c\u2500\u2500 kmodel_related     \n\u2502   \u251c\u2500\u2500 kmodel_export         #\u5bfc\u51fakmodel\uff0c\n\u2502   \u2502   \u251c\u2500\u2500 build_model.sh    #\u751f\u6210kmodel\u811a\u672c\n\u2502   \u2502   \u251c\u2500\u2500 face_detection    #\u5bf9\u5e943.1.3+3.1.4.1\uff08\u4e24\u8005\u90fd\u662fpython\u5199\u7684\uff0c\u4e3a\u4e86\u5199\u8d77\u6765\u7b80\u5355\uff0c\u628a\u4e24\u8005\u653e\u5728\u4e00\u8d77\uff0c\u903b\u8f91\u4e0a\u653e\u52303.1.4\u66f4\u597d\uff09\n\u2502   \u2502   \u251c\u2500\u2500 face_recognition\n\u2502   \u2502   \u251c\u2500\u2500 k230_kmodel       #\u751f\u6210kmodel\n\u2502   \u2502   \u2514\u2500\u2500 k230_utils        #\u751f\u6210\u5176\u5b83\u8f85\u52a9\u6587\u4ef6\uff0cbin\u3001\u56fe\u7247\u7b49\n\u2502   \u2514\u2500\u2500 kmodel_inference      #kmodel\u63a8\u7406             \n\u2502       \u251c\u2500\u2500 build_app.sh      #\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\u811a\u672c\n\u2502       \u251c\u2500\u2500 cmake\n\u2502       \u251c\u2500\u2500 CMakeLists.txt\n\u2502       \u251c\u2500\u2500 face_detection    #\u4eba\u8138\u68c0\u6d4bkmodel\u63a8\u7406\u6d41\u7a0b\uff0c\u5bf9\u5e943.1.4.2+3.1.4.3\uff08\u4e24\u8005\u90fd\u662fc++\u5199\u7684\uff09\n\u2502       \u251c\u2500\u2500 face_recognition  #\u4eba\u8138\u8bc6\u522bkmodel\u63a8\u7406\u6d41\u7a0b\n\u2502       \u251c\u2500\u2500 k230_bin          #\u751f\u6210\u7684\u53ef\u6267\u884c\u6587\u4ef6\u3001kmodel\uff0c\u4e0a\u677f\u6267\u884c\u811a\u672c\u7b49\n\u2502       \u251c\u2500\u2500 main_nncase       #kmodel\u4e0a\u677f\u9a8c\u8bc1\u5de5\u5177\n\u2502       \u251c\u2500\u2500 shell\n\u2502       \u2514\u2500\u2500 test_demo  \n"})}),"\n",(0,s.jsx)(e.h3,{id:"631-\u4eba\u8138\u68c0\u6d4bdemo",children:"6.3.1 \u4eba\u8138\u68c0\u6d4bdemo"}),"\n",(0,s.jsxs)(e.p,{children:["\u4eba\u8138\u68c0\u6d4b\u662f\u6307\u5bf9\u4e8e\u4efb\u610f\u4e00\u5e45\u7ed9\u5b9a\u7684\u56fe\u50cf\uff0c\u91c7\u7528\u4e00\u5b9a\u7684\u7b56\u7565\u5bf9\u5176\u8fdb\u884c\u641c\u7d22\u4ee5\u786e\u5b9a\u5176\u4e2d\u662f\u5426\u542b\u6709\u4eba\u8138\uff0c\u5982\u679c\u6709\u5219\u8fd4\u56de\u4eba\u8138\u68c0\u6d4b\u6846\u3001\u4e94\u5b98\u5173\u952e\u70b9\u3002\u53c2\u8003\u94fe\u63a5\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/biubug6/Pytorch_Retinaface",children:"biubug6/Pytorch_Retinaface"})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"face_detection_result.jpg",src:i(16674).A+"",width:"1024",height:"624"})}),"\n",(0,s.jsx)(e.h4,{id:"6311-pytorch\u5230onnx\u8f6c\u6362",children:"6.3.1.1 PyTorch\u5230ONNX\u8f6c\u6362"}),"\n",(0,s.jsx)(e.p,{children:"\u9009\u62e9\u4eba\u8138\u68c0\u6d4b\u6a21\u578b\u65f6\uff0c\u4e00\u822c\u5e94\u9009\u62e9\u8f7b\u91cf\u5316\u7684\u6a21\u578b\uff0cbackbone\u4e00\u822c\u5c0f\u4e8eresnet50\u53c2\u6570\u91cf\u8f83\u597d\u3002\u56e0\u6b64\u6211\u4eec\u9009\u62e9\u57fa\u4e8eMobileNetV1\u7684RetinaFace \u4f5c\u4e3a\u4eba\u8138\u68c0\u6d4b\u6a21\u578b\u3002"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u52a0\u8f7dpth\u6216ckpt\u6a21\u578b\u5230cpu"}),"\n",(0,s.jsx)(e.li,{children:"\u6784\u5efa\u968f\u673a\u6a21\u578b\u8f93\u5165"}),"\n",(0,s.jsx)(e.li,{children:"\u5bfc\u51faonnx\u6a21\u578b"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8"}),"\uff1apth\u3001onnx\u90fd\u652f\u6301\u52a8\u6001\u8f93\u5165\uff0c\u800cK230\u7684\u6a21\u578b\u6682\u65f6\u4e0d\u652f\u6301\u52a8\u6001\u8f93\u5165\uff0c\u6240\u4ee5\u5bfc\u51faonnx\u65f6\uff0connx\u8f93\u5165shape\u56fa\u5b9a\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240116180710999",src:i(41489).A+"",width:"1351",height:"749"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6267\u884c\u6b65\u9aa4\uff1a"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"\u4ee3\u7801"}),"clone\u5230pc\u4e0a\uff0c\u5b89\u88c5\u4f9d\u8d56\u5e93\uff0c\u6267\u884c\u8f6connx\u811a\u672c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"git clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd onnx_related/onnx_export\ngit clone https://github.com/biubug6/Pytorch_Retinaface\ncp face_detection_convert_to_onnx.py Pytorch_Retinaface/\ncd Pytorch_Retinaface\n#\u6839\u636ePytorch_Retinaface\u8bf4\u660e\u6587\u6863\u4e0b\u8f7d\u9884\u8bad\u7ec3\u6a21\u578b\npython face_detection_convert_to_onnx.py\n"})}),"\n",(0,s.jsx)(e.h4,{id:"6312-\u4f7f\u7528onnxruntime\u8fdb\u884c\u63a8\u7406",children:"6.3.1.2 \u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u9a8c\u8bc1onnx\u6b63\u786e\u6027\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528ONNXRuntime\u5bf9onnx\u8fdb\u884c\u63a8\u7406\uff0c\u63a8\u7406\u65f6\u4fdd\u8bc1\u8bfb\u53d6\u56fe\u7247\u3001\u9884\u5904\u7406\u3001run\u3001\u540e\u5904\u7406\u3001\u663e\u793a\u7ed3\u679c\u4e0epth/ckpt\u7684\u63a8\u7406\u6d41\u7a0b\u4e00\u81f4\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"pytorch2onnx.png",src:i(30007).A+"",width:"819",height:"191"})}),"\n",(0,s.jsx)(e.h5,{id:"63121-\u8bfb\u53d6\u56fe\u50cf",children:"6.3.1.2.1 \u8bfb\u53d6\u56fe\u50cf"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240116182914501",src:i(22982).A+"",width:"269",height:"310"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#ori_img\uff081024,624,3\uff09,opencv\u8bfb\u5165\u56fe\u7247\u7684\u9ed8\u8ba4\u683c\u5f0f\u4e3ahwc,bgr\nori_img = cv2.imread('bin/test.jpg')\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63122-\u56fe\u50cf\u9884\u5904\u7406",children:"6.3.1.2.2 \u56fe\u50cf\u9884\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u9884\u5904\u7406\u6784\u5efa\uff08\u5e38\u7528\u7684\u65b9\u6cd5\uff1apadding_resize\uff0ccrop_resize\uff0cresize\uff0caffine\u3001normalization\uff09\uff1a\u53c2\u8003train.py\uff0ctest.py\u3001predict.py\u3001\u73b0\u6210\u7684onnx\u63a8\u7406\u811a\u672c\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6784\u5efa\u4eba\u8138\u68c0\u6d4b\u9884\u5904\u7406\u4ee3\u7801\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240116181759199",src:i(62211).A+"",width:"1538",height:"902"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#face_detector.py\ndef pre_process(self,ori_img):\n    max_ori_img = max(ori_img.shape[1], ori_img.shape[0])\n    self.scale = [max_ori_img] * 4\n    self.scale1 = [max_ori_img] * 10\n    # (1) padding\uff1a\u5c06\u539f\u56fepadding\u4e3a\u6b63\u65b9\u5f62\uff0cpad_img(1024,1024,3)\n    pad_img = pad_to_square(ori_img,self.normalize_mean,True)\n    # (2) resize+tranpose+normalization\uff1a\u5c06padding\u4e4b\u540e\u7684\u56fe\u50cf\u7f29\u653e\u5230640\uff0chwc\u8f6cchw\uff0c\u5e76\u5f52\u4e00\u5316\uff0cresize_img(3,640,640)\n    resize_img = resize_subtract_mean(pad_img,self.in_size,self.normalize_mean)\n    # (3) dequantize\uff1a\u5c06\u7f29\u653e\u7684\u56fe\u50cf\u8f6c\u6362\u4e3afloat32,resize_img_float(3,640,640)\n    resize_img_float = np.float32(resize_img)\n    #\uff084\uff093\u7ef4\u6269\u5f20\u4e3a4\u7ef4\uff1ainput_data(1,3,640,640)\n    input_data = np.expand_dims(resize_img_float, 0)\n    return input_data\n"})}),"\n",(0,s.jsx)(e.p,{children:"**\u53c2\u8003\uff1a\uff08\u4e0epth\u9884\u5904\u7406\u6d41\u7a0b\u4e00\u81f4\uff09**\u4eba\u8138\u68c0\u6d4b\u9884\u5904\u7406\u4ee3\u7801\u53c2\u8003train.py\uff08k230\u6a21\u578b\u7684\u8f93\u5165shape\u76ee\u524d\u53ea\u652f\u6301\u56fa\u5b9a\u8f93\u5165\uff0c\u8bad\u7ec3\u65f6\u90fd\u662f\u6279\u91cf\u56fa\u5b9a\u8f93\u5165\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u501f\u9274\uff09\u4e2d\u8c03\u7528\u7684\u9884\u5904\u7406\uff0c\u53bb\u6389\u4e0d\u9002\u5408\u63a8\u7406\u4f7f\u7528\u7684crop\u3001distort\u3001mirror\uff08\u6570\u636e\u589e\u5f3a\uff09\uff0c\u53ea\u7559\u4e0bonnx\u63a8\u7406\u65f6\u5fc5\u8981\u7684pad_to_square\u3001resize_subact_mean\u5904\u7406\uff0c\u4fdd\u8bc1onnx\u4e0epth\u9884\u5904\u7406\u4e00\u81f4\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240116184823495",src:i(73963).A+"",width:"1540",height:"1073"})}),"\n",(0,s.jsx)(e.h5,{id:"63123-onnx-run",children:"6.3.1.2.3 onnx run"}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u9884\u5904\u7406\u597d\u7684\u6570\u636e\uff0c\u5582\u7ed9\u6a21\u578b\uff0c\u5f97\u5230onnx\u63a8\u7406\u7ed3\u679c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#onnx_model.py\ndef forward(self, image_tensor):\n    '''\n    image_tensor = image.transpose(2, 0, 1)\n    image_tensor = image_tensor[np.newaxis, :]\n    onnx_session.run([output_name], {input_name: x})\n    :param image_tensor:\n    :return:\n    '''\n    input_feed = self.get_input_feed(image_tensor)\n    output = self.sess.run(self.out_names, input_feed=input_feed)\n    return output\n\n#face_detector.py\nloc,conf,landms = self.model.forward(input_data)\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63124-\u540e\u5904\u7406",children:"6.3.1.2.4 \u540e\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u540e\u5904\u7406\u6784\u5efa\uff08\u5e38\u7528\u7684\u65b9\u6cd5\uff1asoftmax\u3001loc\u89e3\u7801\u3001nms\u7b49\uff09\uff1a\u53c2\u8003test.py\u6216predict.py\u7b49\u6d4b\u8bd5\u811a\u672c\u3001\u73b0\u6210\u7684onnx\u63a8\u7406\u811a\u672c\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6784\u5efa\u4eba\u8138\u68c0\u6d4b\u540e\u5904\u7406\u4ee3\u7801"}),"\uff1a\u5305\u62ec\u89e3\u7801\u3001nms\u7b49\uff0c\u7531\u4e8e\u540e\u5904\u7406\u8f83\u591a\uff0c\u6211\u4eec\u53ea\u622a\u53d6\u90e8\u5206\u4ee3\u7801\u8fdb\u884c\u8bf4\u660e\uff0c\u5177\u4f53\u5b9e\u73b0\u53c2\u8003",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"\u6e90\u7801"}),"\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#face_detector.py\ndef post_process(self,loc,conf,landms):\n    loc, conf, landms = loc[0],conf[0],landms[0]\n    boxes = decode(loc, self.priors_numpy, self.cfg['variance'])\n    boxes = boxes * self.scale / 1                     #\u53f3\u3001\u4e0bpadding\n    ......\n"})}),"\n",(0,s.jsxs)(e.p,{children:["**\u53c2\u8003\uff1a**\u4eba\u8138\u68c0\u6d4brepo\u7684detect.py\uff0c\u5bf9\u6a21\u578b\u8f93\u5165\u7ed3\u679c\uff1aloc\uff08\u68c0\u6d4b\u6846\uff09\u3001conf\uff08\u5f97\u5206\uff09\u3001landms\uff08\u5173\u952e\u70b9\uff09\u8fdb\u884c\u540e\u5904\u7406\uff0c\u8fdb\u800c\u5f97\u5230\u4eba\u8138\u68c0\u6d4b\u6846\u3001\u5f97\u5206\u3001\u4e94\u5b98\u70b9\u3002 ",(0,s.jsx)(e.img,{alt:"image-20240116190012087",src:i(10933).A+"",width:"1493",height:"686"})]}),"\n",(0,s.jsx)(e.h5,{id:"63125-\u663e\u793a\u7ed3\u679c",children:"6.3.1.2.5 \u663e\u793a\u7ed3\u679c"}),"\n",(0,s.jsxs)(e.p,{children:["\u663e\u793a\u7ed3\u679c\uff1a\u5c06\u540e\u5904\u7406\u4e4b\u540e\u7684\u7ed3\u679c\u753b\u5230\u539f\u56fe\uff0c\u5177\u4f53\u5b9e\u73b0\u53c2\u8003",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"\u6e90\u7801"}),"\u3002"]}),"\n",(0,s.jsx)(e.h5,{id:"63126-\u7f16\u8bd1\u6267\u884c",children:"6.3.1.2.6 \u7f16\u8bd1\u6267\u884c"}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"\u6e90\u7801"}),"clone\u5230pc\u4e0a\uff0c\u5b89\u88c5\u4f9d\u8d56\u5e93\uff0c\u6267\u884c\u4eba\u8138\u68c0\u6d4b\u63a8\u7406\u6d41\u7a0b\uff0c\u82e5\u662f\u68c0\u6d4b\u6548\u679c\u6b63\u786e\uff0c\u5219\u8bf4\u660e\u4f7f\u7528ONNXRuntime\u63a8\u7406\u4eba\u8138\u68c0\u6d4b\u7684\u6d41\u7a0b\u662f\u6b63\u786e\u7684\uff0c\u8f6c\u6362\u7684onnx\u4e5f\u662f\u6b63\u786e\u7684\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd onnx_related/onnx_inference/face_detection\npython face_detector.py\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"face_detection_result.jpg",src:i(3688).A+"",width:"1024",height:"624"})}),"\n",(0,s.jsx)(e.h4,{id:"6313-onnx\u5230kmodel\u8f6c\u6362",children:"6.3.1.3 ONNX\u5230kmodel\u8f6c\u6362"}),"\n",(0,s.jsxs)(e.p,{children:["\u4eba\u8138\u68c0\u6d4bonnx\u6a21\u578b\u7ecf\u8fc7nncase\u7f16\u8bd1\u4e4b\u540e\uff0c\u53ef\u4ee5\u751f\u6210\u5728k230\u4e0a\u63a8\u7406\u7684\u6a21\u578bkmodel\uff0c\u751f\u6210kmodel\u9700\u8981\u8c03\u7528nncase\u7684",(0,s.jsx)(e.strong,{children:"\u7f16\u8bd1\u6a21\u578bAPIs(Python)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u7f16\u8bd1\u6a21\u578bAPI"}),"\u7684\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://developer.canaan-creative.com/ai_docs/zh/main/_images/image-20240221130451008.png",alt:"image-20240221130451008"})}),"\n",(0,s.jsx)(e.h5,{id:"63131-\u914d\u7f6e\u751f\u6210kmodel\u53c2\u6570",children:"6.3.1.3.1 \u914d\u7f6e\u751f\u6210kmodel\u53c2\u6570"}),"\n",(0,s.jsx)(e.h6,{id:"1\u7f16\u8bd1\u53c2\u6570compileoptions",children:"1.\u7f16\u8bd1\u53c2\u6570\uff1aCompileOptions"}),"\n",(0,s.jsx)(e.p,{children:"\u7f16\u8bd1\u53c2\u6570\u5305\u62ec\u7f16\u8bd1\u76ee\u6807\u53c2\u6570\u3001\u9884\u5904\u7406\u53c2\u6570\u3001\u540e\u5904\u7406\u53c2\u6570\uff0c\u7f16\u8bd1\u76ee\u6807\u53c2\u6570\u6307\u5b9a\u7f16\u8bd1\u76ee\u6807, \u5982\u2019cpu\u2019, \u2018k230\u2019\uff1b\u5e38\u7528\u9884\u5904\u7406\u53c2\u6570\u7531Transpose\u53c2\u6570\u3001SwapRB\u53c2\u6570\u3001Dequantize\u53c2\u6570\u3001Normalization\u53c2\u6570\u6784\u6210\uff1b\u540e\u5904\u7406\u53c2\u6570\u76ee\u524d\u53ea\u652f\u6301Transpose\u53c2\u6570\u3002"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u53c2\u6570\u7c7b\u522b"}),(0,s.jsx)(e.th,{children:"\u53c2\u6570\u540d\u79f0"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u7f16\u8bd1\u76ee\u6807\u53c2\u6570"}),(0,s.jsx)(e.td,{children:"target"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u9884\u5904\u7406\u53c2\u6570"}),(0,s.jsx)(e.td,{children:"input_shape\u3001input_layout\u3001 swapRB\u3001input_type\u3001input_range\u3001mean\u3001std\u7b49"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u540e\u5904\u7406\u53c2\u6570"}),(0,s.jsx)(e.td,{children:"output_layout"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u7f16\u8bd1\u76ee\u6807\u53c2\u6570\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u6307\u5b9a\u7f16\u8bd1\u76ee\u6807, \u5982'cpu', 'k230'\ncompile_options.target = args.target\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uff081\uff09target = \u201ccpu\u201d\uff0c\u751f\u6210cpu\u4e0a\u63a8\u7406\u7684kmodel\uff0c\u6b64\u65f6\u4e0d\u8fdb\u884c\u91cf\u5316\uff1b"}),"\n",(0,s.jsx)(e.p,{children:"\uff082\uff09target = \u201ck230\u201d\uff0c\u751f\u6210\u5728k230(kpu)\u4e0a\u63a8\u7406\u7684kmodel\uff0c\u6b64\u65f6\u6a21\u578b\u8fdb\u884c\u91cf\u5316\uff08\u9ed8\u8ba4uint8\u91cf\u5316\uff09\uff1b"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u9884\u5904\u7406\u53c2\u6570"}),"\uff1a\u7531\u4e8e\u9884\u5904\u7406\u53c2\u6570\u6bd4\u8f83\u590d\u6742\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u7740\u91cd\u4ecb\u7ecd\u4e0b\u5e38\u7528\u9884\u5904\u7406\u53c2\u6570\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u662f\u5426\u5f00\u542f\u524d\u5904\u7406\uff0c\u9ed8\u8ba4\u4e3aFalse\ncompile_options.preprocess = True\n"})}),"\n",(0,s.jsx)(e.p,{children:"\uff081\uff09\u9884\u5904\u7406\u53c2\u6570\uff08preprocess = False\u65f6\uff0c\u4e0d\u8fdb\u884c\u4efb\u4f55\u9884\u5904\u7406\uff0ckmodel \u2248 onnx\uff09"}),"\n",(0,s.jsx)(e.p,{children:"\uff082\uff09\u9884\u5904\u7406\u53c2\u6570\uff08preprocess = True\u65f6\uff0ckmodel \u2248 \u9884\u5904\u7406 + onnx\uff0c\u6b64\u65f6kmodel\u5305\u542b\u8bbe\u7f6e\u7684\u9884\u5904\u7406\uff0c\u8fd9\u4e9b\u9884\u5904\u7406\u4f1a\u5728KPU\u8ba1\u7b97\uff0cKPU\u8ba1\u7b97\u8f83\u5feb\uff0c\u56e0\u6b64\u6700\u597d\u5c06\u5c3d\u53ef\u80fd\u591a\u9884\u5904\u7406\u653e\u5230kmodel\u4e0a\uff09"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u9884\u5904\u7406\u64cd\u4f5c\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u76f8\u5173\u53c2\u6570"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Transpose"}),(0,s.jsx)(e.td,{children:"input_shape\u3001input_layout"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SwapRB"}),(0,s.jsx)(e.td,{children:"swapRB"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Dequantize"}),(0,s.jsx)(e.td,{children:"input_type\u3001input_range"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"Normalization"}),(0,s.jsx)(e.td,{children:"mean\u3001std"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u3010onnx\u8f93\u5165\u6570\u636e\u3011\u7684\u683c\u5f0f\u51b3\u5b9a\u4e86\u3010\u65b0\u7684\u8f93\u5165\u3011\u7684\u683c\u5f0f\uff1b"}),"\n",(0,s.jsx)(e.p,{children:"\u3010kmodel\u5b9e\u9645\u8f93\u5165\u3011\u7684\u683c\u5f0f\u51b3\u5b9a\u4e86\u3010kmodel\u8f93\u5165\u3011\u7684\u683c\u5f0f\uff1b"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240220135401913",src:i(83708).A+"",width:"717",height:"463"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Transpose\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'# \u6307\u5b9a\u8f93\u5165\u6570\u636e\u7684shape\uff0cinput_shape\u7684layout\u9700\u8981\u4e0einput layout\u4fdd\u6301\u4e00\u81f4\ncompile_options.input_shape = [1, 3, 640, 640]\n# \u5f53\u6309\u7167\u5b57\u7b26\u4e32\uff08`"NHWC"`\u3001`"NCHW"`\uff09\u5f62\u5f0f\u914d\u7f6e `input_layout`\u65f6\uff0c\u8868\u793a\u65b0\u7684\u8f93\u5165\u6570\u636e\u7684layout\ncompile_options.input_layout = "NCHW"\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u76f8\u5173\u53c2\u6570\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"input_shape"}),"\uff1a\u8f93\u5165\u6570\u636e\u7684shape\uff0cinput_shape\u7684layout\u9700\u8981\u4e0e",(0,s.jsx)(e.code,{children:"input_layout"}),"\u4fdd\u6301\u4e00\u81f4\uff1b",(0,s.jsx)(e.strong,{children:"\u5f53 preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"input_layout"}),"\uff1a\u652f\u6301\u5b57\u7b26\u4e32\uff08",(0,s.jsx)(e.code,{children:'"NHWC"'}),"\u3001",(0,s.jsx)(e.code,{children:'"NCHW"'}),"\uff09\u548cindex\u3002\u5f53\u6309\u7167\u5b57\u7b26\u4e32\uff08",(0,s.jsx)(e.code,{children:'"NHWC"'}),"\u3001",(0,s.jsx)(e.code,{children:'"NCHW"'}),"\uff09\u5f62\u5f0f\u914d\u7f6e ",(0,s.jsx)(e.code,{children:"input_layout"}),"\u65f6\uff0c\u8868\u793a\u65b0\u7684\u8f93\u5165\u6570\u636e\u7684layout\uff1b\u5f53\u6309\u7167index\u5f62\u5f0f\u914d\u7f6e ",(0,s.jsx)(e.code,{children:"input_layout"}),"\u65f6\uff0c\u8868\u793a\u8f93\u5165\u6570\u636e\u4f1a\u6309\u7167\u5f53\u524d\u914d\u7f6e\u7684 ",(0,s.jsx)(e.code,{children:"input_layout"}),"\u8fdb\u884c\u6570\u636e\u8f6c\u7f6e\uff0c\u5373 ",(0,s.jsx)(e.code,{children:"input_layout"}),"\u4e3a ",(0,s.jsx)(e.code,{children:"Transpose"}),"\u7684 ",(0,s.jsx)(e.code,{children:"perm"}),"\u53c2\u6570\uff1b",(0,s.jsx)(e.strong,{children:"\u5f53 preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5206\u6790\u8bf4\u660e\uff08\u4ee5\u5b57\u7b26\u4e32\u914d\u7f6e\u683c\u5f0f\u4e3a\u4f8b\uff09\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsxs)(e.p,{children:["\u65b0\u7684\u8f93\u5165layout\u4e0einput_layout\u4e00\u81f4\uff1b\u65b0\u7684\u8f93\u5165layout\u4e0eonnx\u8f93\u5165layout\u4e00\u81f4\uff1b",(0,s.jsx)(e.strong,{children:"\u56e0\u6b64input_layout\u4e0eonnx\u8f93\u5165layout\u4e00\u81f4"}),"\uff1b"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5f53input_layout\u4e0ekmodel\u8f93\u5165layout\u4e00\u81f4\u65f6\uff0ckmodel\u8f93\u5165\u7ecf\u8fc7transpose\u4e4b\u540e\uff0c\u751f\u6210\u7684\u65b0\u7684\u8f93\u5165\u4ecd\u662f\u4e0ekmodel\u8f93\u5165layout\u4e00\u81f4\uff1b"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\u5f53input_layout\u4e0ekmodel\u8f93\u5165layout\u4e0d\u4e00\u81f4\u65f6\uff0ckmodel\u8f93\u5165\u7ecf\u8fc7transpose\u4e4b\u540e\uff0c\u53d8\u6210\u4e0einput_layout\u4e00\u81f4\u7684\u65b0\u7684\u8f93\u5165\u3002"}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240220135401914",src:i(54931).A+"",width:"603",height:"270"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u5b9e\u9645\u63a8\u7406\u65f6"}),"\uff0c\u4eba\u8138\u68c0\u6d4bonnx\u8f93\u5165layout\uff1a",(0,s.jsx)(e.code,{children:"NCHW"}),"\uff0cshape\u662f",(0,s.jsx)(e.code,{children:"[1, 3, 640, 640]"}),"\uff0c\u6240\u4ee5",(0,s.jsx)(e.code,{children:'input_layout = "NCHW",input_shape=[1, 3, 640, 640]'})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"SwapRB\u53c2\u6570\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"compile_options.swapRB = True\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76f8\u5173\u53c2\u6570\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"swapRB"}),"\uff1a\u662f\u5426\u5728 ",(0,s.jsx)(e.code,{children:"channel"}),"\u7ef4\u5ea6\u53cd\u8f6c\u6570\u636e\uff0c\u9ed8\u8ba4\u4e3aFalse"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5206\u6790\u8bf4\u660e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5b9e\u9645\u63a8\u7406\u65f6"}),"\uff0c\u4eba\u8138\u68c0\u6d4bkmodel\u8f93\u5165\uff1a",(0,s.jsx)(e.code,{children:"rgb"}),"\u3001onnx\u8f93\u5165\uff08\u65b0\u7684\u8f93\u5165\uff09\uff1a",(0,s.jsx)(e.code,{children:"bgr"}),"\uff0c\u4e24\u8005\u987a\u5e8f",(0,s.jsx)(e.strong,{children:"\u4e0d\u540c"}),"\uff0c\u6240\u4ee5\u9700\u8981\u53cd\u8f6c",(0,s.jsx)(e.code,{children:"channel"}),"\u7ef4\u5ea6\uff0c\u6545",(0,s.jsx)(e.code,{children:"swapRB = True"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Dequantize\u53c2\u6570\uff1a"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'# \u5f53preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u4e3a"uint8"\u6216\u8005"float32"\ncompile_options.input_type = \'uint8\'            \n# input_type=\u2018uint8\u2019\u65f6\u53cd\u91cf\u5316\u6709\u6548\uff0c\u53cd\u91cf\u5316\u4e4b\u540e\u7684\u6570\u636e\u8303\u56f4\ncompile_options.input_range = [0, 255]\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76f8\u5173\u53c2\u6570\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"input_type"}),"\uff1a\u4e0ekmodel\u5b9e\u9645\u8f93\u5165\u6570\u636e\u7c7b\u578b\u4e00\u81f4\uff1b",(0,s.jsx)(e.strong,{children:"\u5f53 preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u4e3a\u201duint8\u201d\u6216\u8005\u201dfloat32"}),"\u3002"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"input_range"}),"\uff1a\u6307\u5b9a\u8f93\u5165\u6570\u636e\u53cd\u91cf\u5316\u540e\u7684",(0,s.jsx)(e.strong,{children:"\u6d6e\u70b9\u6570\u8303\u56f4"}),"\uff1b",(0,s.jsxs)(e.strong,{children:["\u5f53 ",(0,s.jsx)(e.code,{children:"preprocess"}),"\u4e3a ",(0,s.jsx)(e.code,{children:"True"}),"\u4e14 ",(0,s.jsx)(e.code,{children:"input_type"}),"\u4e3a ",(0,s.jsx)(e.code,{children:"uint8"}),"\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a"]}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\u5206\u6790\u8bf4\u660e\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u82e5kmodel ",(0,s.jsx)(e.code,{children:"input_type"}),"\u4e3afloat32\uff0c\u4e0d\u8fdb\u884c\u53cd\u91cf\u5316"]}),"\n",(0,s.jsxs)(e.li,{children:["\u82e5kmodel ",(0,s.jsx)(e.code,{children:"input_type"}),"\u4e3auint8\uff0crange\u4e3a[0,255]\uff0c\u5f53",(0,s.jsx)(e.code,{children:"input_range"}),"\u4e3a[0,255]\u65f6\uff0c\u5219\u53cd\u91cf\u5316\u7684\u4f5c\u7528\u53ea\u662f\u8fdb\u884c\u7c7b\u578b\u8f6c\u5316\uff0c\u5c06uint8\u7684\u6570\u636e\u8f6c\u5316\u4e3afloat32"]}),"\n",(0,s.jsxs)(e.li,{children:["\u82e5kmodel ",(0,s.jsx)(e.code,{children:"input_type"}),"\u4e3auint8\uff0crange\u4e3a[0,255]\uff0c\u5f53",(0,s.jsx)(e.code,{children:"input_range"}),"\u4e3a[0,1]\uff0c\u5219\u53cd\u91cf\u5316\u4f1a\u5c06\u5b9a\u70b9\u6570\u8f6c\u5316\u4e3a[0.0,1.0]\u7684\u6d6e\u70b9\u6570"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5b9e\u9645\u63a8\u7406\u65f6"}),"\uff0c\u4eba\u8138\u68c0\u6d4bkmodel\u5b9e\u9645\u8f93\u5165\u4ecesensor\u4e2d\u83b7\u53d6\uff0c\u6570\u636e\u7c7b\u578b\u4e3a",(0,s.jsx)(e.code,{children:"uint8"}),"\uff0c\u6240\u4ee5",(0,s.jsx)(e.code,{children:"input_type = 'uint8',input_range = [0,255]\u6216[0,1]\u5747\u53ef"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Normalization\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76f8\u5173\u53c2\u6570","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"mean"}),"\uff1a\u9884\u5904\u7406\u6807\u51c6\u5316\u53c2\u6570\u5747\u503c\uff0c\u9ed8\u8ba4\u4e3a[0,0,0]"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"std"}),"\uff1a\u9884\u5904\u7406\u6807\u51c6\u5316\u53c2\u6570\u65b9\u5dee\uff0c\u9ed8\u8ba4\u4e3a[1,1,1]"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.img,{alt:"image-20240220135401915",src:i(99722).A+"",width:"442",height:"477"})}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"\u5b9e\u9645\u63a8\u7406\u65f6"}),"\uff0c\u4eba\u8138\u68c0\u6d4bonnx\u7684",(0,s.jsx)(e.code,{children:"mean = [104,117,123],std = [1, 1, 1]"}),"\uff1b\u663e\u7136\u4e0a\u56fe\u5de6\u8fb9\u7684\u8bbe\u7f6e\u66f4\u52a0\u7b80\u6d01\uff0c\u4eba\u8138\u68c0\u6d4bkmodel\u7684",(0,s.jsx)(e.code,{children:"input_range = [0,255],mean = [104,117,123],std = [1, 1, 1]"}),"\u3002"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u540e\u5904\u7406\u53c2\u6570"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'# \u540e\u5904\u7406\ncompile_options.output_layout = "NCHW"\n'})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u76f8\u5173\u53c2\u6570\uff1a","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"output_layout"}),"\uff1a\u6307\u5b9a\u8f93\u51fa\u6570\u636e\u7684layout, \u5982\u2019NCHW\u2019, \u2018NHWC\u2019\uff0c\u9ed8\u8ba4\u4e3a\u201c\u201d\uff0c\u4e0d\u8fdb\u884ctranspose\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0e\u9884\u5904\u7406\u53c2\u6570\u7684",(0,s.jsx)(e.code,{children:"input_layout"}),"\u7c7b\u4f3c\uff0c\u82e5\u6a21\u578b\u672c\u8eab\u8f93\u51fa\uff08oldKmodelOutput\uff09\u7684layout\u4e0e",(0,s.jsx)(e.code,{children:"output_layout"}),"\u76f8\u540c\uff0c\u5219transpose\u4e4b\u540e\uff0cnewKmodelOutput layout\u4ecd\u4e0eoldKmodelOutput layout\u4e00\u81f4\uff1b\u82e5\u6a21\u578b\u672c\u8eab\u8f93\u51fa\uff08oldKmodelOutput\uff09\u7684layout\u4e0e",(0,s.jsx)(e.code,{children:"output_layout"}),"\u4e0d\u540c\uff0c\u5219transpose\u4e4b\u540e\uff0cnewKmodelOutput layout\u5c06\u53d8\u4e3a\u4e0e",(0,s.jsx)(e.code,{children:"output_layout"}),"\u4e00\u81f4\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240304191018189",src:i(25904).A+"",width:"564",height:"318"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u751f\u6210\u7684\u4eba\u8138\u68c0\u6d4bkmodel\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-2024030135401913",src:i(39151).A+"",width:"318",height:"612"})}),"\n",(0,s.jsx)(e.h6,{id:"2\u5bfc\u5165\u53c2\u6570importoptions",children:"2.\u5bfc\u5165\u53c2\u6570\uff1aImportOptions"}),"\n",(0,s.jsx)(e.p,{children:"ImportOptions\u7c7b, \u7528\u4e8e\u914d\u7f6enncase\u5bfc\u5165\u9009\u9879\uff0c\u5f88\u5c11\u5355\u72ec\u8bbe\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570\u5373\u53ef\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# 2. \u8bbe\u7f6e\u5bfc\u5165\u53c2\u6570\uff0cimport_options\uff08\u4e00\u822c\u9ed8\u8ba4\u5373\u53ef\uff09\nimport_options = nncase.ImportOptions()\nmodel_file = onnx_simplify(args.model, dump_dir)\nmodel_content = read_model_file(model_file)\ncompiler.import_onnx(model_content, import_options)\n"})}),"\n",(0,s.jsx)(e.h6,{id:"3\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570ptqtensoroptions",children:"3.\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570\uff1aPTQTensorOptions"}),"\n",(0,s.jsx)(e.p,{children:"\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570(Post Training Quantization\uff0cPTQ)\uff0cPTQ\u662f\u4e00\u79cd\u901a\u8fc7\u5c06\u6a21\u578b\u6743\u91cd\u4ecefloat32\u6620\u5c04uint8\u6216int16\u65b9\u6cd5\uff0c\u4fdd\u6301\u6a21\u578b\u7684\u51c6\u786e\u6027\u7684\u540c\u65f6\uff0c\u51cf\u5c11\u63a8\u7406\u6240\u9700\u7684\u8ba1\u7b97\u8d44\u6e90\uff1b\u5f53target = \u201ck230\u201d\uff0cPTQ\u662f\u5fc5\u9009\u53c2\u6570\uff0c\u9ed8\u8ba4uint8\u91cf\u5316\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528uint8\u91cf\u5316\u53ef\u4ee5\u6ee1\u8db3\u4eba\u8138\u68c0\u6d4b\u7cbe\u5ea6\u8981\u6c42\uff0c\u6545\u4f7f\u7528\u9ed8\u8ba4uint8\u91cf\u5316\uff1b\u6821\u6b63\u96c6\u4e2a\u6570\u4e3a100\uff1b\u5047\u8bbe\u4f7f\u7528100\u4e2a\u6821\u6b63\u96c6\u751f\u6210kmodel\u7684\u65f6\u95f4\u5f88\u4e45\uff0c\u53ef\u4ee5\u9002\u5f53\u7684\u51cf\u5c11\u6821\u6b63\u96c6\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# 3. \u8bbe\u7f6e\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570\uff0cptq_options\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 100\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\ncompiler.use_ptq(ptq_options)\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63132-\u6821\u6b63\u96c6\u51c6\u5907",children:"6.3.1.3.2 \u6821\u6b63\u96c6\u51c6\u5907"}),"\n",(0,s.jsx)(e.p,{children:"\u56e0\u4e3a\u751f\u6210kmodel\u65f6\uff0c\u4f7f\u7528\u4e86\u540e\u5904\u7406\u91cf\u5316\uff0c\u56e0\u6b64\u9700\u8981\u51c6\u5907\u6821\u6b63\u96c6\u3002\u4f7f\u7528\u5c11\u91cf\u6821\u6b63\u96c6\u8ba1\u7b97\u91cf\u5316\u56e0\u5b50\uff0c\u53ef\u4ee5\u5feb\u901f\u5f97\u5230\u91cf\u5316\u6a21\u578b\u3002\u4f7f\u7528\u8be5\u91cf\u5316\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u53ef\u5728\u4fdd\u8bc1\u6a21\u578b\u51c6\u786e\u6027\u7684\u540c\u65f6\uff0c\u51cf\u5c11\u8ba1\u7b97\u91cf\u3001\u964d\u4f4e\u8ba1\u7b97\u5185\u5b58\u3001\u51cf\u5c0f\u6a21\u578b\u5927\u5c0f\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6821\u6b63\u96c6"}),"\u4e00\u822c\u9009\u7528",(0,s.jsx)(e.strong,{children:"\u9a8c\u8bc1\u96c6"}),"\u7684",(0,s.jsx)(e.strong,{children:"100\u5f20\u56fe\u7247"}),"\u5373\u53ef\uff0c",(0,s.jsx)(e.a,{href:"https://github.com/biubug6/Pytorch_Retinaface",children:"\u4eba\u8138\u68c0\u6d4b\u6a21\u578b"}),"\u7684",(0,s.jsx)(e.strong,{children:"\u9a8c\u8bc1\u96c6"}),(0,s.jsx)(e.code,{children:"WIDER_val"}),"\uff0c\u6545\u9009\u7528",(0,s.jsx)(e.code,{children:"WIDER_val"}),"\u7684100\u5f20\u56fe\u50cf\u4f5c\u4e3a\u6821\u6b63\u96c6\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6ce8\uff1a"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09\u82e5\u662fkmodel",(0,s.jsx)(e.strong,{children:"\u751f\u6210\u65f6\u95f4\u5f88\u4e45"}),"\u6216\u8005\u9a8c\u8bc1\u96c6\u6570\u636e\u5f88\u5c11\uff0c\u4e5f\u53ef\u5c1d\u8bd5\u5c11\u4e8e100\u4e2a\u6570\u636e"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.code,{children:"generate_data"}),"\u51fd\u6570\uff0c\u751f\u6210\u7684\u6570\u636e\u683c\u5f0f\uff0c\u9700\u8981",(0,s.jsx)(e.strong,{children:"\u5c3d\u91cf\u4fdd\u8bc1"}),"\u4e0e\u5b9e\u9645\u63a8\u7406\u65f6\u5582\u7ed9kmodel\u7684\u6570\u636e\u683c\u5f0f\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u751f\u6210kmodel\u6709\u95ee\u9898\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"def generate_data(shape, batch, calib_dir):\n    #\u83b7\u53d6\u6240\u6709\u6821\u6b63\u96c6\u56fe\u7247\u540d\u79f0\n    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]\n    data = []\n    for i in range(batch):\n        assert i < len(img_paths), \"calibration images not enough.\"\n        #\u751f\u6210\u7684\u6570\u636e\u9700\u8981\u505a\u7684\u9884\u5904\u7406 \u2248 onnx\u9884\u5904\u7406 - \u6839\u636e\u9884\u5904\u7406\u53c2\u6570\u8bbe\u7f6e\u7684\uff0c\u5305\u542b\u5728kmodel\u4e2d\u9884\u5904\u7406\n        #onnx\u9884\u5904\u7406\uff1abgr,padding,reisze,transpose,normalization,dequantize,3\u7ef4\u5ea6\u8f6c4\u7ef4\u5ea6\n        #kmodel\u4e2d\u5305\u542b\u7684\u9884\u5904\u7406\uff1argb->bgr,dequantize,normalization\n        img_data = Image.open(img_paths[i]).convert('RGB')\n        #\u4e3a\u4e86\u7701\u4e8b\uff0c\u8fd9\u91cc\u6ca1\u6709\u7528padding\n        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)  \n        img_data = np.asarray(img_data, dtype=np.uint8)\n        img_data = np.transpose(img_data, (2, 0, 1))\n        data.append([img_data[np.newaxis, ...]])\n    return np.array(data)\n\ninput_shape = [1, 3, 640, 640]\n......\nptq_options = nncase.PTQTensorOptions()\n    ptq_options.samples_count = 100\n    # \u6821\u6b63\u96c6\u6570\u636e\u9884\u5904\u7406\uff0c\u5c06\u539f\u56fe\u5904\u7406\u4e3akmodel\u9700\u8981\u6570\u636e\n    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n    # \u4f7f\u7528100\u4e2a\u6821\u51c6\u6570\u636e\u8ba1\u7b97\u91cf\u5316\u56e0\u5b50\n    compiler.use_ptq(ptq_options)\n......\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63133-\u751f\u6210kmodel",children:"6.3.1.3.3 \u751f\u6210kmodel"}),"\n",(0,s.jsxs)(e.p,{children:["\u751f\u6210\u4eba\u8138\u68c0\u6d4bkmodel\u5b8c\u6574\u4ee3\u7801\u793a\u4f8b\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/blob/main/kmodel_related/kmodel_export/face_detection/mobile_retinaface_data_100_640.py",children:"mobile_retinaface_data_100_640.py"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u6210\u73af\u5883"}),"\uff1a6.2.2 \u6784\u5efa\u7684\u7f16\u8bd1\u73af\u5883"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u6210\u6b65\u9aa4"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"cd src/reference\n#\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd kmodel_related/kmodel_export\n./build_model.sh\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"-rw-r--r-- 1 root root  715216 Feb 28 16:08 face_detect_640.kmodel     #\u4eba\u8138\u68c0\u6d4bkmodel\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6e29\u99a8\u63d0\u793a"}),"\uff1a\u751f\u6210kmodel\u65f6\u9700\u8981\u914d\u7f6e\u591a\u4e2a\u53c2\u6570\uff0c\u6b63\u786e\u7406\u89e3\u548c\u914d\u7f6e\u8fd9\u4e9b\u53c2\u6570\u662f\u786e\u4fdd\u6210\u529f\u751f\u6210kmodel\u7684",(0,s.jsx)(e.strong,{children:"\u5173\u952e"}),"\u3002\u6211\u4eec\u6df1\u77e5\u53c2\u6570\u914d\u7f6e\u7684\u590d\u6742\u6027\uff0c\u4f46\u662f\u4e3a\u4e86\u7ed9\u7528\u6237\u63d0\u4f9b\u6b63\u786e\u7684\u53c2\u6570\u914d\u7f6e\uff0c\u6211\u4eec\u4e00\u6b21\u6027\u63d0\u4f9b\u4e86\u6240\u6709\u6b63\u786e\u7684\u914d\u7f6e\uff0c\u4f46\u5bf9\u4e8e\u4e0d\u592a\u719f\u6089kmodel\u751f\u6210\u7684\u7528\u6237\u6765\u8bf4\uff0c\u4ecd\u7136\u5b58\u5728\u914d\u7f6e\u9519\u8bef\u7684\u53ef\u80fd\u6027\u3002\u9519\u8bef\u7684\u53c2\u6570\u914d\u7f6e\u5c06\u5bfc\u81f4\u751f\u6210\u7684kmodel\u5b58\u5728\u95ee\u9898\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u4e3a\u4e86\u5e2e\u52a9\u5927\u5bb6\u66f4\u597d\u5730\u7406\u89e3\u8fd9\u4e00\u8fc7\u7a0b\uff0c",(0,s.jsx)(e.strong,{children:"\u5efa\u8bae"}),"\u5c1d\u8bd5\u4fee\u6539\u914d\u7f6e\u53c2\u6570\u4e3a\u4e0d\u540c\u503c\uff0c\u89c2\u5bdf\u751f\u6210\u7684kmodel\u7684\u53d8\u5316\u548c\u5bf9\u6700\u7ec8\u63a8\u7406\u7ed3\u679c\u7684\u5f71\u54cd\u3002\u901a\u8fc7\u8fd9\u6837\u7684\u5b9e\u8df5\uff0c\u53ef\u4ee5\u66f4\u6df1\u5165\u5730\u7406\u89e3\u5404\u53c2\u6570\u7684\u4f5c\u7528\u548c\u76f8\u4e92\u5173\u7cfb\u3002\u8fd9\u79cd\u65b9\u5f0f\u5c06\u4f7f\u7528\u6237\u66f4\u719f\u6089kmodel\u751f\u6210\u7684\u6d41\u7a0b\uff0c\u6709\u52a9\u4e8e\u66f4\u51c6\u786e\u5730\u914d\u7f6e\u53c2\u6570\u4ee5\u83b7\u5f97\u6240\u9700\u7684\u7ed3\u679c\u3002"]}),"\n",(0,s.jsx)(e.h4,{id:"6314-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",children:"6.3.1.4 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u4e3a\u4e86\u9a8c\u8bc1kmodel\u6b63\u786e\u6027\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528K230Runtime\u5bf9kmodel\u8fdb\u884c\u63a8\u7406\uff0c\u63a8\u7406\u65f6\u4fdd\u8bc1\u8bfb\u53d6\u56fe\u7247\u3001\u9884\u5904\u7406\u3001run\u3001\u540e\u5904\u7406\u3001\u663e\u793a\u7ed3\u679c\u4e0eonnx\u7684\u5bf9\u5e94\u6d41\u7a0b\u4e00\u81f4\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"onnx2kmodel.png",src:i(46232).A+"",width:"819",height:"201"})}),"\n",(0,s.jsx)(e.p,{children:"\u7531\u4e8eK230\u5f00\u53d1\u677f\u8c03\u8bd5\u8d77\u6765\u6bd4\u8f83\u590d\u6742\uff0c\u56e0\u6b64\u6211\u4eec\u63d0\u4f9b\u4e00\u4e9b\u8f85\u52a9\u5de5\u5177\uff0c\u5e76\u5206\u4eab\u76f8\u5173\u7ecf\u9a8c\u6765\u5e2e\u52a9\u7528\u6237\u9a8c\u8bc1K230\u7aef\u63a8\u7406\u7684\u6b63\u786e\u6027\u3002\u7531\u4e8e\u63a8\u7406\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8981\u7684\u90e8\u5206\u662frun\u3001\u9884\u5904\u7406\u3001\u540e\u5904\u7406\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5206\u522b\u5bf9\u8fd93\u4e2a\u90e8\u5206\u8c03\u8bd5\u7684\u5e38\u7528\u65b9\u6cd5\u8fdb\u884c\u8bf4\u660e\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"run\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Simulator\uff1a\u5728PC\u7aef\u6a21\u62dfkmodel\u5728k230\u7684\u63a8\u7406\u8fc7\u7a0b\uff0c\u7528\u4e8e\u5bf9\u6bd4kmodel\u548connx\u8f93\u51fa\u662f\u5426\u4e00\u81f4\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"main_nncase\uff1a\u5728K230\u7aef\u63a8\u7406kmodel\uff0c\u7528\u4e8e\u5bf9\u6bd4\u6a21\u62df\u63a8\u7406kmodel\u4e0e\u5b9e\u9645\u63a8\u7406kmodel\u7ed3\u679c\u662f\u5426\u4e00\u81f4\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u82e5\u662f\u4e24\u8005\u90fd\u6ca1\u6709\u95ee\u9898\uff0c\u5219\u8bf4\u660e\u751f\u6210kmodel\u662f\u6b63\u786e\u7684\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u9884\u5904\u7406\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u539f\u56fe\u9884\u5904\u7406\u4e4b\u540e\uff0cdump\u9884\u5904\u7406\u540e\u7684\u56fe\u50cf\uff0c\u67e5\u770b\u9884\u5904\u7406\u662f\u5426\u6b63\u786e\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u540e\u5904\u7406\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5728Simulator\u6b63\u786e\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06Simulator\u8f93\u51fabin\u6587\u4ef6\u4f5c\u4e3akmodel\u8f93\u51fa\uff0c\u5582\u7ed9\u540e\u5904\u7406\uff0c\u770b\u540e\u5904\u7406\u7ed3\u679c\u662f\u5426\u4e0eONNX\u540e\u5904\u7406\u7ed3\u679c\u662f\u5426\u4e00\u81f4\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.h5,{id:"63141-\u4f7f\u7528simulator\u9a8c\u8bc1kmodel",children:"6.3.1.4.1 \u4f7f\u7528Simulator\u9a8c\u8bc1kmodel"}),"\n",(0,s.jsx)(e.p,{children:"Simulator\uff1a\u5728PC\u7aef\u6a21\u62dfkmodel\u5728k230\u7684\u63a8\u7406\u8fc7\u7a0b\uff0c\u7528\u4e8e\u5bf9\u6bd4kmodel\u548connx\u8f93\u51fa\u662f\u5426\u4e00\u81f4\uff1b"}),"\n",(0,s.jsx)(e.h6,{id:"1\u751f\u6210inputbin",children:"1.\u751f\u6210input.bin"}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u4f7f\u7528Simulator\u9a8c\u8bc1kmodel\u4e4b\u524d\uff0c\u9700\u8981\u5148\u51c6\u5907\u597d\u8f93\u5165\u6587\u4ef6\u3002\u7531\u4e8ekmodel\u5305\u62ec\u90e8\u5206\u9884\u5904\u7406\uff0c\u56e0\u6b64\u5bf9\u4e8e\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u9700\u8981\u5206\u522b\u5229\u7528\u4e0d\u540c\u9884\u5904\u7406\u751f\u6210",(0,s.jsx)(e.code,{children:"onnx_input.bin\u3001kmodel_input.bin"}),"\u3002"]}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u540d\u79f0"}),(0,s.jsx)(e.th,{children:"onnx_input.bin\u6784\u5efa\u6d41\u7a0b"}),(0,s.jsx)(e.th,{children:"kmodel_input.bin\u6784\u5efa\u6d41\u7a0b"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\u6e90->\u76ee\u6807"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\uff08uint8,hwc,bgr->float32,nchw,bgr\uff09"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\uff08uint8,hwc,bgr->uint8,nchw,rgb\uff09"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u539f\u56fe"}),(0,s.jsx)(e.td,{children:"\uff081024,624,3\uff09\uff0cuint8\uff0chwc\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\uff081024,624,3\uff09\uff0cuint8\uff0chwc\uff0cbgr"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"padding"}),(0,s.jsx)(e.td,{children:"\uff081024,1024,3\uff09, uint8\uff0chwc\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\uff081024,1024,3\uff09, uint8\uff0chwc\uff0cbgr"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"resize"}),(0,s.jsx)(e.td,{children:"\uff08640,640,3\uff09, uint8\uff0chwc\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\uff08640,640,3\uff09, uint8\uff0chwc\uff0cbgr"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"dequantize"}),(0,s.jsx)(e.td,{children:"\uff08640,640,3\uff09, float32\uff0chwc\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\u2014"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"normalization"}),(0,s.jsx)(e.td,{children:"\uff08640,640,3\uff09\uff0cfloat32\uff0chwc\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\u2014"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"bgr->rgb"}),(0,s.jsx)(e.td,{children:"\u2014"}),(0,s.jsx)(e.td,{children:"\uff08640,640,3\uff09, uint8\uff0chwc\uff0crgb"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"transpose"}),(0,s.jsx)(e.td,{children:"\uff083,640,640\uff09\uff0cfloat32\uff0cchw\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\uff083,640,640\uff09\uff0cuint8\uff0cchw\uff0crgb"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u7ef4\u5ea6\u6269\u5c55\uff08\u975e\u5fc5\u987b\uff09"}),(0,s.jsx)(e.td,{children:"\uff081,3,640,640\uff09\uff0cfloat32\uff0cchw\uff0cbgr"}),(0,s.jsx)(e.td,{children:"\uff081,3,640,640\uff09\uff0cuint8\uff0cchw\uff0crgb"})]})]})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8"}),"\uff1a\u7531\u4e8e\u751f\u6210\u7684kmodel\u4e2d\u5305\u542b\u90e8\u5206\u9884\u5904\u7406\uff0c\u751f\u6210kmodel_input.bin\u9700\u8981\u7684\u9884\u5904\u7406 \u2248 \u751f\u6210onnx_input.bin\u9700\u8981\u7684\u9884\u5904\u7406 - kmodel\u4e2d\u5305\u542b\u7684\u9884\u5904\u7406\uff08\u4eba\u8138\u68c0\u6d4bkmodel\u4e2d\u9884\u5904\u7406transpose\u3001dequantize\u3001normalization\u3001swapRB\uff09"]}),"\n",(0,s.jsx)(e.p,{children:"\uff081\uff09\u7ef4\u5ea6\u6269\u5c55\u53ef\u4ee5\u7701\u7565\uff08\u8bfb\u53d6\u65f6bin\u6587\u4ef6\u53ef\u4ee5\u7528reshape\uff0c\u751f\u6210bin\u65f6\u53ef\u4ee5\u7701\u7565\uff09\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\uff082\uff09kmodel_input.bin\u4e3a\u4ec0\u4e48\u65e0\u9700\u8fdb\u884cdequantize\u3001normalization\u64cd\u4f5c\uff1fdequantize\u3001normalization\u5df2\u653e\u5230kmodel\u4e2d\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\uff083\uff09\u4e3a\u4ec0\u4e48\u9700\u8981\u751f\u6210kmodel_input.bin\u9700\u8981bgr->rgb\uff1f\u751f\u6210\u4eba\u8138\u68c0\u6d4bkmode\u65f6\uff0c\u7531\u4e8e\u5b9e\u9645\u9700\u8981\uff0c\u9884\u5904\u7406\u6253\u5f00\u4e86swapRB\u5f00\u5173\uff0c\u7528\u4e8ergb->bgr\uff0c\u5bf9\u5e94\u7684\uff0c\u751f\u6210kmodel_input.bin\u65f6\uff0c\u5219\u9700\u8981\u5148\u5c06\u6570\u636e\u8f6c\u6210rgb\u987a\u5e8f\uff1b"}),"\n",(0,s.jsxs)(e.p,{children:["\uff084\uff09transpose\u4e5f\u653e\u5230kmodel\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u751f\u6210kmodel_input.bin\u4ecd\u9700transpose\uff1f\u7531\u4e8e\u751f\u6210kmodel\uff0c\u82e5\u662f\u6253\u5f00\u4e86\u9884\u5904\u7406\u5f00\u5173\uff0ctranspose\u7684\u76f8\u5173\u53c2\u6570\u5fc5\u987b\u8bbe\u7f6e\uff0c\u6211\u4eec\u4eba\u8138\u68c0\u6d4bkmodel\u7684\u5b9e\u9645\u8f93\u5165\u662f",(0,s.jsx)(e.code,{children:"NCHW"}),"\uff0cinput_layout\u8bbe\u7f6e\u4e3a",(0,s.jsx)(e.code,{children:"NCHW"}),"\uff0c\u4e24\u8005\u662f\u4e00\u81f4\u7684\uff0c\u56e0\u6b64transpose\u662fNCHW2NCHW\uff0c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u8f6c\u6362\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u6210input.bin\u7684\u8fc7\u7a0b"}),"\uff1a\uff08\u653e\u5728onnx\u63a8\u7406\u7684\u9884\u5904\u7406\u65b9\u6cd5\u4e2d\uff09"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240219144839973",src:i(48065).A+"",width:"1184",height:"771"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240220185134172",src:i(21469).A+"",width:"1439",height:"821"})}),"\n",(0,s.jsx)(e.h6,{id:"2simulator\u9a8c\u8bc1",children:"2.Simulator\u9a8c\u8bc1"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6a21\u62df\u5668APIs"}),"\u7684\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240221140036235",src:i(94958).A+"",width:"255",height:"431"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Simulator\u6d41\u7a0b\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u5206\u522b\u5229\u7528\u4e0d\u540c\u9884\u5904\u7406\u751f\u6210\u4e0d\u540c\u7684onnx_input.bin\u3001kmodel_input.bin\uff0c"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5c06onnx_input.bin\u5582\u7ed9onnx\uff0c\u7ecf\u8fc7onnx\u63a8\u7406\u5f97cpu_results\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u5c06kmodel_input.bin\u5582\u7ed9kmodel\uff0c\u7ecf\u8fc7Simulator\u63a8\u7406\u5f97\u5230nncase_results\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u8ba1\u7b97cpu_results\u548cnncase_results\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff0c\u901a\u8fc7\u76f8\u4f3c\u5ea6\u7684\u5927\u5c0f\u6765\u5224\u65ad\u751f\u6210\u7684kmodel\u662f\u5426\u6b63\u786e\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# mobile_retinaface_onnx_simu_640.py\nimport os\nimport copy\nimport argparse\nimport numpy as np\nimport onnx\nimport onnxruntime as ort\nimport nncase\n\ndef read_model_file(model_file):\n    with open(model_file, 'rb') as f:\n        model_content = f.read()\n    return model_content\n\ndef cosine(gt, pred):\n    return (gt @ pred) / (np.linalg.norm(gt, 2) * np.linalg.norm(pred, 2))\n\ndef main():\n    parser = argparse.ArgumentParser(prog=\"nncase\")\n    parser.add_argument(\"--target\", type=str, help='target to run')\n    parser.add_argument(\"--model\", type=str, help='original model file')\n    parser.add_argument(\"--model_input\", type=str, help='input bin file for original model')\n    parser.add_argument(\"--kmodel\", type=str, help='kmodel file')\n    parser.add_argument(\"--kmodel_input\", type=str, help='input bin file for kmodel')\n    args = parser.parse_args()\n\n    # 1. onnx\u63a8\u7406\uff0c\u5f97\u5230cpu_results\n    ort_session = ort.InferenceSession(args.model)\n    output_names = []\n    model_outputs = ort_session.get_outputs()\n    for i in range(len(model_outputs)):\n        output_names.append(model_outputs[i].name)\n    model_input = ort_session.get_inputs()[0]\n  \n    model_input_name = model_input.name\n    model_input_type = np.float32\n    model_input_shape = model_input.shape\n    print('onnx_input\uff1a',model_input_shape)\n    model_input_data = np.fromfile(args.model_input, model_input_type).reshape(model_input_shape)\n    cpu_results = []\n    cpu_results = ort_session.run(output_names, { model_input_name : model_input_data })\n\n    \n    # 2. Simulator\u63a8\u7406\uff0c\u5f97\u5230nncase_results\n    # create Simulator\n    sim = nncase.Simulator()\n\n    # read kmodel\n    kmodel = read_model_file(args.kmodel)\n\n    # load kmodel\n    sim.load_model(kmodel)\n\n    # read input.bin\n    input_shape = [1, 3, 640, 640]\n    dtype = sim.get_input_desc(0).dtype\n    input = np.fromfile(args.kmodel_input, dtype).reshape(input_shape)\n\n    # set input for Simulator\n    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(input))\n\n    # Simulator inference\n    nncase_results = []\n    sim.run()\n    for i in range(sim.outputs_size):\n        nncase_result = sim.get_output_tensor(i).to_numpy()\n        # print(\"nncase_result:\",nncase_result)\n        input_bin_file = 'bin/face_det_{}_{}_simu.bin'.format(i,args.target)\n        nncase_result.tofile(input_bin_file)\n        nncase_results.append(copy.deepcopy(nncase_result))\n\n    # 3. \u8ba1\u7b97onnx\u548cSimulator\u76f8\u4f3c\u5ea6\n    for i in range(sim.outputs_size):\n        cos = cosine(np.reshape(nncase_results[i], (-1)), np.reshape(cpu_results[i], (-1)))\n        print('output {0} cosine similarity : {1}'.format(i, cos))\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0a\u8fb9\u7684\u811a\u672c\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206onnx\u53ca\u5176kmodel\u7684\u5bf9\u6bd4\u9a8c\u8bc1\uff0c\u4e00\u822c\u4e0d\u7528\u592a\u591a\u4fee\u6539\u3002\u53ea\u9700\u6839\u636e\u6a21\u578b\u5b9e\u9645\u8f93\u5165\u5927\u5c0f\u4fee\u6539",(0,s.jsx)(e.code,{children:"input_shape"}),"\u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"python mobile_retinaface_onnx_simu_640.py \\\n        --target k230 --model onnx/FaceDetector.onnx \\\n        --model_input bin/face_det_0_640x640_float32.bin \\\n        --kmodel onnx/k230_face_detection_data_100_640.kmodel \\\n        --kmodel_input bin/face_det_0_640x640_uint8.bin\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd kmodel_related/kmodel_export\n./build_model.sh\n"})}),"\n",(0,s.jsxs)(e.p,{children:["onnx\u548cSimulator\u4f59\u5f26\u76f8\u4f3c\u5ea6\u8d8a\u9ad8\u8d8a\u597d\uff0c\u4e00\u822c0.99\u4ee5\u4e0a\u5373\u53ef\u6ee1\u8db3\u6761\u4ef6\uff1b\u82e5\u662f\u8fbe\u4e0d\u52300.99\uff0c\u4f46\u662f\u57280.95\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fdb\u4e00\u6b65",(0,s.jsx)(e.strong,{children:"\u4e0a\u677f\u9a8c\u8bc1"}),"\u6765\u5224\u65ad\u751f\u6210\u7684kmodel\u662f\u5426\u6ee1\u8db3\u5b9e\u9645\u9700\u6c42\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240220191227828",src:i(32747).A+"",width:"1462",height:"525"})}),"\n",(0,s.jsx)(e.p,{children:"**\u6ce8\uff1a**\u5728\u6267\u884csimulator\u65f6\uff0c\u5fc5\u987b\u5148\u6dfb\u52a0\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\uff08build_model.sh\u6587\u4ef6\u5176\u4e2d\u542b\u6709\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"export NNCASE_PLUGIN_PATH=$NNCASE_PLUGIN_PATH:/usr/local/lib/python3.8/dist-packages/\nexport PATH=$PATH:/usr/local/lib/python3.8/dist-packages/\nsource /etc/profile\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63142-\u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",children:"6.3.1.4.2 \u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel"}),"\n",(0,s.jsxs)(e.p,{children:["Simulator\u63a8\u7406kmodel\u548c\u4e0a\u677f\u63a8\u7406kmodel\u4e00\u822c\u6765\u8bf4\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u662f\u4e0d\u6392\u9664\u4e2a\u522b\u60c5\u51b5\u4e0bSimulator\u4e0e\u5b9e\u9645\u4e0a\u677f\u4ecd\u6709\u4e00\u5b9a\u5dee\u5f02\uff0c\u4e3a\u4e86\u9a8c\u8bc1\u4e24\u8005\u662f\u5426\u4e00\u81f4\uff0c\u9700\u8981\u4f7f\u7528main_nncase\u5de5\u5177\u8f85\u52a9\u9a8c\u8bc1Simulator\u63a8\u7406kmodel\u4e0e\u5b9e\u9645\u63a8\u7406kmodel\u7ed3\u679c\u662f\u5426\u4e00\u81f4\uff1b\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u9700\u8981\u8c03\u7528nncase\u7684",(0,s.jsx)(e.strong,{children:"KPU\u8fd0\u884c\u65f6APIs(C++)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["KPU\u8fd0\u884c\u65f6APIs\u63d0\u4f9bkmodel\u4e0a\u677f\u63a8\u7406\u7684\u5404\u79cd\u63a5\u53e3 \uff0c\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240221141307953",src:i(78401).A+"",width:"310",height:"356"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"main_nncase\u9a8c\u8bc1\u6d41\u7a0b"}),"\uff08\u5bf9K230\u7684KPU\u8c03\u7528\u6709\u4e2a\u5927\u6982\u7684\u5370\u8c61\uff09\uff1a"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u52a0\u8f7dkmodel"}),"\n",(0,s.jsx)(e.li,{children:"\u8bbe\u7f6ekmodel\u8f93\u5165\uff1a\u8bfb\u53d6kmodel_input.bin\u6587\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"\u8bbe\u7f6ekmodel\u8f93\u51fa"}),"\n",(0,s.jsx)(e.li,{children:"\u63a8\u7406kmodel"}),"\n",(0,s.jsx)(e.li,{children:"\u83b7\u53d6kmodel\u8f93\u51fa"}),"\n",(0,s.jsx)(e.li,{children:"\u5bf9\u6bd4Simulator\u63a8\u7406kmodel\u3001\u4e0a\u677f\u63a8\u7406kmodel\u7ed3\u679c\u76f8\u4f3c\u6027"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8"}),"\uff1amain_nncase\u5de5\u5177\u53ef\u4ee5\u9002\u914d\u6240\u6709kmodel\u7684\u9a8c\u8bc1\uff0c\u65e0\u9700\u81ea\u5df1\u4fee\u6539\u3002\u53ea\u9700\u6267\u884c\u65f6\uff0c\u4fee\u6539\u547d\u4ee4\u884c\u7684\u5bf9\u5e94\u53c2\u6570\u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//main_nncase.cc\n#include <chrono>\n#include <fstream>\n#include <iostream>\n#include <nncase/runtime/runtime_tensor.h>\n#include <nncase/runtime/interpreter.h>\n#include <nncase/runtime/runtime_op_utility.h>\n\nusing namespace nncase;\nusing namespace nncase::runtime;\nusing namespace nncase::runtime::detail;\n\n#define USE_CACHE 1\n\ntemplate <class T>\nstd::vector<T> read_binary_file(const char *file_name)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    std::vector<T> vec(len / sizeof(T), 0);\n    ifs.seekg(0, ifs.beg);\n    ifs.read(reinterpret_cast<char *>(vec.data()), len);\n    ifs.close();\n    return vec;\n}\n\nvoid read_binary_file(const char *file_name, char *buffer)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    ifs.seekg(0, ifs.beg);\n    ifs.read(buffer, len);\n    ifs.close();\n}\n\ntemplate <typename T>\ndouble dot(const T *v1, const T *v2, size_t size)\n{\n    double ret = 0.f;\n    for (size_t i = 0; i < size; i++)\n    {\n        ret += v1[i] * v2[i];\n    }\n\n    return ret;\n}\n\ntemplate <typename T>\ndouble cosine(const T *v1, const T *v2, size_t size)\n{\n    return dot(v1, v2, size) / ((sqrt(dot(v1, v1, size)) * sqrt(dot(v2, v2, size))));\n}\n\nvoid dump(const std::string &info, volatile float *p, size_t size)\n{\n    std::cout << info << " dump: p = " << std::hex << (void *)p << std::dec << ", size = " << size << std::endl;\n    volatile unsigned int *q = reinterpret_cast<volatile unsigned int *>(p);\n    for (size_t i = 0; i < size; i++)\n    {\n        if ((i != 0) && (i % 4 == 0))\n        {\n            std::cout << std::endl;\n        }\n\n        std::cout << std::hex << q[i] << " ";\n    }\n    std::cout << std::dec << std::endl;\n}\n\nint main(int argc, char *argv[])\n{\n    std::cout << "case " << argv[0] << " build " << __DATE__ << " " << __TIME__ << std::endl;\n    if (argc < 4)\n    {\n        std::cerr << "Usage: " << argv[0] << " <kmodel> <input_0.bin> <input_1.bin> ... <input_N.bin> <output_0.bin> <output_1.bin> ... <output_N.bin>" << std::endl;\n        return -1;\n    }\n\n    interpreter interp;                             \n\n    // 1. load model\n    std::ifstream in_before_load_kmodel("/proc/media-mem");\n    std::string line_before_load_kmodel;\n    // \u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u67e5\u770bMMZ\u4f7f\u7528\u60c5\u51b5\n    while (std::getline(in_before_load_kmodel, line_before_load_kmodel)) { \n        std::cout << line_before_load_kmodel << std::endl;\n    }\n\n    std::ifstream ifs(argv[1], std::ios::binary);\n    interp.load_model(ifs).expect("Invalid kmodel");\n\n    std::ifstream in_after_load_kmodel("/proc/media-mem");\n    std::string line_after_load_kmodel;\n    // \u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u67e5\u770bMMZ\u4f7f\u7528\u60c5\u51b5\n    while (std::getline(in_after_load_kmodel, line_after_load_kmodel)) {  \n        std::cout << line_after_load_kmodel << std::endl;  \n    }\n\n    // 2. set inputs\n    for (size_t i = 2, j = 0; i < 2 + interp.inputs_size(); i++, j++)\n    {\n        auto desc = interp.input_desc(j);\n        auto shape = interp.input_shape(j);\n        auto tensor = host_runtime_tensor::create(desc.datatype, shape, hrt::pool_shared).expect("cannot create input tensor");\n        auto mapped_buf = std::move(hrt::map(tensor, map_access_::map_write).unwrap());\n#if USE_CACHE\n        read_binary_file(argv[i], reinterpret_cast<char *>(mapped_buf.buffer().data()));\n#else\n        auto vec = read_binary_file<unsigned char>(argv[i]);\n        memcpy(reinterpret_cast<void *>(mapped_buf.buffer().data()), reinterpret_cast<void *>(vec.data()), vec.size());\n        // dump("app dump input vector", (volatile float *)vec.data(), 32);\n#endif\n        auto ret = mapped_buf.unmap();\n        ret = hrt::sync(tensor, sync_op_t::sync_write_back, true);\n        if (!ret.is_ok())\n        {\n            std::cerr << "hrt::sync failed" << std::endl;\n            std::abort();\n        }\n\n        // dump("app dump input block", (volatile float *)block.virtual_address, 32);\n        interp.input_tensor(j, tensor).expect("cannot set input tensor");\n    }\n\n    // 3. set outputs\n    for (size_t i = 0; i < interp.outputs_size(); i++)\n    {\n        auto desc = interp.output_desc(i);\n        auto shape = interp.output_shape(i);\n        auto tensor = host_runtime_tensor::create(desc.datatype, shape, hrt::pool_shared).expect("cannot create output tensor");\n        interp.output_tensor(i, tensor).expect("cannot set output tensor");\n    }\n\n    // 4. run\n    auto start = std::chrono::steady_clock::now();\n    interp.run().expect("error occurred in running model");\n    auto stop = std::chrono::steady_clock::now();\n    double duration = std::chrono::duration<double, std::milli>(stop - start).count();\n    std::cout << "interp run: " << duration << " ms, fps = " << 1000 / duration << std::endl;\n\n    // 5. get outputs\n    for (int i = 2 + interp.inputs_size(), j = 0; i < argc; i++, j++)\n    {\n        auto out = interp.output_tensor(j).expect("cannot get output tensor");\n        auto mapped_buf = std::move(hrt::map(out, map_access_::map_read).unwrap());\n        auto expected = read_binary_file<unsigned char>(argv[i]);\n\n        // 6. compare\n        int ret = memcmp((void *)mapped_buf.buffer().data(), (void *)expected.data(), expected.size());\n        if (!ret)\n        {\n            std::cout << "compare output " << j << " Pass!" << std::endl;\n        }\n        else\n        {\n            auto cos = cosine((const float *)mapped_buf.buffer().data(), (const float *)expected.data(), expected.size()/sizeof(float));\n            std::cerr << "compare output " << j << " Fail: cosine similarity = " << cos << std::endl;\n        }\n    }\n\n    return 0;\n}\n'})}),"\n",(0,s.jsxs)(e.p,{children:["\u7f16\u8bd1\u4e0a\u8ff0c++\u4ee3\u7801\uff0c\u5c06",(0,s.jsx)(e.code,{children:"k230_bin"}),"\u76ee\u5f55\u4e0b\u7684",(0,s.jsx)(e.code,{children:"debug"}),"\u76ee\u5f55\u62f7\u8d1d\u5230k230\u5f00\u53d1\u677f\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#docker\u5bb9\u5668\u4e2d\uff0c\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ndocker exec -it v1.3_0219_lj /bin/bash\ncd src/reference\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis.git\ncd K230_AI_Demo_Development_Process_Analysis/kmodel_related/kmodel_inference/\n./build_app.sh debug\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5728\u5c0f\u6838\u4e0a\uff1a\n# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\ncd /sharefs/\n#\u793a\u4f8b\uff1a\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5c06\u6e90\u76ee\u5f55\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u76ee\u5f55\nscp liujie@10.10.1.22:/xxx/k230_bin/debug /sharefs/ \n\n# \u5927\u6838\u4e0a\ncd /sharefs/k230_bin/debug\n#./face_detect_main_nncase.sh\n./main_nncase.elf face_detect_640.kmodel face_det_0_640x640_uint8.bin face_det_0_k230_simu.bin face_det_1_k230_simu.bin face_det_2_k230_simu.bin\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240221112222263",src:i(63945).A+"",width:"1242",height:"489"})}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u8fc7\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u68c0\u6d4bkmodel",(0,s.jsx)(e.strong,{children:"\u5185\u5b58"}),"\uff1a\u5927\u6982\u5360\u75281M\u5de6\u53f3"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u68c0\u6d4bkmodel",(0,s.jsx)(e.strong,{children:"\u63a8\u7406\u901f\u5ea6"}),"\uff1a26.6ms"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u68c0\u6d4b",(0,s.jsx)(e.strong,{children:"Simulator\u548c\u4e0a\u677f\u63a8\u7406\u76f8\u4f3c\u5ea6"}),"\uff1a\u8f93\u51fa0,2 pass\uff0cbyte\u7ea7\u522b\u5b8c\u5168\u4e00\u81f4\uff1b\u8f93\u51fa1 fail\uff0cfloat\u7ea7\u522b\u4f59\u5f26\u76f8\u4f3c\u5ea6\u4e3a1\u3002\u4e00\u822c0.99\u4ee5\u4e0a\u5373\u53ef\u4ee5\u6ee1\u8db3\u8981\u6c42"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4eba\u8138\u68c0\u6d4bsimulator\u7ed3\u679c\u5927\u81f4\u6ee1\u8db3\u8981\u6c42\uff0cmain_nncase\u7684\u7ed3\u679c\u4e5f\u6ee1\u8db3\u8981\u6c42\uff0c\u56e0\u6b64\u751f\u6210\u7684\u4eba\u8138\u68c0\u6d4bkmodel\u5927\u6982\u7387\u662f\u6ca1\u6709\u95ee\u9898\u7684\u3002"}),"\n",(0,s.jsx)(e.h5,{id:"63143-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",children:"6.3.1.4.3 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240223100614823",src:i(25941).A+"",width:"631",height:"781"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/face_detection",children:"face_detection code"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u251c\u2500\u2500 ai_base.cc                  #AI\u57fa\u7c7b\uff0c\u5c01\u88c5KPU(K230)\u8fd0\u884c\u65f6API\uff0c\u7b80\u5316kmodel\u76f8\u5173\u64cd\u4f5c\n\u251c\u2500\u2500 ai_base.h\n\u251c\u2500\u2500 anchors_640.cc              #\u4eba\u8138\u68c0\u6d4b640\u5206\u8fa8\u7387\u8f93\u5165\u5bf9\u5e94anchor\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 face_detection.cc           #\u4eba\u8138\u68c0\u6d4bdemo\uff0c\u9884\u5904\u7406\uff0ckmodel\u63a8\u7406\u3001\u540e\u5904\u7406\n\u251c\u2500\u2500 face_detection.h\n\u251c\u2500\u2500 main.cc                     #\u4eba\u8138\u68c0\u6d4bdemo\u4e3b\u6d41\u7a0b\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 scoped_timing.hpp           #\u8ba1\u65f6\u7c7b\n\u251c\u2500\u2500 utils.cc                    #\u5de5\u5177\u7c7b\uff0c\u5c01\u88c5\u5e38\u7528\u51fd\u6570\u53caAI2D\u8fd0\u884c\u65f6APIs\uff0c\u7b80\u5316\u9884\u5904\u7406\u64cd\u4f5c\n\u251c\u2500\u2500 utils.h\n\u2514\u2500\u2500 vi_vo.h                     #\u5c01\u88c5sensor\u3001display\u64cd\u4f5c\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f7f\u7528K230Runtime\u63a8\u7406kmodel\u9700\u8981\u8be6\u7ec6\u4e86\u89e3K230Runtime\u7684\u8bf4\u660e\u6587\u6863\uff0c\u4e3a\u4e86\u7b80\u5316\u63a8\u7406\u6d41\u7a0b\uff0c\u5bf9K230Runtime\u7684\u63a5\u53e3\u8fdb\u884c\u5c01\u88c5\uff0c\u5176\u4e2d",(0,s.jsx)(e.code,{children:"ai_base.cc\u3001scoped_timing.hpp\u3001utils.cc\u3001vi_vo.h"}),"\u662f\u5c01\u88c5\u597d\u7684\u65b9\u6cd5\uff0c\u65e0\u9700\u4fee\u6539\uff1b\u5bf9\u4e8e\u4e0d\u540c\u6a21\u578b\uff0c\u7528\u6237\u65e0\u9700\u5173\u5fc3K230Runtime\u76f8\u5173\u64cd\u4f5c\uff0c\u53ea\u9700\u5c06",(0,s.jsx)(e.code,{children:"face_detection.cc"}),"\u3001",(0,s.jsx)(e.code,{children:"main.cc"}),"\u62f7\u8d1d\u4e00\u4efd\uff0c\u53ea\u4fee\u6539\u5bf9\u5e94\u6784\u9020\u51fd\u6570\u3001\u9884\u5904\u7406\uff08pre_process\uff09\u3001\u540e\u5904\u7406\uff08post_process\uff09\u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(e.h6,{id:"1\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27",children:"1.\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27"}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u56fe\u7247"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"cv::Mat ori_img = cv::imread(xxx);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u89c6\u9891\u5e27"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u80cc\u666f\u77e5\u8bc6"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.strong,{children:"vi_vo.h\u7b80\u4ecb"}),"\uff1a",(0,s.jsx)(e.code,{children:"vi_vo.h"}),"\u4e3b\u8981\u5c01\u88c5\u4e86\u89c6\u9891\u8f93\u5165\u3001\u89c6\u9891\u8f93\u51fa\u76f8\u5173\u914d\u7f6e\u3002\u6211\u4eec\u6839\u636e",(0,s.jsx)(e.code,{children:"vi_vo.h"}),"\u6784\u5efa\u4e86",(0,s.jsx)(e.code,{children:"test_vi_vo"}),"\u793a\u4f8b\uff0c\u793a\u4f8b\u4e2d\u8bb2\u89e3\u4e86\u5982\u4f55\u4f7f\u7528vi\uff0cvo\u90e8\u5206\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["vi\uff1a\u89c6\u9891\u8f93\u5165\uff0c\u4e0esensor\u76f8\u5173\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u89c1",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/mpp/K230_VICAP_API%E5%8F%82%E8%80%83.md",children:"K230_VICAP_API\u53c2\u8003.md"}),"\u3001",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/mpp/K230_VICAP_SENSOR_%E5%8F%82%E6%95%B0%E5%88%86%E5%8C%BA%E5%8F%82%E8%80%83.md",children:"K230_VICAP_SENSOR_\u53c2\u6570\u5206\u533a\u53c2\u8003.md"}),"\u3001",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/mpp/K230_Camera_Sensor%E9%80%82%E9%85%8D%E6%8C%87%E5%8D%97.md",children:"K230_Camera_Sensor\u9002\u914d\u6307\u5357.md"}),"\u3002"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"sensor\u542f\u52a8"}),"\n",(0,s.jsx)(e.li,{children:"\u4ecesensor\u4e2ddump\u4e00\u5e27\u6570\u636e"}),"\n",(0,s.jsx)(e.li,{children:"\u5c06sensor\u4e2d\u6570\u636e\u4fdd\u5b58\u4e3apng"}),"\n",(0,s.jsx)(e.li,{children:"\u91ca\u653esensor\u5f53\u524d\u5e27"}),"\n",(0,s.jsx)(e.li,{children:"sensor\u505c\u6b62"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["vo\uff1a\u89c6\u9891\u8f93\u51fa\uff0c\u4e0edisplay\u76f8\u5173\uff0c\u8be6\u7ec6\u4ecb\u7ecd\u89c1",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/mpp/K230_%E8%A7%86%E9%A2%91%E8%BE%93%E5%87%BA_API%E5%8F%82%E8%80%83.md",children:"K230_\u89c6\u9891\u8f93\u51fa_API\u53c2\u8003.md"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5c06\u6846\u6216\u6587\u5b57\u753b\u5230cv::Mat\uff0c\u5e76\u63d2\u5165\u5230vo osd\u5bf9\u5e94\u901a\u9053\u4e2d"}),"\n",(0,s.jsx)(e.li,{children:"\u91ca\u653eosd block"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u89c6\u9891\u5e27\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_vi_vo",children:"test_vi_vo demo"})]}),"\n",(0,s.jsx)(e.h6,{id:"2\u9884\u5904\u7406",children:"2.\u9884\u5904\u7406"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u80cc\u666f\u77e5\u8bc6"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.strong,{children:"Uitls\u7b80\u4ecb"}),"\uff1aUitls\u4e3b\u8981\u5c01\u88c5\u4e86\u5e38\u7528\u51fd\u6570\u3001nncase AI2D\u76f8\u5173\u64cd\u4f5c\uff0cAI2D\u76f8\u5173\u90e8\u5206\u5305\u62ecAffine\u3001Crop\u3001Resize\u3001Padding\u9884\u5904\u7406\u64cd\u4f5c\uff0c\u53ef\u4ee5\u52a0\u901f\u56fe\u50cf\u7684\u9884\u5904\u7406\u64cd\u4f5c\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.strong,{children:"\u9884\u5904\u7406\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_utils",children:"test_utils demo"})]}),"\n",(0,s.jsxs)(e.p,{children:["\u82e5\u662f",(0,s.jsx)(e.strong,{children:"\u5bf9AI2D \u8fd0\u884c\u65f6APIs"}),"\u611f\u5174\u8da3\uff0c\u8be6\u60c5\u8bf7\u67e5\u770b",(0,s.jsx)(e.code,{children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\uff0c\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240222134841039",src:i(46190).A+"",width:"347",height:"501"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4b\u9884\u5904\u7406"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u80cc\u666f\u77e5\u8bc6"}),"\uff1a\u53c2\u6570\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u53ef\u4ee5\u53cd\u590d\u8c03\u7528\uff1b\u53c2\u6570\u6539\u53d8\u5219\u9700\u8981\u521b\u5efa\u65b0\u7684",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5bf9\u4e8e\u56fe\u50cf\u9884\u5904\u7406\uff1a\u7531\u4e8e\u4e0d\u540c\u56fe\u50cf\u7684\u5c3a\u5bf8\u4e0d\u540c\uff0c\u5bf9\u4e8epadding_resize\u65b9\u6cd5\u6765\u8bf4\uff0cAI2D\u7684\u53c2\u6570\u6bcf\u6b21\u90fd\u4f1a\u6539\u53d8\uff0c\u9700\u8981\u91cd\u65b0\u8c03\u7528Utils::padding_resize_one_side\u521b\u5efa\u65b0\u7684",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u6765\u8fdb\u884c\u9884\u5904\u7406\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"padding_resize.png",src:i(33997).A+"",width:"461",height:"132"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5bf9\u4e8e\u89c6\u9891\u6d41\u9884\u5904\u7406\uff1a\u7531\u4e8e\u4e0d\u540c\u5e27\u7684\u5c3a\u5bf8\u76f8\u540c\uff0cpadding\u7684\u6570\u503c\u4e5f\u672a\u6539\u53d8\uff1b\u6545\u5bf9\u4e8e",(0,s.jsx)(e.code,{children:"padding_resize"}),"\u65b9\u6cd5\u6765\u8bf4\uff0cAI2D\u7684\u53c2\u6570\u4e00\u76f4\u4e0d\u53d8\uff0c\u5c06\u65b0\u4e00\u5e27\u7684\u56fe\u50cf\u62f7\u8d1d\u7ed9",(0,s.jsx)(e.code,{children:"ai2d_in_tensor_"}),"\u540e\uff0c\u53ea\u9700",(0,s.jsx)(e.code,{children:"ai2d_builder_->invoke"}),"\uff08\u4eba\u8138\u6784\u9020\u51fd\u6570\u4e2d\u5df2\u7ecf\u6784\u9020\u597d",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\uff09\u8c03\u7528\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//face_detection.cc\n// ai2d for image\nvoid FaceDetection::pre_process(cv::Mat ori_img)\n{\n    ScopedTiming st(model_name_ + " pre_process image", debug_mode_);\n    std::vector<uint8_t> chw_vec;\n    Utils::bgr2rgb_and_hwc2chw(ori_img, chw_vec);\n    Utils::padding_resize_one_side({ori_img.channels(), ori_img.rows, ori_img.cols}, chw_vec, {input_shapes_[0][3], input_shapes_[0][2]}, ai2d_out_tensor_, cv::Scalar(123, 117, 104));\n    if (debug_mode_ > 1)  //\u9a8c\u8bc1\u9884\u5904\u7406\u662f\u5426\u6b63\u786e\uff0c\u770b\u5f53\u524d\u9884\u5904\u7406\u4e0eonnx\u9884\u5904\u7406\u662f\u5426\u4e00\u81f4\uff1adump\u9884\u5904\u7406\u4e4b\u540e\u56fe\u50cf\n    {\n        auto vaddr_out_buf = ai2d_out_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        unsigned char *output = reinterpret_cast<unsigned char *>(vaddr_out_buf.data());\n        Utils::dump_color_image("FaceDetection_input_padding.png",{input_shapes_[0][3],input_shapes_[0][2]},output);\n    }\n}\n\n// ai2d for video\nvoid FaceDetection::pre_process()\n{\n    ScopedTiming st(model_name_ + " pre_process video", debug_mode_);\n    size_t isp_size = isp_shape_.channel * isp_shape_.height * isp_shape_.width;\n    auto buf = ai2d_in_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();\n    memcpy(reinterpret_cast<char *>(buf.data()), (void *)vaddr_, isp_size);\n    hrt::sync(ai2d_in_tensor_, sync_op_t::sync_write_back, true).expect("sync write_back failed");\n    ai2d_builder_->invoke(ai2d_in_tensor_, ai2d_out_tensor_).expect("error occurred in ai2d running");\n\n    if (debug_mode_ > 1)  //\u9a8c\u8bc1\u9884\u5904\u7406\u662f\u5426\u6b63\u786e\uff0c\u770b\u5f53\u524d\u9884\u5904\u7406\u4e0eonnx\u9884\u5904\u7406\u662f\u5426\u4e00\u81f4\uff1adump\u9884\u5904\u7406\u4e4b\u540e\u56fe\u50cf\n    {\n        auto vaddr_out_buf = ai2d_out_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        unsigned char *output = reinterpret_cast<unsigned char *>(vaddr_out_buf.data());\n        Utils::dump_color_image("FaceDetection_input_padding.png",{input_shapes_[0][3],input_shapes_[0][2]},output);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h6,{id:"3kmodel-run",children:"3.kmodel run"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u80cc\u666f\u77e5\u8bc6"}),"\uff1a"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.strong,{children:"AIBase\u7b80\u4ecb"}),"\uff1aAIBase\u4e3b\u8981\u5c01\u88c5\u4e86KPU\u76f8\u5173\u64cd\u4f5c\uff0c\u5305\u62ec\u5728AI\u8bbe\u5907\uff08\u5982k230\uff09\u52a0\u8f7dkmodel\uff0c\u8bbe\u7f6ekmodel\u8f93\u5165\u6570\u636e\uff0c\u6267\u884ckpu/cpu\u8ba1\u7b97\uff0c \u83b7\u53d6kmodel\u8f93\u51fa\u6570\u636e\u7b49\uff0cAIBase\u7684\u5c01\u88c5\u7b80\u5316\u4e86KPU\u8c03\u7528\u8fc7\u7a0b\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.strong,{children:"kmodel\u63a8\u7406\u793a\u4f8b"}),"\uff08main_nncase\u4fee\u6539\u4e3a\u57fa\u4e8eAIBase\u7c7b\u7684demo\uff09\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_aibase",children:"test_aibase demo"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["**KPU\u8fd0\u884c\u65f6APIs\uff08KPU Runtime AIPS\uff09**\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u8be6\u60c5\u8bf7\u67e5\u770b",(0,s.jsx)(e.code,{children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\uff0c\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240223100614822",src:i(56844).A+"",width:"306",height:"350"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4bkmode\u63a8\u7406"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//ai_base.cc\nvoid AIBase::run()\n{\n    ScopedTiming st(model_name_ + " run", debug_mode_);\n    kmodel_interp_.run().expect("error occurred in running model");\n}\n\nvoid AIBase::get_output()\n{\n    ScopedTiming st(model_name_ + " get_output", debug_mode_);\n    p_outputs_.clear();\n    for (int i = 0; i < kmodel_interp_.outputs_size(); i++)\n    {\n        auto out = kmodel_interp_.output_tensor(i).expect("cannot get output tensor");\n        auto buf = out.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        float *p_out = reinterpret_cast<float *>(buf.data());\n        p_outputs_.push_back(p_out);\n    }\n}\n//face_detection.cc\nvoid FaceDetection::inference()\n{\n    this->run();\n    this->get_output();\n}\n//main.cc\uff0c\u9a8c\u8bc1kmodel\u63a8\u7406\u662f\u5426\u6b63\u786e\uff1a\u6211\u4eec\u4f7f\u7528simulator\u548cmain_nncase\u5df2\u7ecf\u9a8c\u8bc1\u8fc7\n......\nFaceDetection fd;\nfd.inference();\n......\n'})}),"\n",(0,s.jsx)(e.h6,{id:"4\u540e\u5904\u7406",children:"4.\u540e\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"onnx\u540e\u5904\u7406\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240223153101754.png",src:i(48979).A+"",width:"1149",height:"1115"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"c++\u540e\u5904\u7406\uff08\u8be6\u60c5\u89c1\u4ee3\u7801\uff09"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//face_detection.cc\nvoid FaceDetection::post_process(FrameSize frame_size, vector<FaceDetectionInfo> &results)\n{\n    ScopedTiming st(model_name_ + " post_process", debug_mode_);\n    if (debug_mode_ > 3)\n    {\n        //\u9a8c\u8bc1\u540e\u5904\u7406\u6d41\u7a0b\u662f\u5426\u6b63\u786e\uff1a\u6392\u9664\u9884\u5904\u7406\u3001\u6a21\u578b\u63a8\u7406\uff0c\u76f4\u63a5\u62ffSimulator kmodel\u6570\u636e\uff0c\u5224\u65ad\u540e\u5904\u7406\u4ee3\u7801\u6b63\u786e\u6027\u3002\n        ......\n    }\n    else\n    {\n        filter_confs(p_outputs_[1]);\n        filter_locs(p_outputs_[0]);\n        filter_landms(p_outputs_[2]);\n    }\n\n    std::sort(confs_.begin(), confs_.end(), nms_comparator);\n    nms(results);\n    transform_result_to_src_size(frame_size, results);\n}\n'})}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"onnx\u540e\u5904\u7406\u6d41\u7a0b"}),(0,s.jsx)(e.th,{children:"kmodel\u540e\u5904\u7406\u6d41\u7a0b"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"1.\u89e3\u7801loc\u3001landms"}),(0,s.jsx)(e.td,{children:"1.\u8fc7\u6ee4conf\u3001loc\u3001landms\uff08\u6570\u91cf\u7ea7\uff1a16800->\u6570\u767e\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"2.\u8fc7\u6ee4conf\u3001loc\u3001landms"}),(0,s.jsx)(e.td,{children:"2.\u6839\u636econf\u5bf9conf\u3001loc\u3001landms\u8fdb\u884c\u6392\u5e8f\uff08\u964d\u4f4e\u6392\u5e8f\u8017\u65f6\uff09"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"3.\u6839\u636econf\u5bf9conf\u3001loc\u3001landms\u8fdb\u884c\u6392\u5e8f"}),(0,s.jsx)(e.td,{children:"3.nms + \u89e3\u7801loc\u3001landms"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"4.nms"}),(0,s.jsx)(e.td,{children:"4.\u5c06\u4eba\u8138\u68c0\u6d4b\u7ed3\u679c\u53d8\u6362\u5230\u539f\u56fe\u5927\u5c0f"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"5.top_k"}),(0,s.jsx)(e.td,{})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u8c03\u6574\u987a\u5e8f\u4e4b\u540e\u7684kmodel\u63a8\u7406\u6d41\u7a0b\uff0c\u66f4\u9002\u5408c++\u4ee3\u7801\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4b\u540e\u5904\u7406\u4ee3\u7801"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//face_detection.cc\nvoid FaceDetection::post_process(FrameSize frame_size, vector<FaceDetectionInfo> &results)\n{\n    ScopedTiming st(model_name_ + " post_process", debug_mode_);\n    if (debug_mode_ > 2)\n    {\n        //\u9a8c\u8bc1\u540e\u5904\u7406\u6d41\u7a0b\u662f\u5426\u6b63\u786e\uff1a\u6392\u9664\u9884\u5904\u7406\u3001\u6a21\u578b\u63a8\u7406\uff0c\u76f4\u63a5\u62ffSimulator kmodel\u6570\u636e\uff0c\u5224\u65ad\u540e\u5904\u7406\u4ee3\u7801\u6b63\u786e\u6027\u3002\n        vector<float> out0 = Utils::read_binary_file<float>("../debug/face_det_0_k230_simu.bin");\n        vector<float> out1 = Utils::read_binary_file<float>("../debug/face_det_1_k230_simu.bin");\n        vector<float> out2 = Utils::read_binary_file<float>("../debug/face_det_2_k230_simu.bin");\n        filter_confs(out1.data());\n        filter_locs(out0.data());\n        filter_landms(out2.data());\n    }\n    else\n    {\n        filter_confs(p_outputs_[1]);\n        filter_locs(p_outputs_[0]);\n        filter_landms(p_outputs_[2]);\n    }\n\n    std::sort(confs_.begin(), confs_.end(), nms_comparator);\n    nms(results);\n    transform_result_to_src_size(frame_size, results);\n}\n\n/********************\u6839\u636e\u68c0\u6d4b\u9608\u503ckmodel\u6570\u636e\u7ed3\u679c***********************/\nvoid FaceDetection::filter_confs(float *conf)\n{\n    NMSRoiObj inter_obj;\n    confs_.clear();\n    for (uint32_t roi_index = 0; roi_index < objs_num_; roi_index++)\n    {\n        float score = conf[roi_index * CONF_SIZE + 1];\n        if (score > obj_thresh_)\n        {\n            inter_obj.ori_roi_index = roi_index;\n            inter_obj.before_sort_conf_index = confs_.size();\n            inter_obj.confidence = score;\n            confs_.push_back(inter_obj);\n        }\n    }\n}\n\nvoid FaceDetection::filter_locs(float *loc)\n{\n    boxes_.clear();\n    boxes_.resize(confs_.size());\n    int roi_index = 0;\n    for (uint32_t conf_index = 0; conf_index < boxes_.size(); conf_index++)\n    {\n        roi_index = confs_[conf_index].ori_roi_index;\n        int start = roi_index * LOC_SIZE;\n        for (int i = 0; i < LOC_SIZE; ++i)\n        {\n            boxes_[conf_index][i] = loc[start + i];\n        }\n    }\n}\n\nvoid FaceDetection::filter_landms(float *landms)\n{\n    landmarks_.clear();\n    landmarks_.resize(confs_.size());\n    int roi_index = 0;\n    for (uint32_t conf_index = 0; conf_index < boxes_.size(); conf_index++)\n    {\n        roi_index = confs_[conf_index].ori_roi_index;\n        int start = roi_index * LAND_SIZE;\n        for (int i = 0; i < LAND_SIZE; ++i)\n        {\n            landmarks_[conf_index][i] = landms[start + i];\n        }\n    }\n}\n\n/********************\u6839\u636eanchor\u89e3\u7801\u68c0\u6d4b\u6846\u3001\u4e94\u5b98\u70b9***********************/\nBbox FaceDetection::decode_box(int obj_index)\n{\n    float cx, cy, w, h;\n\n    int box_index = confs_[obj_index].before_sort_conf_index;\n    int anchor_index = confs_[obj_index].ori_roi_index;\n\n    cx = boxes_[box_index][0];\n    cy = boxes_[box_index][1];\n    w = boxes_[box_index][2];\n    h = boxes_[box_index][3];\n    cx = g_anchors[anchor_index][0] + cx * 0.1 * g_anchors[anchor_index][2];\n    cy = g_anchors[anchor_index][1] + cy * 0.1 * g_anchors[anchor_index][3];\n    w = g_anchors[anchor_index][2] * std::exp(w * 0.2);\n    h = g_anchors[anchor_index][3] * std::exp(h * 0.2);\n    Bbox box;\n    box.x = cx - w / 2;\n    box.y = cy - h / 2;\n    box.w = w;\n    box.h = h;\n    return box;\n}\n\nSparseLandmarks FaceDetection::decode_landmark(int obj_index)\n{\n    SparseLandmarks landmark;\n    int landm_index = confs_[obj_index].before_sort_conf_index;\n    int anchor_index = confs_[obj_index].ori_roi_index;\n    for (uint32_t ll = 0; ll < 5; ll++)\n    {\n        landmark.points[2 * ll + 0] = g_anchors[anchor_index][0] + landmarks_[landm_index][2 * ll + 0] * 0.1 * g_anchors[anchor_index][2];\n        landmark.points[2 * ll + 1] = g_anchors[anchor_index][1] + landmarks_[landm_index][2 * ll + 1] * 0.1 * g_anchors[anchor_index][3];\n    }\n    return landmark;\n}\n\n/********************iou\u8ba1\u7b97***********************/\nfloat FaceDetection::overlap(float x1, float w1, float x2, float w2)\n{\n    float l1 = x1 - w1 / 2;\n    float l2 = x2 - w2 / 2;\n    float left = l1 > l2 ? l1 : l2;\n    float r1 = x1 + w1 / 2;\n    float r2 = x2 + w2 / 2;\n    float right = r1 < r2 ? r1 : r2;\n    return right - left;\n}\n\nfloat FaceDetection::box_intersection(Bbox a, Bbox b)\n{\n    float w = overlap(a.x, a.w, b.x, b.w);\n    float h = overlap(a.y, a.h, b.y, b.h);\n\n    if (w < 0 || h < 0)\n        return 0;\n    return w * h;\n}\n\nfloat FaceDetection::box_union(Bbox a, Bbox b)\n{\n    float i = box_intersection(a, b);\n    float u = a.w * a.h + b.w * b.h - i;\n\n    return u;\n}\n\nfloat FaceDetection::box_iou(Bbox a, Bbox b)\n{\n    return box_intersection(a, b) / box_union(a, b);\n}\n\n/********************nms***********************/\nvoid FaceDetection::nms(vector<FaceDetectionInfo> &results)\n{\n    // nms\n    for (int conf_index = 0; conf_index < confs_.size(); ++conf_index)\n    {\n        if (confs_[conf_index].confidence < 0)\n            continue;\n\n        FaceDetectionInfo obj;\n        obj.bbox = decode_box(conf_index);\n        obj.sparse_kps = decode_landmark(conf_index);\n        obj.score = confs_[conf_index].confidence;\n        results.push_back(obj);\n\n        for (int j = conf_index + 1; j < confs_.size(); ++j)\n        {\n            if (confs_[j].confidence < 0)\n                continue;\n            Bbox b = decode_box(j);\n            if (box_iou(obj.bbox, b) >= nms_thresh_) // iou\u5927\u4e8enms\u9608\u503c\u7684\uff0c\u4e4b\u540e\u5faa\u73af\u5c06\u4f1a\u5ffd\u7565\n                confs_[j].confidence = -1;\n        }\n    }\n}\n\n/********************\u5c06\u4eba\u8138\u68c0\u6d4b\u7ed3\u679c\u53d8\u6362\u5230\u539f\u56fe***********************/\nvoid FaceDetection::transform_result_to_src_size(FrameSize &frame_size, vector<FaceDetectionInfo> &results)\n{\n    // transform result to dispaly size\n    int max_src_size = std::max(frame_size.width, frame_size.height);\n    for (int i = 0; i < results.size(); ++i)\n    {\n        auto &l = results[i].sparse_kps;\n        for (uint32_t ll = 0; ll < 5; ll++)\n        {\n            l.points[2 * ll + 0] = l.points[2 * ll + 0] * max_src_size;\n            l.points[2 * ll + 1] = l.points[2 * ll + 1] * max_src_size;\n        }\n\n        auto &b = results[i].bbox;\n        float x0 = b.x * max_src_size;\n        float x1 = (b.x + b.w) * max_src_size;\n        float y0 = b.y * max_src_size;\n        float y1 = (b.y + b.h) * max_src_size;\n        x0 = std::max(float(0), std::min(x0, float(frame_size.width)));\n        x1 = std::max(float(0), std::min(x1, float(frame_size.width)));\n        y0 = std::max(float(0), std::min(y0, float(frame_size.height)));\n        y1 = std::max(float(0), std::min(y1, float(frame_size.height)));\n        b.x = x0;\n        b.y = y0;\n        b.w = x1 - x0;\n        b.h = y1 - y0;\n    }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6269\u5c55\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:"\u68c0\u6d4b\u540e\u5904\u7406\u5199\u8d77\u6765\u6bd4\u4ef7\u590d\u6742\uff0c\u56e0\u6b64\u5bf9\u4e8e\u5e38\u89c1\u7684\u68c0\u6d4b\u6a21\u578b\uff0c\u6211\u4eec\u7ed9\u51fa\u4e86\u4e00\u4e9b\u793a\u4f8b\u4ee3\u7801\u3002"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"retinaface"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_sdk/blob/main/src/reference/ai_poc/face_detection/face_detection.cc",children:"\u4eba\u8138\u68c0\u6d4bpost_process"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"yolov5"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_sdk/blob/main/src/reference/ai_poc/falldown_detect/falldown_detect.cc",children:"\u6454\u5012\u68c0\u6d4bpost_process"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"yolov8"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_sdk/blob/main/src/reference/ai_poc/head_detection/head_detection.cc",children:"\u4eba\u5934\u68c0\u6d4bpost_process"})]}),"\n"]}),"\n",(0,s.jsx)(e.h6,{id:"5\u663e\u793a\u7ed3\u679c",children:"5.\u663e\u793a\u7ed3\u679c"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u663e\u793a\u7ed3\u679c\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_vi_vo",children:"test_vi_vo demo"})]}),"\n",(0,s.jsx)(e.h6,{id:"6\u7f16\u8bd1\u6267\u884c",children:"6.\u7f16\u8bd1\u3001\u6267\u884c"}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u4ee3\u7801clone\u5230\u5df2\u542f\u52a8docker\u5bb9\u5668",(0,s.jsx)(e.code,{children:"src/reference/"}),"\u76ee\u5f55\uff0c\u6267\u884c",(0,s.jsx)(e.code,{children:"build_app.sh"}),"\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"docker exec -it v1.3_0219_lj /bin/bash\ncd src/reference\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis.git\ncd K230_AI_Demo_Development_Process_Analysis/kmodel_related/kmodel_inference/\n./build_app.sh debug         #\u82e5\u662f\u65e0\u9700debug\u76ee\u5f55\uff0c\u6267\u884c./build_app.sh\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06",(0,s.jsx)(e.code,{children:"k230_bin"}),"\u76ee\u5f55\u4e0b\u7684",(0,s.jsx)(e.code,{children:"face_detect"}),"\u76ee\u5f55\u62f7\u8d1d\u5230k230\u5f00\u53d1\u677f\u5c0f\u6838",(0,s.jsx)(e.code,{children:"/sharefs"}),"\u76ee\u5f55\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"k230_bin\n\u251c\u2500\u2500 debug            #\u8c03\u8bd5\u7528\u5230\u7684\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 face_det_0_640x640_uint8.bin    #\u4eba\u8138\u68c0\u6d4bkmodel\u8f93\u5165\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 face_det_0_k230_simu.bin        #\u4eba\u8138\u68c0\u6d4bsimulator\u7b2c1\u4e2a\u8f93\u51fa\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 face_det_1_k230_simu.bin        #\u4eba\u8138\u68c0\u6d4bsimulator\u7b2c2\u4e2a\u8f93\u51fa\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 face_det_2_k230_simu.bin        #\u4eba\u8138\u68c0\u6d4bsimulator\u7b2c3\u4e2a\u8f93\u51fa\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 face_detect_640.kmodel          #\u4eba\u8138\u68c0\u6d4bkmodel\n\u2502   \u251c\u2500\u2500 face_detect.jpg                 #\u4eba\u8138\u68c0\u6d4b\u57fa\u4e8e\u56fe\u50cf\u63a8\u7406\u65f6\u7684\u8f93\u5165\u56fe\u50cf\n\u2502   \u251c\u2500\u2500 face_detect_main_nncase.sh      #\u4eba\u8138\u68c0\u6d4bkmodel\u4e0a\u677f\u9a8c\u8bc1\u8fd0\u884c\u811a\u672c\n\u2502   \u251c\u2500\u2500 face_detect_main_nncase_with_aibase.sh #\u4eba\u8138\u68c0\u6d4bkmodel\u4e0a\u677f\u9a8c\u8bc1\u8fd0\u884c\u811a\u672c\n\u2502   \u251c\u2500\u2500 face_recg_0_112x112_uint8.bin\n\u2502   \u251c\u2500\u2500 face_recg_0_k230_simu.bin\n\u2502   \u251c\u2500\u2500 face_recognize.kmodel\n\u2502   \u251c\u2500\u2500 face_recognize_main_nncase.sh\n\u2502   \u251c\u2500\u2500 main_nncase.elf                 #\u4eba\u8138\u68c0\u6d4bkmodel\u4e0a\u677f\u9a8c\u8bc1\u53ef\u6267\u884c\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 test_aibase.elf                 #test_aibase demo\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 test_scoped_timing.elf          #test_scoped_timing demo\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 test_utils.elf                  #test_utils demo\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\n\u2502   \u2514\u2500\u2500 test_vi_vo.elf                  #test_vi_vo demo\u751f\u6210\u53ef\u6267\u884c\u6587\u4ef6\n\u251c\u2500\u2500 face_detect     #\u4eba\u8138\u68c0\u6d4b\n\u2502   \u251c\u2500\u2500 face_detect_640.kmodel\n\u2502   \u251c\u2500\u2500 face_detect_image.sh\n\u2502   \u251c\u2500\u2500 face_detection.elf\n\u2502   \u251c\u2500\u2500 face_detect_isp.sh\n\u2502   \u2514\u2500\u2500 face_detect.jpg\n\u2514\u2500\u2500 face_recognize   #\u4eba\u8138\u8bc6\u522b\uff0c\u4eba\u8138\u68c0\u6d4b\u53ef\u4ee5\u4e0d\u5173\u6ce8\n    \u251c\u2500\u2500 db\n    \u251c\u2500\u2500 face_detect_640.kmodel\n    \u251c\u2500\u2500 face_recognition.elf\n    \u251c\u2500\u2500 face_recognize_isp.sh\n    \u2514\u2500\u2500 face_recognize.kmodel\n"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"(1) \u9884\u5904\u7406\u662f\u5426\u6b63\u786e"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5c06debug_mode\u8bbe\u7f6e\u4e3a2\uff0c\u5373\u53ef\u4fdd\u5b58\u9884\u5904\u7406\u4e4b\u540e\u7684\u56fe\u50cf\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\n# \u5728\u5c0f\u6838\u4e0a\ncd /sharefs/\n#\u793a\u4f8b\uff1a\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5c06\u6e90\u76ee\u5f55\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u76ee\u5f55\nscp liujie@10.10.1.22:/xxx/k230_bin /sharefs/ \n\n#\u5728\u5927\u6838\u4e0a\uff08\u82e5\u662f\u521a\u542f\u52a8\uff0c\u5148\u6309q+Enter\u9000\u53bb\u81ea\u542f\u52a8\u7a0b\u5e8f\uff09\ncd /sharefs/k230_bin/face_detect\n./face_detection.elf face_detect_640.kmodel 0.5 0.2 face_detect.jpg 2\n#\u5728\u5c0f\u6838\u4e0a\ncd  /sharefs/k230_bin/face_detect\nscp FaceDetection_input_padding.png username@ip:dir\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u751f\u6210",(0,s.jsx)(e.code,{children:"FaceDetection_input_padding.png"}),"\uff0c\u62f7\u8d1d\u5230pc\u67e5\u770b\uff0c\u9884\u5904\u7406\u4ee3\u7801\u662f\u5426\u6b63\u786e\u3002\u82e5\u662f\u6709\u95ee\u9898\uff0c\u5219\u9700\u8981\u770bsensor\u539f\u56fe\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u8bbe\u7f6e\u7684\u9884\u5904\u7406\u53c2\u6570\u662f\u5426\u6b63\u786e\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"FaceDetection_input_padding",src:i(39256).A+"",width:"640",height:"640"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"(2) \u540e\u5904\u7406\u662f\u5426\u6b63\u786e"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5c06debug_mode\u8bbe\u7f6e\u4e3a3\uff0c\u5373\u53ef\u9a8c\u8bc1\u540e\u5904\u7406\u6b63\u786e\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\n# \u5728\u5c0f\u6838\u4e0a\ncd /sharefs/\n#\u793a\u4f8b\uff1a\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5c06\u6e90\u76ee\u5f55\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u76ee\u5f55\nscp liujie@10.10.1.22:/xxx/k230_bin /sharefs/ \n\n#\u5728\u5927\u6838\u4e0a\uff08\u5148\u6309q+Enter\u9000\u53bb\u81ea\u542f\u52a8\u7a0b\u5e8f\uff09\ncd /sharefs/k230_bin/face_detect\n./face_detection.elf face_detect_640.kmodel 0.5 0.2 face_detect.jpg 3\n#\u5728\u5c0f\u6838\u4e0a\ncd  /sharefs/k230_bin/face_detect\nscp face_detection_result.jpg username@ip:dir\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u751f\u6210",(0,s.jsx)(e.code,{children:"face_detection_result.jpg"}),"\uff0c\u62f7\u8d1d\u5230pc\u67e5\u770b\uff0c\u9884\u5904\u7406\u4ee3\u7801\u662f\u5426\u6b63\u786e\u3002\u82e5\u662f\u4e0d\u6b63\u786e\u5c31\u9700\u8981\u5bf9\u540e\u5904\u7406\u90e8\u5206\u4ee3\u7801\u8fdb\u884c\u4ed4\u7ec6\u68c0\u67e5\uff0c\u6253\u5370\u8c03\u8bd5\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"face_detection_result.jpg",src:i(91636).A+"",width:"1024",height:"624"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["(3) \u6267\u884c \u5728\u5927\u6838\u4e0a\u6267\u884c",(0,s.jsx)(e.code,{children:"face_detect_isp.sh"}),"\u5373\u53ef\u6267\u884c\u57fa\u4e8e\u89c6\u9891\u6d41\u7684\u63a8\u7406\u6d41\u7a0b\u3002"]}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u5728\u5927\u6838\u4e0a\ncd /sharefs/k230_bin/face_detect\n./face_detect_isp.sh\n"})}),"\n",(0,s.jsx)(e.h3,{id:"632-\u4eba\u8138\u8bc6\u522bdemo",children:"6.3.2 \u4eba\u8138\u8bc6\u522bdemo"}),"\n",(0,s.jsxs)(e.p,{children:["\u4eba\u8138\u8bc6\u522b\u662f\u5e7f\u6cdb\u4f7f\u7528\u7684\u4eba\u8138\u4efb\u52a1\uff0c\u5b83\u5c06\u5f53\u524d\u4eba\u8138\u4e0e\u5df2\u77e5\u7684\u4eba\u8138\u8eab\u4efd\u5e93\u8fdb\u884c\u6bd4\u8f83\uff0c\u5224\u65ad\u662f\u5426\u8ba4\u8bc6\u5f53\u524d\u4eba\u8138\u3002 \u4eba\u8138\u8bc6\u522b\u4e00\u822c\u5305\u542b2\u4e2a\u6b65\u9aa4\uff1a\u4eba\u8138\u6ce8\u518c\u548c\u4eba\u8138\u8bc6\u522b\uff0c\u4eba\u8138\u6ce8\u518c\u7528\u4e8e\u6784\u5efa\u4eba\u8138\u6570\u636e\u5e93\uff0c\u4eba\u8138\u8bc6\u522b\u7528\u4e8e\u8bc6\u522b\u5b58\u5728\u6570\u636e\u5e93\u4e2d\u7684\u4eba\u8138\u3002 ",(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u6ce8\u518c"}),"\uff1a\u56fe\u50cf\u91c7\u96c6->\u4eba\u8138\u5b9a\u4f4d->\u4eba\u8138\u5bf9\u9f50->\u7279\u5f81\u63d0\u53d6->\u6570\u636e\u5e93\u4fdd\u5b58 ",(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u8bc6\u522b"}),"\uff1a\u56fe\u50cf\u91c7\u96c6->\u4eba\u8138\u5b9a\u4f4d->\u4eba\u8138\u5bf9\u9f50->\u7279\u5f81\u63d0\u53d6->\u7279\u5f81\u6bd4\u5bf9->\u7ed9\u51fa\u8bc6\u522b\u7ed3\u679c ",(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u5bf9\u9f50"}),"\uff1a\u5bf9\u4e8e\u4e00\u5f20\u56fe\u50cf\uff0c\u4eba\u8138\u68c0\u6d4b\u6a21\u578b\u8f93\u51fa\u4eba\u8138\u76ee\u6807\u6846\u5750\u6807\u548c5\u4e2a\u4eba\u8138\u5173\u952e\u70b9\uff0c\u5728\u8fdb\u884c\u4eba\u8138\u8bc6\u522b\u524d\uff0c\u9700\u8981\u5bf9\u68c0\u6d4b\u5f97\u5230\u7684\u4eba\u8138\u6846\u8fdb\u884c\u5bf9\u9f50\uff1b\u5373\u57282D\u5e73\u9762\u5c06\u4eba\u8138\u8f6c\u6b63\uff0c\u51cf\u5c11\u4eba\u8138\u65cb\u8f6c\u9020\u6210\u7684\u5dee\u5f02\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u66f4\u51c6\u786e\u7684\u4eba\u8138\u8bc6\u522b\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240227110308196",src:i(91693).A+"",width:"904",height:"407"})}),"\n",(0,s.jsx)(e.h4,{id:"6321-pytorch\u5230onnx\u8f6c\u6362",children:"6.3.2.1 PyTorch\u5230ONNX\u8f6c\u6362"}),"\n",(0,s.jsxs)(e.p,{children:["\u9009\u62e9\u4eba\u8138\u8bc6\u522b\u6a21\u578b\u65f6\uff0c\u4e00\u822c\u5e94\u9009\u62e9\u8f7b\u91cf\u5316\u7684\u6a21\u578b\uff0cbackbone\u4e00\u822c\u5c0f\u4e8eresnet50\u53c2\u6570\u91cf\u8f83\u597d\u3002\u56e0\u6b64\u6211\u4eec\u9009\u62e9\u57fa\u4e8eMobileNet\u4e14\u7cbe\u5ea6\u8f83\u9ad8MobileFaceNet\u4f5c\u4e3a\u6211\u4eec\u7684\u4eba\u8138\u8bc6\u522b\u6a21\u578b\u3002\u53c2\u8003\u94fe\u63a5\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/Xiaoccer/MobileFaceNet_Pytorch",children:"Xiaoccer/MobileFaceNet_Pytorch"})]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u52a0\u8f7dpth\u6216ckpt\u6a21\u578b\u5230cpu"}),"\n",(0,s.jsx)(e.li,{children:"\u6784\u5efa\u968f\u673a\u6a21\u578b\u8f93\u5165"}),"\n",(0,s.jsx)(e.li,{children:"\u5bfc\u51faonnx\u6a21\u578b"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8"}),"\uff1apth\u3001onnx\u90fd\u652f\u6301\u52a8\u6001\u8f93\u5165\uff0c\u800cK230\u7684\u6a21\u578b\u6682\u65f6\u4e0d\u652f\u6301\u52a8\u6001\u8f93\u5165\uff0c\u6240\u4ee5\u5bfc\u51faonnx\u65f6\uff0connx\u8f93\u5165shape\u56fa\u5b9a\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#convert_to_onnx.py\nimport numpy as np\nimport torch\nfrom core import model               #\u56e0\u6a21\u578b\u800c\u4e0d\u540c\n\ndef convert_onnx(net, path_module, output, opset=11):\n    assert isinstance(net, torch.nn.Module)\n    img = np.random.randint(0, 255, size=(112, 112, 3), dtype=np.int32)\n    img = img.astype(np.float)\n    img = (img / 255. - 0.5) / 0.5  # torch style norm\n    img = img.transpose((2, 0, 1))\n    img = torch.from_numpy(img).unsqueeze(0).float()\n\n    ckpt = torch.load(path_module,map_location='cpu')\n    net.load_state_dict(ckpt['net_state_dict'],strict=True)\n    net.eval()\n    torch.onnx.export(net, img, output, input_names=[\"data\"], keep_initializers_as_inputs=False, verbose=False,\n                      opset_version=opset)\n\nif __name__ == '__main__':\n    net = model.MobileFacenet()\n    input_file = 'model/best/068.ckpt'\n    output_file = 'model/best/MobileFaceNet.onnx'\n    convert_onnx(net, input_file, output_file)\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6267\u884c\u6b65\u9aa4\uff1a"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/",children:"\u4ee3\u7801"}),"clone\u5230pc\u4e0a\uff0c\u5b89\u88c5\u4f9d\u8d56\u5e93\uff0c\u6267\u884c\u8f6connx\u811a\u672c\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"git clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd onnx_related/onnx_export\ngit clone https://github.com/Xiaoccer/MobileFaceNet_Pytorch\ncp face_recognition_convert_to_onnx.py MobileFaceNet_Pytorch/\ncd MobileFaceNet_Pytorch\n#\u5b89\u88c5\u4f9d\u8d56\u5e93\npython face_recognition_convert_to_onnx.py\n"})}),"\n",(0,s.jsx)(e.h4,{id:"6322-\u4f7f\u7528onnxruntime\u8fdb\u884c\u63a8\u7406",children:"6.3.2.2 \u4f7f\u7528ONNXRuntime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.h5,{id:"63221-\u4eba\u8138\u5bf9\u9f50",children:"6.3.2.2.1 \u4eba\u8138\u5bf9\u9f50"}),"\n",(0,s.jsx)(e.p,{children:"\u5e38\u7528\u4eba\u8138\u8bc6\u522b\u8bad\u7ec3\u96c6\u4e3b\u8981\u6709\uff1aMS1MV2\u3001MS1MV3\u3001Glint360K\uff0c\u5236\u4f5c\u8fd9\u4e9b\u6570\u636e\u96c6\u4e00\u822c\u9700\u8981\u5bf9\u5b8c\u6574\u7684\u4eba\u8138\u539f\u56fe\u8fdb\u884c\u9884\u5904\u7406\uff0c\u5373\u5148\u8fdb\u884c\u4eba\u8138\u68c0\u6d4b\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u4eba\u8138\u8fdb\u884c\u4eba\u8138\u5bf9\u9f50\uff0c\u7136\u540e\u4fdd\u5b58\u5bf9\u9f50\u540e\u7684\u4eba\u8138\u56fe\u7247\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u5bf9\u9f50"}),"\uff1a\u5bf9\u4e8e\u4e00\u5f20\u56fe\u50cf\uff0c\u4eba\u8138\u68c0\u6d4b\u6a21\u578b\u8f93\u51fa\u4eba\u8138\u76ee\u6807\u6846\u5750\u6807\u548c5\u4e2a\u4eba\u8138\u5173\u952e\u70b9\uff0c\u5728\u8fdb\u884c\u4eba\u8138\u8bc6\u522b\u524d\uff0c\u9700\u8981\u5bf9\u68c0\u6d4b\u5f97\u5230\u7684\u4eba\u8138\u8fdb\u884c\u5bf9\u9f50\uff1b\u5373\u57282D\u5e73\u9762\u5c06\u4eba\u8138\u8f6c\u6b63\uff0c\u51cf\u5c11\u4eba\u8138\u65cb\u8f6c\u9020\u6210\u7684\u5dee\u5f02\uff0c\u4ee5\u4fbf\u4e8e\u540e\u7eed\u66f4\u51c6\u786e\u7684\u4eba\u8138\u8bc6\u522b\u3002"]}),"\n",(0,s.jsx)(e.p,{children:"x.png\uff1a\u539f\u59cb\u56fe\u7247\uff0cx_affine.png\uff1a\u5bf9\u9f50\u540e\u7684\u4eba\u8138"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226154210101",src:i(97036).A+"",width:"331",height:"180"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"def st_image(ori_image, landmarks):\n    #\u6807\u51c6\u6b63\u8138\u4eba\u8138\u4e94\u5b98\u4f4d\u7f6e\uff08112x112\u5206\u8fa8\u7387\uff09\n    le_g = [38.2946, 51.6963]\n    re_g = [73.5318, 51.5014]\n    nose_g = [56.0252, 71.7366]\n    l_mouth_g = [41.5493, 92.3655]\n    r_mouth_g = [70.7299, 92.2041]\n    #\u5b9e\u9645\u4eba\u8138\u4e94\u5b98\u4f4d\u7f6e\n    le = landmarks[0, :]\n    re = landmarks[1, :]\n    nose = landmarks[2, :]\n    l_mouth = landmarks[3, :]\n    r_mouth = landmarks[4, :]\n    landmark_get = np.float32([le, re, nose, l_mouth, r_mouth])\n    landmark_golden = np.float32([le_g, re_g, nose_g, l_mouth_g, r_mouth_g])\n    #\u8ba1\u7b97\u4ece\u5b9e\u9645\u4eba\u8138->\u6807\u51c6\u6b63\u8138\u9700\u8981\u7ecf\u8fc7\u7684\u53d8\u6362\n    tform = trans.SimilarityTransform()\n    tform.estimate(np.array(landmark_get), landmark_golden)\n    M = tform.params[0:2, :]\n    #\u5f97\u5230\u53d8\u6362\u540e\u7684\u4eba\u8138\n    affine_output = cv2.warpAffine(ori_image, M, (112, 112), borderValue=0.0)\n    return affine_output\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63222-\u56fe\u50cf\u9884\u5904\u7406",children:"6.3.2.2.2 \u56fe\u50cf\u9884\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u9884\u5904\u7406\u6784\u5efa\uff08\u5e38\u7528\u7684\u65b9\u6cd5\uff1apadding_resize\uff0ccrop_resize\uff0cresize\uff0caffine\u3001normalization\uff09\uff1a\u53c2\u8003train.py\uff0ctest.py\u3001predict.py\u3001\u73b0\u6210\u7684onnx\u63a8\u7406\u811a\u672c\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6784\u5efa\u4eba\u8138\u8bc6\u522b\u9884\u5904\u7406\u4ee3\u7801\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226160055218",src:i(79457).A+"",width:"1091",height:"899"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#mobile_face_net.py\uff1aMobileFaceNet\ndef pre_process(self,img,to_bin = True):\n    # bgr->rgb,uint8,(112,112,3)\n    img = img[..., ::-1]\n    # Dequantize,float32,(112,112,3)\n    img = np.array(img, dtype='float32')\n    #Normalization \uff0cfloat32,(112,112,3)\n    for i in range(3):\n        img[:, :, i] -= self.normalize_mean\n        img[:, :, i] /= self.normalize_std\n    # transpose\uff0chcw->chw,float32,(3,112,112)\n    img = np.transpose(img, [2, 0, 1])\n    # 3\u7ef4\u6269\u5f20\u4e3a4\u7ef4\uff0cinput_data,float32,(1,3,112,112)\n    input_data = np.expand_dims(img, 0)\n    return input_data\n"})}),"\n",(0,s.jsxs)(e.p,{children:["**\u53c2\u8003\uff1a**\u4eba\u8138\u8bc6\u522b\u9884\u5904\u7406\u4ee3\u7801\u53c2\u8003train.py\u4e2d\u8c03\u7528\u7684dataloader\uff0c\u53bb\u6389\u4e0d\u9002\u5408\u63a8\u7406\u4f7f\u7528\u7684flip\uff08\u6570\u636e\u589e\u5f3a\uff09\uff0c\u53ea\u7559\u4e0bonnx\u63a8\u7406\u65f6\u5fc5\u8981\u7684bgr->rgb\uff08",(0,s.jsx)(e.a,{href:"https://so.csdn.net/so/search?q=scipy&spm=1001.2101.3001.7020",children:"scipy"}),".misc.imread \u8bfb\u53d6\u7684\u56fe\u7247\u6570\u636e\u662f RGB \u683c\u5f0f\uff09\u3001Normalization\uff08\u51cfmean\u9664std\uff09\u3001hwc->chw\uff08transpose\uff09\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226160816525",src:i(1855).A+"",width:"1805",height:"814"})}),"\n",(0,s.jsx)(e.h5,{id:"63123-onnx-run-1",children:"6.3.1.2.3 onnx run"}),"\n",(0,s.jsx)(e.p,{children:"\u5c06\u9884\u5904\u7406\u597d\u7684\u6570\u636e\uff0c\u5582\u7ed9\u6a21\u578b\uff0c\u5f97\u5230onnx\u63a8\u7406\u7ed3\u679c"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#onnx_model.py\ndef forward(self, image_tensor):\n    '''\n    image_tensor = image.transpose(2, 0, 1)\n    image_tensor = image_tensor[np.newaxis, :]\n    onnx_session.run([output_name], {input_name: x})\n    :param image_tensor:\n    :return:\n    '''\n    input_feed = self.get_input_feed(image_tensor)\n    output = self.sess.run(self.out_names, input_feed=input_feed)\n    return output\n\n#mobile_face_net.py\ndef farward(self, input_data):\n    embedding = self.model.forward(input_data)\n    return embedding[0]\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63124-\u540e\u5904\u7406-1",children:"6.3.1.2.4 \u540e\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u6a21\u578b\u63d0\u53d6\u5b8c\u7279\u5f81\u540e\uff0c\u653e\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u4ee5\u5907\u540e\u7eed\u4eba\u8138\u5bf9\u6bd4\u4f7f\u7528\u3002\u4e3a\u4e86\u7b80\u5316\u4ee3\u7801\uff0c\u6211\u4eec\u6682\u65f6\u4e0d\u5199\u51c6\u5907\u6570\u636e\u5e93\u7684\u8fc7\u7a0b\u4e86\uff0c\u628a\u5b83\u653e\u5728\u4eba\u8138\u5bf9\u6bd4\u7684\u8fc7\u7a0b\u4e2d\u3002"}),"\n",(0,s.jsx)(e.h5,{id:"63125-\u4eba\u8138\u5bf9\u6bd4\u7ed3\u679c",children:"6.3.1.2.5 \u4eba\u8138\u5bf9\u6bd4\u7ed3\u679c"}),"\n",(0,s.jsx)(e.p,{children:"\u8bfb\u53d6\u591a\u5f20\u4eba\u8138\uff0c\u5bf9\u6bcf\u4e2a\u4eba\u8138\u63d0\u53d6\u7279\u5f81\uff0c\u5e76\u5c06Normalization\u4e4b\u540e\u7684\u7279\u5f81\u4fdd\u5b58\u5230\u5217\u8868\u4e2d\u3002\u6700\u540e\u5bf9\u6bd4\u5f53\u524d\u5217\u8868\u7684\u7b2c\u4e00\u4e2a\u4eba\u8138\u548c\u5217\u8868\u7684\u76f8\u4f3c\u5ea6\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'face_recg = MobileFaceNet()\n\nembeddings = []\nfor i,img_file in enumerate(img_lists):\n    ori_img = cv2.imread(img_file)\n    input_data = face_recg.pre_process(ori_img)\n    embedding = face_recg.farward(input_data)\n    # \u6a21\u578b\u7279\u5f81\u5f52\u4e00\u5316\uff0c\u7136\u540e\u653e\u5230\u6570\u636e\u5e93\u4e2d\n    embedding_norm = preprocessing.normalize(embedding)\n    embeddings.append(embedding_norm)       #\u6a21\u62df\u6784\u5efa\u6570\u636e\u5e93\u8fc7\u7a0b\n\n# \u83b7\u53d6\u7b2c\u4e00\u4e2a\u4eba\u8138\u7279\u5f81\uff0c\u548c\u5176\u5b83\u4eba\u8138\u7279\u5f81\u8fdb\u884c\u5bf9\u6bd4   \nembedding_one = embeddings[0]\nscores = np.array([np.sum(embedding_one * emb_database) / 2 + 0.5 for emb_database in embeddings])\nprint("scores:",scores)\n'})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"img_lists"}),"\uff1a"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240304105854986",src:i(95944).A+"",width:"459",height:"150"})}),"\n",(0,s.jsx)(e.p,{children:"\u5047\u5982\u9608\u503c\u8bbe\u7f6e\u4e3a0.75\u7684\u8bdd\uff0c\u8bf4\u660e\u7b2c0\u30011\u662f\u540c\u4e00\u4e2a\u4eba\u8138\uff0c\u7b2c0\u30012\u662f\u4e0d\u540c\u4eba\u3002"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240227130213074",src:i(85581).A+"",width:"1465",height:"176"})}),"\n",(0,s.jsx)(e.h4,{id:"6323-onnx\u5230kmodel\u8f6c\u6362",children:"6.3.2.3 ONNX\u5230kmodel\u8f6c\u6362"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226162226960.png",src:i(7505).A+"",width:"705",height:"458"})}),"\n",(0,s.jsx)(e.h5,{id:"63231-\u914d\u7f6ekmodel\u751f\u6210\u53c2\u6570",children:"6.3.2.3.1 \u914d\u7f6ekmodel\u751f\u6210\u53c2\u6570"}),"\n",(0,s.jsx)(e.h6,{id:"1\u7f16\u8bd1\u53c2\u6570compileoptions-1",children:"1.\u7f16\u8bd1\u53c2\u6570\uff1aCompileOptions"}),"\n",(0,s.jsx)(e.p,{children:"\u5177\u4f53\u4e3a\u4ec0\u4e48\u8fd9\u6837\u8bbe\u7f6e\uff0c\u8bf7\u53c2\u71676.3.1.3.1\u4e2d\u7684\u7f16\u8bd1\u53c2\u6570\u8bbe\u7f6e\u65b9\u6cd5\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'# 1. \u8bbe\u7f6e\u7f16\u8bd1\u53c2\u6570\uff0ccompile_options\ncompile_options = nncase.CompileOptions()\n# \u6307\u5b9a\u7f16\u8bd1\u76ee\u6807, \u5982\'cpu\', \'k230\',cpu\u751f\u6210cpu\u4e0a\u63a8\u7406\u7684kmodel,k230\u751f\u6210\u5728k230(kpu)\u4e0a\u63a8\u7406\u7684kmodel\ncompile_options.target = args.target\n# \u9884\u5904\u7406\ncompile_options.preprocess = True\n# \uff081\uff09\u9884\u5904\u7406---Transpose\u76f8\u5173\u53c2\u6570\n# \u5f53 preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\ninput_shape = [1, 3, 112, 112]\ncompile_options.input_shape = input_shape\n# \u8f93\u5165\u6570\u636e\u7684layout\uff0c\u9ed8\u8ba4\u4e3a""\n# compile_options.input_layout = "NCHW"\ncompile_options.input_layout = "0,1,2,3"\n\n# \uff082\uff09\u9884\u5904\u7406---SwapRB\u76f8\u5173\u53c2\u6570\ncompile_options.swapRB = False\n\n# \uff083\uff09\u9884\u5904\u7406---Dequantize\uff08\u53cd\u91cf\u5316\uff09\u76f8\u5173\u53c2\u6570\n# \u5f00\u542f\u9884\u5904\u7406\u65f6\u6307\u5b9a\u8f93\u5165\u6570\u636e\u7c7b\u578b\uff0c\u9ed8\u8ba4\u4e3a"float"\uff1b\u5f53 preprocess\u4e3a True\u65f6\uff0c\u5fc5\u987b\u6307\u5b9a\u4e3a"uint8"\u6216\u8005"float32"\ncompile_options.input_type = \'uint8\'            \n# input_type=\u2018uint8\u2019\u65f6\u53cd\u91cf\u5316\u6709\u6548\uff0c\u53cd\u91cf\u5316\u4e4b\u540e\u7684\u6570\u636e\u8303\u56f4\ncompile_options.input_range = [0, 255]\n\n# \uff084\uff09\u9884\u5904\u7406---Normalization\u76f8\u5173\u53c2\u6570\ncompile_options.mean = [ 127.5,127.5,127.5]\ncompile_options.std = [128.0, 128.0, 128.0]\n\n# \u540e\u5904\u7406\n# compile_options.output_layout = "NCHW"\n#Compiler\u7c7b, \u6839\u636e\u7f16\u8bd1\u53c2\u6570\u914d\u7f6eCompiler\uff0c\u7528\u4e8e\u7f16\u8bd1\u795e\u7ecf\u7f51\u7edc\u6a21\u578b\ncompiler = nncase.Compiler(compile_options)\n'})}),"\n",(0,s.jsx)(e.h6,{id:"2\u5bfc\u5165\u53c2\u6570importoptions-1",children:"2.\u5bfc\u5165\u53c2\u6570\uff1aImportOptions"}),"\n",(0,s.jsx)(e.p,{children:"ImportOptions\u7c7b, \u7528\u4e8e\u914d\u7f6enncase\u5bfc\u5165\u9009\u9879\uff0c\u5f88\u5c11\u5355\u72ec\u8bbe\u7f6e\uff0c\u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570\u5373\u53ef\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# 2. \u8bbe\u7f6e\u5bfc\u5165\u53c2\u6570\uff0cimport_options\uff08\u4e00\u822c\u9ed8\u8ba4\u5373\u53ef\uff09\nimport_options = nncase.ImportOptions()\nmodel_file = onnx_simplify(args.model, dump_dir)\nmodel_content = read_model_file(model_file)\ncompiler.import_onnx(model_content, import_options)\n"})}),"\n",(0,s.jsx)(e.h6,{id:"3\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570ptqtensoroptions-1",children:"3.\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570\uff1aPTQTensorOptions"}),"\n",(0,s.jsx)(e.p,{children:"\u8bad\u7ec3\u540e\u91cf\u5316\u53c2\u6570(Post Training Quantization\uff0cPTQ)\uff0cPTQ\u662f\u4e00\u79cd\u901a\u8fc7\u5c06\u6a21\u578b\u6743\u91cd\u4ecefloat32\u6620\u5c04uint8\u6216int16\u65b9\u6cd5\uff0c\u4fdd\u6301\u6a21\u578b\u7684\u51c6\u786e\u6027\u7684\u540c\u65f6\uff0c\u51cf\u5c11\u63a8\u7406\u6240\u9700\u7684\u8ba1\u7b97\u8d44\u6e90\uff1b\u5f53target = \u201ck230\u201d\uff0cPTQ\u662f\u5fc5\u9009\u53c2\u6570\uff0c\u9ed8\u8ba4uint8\u91cf\u5316\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528uint8\u91cf\u5316\u53ef\u4ee5\u6ee1\u8db3\u4eba\u8138\u8bc6\u522b\u7cbe\u5ea6\u8981\u6c42\uff0c\u6545\u4f7f\u7528\u9ed8\u8ba4uint8\u91cf\u5316\uff1b\u6821\u6b63\u96c6\u4e2a\u6570\u4e3a100\uff1b\u5047\u8bbe\u4f7f\u7528100\u4e2a\u6821\u6b63\u96c6\u751f\u6210kmodel\u7684\u65f6\u95f4\u5f88\u4e45\uff0c\u53ef\u4ee5\u9002\u5f53\u7684\u51cf\u5c11\u6821\u6b63\u96c6\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# 3. \u8bbe\u7f6e\u91cf\u5316\u53c2\u6570\uff0cptq_options\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 100\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\ncompiler.use_ptq(ptq_options)\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63232-\u6821\u6b63\u96c6\u51c6\u5907",children:"6.3.2.3.2 \u6821\u6b63\u96c6\u51c6\u5907"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528\u5c11\u91cf\u6821\u6b63\u96c6\u8ba1\u7b97\u91cf\u5316\u56e0\u5b50\uff0c\u53ef\u4ee5\u5feb\u901f\u5f97\u5230\u91cf\u5316\u6a21\u578b\u3002\u4f7f\u7528\u8be5\u91cf\u5316\u6a21\u578b\u8fdb\u884c\u9884\u6d4b\uff0c\u53ef\u4ee5\u51cf\u5c11\u8ba1\u7b97\u91cf\u3001\u964d\u4f4e\u8ba1\u7b97\u5185\u5b58\u3001\u51cf\u5c0f\u6a21\u578b\u5927\u5c0f\u3002"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6821\u6b63\u96c6"}),"\u4e00\u822c\u9009\u7528",(0,s.jsx)(e.strong,{children:"\u9a8c\u8bc1\u96c6"}),"\u7684",(0,s.jsx)(e.strong,{children:"100\u5f20\u56fe\u7247"}),"\u5373\u53ef\u3002\u8be5",(0,s.jsx)(e.a,{href:"https://github.com/Xiaoccer/MobileFaceNet_Pytorch",children:"\u4eba\u8138\u8bc6\u522b\u6a21\u578b"}),"\u7684\u9a8c\u8bc1\u96c6\u4e3a",(0,s.jsx)(e.code,{children:"LFW"}),"\uff0c\u6545\u9009\u7528",(0,s.jsx)(e.code,{children:"LFW"}),"\u7684100\u5f20\u56fe\u50cf\u4f5c\u4e3a\u6821\u6b63\u96c6\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6ce8\uff1a"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09\u82e5\u662fkmodel",(0,s.jsx)(e.strong,{children:"\u751f\u6210\u65f6\u95f4\u5f88\u4e45"}),"\u6216\u8005\u9a8c\u8bc1\u96c6\u6570\u636e\u5f88\u5c11\uff0c\u4e5f\u53ef\u5c1d\u8bd5\u5c11\u4e8e100\u4e2a\u6570\u636e"]}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.code,{children:"generate_data"}),"\u51fd\u6570\uff0c\u751f\u6210\u7684\u6570\u636e\u683c\u5f0f\uff0c\u9700\u8981",(0,s.jsx)(e.strong,{children:"\u5927\u81f4\u4fdd\u8bc1"}),"\u4e0e\u5b9e\u9645\u63a8\u7406\u65f6\u5582\u7ed9kmodel\u7684\u6570\u636e\u683c\u5f0f\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u751f\u6210kmodel\u6709\u95ee\u9898\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"def generate_data(shape, batch, calib_dir):\n    # \u751f\u6210\u7684\u6570\u636e\u548c\u5b9e\u9645kmodel\u8f93\u5165\u6570\u636e\u4fdd\u6301\u4e00\u81f4\uff0c\u56e0\u4e3a\u751f\u6210kmodel\u65f6\uff0c\u53ea\u4f1a\u505a\u53c2\u6570\u4e2d\u8bbe\u7f6e\u7684\u9884\u5904\u7406\n    # \u751f\u6210\u7684\u6821\u6b63\u96c6\u6570\u636e\u9700\u8981\u505a\u7684\u9884\u5904\u7406 \u2248 onnx\u9884\u5904\u7406 - \u6839\u636e\u9884\u5904\u7406\u53c2\u6570\u8bbe\u7f6e\u7684\uff0c\u5305\u542b\u5728kmodel\u4e2d\u9884\u5904\u7406\n    # onnx\u9884\u5904\u7406\uff1abgr->rgb,transpose,normalization,dequantize,3\u7ef4\u5ea6\u8f6c4\u7ef4\u5ea6\n    # kmodel\u4e2d\u5305\u542b\u7684\u9884\u5904\u7406\uff1adequantize,normalization\n    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]\n    data = []\n    for i in range(batch):\n        assert i < len(img_paths), \"calibration images not enough.\"\n        # \u8bfb\u53d6\u56fe\u50cf\uff0c\u5e76\u8f6c\u4e3aRGB\n        img_data = Image.open(img_paths[i]).convert('RGB')\n        # transpose \n        img_data = np.transpose(img_data, (2, 0, 1))\n        data.append([img_data[np.newaxis, ...]])\n    return np.array(data)\n\ninput_shape = [1, 3, 112, 112]\n......\nptq_options = nncase.PTQTensorOptions()\n    ptq_options.samples_count = 100\n    # \u6821\u6b63\u96c6\u6570\u636e\u9884\u5904\u7406\uff0c\u5c06\u539f\u56fe\u5904\u7406\u4e3akmodel\u9700\u8981\u6570\u636e\n    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n    # \u4f7f\u7528samples_count\u4e2a\u6821\u51c6\u6570\u636e\u8ba1\u7b97\u91cf\u5316\u56e0\u5b50\n    compiler.use_ptq(ptq_options)\n......\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63233-\u751f\u6210kmodel",children:"6.3.2.3.3 \u751f\u6210kmodel"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u6210\u73af\u5883"}),"\uff1a6.2.2 \u6784\u5efa\u7684\u7f16\u8bd1\u73af\u5883"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u751f\u6210\u6b65\u9aa4"}),"\uff1a"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"cd k230_sdk/src/reference\n#\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd kmodel_related/kmodel_export\n#python mobile_face.py --target k230 --model onnx/MobileFaceNet.onnx --dataset lfw\n./build_model.sh\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"-rw-r--r--+ 1 root root 1319744 Feb 29 14:56 face_recognize.kmodel\n"})}),"\n",(0,s.jsx)(e.h4,{id:"6324-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",children:"6.3.2.4 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.h5,{id:"63241-simulator\u9a8c\u8bc1kmodel",children:"6.3.2.4.1 Simulator\u9a8c\u8bc1kmodel"}),"\n",(0,s.jsxs)(e.p,{children:["\u751f\u6210\u4eba\u8138\u8bc6\u522bkmodel\u4e4b\u540e\uff0c\u4e3a\u4e86\u9a8c\u8bc1kmodel\u7684\u51c6\u786e\u6027\uff0c\u9700\u8981\u5728\u4f7f\u7528Simulator\u5bf9\u6bd4kmodel\u7684\u8f93\u51fa\u548connx\u7684\u8f93\u51fa\u662f\u5426\u4e00\u81f4\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u8c03\u7528",(0,s.jsx)(e.strong,{children:"\u6a21\u62df\u5668APIs(Python)"}),"\u3002"]}),"\n",(0,s.jsx)(e.h6,{id:"1\u751f\u6210inputbin-1",children:"1.\u751f\u6210input.bin"}),"\n",(0,s.jsx)(e.p,{children:"\u4f7f\u7528simulator\u9a8c\u8bc1kmodel\u4e4b\u524d\uff0c\u9700\u8981\u5148\u51c6\u5907\u597d\u8f93\u5165\u6587\u4ef6\u3002\u7531\u4e8ekmodel\u5305\u62ec\u90e8\u5206\u9884\u5904\u7406\uff0c\u56e0\u6b64\u5bf9\u4e8e\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u9700\u8981\u5206\u522b\u5229\u7528\u4e0d\u540c\u9884\u5904\u7406\u751f\u6210\u4e0d\u540c\u7684onnx_input.bin\u3001kmodel_input.bin\u3002"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u540d\u79f0"}),(0,s.jsx)(e.th,{children:"onnx_input.bin\u6784\u5efa\u6d41\u7a0b"}),(0,s.jsx)(e.th,{children:"kmodel_input.bin\u6784\u5efa\u6d41\u7a0b"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\u6e90->\u76ee\u6807"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\uff08uint8,hwc,bgr->float32,nchw,bgr\uff09"})}),(0,s.jsx)(e.td,{children:(0,s.jsx)(e.strong,{children:"\uff08uint8,hwc,bgr->uint8,nchw,rgb\uff09"})})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u539f\u56fe"}),(0,s.jsx)(e.td,{children:"(112,112,3) ,uint8, hwc,bgr"}),(0,s.jsx)(e.td,{children:"(112,112,3) ,uint8,hwc,bgr"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"bgr->rgb"}),(0,s.jsx)(e.td,{children:"\uff08112,112,3\uff09\uff0cuint8\uff0chwc\uff0crgb"}),(0,s.jsx)(e.td,{children:"\uff08112,112,3\uff09\uff0cuint8\uff0chwc\uff0crgb"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"dequantize"}),(0,s.jsx)(e.td,{children:"\uff08112,112,3\uff09\uff0cfloat32\uff0chwc\uff0crgb"}),(0,s.jsx)(e.td,{children:"\u2014"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"normalization"}),(0,s.jsx)(e.td,{children:"\uff08112,112,3\uff09\uff0cfloat32\uff0chwc\uff0crgb"}),(0,s.jsx)(e.td,{children:"\u2014"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"transpose"}),(0,s.jsx)(e.td,{children:"\uff083,112,112\uff09\uff0cfloat32\uff0cchw\uff0crgb"}),(0,s.jsx)(e.td,{children:"\uff083,112,112\uff09\uff0cuint8\uff0cchw\uff0crgb"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"\u7ef4\u5ea6\u6269\u5c55\uff08\u975e\u5fc5\u987b\uff09"}),(0,s.jsx)(e.td,{children:"\uff081,3,112,112\uff09\uff0cuint8\uff0cchw\uff0crgb"}),(0,s.jsx)(e.td,{children:"\uff081,3,112,112\uff09\uff0cuint8\uff0cchw\uff0crgb"})]})]})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u6ce8"}),"\uff1a\u751f\u6210\u7684kmodel\u4e2d\u5305\u542b\u90e8\u5206\u9884\u5904\u7406\uff0c\u751f\u6210kmodel_input.bin\u9700\u8981\u7684\u9884\u5904\u7406 \u2248 \u751f\u6210onnx_input.bin\u9700\u8981\u7684\u9884\u5904\u7406 - kmodel\u4e2d\u5305\u542b\u7684\u9884\u5904\u7406\uff08\u4eba\u8138\u8bc6\u522bkmodel\u4e2d\u9884\u5904\u7406transpose\u3001dequantize\u3001normalization\uff09"]}),"\n",(0,s.jsx)(e.p,{children:"\uff081\uff09\u7ef4\u5ea6\u6269\u5c55\u53ef\u4ee5\u7701\u7565\uff08\u8bfb\u53d6\u65f6bin\u6587\u4ef6\u53ef\u4ee5\u7528reshape\uff0c\u751f\u6210bin\u65f6\u53ef\u4ee5\u7701\u7565\uff09"}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09transpose\u4e5f\u653e\u5230kmodel\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u751f\u6210kmodel_input.bin\u4ecd\u9700transpose\uff1f\u7531\u4e8e\u751f\u6210kmodel\uff0c\u82e5\u662f\u6253\u5f00\u4e86\u9884\u5904\u7406\u5f00\u5173\uff0ctranspose\u7684\u76f8\u5173\u53c2\u6570\u5fc5\u987b\u8bbe\u7f6e\uff0c\u6211\u4eec\u4eba\u8138\u8bc6\u522bkmodel\u7684\u5b9e\u9645\u8f93\u5165\u662f",(0,s.jsx)(e.code,{children:"NCHW"}),"\uff0cinput_layout\u8bbe\u7f6e\u4e3a",(0,s.jsx)(e.code,{children:"NCHW"}),"\uff0c\u4e24\u8005\u662f\u4e00\u81f4\u7684\uff0c\u56e0\u6b64transpose\u662fNCHW2NCHW\uff0c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u8f6c\u6362\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226174214155",src:i(71621).A+"",width:"1637",height:"920"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"-rw-r--r-- 1 root root 147K Feb 26 16:37 face_recg_0_112x112_float32.bin\n-rw-r--r-- 1 root root  37K Feb 26 16:37 face_recg_0_112x112_uint8.bin\n"})}),"\n",(0,s.jsx)(e.h6,{id:"2simulator\u9a8c\u8bc1-1",children:"2.Simulator\u9a8c\u8bc1"}),"\n",(0,s.jsxs)(e.p,{children:["\u6a21\u62df\u5668APIs\u7684\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240221140036235",src:i(87206).A+"",width:"255",height:"431"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"Simulator\u6d41\u7a0b"}),"\uff1a\uff08\u4e0e\u4eba\u8138\u68c0\u6d4b\u6d41\u7a0b\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u9700\u4fee\u6539input_shape\u3001input_bin_file\u5373\u53ef\uff09"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u5bf9\u4e8e\u540c\u4e00\u5f20\u56fe\u7247\uff0c\u5206\u522b\u5229\u7528\u4e0d\u540c\u9884\u5904\u7406\u751f\u6210\u4e0d\u540c\u7684onnx_input.bin\u3001kmodel_input.bin\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u5c06onnx_input.bin\u5582\u7ed9onnx\uff0c\u7ecf\u8fc7onnx\u63a8\u7406\u5f97cpu_results\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u5c06kmodel_input.bin\u5582\u7ed9kmodel\uff0c\u7ecf\u8fc7Simulator\u63a8\u7406\u5f97\u5230nncase_results\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u8ba1\u7b97cpu_results\u548cnncase_results\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff0c\u901a\u8fc7\u76f8\u4f3c\u5ea6\u7684\u5927\u5c0f\u5224\u65adkmodel\u7684\u6a21\u62df\u63a8\u7406\u548connx\u7684\u63a8\u7406\u7ed3\u679c\u662f\u5426\u4e00\u81f4\u3002"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"import os\nimport copy\nimport argparse\nimport numpy as np\nimport onnx\nimport onnxruntime as ort\nimport nncase\n\ndef read_model_file(model_file):\n    with open(model_file, 'rb') as f:\n        model_content = f.read()\n    return model_content\n\ndef cosine(gt, pred):\n    return (gt @ pred) / (np.linalg.norm(gt, 2) * np.linalg.norm(pred, 2))\n\ndef main():\n    parser = argparse.ArgumentParser(prog=\"nncase\")\n    parser.add_argument(\"--target\", type=str, help='target to run')\n    parser.add_argument(\"--model\", type=str, help='original model file')\n    parser.add_argument(\"--model_input\", type=str, help='input bin file for original model')\n    parser.add_argument(\"--kmodel\", type=str, help='kmodel file')\n    parser.add_argument(\"--kmodel_input\", type=str, help='input bin file for kmodel')\n    args = parser.parse_args()\n\n    # 1. onnx\u63a8\u7406\uff0c\u5f97\u5230cpu_results\n    ort_session = ort.InferenceSession(args.model)\n    output_names = []\n    model_outputs = ort_session.get_outputs()\n    for i in range(len(model_outputs)):\n        output_names.append(model_outputs[i].name)\n    model_input = ort_session.get_inputs()[0]\n  \n    model_input_name = model_input.name\n    model_input_type = np.float32\n    model_input_shape = model_input.shape\n    print('onnx_input\uff1a',model_input_shape)\n    model_input_data = np.fromfile(args.model_input, model_input_type).reshape(model_input_shape)\n    cpu_results = []\n    cpu_results = ort_session.run(output_names, { model_input_name : model_input_data })\n\n    \n    # 2. Simulator\u63a8\u7406\uff0c\u5f97\u5230nncase_results\n    # create Simulator\n    sim = nncase.Simulator()\n\n    # read kmodel\n    kmodel = read_model_file(args.kmodel)\n\n    # load kmodel\n    sim.load_model(kmodel)\n\n    # read input.bin\n    input_shape = [1, 3, 112, 112]\n    dtype = sim.get_input_desc(0).dtype\n    input = np.fromfile(args.kmodel_input, dtype).reshape(input_shape)\n\n    # set input for Simulator\n    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(input))\n\n    # Simulator inference\n    nncase_results = []\n    sim.run()\n    for i in range(sim.outputs_size):\n        nncase_result = sim.get_output_tensor(i).to_numpy()\n        # print(\"nncase_result:\",nncase_result)\n        input_bin_file = 'bin/face_recg_{}_{}_simu.bin'.format(i,args.target)\n        nncase_result.tofile(input_bin_file)\n        nncase_results.append(copy.deepcopy(nncase_result))\n\n    # 3. \u8ba1\u7b97onnx\u548cSimulator\u76f8\u4f3c\u5ea6\n    for i in range(sim.outputs_size):\n        cos = cosine(np.reshape(nncase_results[i], (-1)), np.reshape(cpu_results[i], (-1)))\n        print('output {0} cosine similarity : {1}'.format(i, cos))\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e0a\u8fb9\u7684\u811a\u672c\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206onnx\u53ca\u5176kmodel\u7684\u5bf9\u6bd4\u9a8c\u8bc1\uff0c\u4e00\u822c\u4e0d\u7528\u592a\u591a\u4fee\u6539\u3002\u53ea\u9700\u6839\u636e\u6a21\u578b\u5b9e\u9645\u8f93\u5165\u5927\u5c0f\u4fee\u6539",(0,s.jsx)(e.code,{children:"input_shape"}),"\u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"python mobile_face_onnx_simu.py --target k230 --model onnx/MobileFaceNet.onnx --model_input bin/face_recg_0_112x112_float32.bin --kmodel onnx/k230_mobile_face.kmodel --kmodel_input bin/face_recg_0_112x112_uint8.bin\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/ \ncd K230_AI_Demo_Development_Process_Analysis\ncd kmodel_related/kmodel_export\n#\u4e0a\u8ff0\u547d\u4ee4\u884c\u5df2\u7ecf\u653e\u5230build_model.sh \n./build_model.sh            \n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4e00\u822connx\u548cSimulator\u4f59\u5f26\u76f8\u4f3c\u5ea6\u8d8a\u9ad8\u8d8a\u597d\uff0c\u4e00\u822c0.99\u4ee5\u4e0a\u5373\u53ef\u6ee1\u8db3\u6761\u4ef6\uff1b\u82e5\u662f\u8fbe\u4e0d\u52300.99\uff0c\u4f46\u662f\u57280.96\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fdb\u4e00\u6b65",(0,s.jsx)(e.strong,{children:"\u4e0a\u677f\u63a8\u7406\u9a8c\u8bc1"}),"\u751f\u6210\u7684kmodel\u662f\u5426\u6ee1\u8db3\u5b9e\u9645\u6548\u679c\u9700\u6c42\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226175528723",src:i(64959).A+"",width:"1457",height:"125"})}),"\n",(0,s.jsx)(e.p,{children:"**\u6ce8\uff1a**\u5728\u6267\u884cSimulator\u65f6\uff0c\u5fc5\u987b\u5148\u6dfb\u52a0\u4ee5\u4e0b\u73af\u5883\u53d8\u91cf\uff08build_model.sh\u6587\u4ef6\u5176\u4e2d\u542b\u6709\uff09"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"export NNCASE_PLUGIN_PATH=$NNCASE_PLUGIN_PATH:/usr/local/lib/python3.8/dist-packages/\nexport PATH=$PATH:/usr/local/lib/python3.8/dist-packages/\nsource /etc/profile\n"})}),"\n",(0,s.jsx)(e.h5,{id:"63242-\u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel",children:"6.3.2.4.2 \u4f7f\u7528main_nncase\u9a8c\u8bc1kmodel"}),"\n",(0,s.jsxs)(e.p,{children:["Simulator\u63a8\u7406kmodel\u548c\u4e0a\u677f\u63a8\u7406kmodel\u4e00\u822c\u6765\u8bf4\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u662f\u4e0d\u6392\u9664\u4e2a\u522b\u60c5\u51b5\u4e0bSimulator\u4e0e\u5b9e\u9645\u4e0a\u677f\u4ecd\u6709\u4e00\u5b9a\u5dee\u5f02\uff0c\u4e3a\u4e86\u9a8c\u8bc1\u4e24\u8005\u662f\u5426\u4e00\u81f4\uff0c\u9700\u8981\u4f7f\u7528main_nncase\u5de5\u5177\u8f85\u52a9\u9a8c\u8bc1Simulator\u63a8\u7406kmodel\u4e0e\u4e0a\u677f\u5b9e\u9645\u63a8\u7406kmodel\u7ed3\u679c\u662f\u5426\u4e00\u81f4\uff1b\u4f7f\u7528\u8fd9\u4e2a\u5de5\u5177\u9700\u8981\u8c03\u7528nncase\u7684",(0,s.jsx)(e.strong,{children:"KPU\u8fd0\u884c\u65f6APIs(C++)"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:["KPU\u8fd0\u884c\u65f6APIs\u63d0\u4f9bkmodel\u4e0a\u677f\u63a8\u7406\u7684\u5404\u79cd\u63a5\u53e3 \uff0c\u63a5\u53e3\u5982\u4e0b\u56fe\u6240\u793a\u3002\u82e5\u662f\u5728github\u65e0\u6cd5\u770b\u5230",(0,s.jsx)(e.a,{href:"https://github.com/kendryte/k230_docs/blob/main/zh/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.md",children:"K230_nncase_\u5f00\u53d1\u6307\u5357.md"}),"\u6587\u6863\u4e2d\u76ee\u5f55\u7ed3\u6784\uff0c\u53ef\u4ee5\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u4f7f\u7528Typora\u5de5\u5177\u6253\u5f00\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240221141307953",src:i(60941).A+"",width:"310",height:"356"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"main_nncase\u9a8c\u8bc1\u6d41\u7a0b\uff1a"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\u52a0\u8f7dkmodel"}),"\n",(0,s.jsx)(e.li,{children:"\u8bbe\u7f6ekmodel\u8f93\u5165\uff1a\u8bfb\u53d6kmodel_input.bin\u6587\u4ef6"}),"\n",(0,s.jsx)(e.li,{children:"\u8bbe\u7f6ekmodel\u8f93\u51fa"}),"\n",(0,s.jsx)(e.li,{children:"\u63a8\u7406kmodel"}),"\n",(0,s.jsx)(e.li,{children:"\u83b7\u53d6kmodel\u8f93\u51fa"}),"\n",(0,s.jsx)(e.li,{children:"\u5bf9\u6bd4Simulator\u63a8\u7406kmodel\u3001\u4e0a\u677f\u63a8\u7406kmodel\u7ed3\u679c\u76f8\u4f3c\u6027"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//main_nncase\n#include <chrono>\n#include <fstream>\n#include <iostream>\n#include <nncase/runtime/runtime_tensor.h>\n#include <nncase/runtime/interpreter.h>\n#include <nncase/runtime/runtime_op_utility.h>\n\nusing namespace nncase;\nusing namespace nncase::runtime;\nusing namespace nncase::runtime::detail;\n\n#define USE_CACHE 1\n\ntemplate <class T>\nstd::vector<T> read_binary_file(const char *file_name)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    std::vector<T> vec(len / sizeof(T), 0);\n    ifs.seekg(0, ifs.beg);\n    ifs.read(reinterpret_cast<char *>(vec.data()), len);\n    ifs.close();\n    return vec;\n}\n\nvoid read_binary_file(const char *file_name, char *buffer)\n{\n    std::ifstream ifs(file_name, std::ios::binary);\n    ifs.seekg(0, ifs.end);\n    size_t len = ifs.tellg();\n    ifs.seekg(0, ifs.beg);\n    ifs.read(buffer, len);\n    ifs.close();\n}\n\ntemplate <typename T>\ndouble dot(const T *v1, const T *v2, size_t size)\n{\n    double ret = 0.f;\n    for (size_t i = 0; i < size; i++)\n    {\n        ret += v1[i] * v2[i];\n    }\n\n    return ret;\n}\n\ntemplate <typename T>\ndouble cosine(const T *v1, const T *v2, size_t size)\n{\n    return dot(v1, v2, size) / ((sqrt(dot(v1, v1, size)) * sqrt(dot(v2, v2, size))));\n}\n\nvoid dump(const std::string &info, volatile float *p, size_t size)\n{\n    std::cout << info << " dump: p = " << std::hex << (void *)p << std::dec << ", size = " << size << std::endl;\n    volatile unsigned int *q = reinterpret_cast<volatile unsigned int *>(p);\n    for (size_t i = 0; i < size; i++)\n    {\n        if ((i != 0) && (i % 4 == 0))\n        {\n            std::cout << std::endl;\n        }\n\n        std::cout << std::hex << q[i] << " ";\n    }\n    std::cout << std::dec << std::endl;\n}\n\nint main(int argc, char *argv[])\n{\n    std::cout << "case " << argv[0] << " build " << __DATE__ << " " << __TIME__ << std::endl;\n    if (argc < 4)\n    {\n        std::cerr << "Usage: " << argv[0] << " <kmodel> <input_0.bin> <input_1.bin> ... <input_N.bin> <output_0.bin> <output_1.bin> ... <output_N.bin>" << std::endl;\n        return -1;\n    }\n\n    interpreter interp;                             \n\n    // 1. load model\n    std::ifstream in_before_load_kmodel("/proc/media-mem");\n    std::string line_before_load_kmodel;\n    // \u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u67e5\u770bMMZ\u4f7f\u7528\u60c5\u51b5\n    while (std::getline(in_before_load_kmodel, line_before_load_kmodel)) { \n        std::cout << line_before_load_kmodel << std::endl;\n    }\n\n    std::ifstream ifs(argv[1], std::ios::binary);\n    interp.load_model(ifs).expect("Invalid kmodel");\n\n    std::ifstream in_after_load_kmodel("/proc/media-mem");\n    std::string line_after_load_kmodel;\n    // \u9010\u884c\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff0c\u67e5\u770bMMZ\u4f7f\u7528\u60c5\u51b5\n    while (std::getline(in_after_load_kmodel, line_after_load_kmodel)) {  \n        std::cout << line_after_load_kmodel << std::endl;  \n    }\n\n    // 2. set inputs\n    for (size_t i = 2, j = 0; i < 2 + interp.inputs_size(); i++, j++)\n    {\n        auto desc = interp.input_desc(j);\n        auto shape = interp.input_shape(j);\n        auto tensor = host_runtime_tensor::create(desc.datatype, shape, hrt::pool_shared).expect("cannot create input tensor");\n        auto mapped_buf = std::move(hrt::map(tensor, map_access_::map_write).unwrap());\n#if USE_CACHE\n        read_binary_file(argv[i], reinterpret_cast<char *>(mapped_buf.buffer().data()));\n#else\n        auto vec = read_binary_file<unsigned char>(argv[i]);\n        memcpy(reinterpret_cast<void *>(mapped_buf.buffer().data()), reinterpret_cast<void *>(vec.data()), vec.size());\n        // dump("app dump input vector", (volatile float *)vec.data(), 32);\n#endif\n        auto ret = mapped_buf.unmap();\n        ret = hrt::sync(tensor, sync_op_t::sync_write_back, true);\n        if (!ret.is_ok())\n        {\n            std::cerr << "hrt::sync failed" << std::endl;\n            std::abort();\n        }\n\n        // dump("app dump input block", (volatile float *)block.virtual_address, 32);\n        interp.input_tensor(j, tensor).expect("cannot set input tensor");\n    }\n\n    // 3. set outputs\n    for (size_t i = 0; i < interp.outputs_size(); i++)\n    {\n        auto desc = interp.output_desc(i);\n        auto shape = interp.output_shape(i);\n        auto tensor = host_runtime_tensor::create(desc.datatype, shape, hrt::pool_shared).expect("cannot create output tensor");\n        interp.output_tensor(i, tensor).expect("cannot set output tensor");\n    }\n\n    // 4. run\n    auto start = std::chrono::steady_clock::now();\n    interp.run().expect("error occurred in running model");\n    auto stop = std::chrono::steady_clock::now();\n    double duration = std::chrono::duration<double, std::milli>(stop - start).count();\n    std::cout << "interp run: " << duration << " ms, fps = " << 1000 / duration << std::endl;\n\n    // 5. get outputs\n    for (int i = 2 + interp.inputs_size(), j = 0; i < argc; i++, j++)\n    {\n        auto out = interp.output_tensor(j).expect("cannot get output tensor");\n        auto mapped_buf = std::move(hrt::map(out, map_access_::map_read).unwrap());\n        auto expected = read_binary_file<unsigned char>(argv[i]);\n\n        // 6. compare\n        int ret = memcmp((void *)mapped_buf.buffer().data(), (void *)expected.data(), expected.size());\n        if (!ret)\n        {\n            std::cout << "compare output " << j << " Pass!" << std::endl;\n        }\n        else\n        {\n            auto cos = cosine((const float *)mapped_buf.buffer().data(), (const float *)expected.data(), expected.size()/sizeof(float));\n            std::cerr << "compare output " << j << " Fail: cosine similarity = " << cos << std::endl;\n        }\n    }\n\n    return 0;\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"\u7f16\u8bd1\u4e0a\u8ff0c++\u4ee3\u7801\uff0c\u5c06\u751f\u6210\u7684k230_bin\u76ee\u5f55\u62f7\u8d1d\u5230CanMV-K230\u5f00\u53d1\u677f\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#docker\u5bb9\u5668\u4e2d\uff0c\u82e5\u5df2\u4e0b\u8f7dcode\u8fc7\uff0c\u8bf7\u5ffd\u7565clone\u6b65\u9aa4\ndocker exec -it v1.3_0219_lj /bin/bash\ncd src/reference\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis.git\ncd K230_AI_Demo_Development_Process_Analysis/kmodel_related/kmodel_inference/\n./build_app.sh debug\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5728\u5c0f\u6838\u4e0a\uff1a\n# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\ncd /sharefs/\n#\u793a\u4f8b\uff1a\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5c06\u6e90\u76ee\u5f55\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u76ee\u5f55\nscp liujie@10.10.1.22:/xxx/k230_bin/debug /sharefs/ \n\n# \u5927\u6838\u4e0a\ncd /sharefs/k230_bin/debug\n# face_recognize_main_nncase.sh\n./main_nncase.elf face_recognize.kmodel face_recg_0_112x112_uint8.bin face_recg_0_k230_simu.bin\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226185940457",src:i(86694).A+"",width:"1463",height:"344"})}),"\n",(0,s.jsx)(e.p,{children:"\u901a\u8fc7\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u8bc6\u522bkmodel",(0,s.jsx)(e.strong,{children:"\u5185\u5b58"}),"\uff1a\u5927\u6982\u5360\u75282M\u5de6\u53f3"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u8bc6\u522bkmodel",(0,s.jsx)(e.strong,{children:"\u63a8\u7406\u901f\u5ea6"}),"\uff1a1.21ms"]}),"\n",(0,s.jsxs)(e.li,{children:["\u4eba\u8138\u8bc6\u522b",(0,s.jsx)(e.strong,{children:"Simulator\u548c\u4e0a\u677f\u63a8\u7406\u76f8\u4f3c\u5ea6"}),"\uff1a\u8f93\u51fa\u5b8c\u5168\u4e00\u81f4\uff08byte\u7ea7\u522b\u4e00\u81f4\uff09"]}),"\n"]}),"\n",(0,s.jsx)(e.h5,{id:"63243-\u4f7f\u7528k230runtime\u8fdb\u884c\u63a8\u7406",children:"6.3.2.4.3 \u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u6574\u4f53\u6d41\u7a0b\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226185940459.png",src:i(58232).A+"",width:"1002",height:"918"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u8bc6\u522b\u6d41\u7a0b\uff1a"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"image-20240226185940458.png",src:i(42849).A+"",width:"688",height:"857"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/face_recognition",children:"face_recognition code"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"\u251c\u2500\u2500 ai_base.cc                  #AI\u57fa\u7c7b\uff0c\u5c01\u88c5KPU\u8fd0\u884c\u65f6API\uff0c\u7b80\u5316kmodel\u76f8\u5173\u64cd\u4f5c\n\u251c\u2500\u2500 ai_base.h\n\u251c\u2500\u2500 anchors_640.cc              #\u4eba\u8138\u68c0\u6d4b640\u5206\u8fa8\u7387\u8f93\u5165\u5bf9\u5e94anchor\n\u251c\u2500\u2500 CMakeLists.txt\n\u251c\u2500\u2500 face_detection.cc           #\u4eba\u8138\u68c0\u6d4b\uff0c\u9884\u5904\u7406\uff0ckmodel\u63a8\u7406\u3001\u540e\u5904\u7406\n\u251c\u2500\u2500 face_detection.h\n\u251c\u2500\u2500 face_recognition.cc         #\u4eba\u8138\u8bc6\u522b\uff0c\u9884\u5904\u7406\uff0ckmodel\u63a8\u7406\u3001\u6570\u636e\u5e93\u6bd4\u5bf9\n\u251c\u2500\u2500 face_recognition.h\n\u251c\u2500\u2500 main.cc                     #\u4eba\u8138\u8bc6\u522bdemo\u4e3b\u6d41\u7a0b\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 scoped_timing.hpp           #\u8ba1\u65f6\u7c7b\n\u251c\u2500\u2500 utils.cc                    #\u5de5\u5177\u7c7b\uff0c\u5c01\u88c5\u5e38\u7528\u51fd\u6570\u53caAI2D \u8fd0\u884c\u65f6APIs\uff0c\u7b80\u5316\u9884\u5904\u7406\u64cd\u4f5c\n\u251c\u2500\u2500 utils.h\n\u2514\u2500\u2500 vi_vo.h                     #\u5c01\u88c5sensor\u3001display\u64cd\u4f5c\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4f7f\u7528K230Runtime\u63a8\u7406kmodel\u9700\u8981\u8be6\u7ec6\u4e86\u89e3K230Runtime\u7684\u8bf4\u660e\u6587\u6863\uff0c\u4e3a\u4e86\u7b80\u5316\u63a8\u7406\u6d41\u7a0b\uff0c\u5bf9K230Runtime\u7684\u63a5\u53e3\u8fdb\u884c\u5c01\u88c5\uff0c\u5176\u4e2d",(0,s.jsx)(e.code,{children:"ai_base.cc\u3001scoped_timing.hpp\u3001utils.cc\u3001vi_vo.h"}),"\u662f\u5c01\u88c5\u597d\u7684\u65b9\u6cd5\uff0c\u65e0\u9700\u4fee\u6539\uff1b",(0,s.jsx)(e.code,{children:"face_detection.cc"}),"\u5df2\u7ecf\u5728\u4eba\u8138\u68c0\u6d4bdemo\u4e2d\u5b9e\u73b0\uff0c\u76f4\u63a5\u62f7\u8d1d\u5373\u53ef\uff1b",(0,s.jsx)(e.code,{children:"face_recognition.cc"}),"\u53ea\u9700\u5c06",(0,s.jsx)(e.code,{children:"face_detection.cc"}),"\u62f7\u8d1d\u4e00\u4efd\uff0c\u4fee\u6539\u5bf9\u5e94\u6784\u9020\u51fd\u6570\u3001\u9884\u5904\u7406\uff08pre_process\uff09\u3001\u540e\u5904\u7406\uff08post_process\uff09\u5373\u53ef\u3002"]}),"\n",(0,s.jsx)(e.h6,{id:"1\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27-1",children:"1.\u8bfb\u53d6\u56fe\u7247\u6216\u89c6\u9891\u5e27"}),"\n",(0,s.jsxs)(e.p,{children:["\uff081\uff09",(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u56fe\u7247"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"cv::Mat ori_img = cv::imread(xxx);\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\uff082\uff09",(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u89c6\u9891\u5e27"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u8bfb\u53d6\u89c6\u9891\u5e27\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_vi_vo",children:"test_vi_vo demo"})]}),"\n",(0,s.jsx)(e.h6,{id:"2\u9884\u5904\u7406-1",children:"2.\u9884\u5904\u7406"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u80cc\u666f\u77e5\u8bc6"}),"\uff1a\u53c2\u6570\u4e0d\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u53ef\u4ee5\u53cd\u590d\u8c03\u7528\uff1b\u53c2\u6570\u6539\u53d8\u5219\u9700\u8981\u521b\u5efa\u65b0\u7684",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u8bc6\u522b\u56fe\u50cf\u9884\u5904\u7406"}),"\uff1a\u7531\u4e8e\u8f93\u5165\u7684\u4eba\u8138\u4e94\u5b98\u70b9\u4f4d\u7f6e\u4e0d\u540c\uff0c\u8ba1\u7b97\u5f97\u5230\u4eff\u5c04\u53d8\u6362\u4e5f\u4e0d\u540c\uff1b\u4eba\u8138\u5bf9\u9f50\uff08affine\uff09\u65f6\u9700\u8981\u7528\u751f\u6210\u7684\u4eff\u5c04\u53d8\u6362\u4f5c\u4e3a\u53c2\u6570\u6765\u8bbe\u7f6eAI2D\uff0cAI2D\u7684\u53c2\u6570\u6bcf\u6b21\u90fd\u4f1a\u6539\u53d8\uff0c\u9700\u8981\u91cd\u65b0\u8c03\u7528Utils::affine\u521b\u5efa\u65b0\u7684",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u6765\u8fdb\u884c\u9884\u5904\u7406\u3002"]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u8bc6\u522b\u89c6\u9891\u6d41\u9884\u5904\u7406"}),"\uff1a\u540c\u7406\uff0c\u7531\u4e8e\u4e0d\u540c\u5e27\u7684\u4eba\u8138\u4e94\u5b98\u70b9\u4f4d\u7f6e\u4e0d\u540c\uff0c\u4e5f\u9700\u8981\u91cd\u65b0\u8c03\u7528Utils::affine\u521b\u5efa\u65b0\u7684",(0,s.jsx)(e.code,{children:"ai2d_builder_"}),"\u6765\u8fdb\u884c\u9884\u5904\u7406\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'// ai2d for image\nvoid FaceRecognition::pre_process(cv::Mat ori_img, float *sparse_points)\n{\n    ScopedTiming st(model_name_ + " pre_process image", debug_mode_);\n    get_affine_matrix(sparse_points);\n\n    std::vector<uint8_t> chw_vec;\n    Utils::bgr2rgb_and_hwc2chw(ori_img, chw_vec);\n    Utils::affine({ori_img.channels(), ori_img.rows, ori_img.cols}, chw_vec, matrix_dst_, ai2d_out_tensor_);\n\n    if (debug_mode_ > 1)\n    {\n        auto vaddr_out_buf = ai2d_out_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        unsigned char *output = reinterpret_cast<unsigned char *>(vaddr_out_buf.data());\n        Utils::dump_color_image("FaceRecognition_input_affine.png",{input_shapes_[0][3],input_shapes_[0][2]},output);\n    }\n}\n\n// ai2d for video\nvoid FaceRecognition::pre_process(float *sparse_points)\n{\n    ScopedTiming st(model_name_ + " pre_process_video", debug_mode_);\n    get_affine_matrix(sparse_points);\n    size_t isp_size = isp_shape_.channel * isp_shape_.height * isp_shape_.width;\n    auto buf = ai2d_in_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();\n    memcpy(reinterpret_cast<char *>(buf.data()), (void *)vaddr_, isp_size);\n    hrt::sync(ai2d_in_tensor_, sync_op_t::sync_write_back, true).expect("sync write_back failed");\n    Utils::affine(matrix_dst_, ai2d_builder_, ai2d_in_tensor_, ai2d_out_tensor_);\n\n    if (debug_mode_ > 1)\n    {\n        auto vaddr_out_buf = ai2d_out_tensor_.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        unsigned char *output = reinterpret_cast<unsigned char *>(vaddr_out_buf.data());\n        Utils::dump_color_image("FaceRecognition_input_affine.png",{input_shapes_[0][3],input_shapes_[0][2]},output);\n    }\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:"sparse_point\uff08\u4eba\u8138\u4e94\u5b98\u70b9\uff09\u7684\u83b7\u53d6\u65b9\u5f0f\uff1a\u5148\u8fdb\u884c\u4eba\u8138\u68c0\u6d4b\uff0c\u4eba\u8138\u68c0\u6d4b\u7ed3\u679c\u4e2d\u5305\u542bsparse_point\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//main.cc\n......\n//\u4eba\u8138\u68c0\u6d4b\u3001\u4eba\u8138\u8bc6\u522b\u793a\u4f8b\u521b\u5efa\u65f6\u90fd\u5171\u4eab\u540c\u4e00\u5757\u5730\u5740vaddr\nFaceDetection face_det(argv[1], atof(argv[2]),atof(argv[3]), {SENSOR_CHANNEL, SENSOR_HEIGHT, SENSOR_WIDTH}, reinterpret_cast<uintptr_t>(vaddr), reinterpret_cast<uintptr_t>(paddr), atoi(argv[8]));\n\nFaceRecognition face_recg(argv[4],atoi(argv[5]),recg_thres, {SENSOR_CHANNEL, SENSOR_HEIGHT, SENSOR_WIDTH}, reinterpret_cast<uintptr_t>(vaddr), reinterpret_cast<uintptr_t>(paddr), atoi(argv[8]));\n\n//\u6bcf\u4ecesensor\u8bfb\u53d6\u4e00\u5e27\u56fe\u50cf\uff0c\u90fd\u4f1a\u5c06\u6570\u636e\u62f7\u8d1d\u5230vaddr\nwhile (!isp_stop)\n{\n    ScopedTiming st("total time", 1);\n    {\n        // \u6bcf\u4ecesensor\u8bfb\u53d6\u4e00\u5e27\u56fe\u50cf\n        ScopedTiming st("read capture", atoi(argv[8]));\n        memset(&dump_info, 0, sizeof(k_video_frame_info));\n        ret = kd_mpi_vicap_dump_frame(vicap_dev, VICAP_CHN_ID_1, VICAP_DUMP_YUV, &dump_info, 1000);\n        if (ret)\n        {\n            printf("sample_vicap...kd_mpi_vicap_dump_frame failed.\\n");\n            continue;\n        }\n    }\n\n    {\n        // \u5c06\u4ecesensor\u4e2d\u8bfb\u53d6\u6570\u636e\u62f7\u8d1d\u5230vaddr\n        ScopedTiming st("isp copy", atoi(argv[8]));\n        auto vbvaddr = kd_mpi_sys_mmap_cached(dump_info.v_frame.phys_addr[0], size);\n        memcpy(vaddr, (void *)vbvaddr, SENSOR_HEIGHT * SENSOR_WIDTH * 3);  // \u8fd9\u91cc\u4ee5\u540e\u53ef\u4ee5\u53bb\u6389\uff0c\u4e0d\u7528copy\n        kd_mpi_sys_munmap(vbvaddr, size);\n    }\n\n    det_results.clear();\n\n    // \u5c06vaddr\u6570\u636e\u62f7\u8d1d\u7ed9\u4eba\u8138\u68c0\u6d4bai2d\u8f93\u5165\uff0c\u9884\u5904\u7406\u540e\uff0c\u9884\u5904\u7406\u7ed3\u679c\u4f1a\u653e\u5230ai2d\u8f93\u51fa;ai2d\u8f93\u51fa\uff0c\u5176\u5b9e\u662f\u6307\u5411\u4eba\u8138\u68c0\u6d4bkmodel\u8f93\u5165\u7684\n    face_det.pre_process();\n    face_det.inference();\n    face_det.post_process({SENSOR_WIDTH, SENSOR_HEIGHT}, det_results);\n\n    cv::Mat osd_frame(osd_height, osd_width, CV_8UC4, cv::Scalar(0, 0, 0, 0));\n    for (int i = 0; i < det_results.size(); ++i)\n    {\n        //***for face recg***\n        // \u5c06vaddr\u6570\u636e\u62f7\u8d1d\u7ed9\u4eba\u8138\u8bc6\u522bai2d\u8f93\u5165\uff0c\u9884\u5904\u7406\u540e\uff0c\u9884\u5904\u7406\u7ed3\u679c\u4f1a\u653e\u5230ai2d\u8f93\u51fa;ai2d\u8f93\u51fa\uff0c\u5176\u5b9e\u662f\u6307\u5411\u4eba\u8138\u8bc6\u522bkmodel\u8f93\u5165\u7684\n        face_recg.pre_process(det_results[i].sparse_kps.points);\n        face_recg.inference();\n\n        FaceRecognitionInfo recg_result;\n        face_recg.database_search(recg_result); \n        face_recg.draw_result(osd_frame,det_results[i].bbox,recg_result,false);\n    }\n\n    {\n        ScopedTiming st("osd copy", atoi(argv[8]));\n        memcpy(pic_vaddr, osd_frame.data, osd_width * osd_height * 4);\n        // \u663e\u793a\u901a\u9053\u63d2\u5165\u5e27\n        kd_mpi_vo_chn_insert_frame(osd_id + 3, &vf_info); // K_VO_OSD0\n        ret = kd_mpi_vicap_dump_release(vicap_dev, VICAP_CHN_ID_1, &dump_info);\n        if (ret)\n        {\n            printf("sample_vicap...kd_mpi_vicap_dump_release failed.\\n");\n        }\n    }\n}\n......\n'})}),"\n",(0,s.jsx)(e.h6,{id:"3kmodel-run-1",children:"3.kmodel run"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//ai_base.cc\nvoid AIBase::run()\n{\n    ScopedTiming st(model_name_ + " run", debug_mode_);\n    kmodel_interp_.run().expect("error occurred in running model");\n}\n\nvoid AIBase::get_output()\n{\n    ScopedTiming st(model_name_ + " get_output", debug_mode_);\n    p_outputs_.clear();\n    for (int i = 0; i < kmodel_interp_.outputs_size(); i++)\n    {\n        auto out = kmodel_interp_.output_tensor(i).expect("cannot get output tensor");\n        auto buf = out.impl()->to_host().unwrap()->buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();\n        float *p_out = reinterpret_cast<float *>(buf.data());\n        p_outputs_.push_back(p_out);\n    }\n}\n//face_recognition.cc\nvoid FaceRecognition::inference()\n{\n    this->run();\n    this->get_output();\n}\n//main.cc\uff0c\u9a8c\u8bc1kmodel\u63a8\u7406\u662f\u5426\u6b63\u786e\uff1a\u6211\u4eec\u4f7f\u7528simulator\u548cmain_nncase\u5df2\u7ecf\u9a8c\u8bc1\u8fc7\n......\nFaceRecognition face_recg;\nface_recg.inference();\n......\n'})}),"\n",(0,s.jsx)(e.h6,{id:"4\u540e\u5904\u7406-1",children:"4.\u540e\u5904\u7406"}),"\n",(0,s.jsx)(e.p,{children:"\u62ff\u5230\u4eba\u8138\u8bc6\u522bkmodel\u63a8\u7406\u7ed3\u679cembeding\u540e\uff0c\u9700\u8981\u5c06\u5f53\u524dembeding\u4e0e\u6570\u636e\u5e93\u4e2dembedding\u8fdb\u884c\u5bf9\u6bd4\uff0c\u82e5\u5bf9\u6bd4\u7ed3\u679c\u5927\u4e8e\u67d0\u4e00\u9608\u503c\uff0c\u5219\u8bc6\u522b\u6210\u529f\uff0c\u8bf4\u660e\u8be5\u4eba\u8138\u5df2\u6ce8\u518c\uff1b\u5426\u5219\uff0c\u8bc6\u522b\u5931\u8d25\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:'//face_recognition.cc\nvoid FaceRecognition::l2_normalize(float *src, float *dst, int len)\n{\n    float sum = 0;\n    for (int i = 0; i < len; ++i)\n    {\n        sum += src[i] * src[i];\n    }\n    sum = sqrtf(sum);\n    for (int i = 0; i < len; ++i)\n    {\n        dst[i] = src[i] / sum;\n    }\n}\n\nfloat FaceRecognition::cal_cosine_distance(float *feature_0, float *feature_1, int feature_len)\n{\n    float cosine_distance = 0;\n    // calculate the sum square\n    for (int i = 0; i < feature_len; ++i)\n    {\n        float p0 = *(feature_0 + i);\n        float p1 = *(feature_1 + i);\n        cosine_distance += p0 * p1;\n    }\n    // cosine distance\n    return (0.5 + 0.5 * cosine_distance) * 100;\n}\n\nvoid FaceRecognition::database_search(FaceRecognitionInfo &result)\n{\n    int i;\n    int v_id = -1;\n    float v_score;\n    float v_score_max = 0.0;\n    float basef[feature_num_], testf[feature_num_];\n\n    // current frame\n    l2_normalize(p_outputs_[0], testf, feature_num_);\n\n    for (i = 0; i < valid_register_face_; i++)\n    {\n        l2_normalize(feature_database_ + i * feature_num_, basef, feature_num_);\n        v_score = cal_cosine_distance(testf, basef, feature_num_);\n        if (v_score > v_score_max)\n        {\n            v_score_max = v_score;\n            v_id = i;\n        }\n    }\n    if (v_id == -1)\n    {\n        result.id = v_id;\n        result.name = "unknown";\n        result.score = 0;\n    }\n    else\n    {\n        result.id = v_id;\n        result.name = names_[v_id];\n        result.score = v_score_max;\n    }\n}\n'})}),"\n",(0,s.jsx)(e.h6,{id:"5\u663e\u793a\u7ed3\u679c-1",children:"5.\u663e\u793a\u7ed3\u679c"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u663e\u793a\u7ed3\u679c\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/tree/main/kmodel_related/kmodel_inference/test_demo/test_vi_vo",children:"test_vi_vo demo"})]}),"\n",(0,s.jsx)(e.h6,{id:"6\u7f16\u8bd1\u6267\u884c-1",children:"6.\u7f16\u8bd1\u3001\u6267\u884c"}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u4ee3\u7801clone\u5230\u5df2\u542f\u52a8docker\u5bb9\u5668",(0,s.jsx)(e.code,{children:"src/reference/"}),"\u76ee\u5f55\uff0c\u6267\u884c",(0,s.jsx)(e.code,{children:"build_app.sh"}),"\uff0c\u5c06",(0,s.jsx)(e.code,{children:"k230_bin"}),"\u76ee\u5f55\u62f7\u8d1d\u5230k230\u5f00\u53d1\u677f\u5c0f\u6838\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"docker exec -it v1.3_0219_lj /bin/bash\ncd src/reference\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis.git\ncd K230_AI_Demo_Development_Process_Analysis/kmodel_related/kmodel_inference/\n./build_app.sh debug         #\u82e5\u662f\u65e0\u9700debug\u76ee\u5f55\uff0c\u6267\u884c./build_app.sh\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06",(0,s.jsx)(e.code,{children:"k230_bin"}),"\u76ee\u5f55\u62f7\u8d1d\u5230k230\u5f00\u53d1\u677f/sharefs/\u3002"]}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"(1) \u9884\u5904\u7406\u662f\u5426\u6b63\u786e"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u5c06debug_mode\u8bbe\u7f6e\u4e3a2\uff0c\u5373\u53ef\u4fdd\u5b58\u9884\u5904\u7406\u4e4b\u540e\u7684\u56fe\u50cf\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\n# \u5728\u5c0f\u6838\u4e0a\ncd /sharefs/\n#\u793a\u4f8b\uff1a\u5b9e\u9645\u6267\u884c\u65f6\uff0c\u5c06\u6e90\u76ee\u5f55\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u76ee\u5f55\nscp liujie@10.10.1.22:/xxx/k230_bin /sharefs/ \n\n#\u5728\u5927\u6838\u4e0a\uff08\u5148\u6309q+Enter\u9000\u53bb\u81ea\u542f\u52a8\u7a0b\u5e8f\uff09\ncd /sharefs/k230_bin/face_recognize\n./face_recognition.elf face_detect_640.kmodel 0.6 0.2 face_recognize.kmodel 100 75 None 2 db\n#\u5728\u5c0f\u6838\u4e0a\ncd  /sharefs/k230_bin/face_recognize\nscp FaceRecognition_input_affine.png username@ip:dir\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u5c06\u751f\u6210",(0,s.jsx)(e.code,{children:"FaceDetection_input_padding.png"}),"\uff0c\u62f7\u8d1d\u5230pc\u67e5\u770b\uff0c\u9884\u5904\u7406\u4ee3\u7801\u662f\u5426\u6b63\u786e\u3002\u82e5\u662f\u6709\u95ee\u9898\uff0c\u5219\u9700\u8981\u770bsensor\u539f\u56fe\u6709\u6ca1\u6709\u95ee\u9898\uff0c\u8bbe\u7f6e\u7684\u9884\u5904\u7406\u53c2\u6570\u662f\u5426\u6b63\u786e\u3002"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{alt:"FaceRecognition_input_affine.png",src:i(87830).A+"",width:"112",height:"112"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"(2) \u540e\u5904\u7406\u662f\u5426\u6b63\u786e"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:"\u4eba\u8138\u8bc6\u522b\u7684\u540e\u5904\u7406\u6bd4\u8f83\u7b80\u5355\uff0c\u6bd4\u8f83\u5f53\u524d\u4eba\u8138\u548c\u6570\u636e\u5e93\u4eba\u8138\u7684\u76f8\u4f3c\u5ea6\u5373\u53ef\uff0c\u8fd9\u91cc\u6211\u4eec\u5c31\u4e0d\u5355\u72ec\u8fdb\u884c\u9a8c\u8bc1\u3002"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"(3) \u6267\u884c"}),"\n"]}),"\n",(0,s.jsxs)(e.p,{children:["\u5728\u5927\u6838\u4e0a\u6267\u884c",(0,s.jsx)(e.code,{children:"face_recognize_isp.sh"}),"\u5373\u53ef\u6267\u884c\u57fa\u4e8e\u89c6\u9891\u6d41\u7684\u63a8\u7406\u6d41\u7a0b\u3002"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# \u5927\u5c0f\u6838\u5171\u7528/sharefs/\n#\u5927\u6838\u4e0a\ncd /sharefs/k230_bin/face_recognize\n./face_recognize_isp.sh\n#\u6309\u2018i\u2019\u952e\u5f00\u59cb\u6ce8\u518c\u5f53\u524d\u5e27\u6700\u5927\u4eba\u8138\uff0c\u8f93\u5165\u6ce8\u518c\u4eba\u8138\u540d\u79f0\uff1aeg:aaa\n#\u4e0b\u4e00\u5e27\u5f00\u59cb\u5c31\u53ef\u4ee5\u8bc6\u522b\u5df2\u6ce8\u518c\u4eba\u8138\n#\u6309\u2018Esc\u2019\u63a8\u7406\u5f53\u524d\u7a0b\u5e8f\n"})}),"\n",(0,s.jsx)(e.h2,{id:"64-\u5e38\u7528\u8c03\u8bd5\u6280\u5de7",children:"6.4 \u5e38\u7528\u8c03\u8bd5\u6280\u5de7"}),"\n",(0,s.jsx)(e.h3,{id:"641-\u6280\u5de7\u4e00target--cpu",children:"6.4.1 \u6280\u5de7\u4e00\uff1atarget = \u2018cpu\u2019"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53",(0,s.jsx)(e.code,{children:"target = 'k230'"}),"\u65f6\uff0c\u751f\u6210kmodel\uff0c\u9a8c\u8bc1\u53d1\u73b0kmodel\u63a8\u7406\u7ed3\u679c\u4e0d\u5bf9\uff0c\u600e\u4e48\u529e\uff1f"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"compile_options.target = 'k230'\n...\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 100\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\ncompiler.use_ptq(ptq_options)\n"})}),"\n",(0,s.jsxs)(e.p,{children:["\u4fee\u6539target\u8bbe\u7f6e\uff0c",(0,s.jsx)(e.code,{children:"target = 'cpu'"}),"\uff0c\u91cd\u65b0\u751f\u6210cpu_xxx.kmodel\uff0c\u6b64\u65f6\u751f\u6210\u7684kmodel\u6ca1\u6709\u91cf\u5316\uff1b\u82e5cpu_xxx.kmodel\u63a8\u7406\u6b63\u786e\uff0c\u800ck230_xxx.kmodel\u63a8\u7406\u9519\u8bef\uff0c\u8bf4\u660ekmodel\u7684\u89e3\u6790\u6ca1\u6709\u95ee\u9898\uff0c\u8ddf\u91cf\u5316\u6709\u5173\uff0c\u53ef\u4ee5\u68c0\u67e5\u6821\u6b63\u96c6\u6570\u91cf\uff08\u6570\u91cf\u5c11?\uff09\u3001\u6821\u6b63\u96c6\u5185\u5bb9\uff08",(0,s.jsx)(e.code,{children:"generate_data"}),"\u7684\u683c\u5f0f\u662f\u5426\u548c\u5b9e\u9645kmodel\u8f93\u5165\u4e00\u81f4\uff09\u3001\u4fee\u6539\u91cf\u5316\u65b9\u6cd5\u3001\u91cf\u5316\u7c7b\u578b\u6765\u4fee\u6b63\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"642-\u6280\u5de7\u4e8cint16\u91cf\u5316",children:"6.4.2 \u6280\u5de7\u4e8c\uff1aint16\u91cf\u5316"}),"\n",(0,s.jsxs)(e.p,{children:["\u5f53",(0,s.jsx)(e.code,{children:"target = 'k230'"}),"\u65f6\uff0c\u751f\u6210kmodel\uff0c\u4f7f\u7528K230Runtime\u8fdb\u884c\u63a8\u7406\u65f6\uff0c\u53d1\u73b0\u6709\u6548\u679c\uff0c\u4f46\u7cbe\u5ea6\u8fd8\u6709\u5f85\u63d0\u9ad8\uff0c\u600e\u4e48\u529e\uff1f"]}),"\n",(0,s.jsx)(e.p,{children:"\u6709\u6548\u679c\uff0c\u4f46\u7cbe\u5ea6\u8fd8\u6709\u5f85\u63d0\u9ad8\u65f6\uff0c\u8bf4\u660e\u6821\u6b63\u96c6\u5927\u6982\u7387\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff0c\u53ef\u4ee5\u4fee\u6539\u91cf\u5316\u65b9\u6cd5\u3001\u91cf\u5316\u7c7b\u578b\u6765\u4f18\u5316\u3002"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"# int16\u91cf\u5316\uff08\u91cf\u5316\u53c2\u6570\u914d\u7f6e\uff09\nimport nncase\nptq_options = nncase.PTQTensorOptions()\nptq_options.samples_count = 100                #\u91cf\u5316\u6570\u91cf\u4e00\u822c\u662f100\nptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))\n# \u56db\u79cdoption\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u7528\uff0c\u6682\u4e0d\u652f\u6301w_quant_type\u3001quant_type\u3010\u540c\u65f6\u3011int16\u91cf\u5316\n# option 1\uff1a\u4f7f\u7528'Noclip'\u7684int16\u91cf\u5316\uff0c\u6743\u91cd\uff1afloat32->int16\nptq_options.calibrate_method = 'NoClip'      #\u91cf\u5316\u65b9\u6cd5\uff0c\u53ca\u53d8\u6362\u65b9\u6cd5\uff0c\u6bd4\u8f83\u5178\u578b\u7684\u662f\u6700\u5927\u6700\u5c0f\u503c\u91cf\u5316\nptq_options.w_quant_type = 'int16'           #\u6307\u5b9a\u6743\u91cd\uff08Weights\uff09\u91cf\u5316\u7c7b\u578b\uff0c'int16'\u6216'uint8'\n \n# option 2\uff1a\u4f7f\u7528'Noclip'\u7684int16\u91cf\u5316\uff0c\u6570\u636e\uff1afloat32->int16\nptq_options.calibrate_method = 'NoClip'\nptq_options.quant_type = 'int16'               #\u6307\u5b9a\u6570\u636e\uff08data\uff09\u91cf\u5316\u7c7b\u578b\uff0c'int16'\u6216'uint8'\n \n# option 3\uff1a\u4f7f\u7528'Kld'\u7684int16\u91cf\u5316\uff0c\u6743\u91cd\uff1afloat32->int16\nptq_options.w_quant_type = 'int16'\n \n# option 4\uff1a\u4f7f\u7528'Kld'\u7684int16\u91cf\u5316\uff0c\u6570\u636e\uff1afloat32->int16\nptq_options.quant_type = 'int16'\ncompiler.use_ptq(ptq_options)\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4boption 1\u91cf\u5316\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/blob/main/kmodel_related/kmodel_export/face_detection/mobile_retinaface_data_100_640_uint16_option_1.py",children:"mobile_retinaface_data_100_640_uint16_option_1.py"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4boption 2\u91cf\u5316\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/blob/main/kmodel_related/kmodel_export/face_detection/mobile_retinaface_data_100_640_uint16_option_2.py",children:"mobile_retinaface_data_100_640_uint16_option_2.py"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4boption 3\u91cf\u5316\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/blob/main/kmodel_related/kmodel_export/face_detection/mobile_retinaface_data_100_640_uint16_option_3.py",children:"mobile_retinaface_data_100_640_uint16_option_3.py"})]}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"\u4eba\u8138\u68c0\u6d4boption 4\u91cf\u5316\u793a\u4f8b"}),"\uff1a",(0,s.jsx)(e.a,{href:"https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis/blob/main/kmodel_related/kmodel_export/face_detection/mobile_retinaface_data_100_640_uint16_option_4.py",children:"mobile_retinaface_data_100_640_uint16_option_4.py"})]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"#\u751f\u6210\u73af\u5883\uff1a6.2.2\u4e2d\u6784\u5efa\u7684\u7f16\u8bd1\u73af\u5883\ngit clone https://github.com/JayL323/K230_AI_Demo_Development_Process_Analysis.git\ncd K230_AI_Demo_Development_Process_Analysis/kmodel_related/kmodel_export\n./build_model_int16.sh\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"-rw-r--r--  1 root root 1.2M Mar  1 11:48 face_detect_int16_opt1.kmodel\n-rw-r--r--  1 root root 960K Mar  1 11:50 face_detect_int16_opt2.kmodel\n-rw-r--r--  1 root root 1.7M Mar  1 11:52 face_detect_int16_opt3.kmodel\n-rw-r--r--  1 root root 960K Mar  1 11:54 face_detect_int16_opt4.kmodel\n"})}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"./build_model_int16.sh"}),"\u540e\uff0c\u4f1a\u5728\u751f\u62104\u4e2a\u6a21\u578b\uff1b\u751f\u6210kmodel\u7684\u540c\u65f6\uff0c\u4f7f\u7528Simulator\u8fdb\u884c\u9a8c\u8bc1\uff0c\u8f93\u51fa\u9a8c\u8bc1\u7684\u76f8\u4f3c\u5ea6\uff0c\u6839\u636e\u76f8\u4f3c\u5ea6\u7684\u9ad8\u4f4e\u9009\u62e9\u6a21\u578b\u3002"]}),"\n",(0,s.jsx)(e.h3,{id:"643-\u6280\u5de7\u4e09inputbin\u751f\u6210",children:"6.4.3 \u6280\u5de7\u4e09\uff1ainput.bin\u751f\u6210"}),"\n",(0,s.jsx)(e.p,{children:"\u5f53\u751f\u6210kmodel\u65f6\uff0c\u914d\u7f6e\u9884\u5904\u7406\u53c2\u6570\u4e3aTrue\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u8ba4\u4e3a\uff1a"}),"\n",(0,s.jsx)(e.p,{children:"kmodel \u2248 \u914d\u7f6e\u7684kmodel\u9884\u5904\u7406 + onnx\uff1b"}),"\n",(0,s.jsx)(e.p,{children:"\u5bf9\u4e8e\u540c\u4e00\u5f20\u56fe\u7247\uff0ckmodel\u8f93\u5165\u9700\u8981\u7684\u9884\u5904\u7406 \u2248 onnx\u8f93\u5165\u9700\u8981\u7684\u9884\u5904\u7406 - \u914d\u7f6e\u7684kmodel\u9884\u5904\u7406 \uff1b\u5373kmodel_input.bin \u2248 onnx_input.bin - \u914d\u7f6e\u7684kmodel\u9884\u5904\u7406\u3002"})]})}function p(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},98501:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/20240228-095423-f4b4e51dea44efaf98907c850a07e686.jpg"},39256:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/FaceDetection_input_padding-182f85288cc3c277330686e805181d5f.png"},87830:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/FaceRecognition_input_affine-8118a5be0537f25c0c5bc8a1c4c0f473.png"},86101:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/canmv_board-fe160a6cf0648e8730728da9c3dfd496.png"},19529:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/canmv_connect_demo-e32666628c7317088e4516eb3d5d4a8f.png"},3688:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/face_detection_result-1721612048481-49-840ef2b05b98206ba13a6efd4c299979.jpg"},91636:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/face_detection_result-1721612140878-88-840ef2b05b98206ba13a6efd4c299979.jpg"},16674:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/face_detection_result-840ef2b05b98206ba13a6efd4c299979.jpg"},41489:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240116180710999-57d192c3d18e775d7a6405d763ad51a1.png"},62211:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240116181759199-af7b64514a4aa63460f577c0d6e9146e.png"},22982:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240116182914501-a0a655500852bf26e82bd652f1281d40.png"},73963:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240116184823495-973d390bc49a523e6e0f5fce8ef75846.png"},10933:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240116190012087-664bbd7bfb5c80ce4099444172b8c9c2.png"},79657:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240131110201060-a50ffac0d3f3b83198161bc13b1690ed.png"},52350:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240131112814667-3bcf7ffdfb6de8c3b44f66c6c11a95c3.png"},18350:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240201140752999-497e0f34e97ce76fd979df4a4b0f8881.png"},39496:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240201141045153-b7667be3f7a008ce5748e255cd211ab5.png"},22687:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240201141139709-b28f0e17c8b5aa2b838927b5a16cd6d4.png"},40479:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240201141234952-f11eceb1f1874b32422afe2941e05d9e.png"},45964:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240201143138314-8ce2133e8fd85f57634ebbeab24d159a.png"},48065:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240219144839973-65970ff5149bad25ee038e1d9870cac2.png"},83708:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240220135401913-58dc8bad06cad4f090c2fc22a3295bd9.png"},54931:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240220135401914-a0ef63a5bc0e30e3d8e56809580fb957.png"},99722:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240220135401915-a3419867ac1d24bd3438d09ca23ff3cd.png"},21469:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240220185134172-5311dddd53ffaa64fe402f926c95cf46.png"},32747:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240220191227828-0b2ae93f44b3bb75a2c4f86539c4b238.png"},63945:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240221112222263-de777f8d8fc1a6c7e449ed17afa5c4e7.png"},87206:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240221140036235-1721612171285-107-b0b2651bf7161275f33256cb4a84bf24.png"},94958:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240221140036235-b0b2651bf7161275f33256cb4a84bf24.png"},60941:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240221141307953-1721612179148-112-25e55837f9bff0dfa5a023c8d1c91f9d.png"},78401:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240221141307953-25e55837f9bff0dfa5a023c8d1c91f9d.png"},46190:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240222134841039-e84496b001d1bb47dbb20797dda5b896.png"},56844:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240223100614822-c9031675c976b9efc6c11f66a11db7a6.png"},25941:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240223100614823-5ef5a319f999e6cca78230a91065c00e.png"},48979:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240223153101754-56c24c152c5398ce6dd1dbbe947d1809.png"},97036:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226154210101-d4f15939b8f4c224c2235d1c07f29402.png"},79457:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226160055218-e0d7e67e81ebe4e38f4f90ad9e4b6664.png"},1855:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226160816525-b554acafd31afe88749be19866d3ed84.png"},7505:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226162226960-ab5af5aa5899ffcacc528c6ecb17b806.png"},71621:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226174214155-28b923a8f0141ab52e9e2dbfb0fbcdc9.png"},64959:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226175528723-ef71af28b1ac6ebf37fe67cc8587782c.png"},86694:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226185940457-76a43f26d9746cfe2aa2e0155b2662bd.png"},42849:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226185940458-324a22e05a928f140b23216151637412.png"},58232:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240226185940459-46a632740a827c596bed68ff1d6c2a6c.png"},91693:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240227110308196-86cd67f7a867f1e8f935dba1b8f49545.png"},85581:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240227130213074-3cbe94dfcec478d1793dacc2631f5f61.png"},46648:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240228110135631-55b9514864188725ce0ecfe7a8ec5217.png"},39151:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-2024030135401913-d4694b8c7dbef2953a49509abc93b0e1.png"},95944:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240304105854986-193dbd701ca93ab22d623340f173cf1d.png"},25904:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/image-20240304191018189-be16f3a88b1aa61c7aaa9250018026f4.png"},46232:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/onnx2kmodel-35ba62e24e4606c98d1c3f2deef8f265.png"},33997:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/padding_resize-59bd856168818fa7c15752ea30e1e236.png"},30007:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/pytorch2onnx-d701975b88e58de7fab601d8e6e6061d.png"},74379:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/pytorch2onnx2kmodel-76392da03de05db53787a9efdc4f383a.png"},26284:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/rufus_finish-ee9f7245b8722c20d46c1dd7a35e003d.png"},88021:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/rufus_select-d7997d7eaf258b707f384880887bda39.png"},32045:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/rufus_start-0365da8e19357ce420c4bd9ce05c93ba.png"},44806:(n,e,i)=>{i.d(e,{A:()=>s});const s="data:image/png;base64,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"},44577:(n,e,i)=>{i.d(e,{A:()=>s});const s=i.p+"assets/images/rufus_warning-02b4676d68826fbaa6733fd16c8bb305.png"},28453:(n,e,i)=>{i.d(e,{R:()=>d,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function d(n){const e=s.useContext(r);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:d(n.components),s.createElement(r.Provider,{value:e},n.children)}}}]);