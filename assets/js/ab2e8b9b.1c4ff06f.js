"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9902],{40860:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var d=r(74848),s=r(28453);const t={sidebar_position:15},i="K230 DRM\u4f7f\u7528\u6307\u5357",l={id:"CanaanK230/part7/K230DRMUserGuide",title:"K230 DRM\u4f7f\u7528\u6307\u5357",description:"1. DRM\u7b80\u4ecb",source:"@site/docs/CanaanK230/part7/15_K230DRMUserGuide.md",sourceDirName:"CanaanK230/part7",slug:"/CanaanK230/part7/K230DRMUserGuide",permalink:"/docs/CanaanK230/part7/K230DRMUserGuide",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part7/15_K230DRMUserGuide.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"canaanK230Sidebar",previous:{title:"K230\u97f3\u9891API\u53c2\u8003",permalink:"/docs/CanaanK230/part7/K230AudioAPIreference"},next:{title:"K230\u5927\u6838\u4f4e\u901f\u9a71\u52a8API\u53c2\u8003",permalink:"/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference"}},c={},a=[{value:"1. DRM\u7b80\u4ecb",id:"1-drm\u7b80\u4ecb",level:2},{value:"1.1 DRM\u67b6\u6784\u7279\u70b9",id:"11-drm\u67b6\u6784\u7279\u70b9",level:3},{value:"1.2 DRM\u67b6\u6784\u7ec4\u6210",id:"12-drm\u67b6\u6784\u7ec4\u6210",level:3},{value:"2. modetest\u4f7f\u7528\u8bf4\u660e",id:"2-modetest\u4f7f\u7528\u8bf4\u660e",level:2},{value:"2.1 \u67e5\u8be2K230 DRM\u8be6\u7ec6\u4fe1\u606f",id:"21-\u67e5\u8be2k230-drm\u8be6\u7ec6\u4fe1\u606f",level:3},{value:"2.2 video\u56fe\u5c42\u8f93\u51fasmpte\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aNV12",id:"22-video\u56fe\u5c42\u8f93\u51fasmpte\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3anv12",level:3},{value:"2.3 OSD\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aAR24\uff0c\u5373ARGB8888",id:"23-osd\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3aar24\u5373argb8888",level:3},{value:"2.4 OSD\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aRG16\uff0c\u5373RGB565",id:"24-osd\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3arg16\u5373rgb565",level:3},{value:"3. DRM API\u4ecb\u7ecd",id:"3-drm-api\u4ecb\u7ecd",level:2},{value:"3.1 \u6253\u5f00DRM\u8bbe\u5907",id:"31-\u6253\u5f00drm\u8bbe\u5907",level:3},{value:"3.2 \u68c0\u7d22DRM\u8d44\u6e90",id:"32-\u68c0\u7d22drm\u8d44\u6e90",level:3},{value:"3.3 \u4f7f\u80fd\u6216\u8005\u7981\u6b62DRM\u76f8\u5173\u7279\u6027",id:"33-\u4f7f\u80fd\u6216\u8005\u7981\u6b62drm\u76f8\u5173\u7279\u6027",level:3},{value:"3.4 \u68c0\u7d22\u56fe\u5c42\u8d44\u6e90",id:"34-\u68c0\u7d22\u56fe\u5c42\u8d44\u6e90",level:3},{value:"3.5 \u83b7\u5f97Connector",id:"35-\u83b7\u5f97connector",level:3},{value:"3.6 \u7533\u8bf7DRM DUMB\u7f13\u51b2\u533a",id:"36-\u7533\u8bf7drm-dumb\u7f13\u51b2\u533a",level:3},{value:"3.7 \u63d0\u4ea4DRM\u8bf7\u6c42",id:"37-\u63d0\u4ea4drm\u8bf7\u6c42",level:3},{value:"4. \u6ce8\u610f\u4e8b\u9879",id:"4-\u6ce8\u610f\u4e8b\u9879",level:2}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(e.header,{children:(0,d.jsx)(e.h1,{id:"k230-drm\u4f7f\u7528\u6307\u5357",children:"K230 DRM\u4f7f\u7528\u6307\u5357"})}),"\n",(0,d.jsx)(e.h2,{id:"1-drm\u7b80\u4ecb",children:"1. DRM\u7b80\u4ecb"}),"\n",(0,d.jsx)(e.p,{children:"DRM\u662flinux\u5185\u6838\u4e2d\u8d1f\u8d23\u4e0e\u663e\u5361\u4ea4\u4e92\u7684\u7ba1\u7406\u67b6\u6784\uff0c\u7528\u6237\u7a0b\u5e8f\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5229\u7528DRM\u63d0\u4f9b\u7684API\uff0c\u5b9e\u73b0\u663e\u793a\u63a7\u5236\u30013D\u6e32\u67d3\u3001\u89c6\u9891\u7f16\u89e3\u7801\u3001GPU\u8ba1\u7b97\u7b49\u5de5\u4f5c"}),"\n",(0,d.jsx)(e.h3,{id:"11-drm\u67b6\u6784\u7279\u70b9",children:"1.1 DRM\u67b6\u6784\u7279\u70b9"}),"\n",(0,d.jsx)(e.p,{children:"DRM\u662f\u5f53\u524dLinux\u5185\u6838\u4e2d\u4e3b\u6d41\u7684\u56fe\u5f62\u663e\u793a\u6846\u67b6\uff0c\u76f8\u6bd4\u4e8e\u4f20\u7edf\u7684FB\u67b6\u6784\uff0c\u5177\u6709\u5982\u4e0b\u7279\u70b9\uff1a"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsx)(e.li,{children:"DRM\u67b6\u6784\u539f\u751f\u652f\u6301\u591a\u56fe\u5c42\u5408\u6210\uff0cFB\u67b6\u6784\u539f\u751f\u4e0d\u652f\u6301\u591a\u56fe\u5c42\u5408\u6210"}),"\n",(0,d.jsx)(e.li,{children:"DRM\u67b6\u6784\u539f\u751f\u652f\u6301VSYNC\u3001DMA_BUF\u3001Fence\u673a\u5236"}),"\n",(0,d.jsx)(e.li,{children:"DRM\u67b6\u6784\u7edf\u4e00\u7ba1\u7406\u6e32\u67d3\u548c\u663e\u793a\u9a71\u52a8\uff0c\u8ba9\u8f6f\u4ef6\u5f00\u53d1\u548c\u7ef4\u62a4\u66f4\u7b80\u5355"}),"\n"]}),"\n",(0,d.jsx)(e.h3,{id:"12-drm\u67b6\u6784\u7ec4\u6210",children:"1.2 DRM\u67b6\u6784\u7ec4\u6210"}),"\n",(0,d.jsx)(e.p,{children:"\u4ece\u6574\u4f53\u67b6\u6784\u6765\u8bf4\uff0cDRM\u4e3b\u8981\u5206\u6210\u4e09\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,d.jsxs)(e.ul,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:"libdrm"}),"\n",(0,d.jsx)(e.p,{children:"libdrm\u4f1a\u5bf9\u5e95\u5c42\u63a5\u53e3\u8fdb\u884c\u5c01\u88c5\uff0c\u5411\u7528\u6237\u6001\u63d0\u4f9b\u901a\u7528\u7684API\u63a5\u53e3"}),"\n",(0,d.jsx)(e.p,{children:"libdrm\u5185\u90e8\u8fd8\u63d0\u4f9bmodetest\u7a0b\u5e8f\uff0c\u7528\u4e8e\u67e5\u8be2DRM\u8bbe\u5907\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u8fdb\u884c\u57fa\u672c\u7684\u663e\u793a\u6d4b\u8bd5"}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:"KMS"}),"\n",(0,d.jsx)(e.p,{children:"KMS\u8868\u793a\u5185\u6838\u6a21\u5f0f\u8bbe\u7f6e\uff0c\u4e3b\u8981\u8bbe\u7f6e\u663e\u793a\u5206\u8fa8\u7387\u3001\u989c\u8272\u7a7a\u95f4\u3001\u5237\u65b0\u7387\u4ee5\u53ca\u663e\u793abuffer\u5207\u6362\u548c\u591a\u56fe\u5c42\u5408\u6210"}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:"GEM"}),"\n",(0,d.jsx)(e.p,{children:"\u663e\u5b58\u7ba1\u7406\uff0c\u8d1f\u8d23\u663e\u5b58\u5206\u914d\u548c\u91ca\u653e"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(e.h2,{id:"2-modetest\u4f7f\u7528\u8bf4\u660e",children:"2. modetest\u4f7f\u7528\u8bf4\u660e"}),"\n",(0,d.jsx)(e.p,{children:"modetest\u662f\u7531libdrm\u63d0\u4f9b\u7684\u6d4b\u8bd5\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u67e5\u8be2DRM\u8bbe\u5907\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u540c\u65f6\u8fd8\u53ef\u4ee5\u8fdb\u884c\u57fa\u672c\u7684\u663e\u793a\u6d4b\u8bd5"}),"\n",(0,d.jsx)(e.h3,{id:"21-\u67e5\u8be2k230-drm\u8be6\u7ec6\u4fe1\u606f",children:"2.1 \u67e5\u8be2K230 DRM\u8be6\u7ec6\u4fe1\u606f"}),"\n",(0,d.jsx)(e.p,{children:"\u5177\u4f53\u6307\u4ee4\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sh",children:"[root@canaan ~ ]#modetest -M canaan-drm\nEncoders:\nid      crtc    type    possible crtcs  possible clones\n37      36      DSI     0x00000001      0x00000001\n\nConnectors:\nid      encoder status          name            size (mm)       modes   encoders\n38      37      connected       DSI-1           68x120          1       37\n  modes:\n        index name refresh (Hz) hdisp hss hse htot vdisp vss vse vtot\n  #0 1080x1920 30.00 1080 1310 1330 1350 1920 1925 1931 1939 78529 flags: ; type: preferred, driver\n  props:\n        1 EDID:\n                flags: immutable blob\n                blobs:\n\n                value:\n        2 DPMS:\n                flags: enum\n                enums: On=0 Standby=1 Suspend=2 Off=3\n                value: 0\n        5 link-status:\n                flags: enum\n                enums: Good=0 Bad=1\n                value: 0\n        6 non-desktop:\n                flags: immutable range\n                values: 0 1\n                value: 0\n        4 TILE:\n                flags: immutable blob\n                blobs:\n\n                value:\n\nCRTCs:\nid      fb      pos     size\n36      0       (0,0)   (1080x1920)\n  #0 1080x1920 30.00 1080 1310 1330 1350 1920 1925 1931 1939 78529 flags: ; type: preferred, driver\n  props:\n        24 VRR_ENABLED:\n                flags: range\n                values: 0 1\n                value: 0\n        28 GAMMA_LUT:\n                flags: blob\n                blobs:\n\n                value:\n        29 GAMMA_LUT_SIZE:\n                flags: immutable range\n                values: 0 4294967295\n                value: 256\n\nPlanes:\nid      crtc    fb      CRTC x,y        x,y     gamma size      possible crtcs\n31      0       0       0,0             0,0     0               0x00000001\n  formats: NV12 NV21 NV16 NV61\n  props:\n        8 type:\n                flags: immutable enum\n                enums: Overlay=0 Primary=1 Cursor=2\n                value: 0\n32      0       0       0,0             0,0     0               0x00000001\n  formats: AR24 AR12 AR15 RG24 RG16\n  props:\n        8 type:\n                flags: immutable enum\n                enums: Overlay=0 Primary=1 Cursor=2\n                value: 1\n33      0       0       0,0             0,0     0               0x00000001\n  formats: AR24 AR12 AR15 RG24 RG16\n  props:\n        8 type:\n                flags: immutable enum\n                enums: Overlay=0 Primary=1 Cursor=2\n                value: 2\n34      0       0       0,0             0,0     0               0x00000001\n  formats: AR24 AR12 AR15 RG24 RG16\n  props:\n        8 type:\n                flags: immutable enum\n                enums: Overlay=0 Primary=1 Cursor=2\n                value: 0\n35      0       0       0,0             0,0     0               0x00000001\n  formats: AR24 AR12 AR15 RG24 RG16\n  props:\n        8 type:\n                flags: immutable enum\n                enums: Overlay=0 Primary=1 Cursor=2\n                value: 0\n\nFrame buffers:\nid      size    pitch\n\n[root@canaan ~ ]#\n\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4e0a\u8ff0\u4fe1\u606f\u5373K230 DRM\u8be6\u7ec6\u4fe1\u606f\uff0c\u4ee5\u4e0b\u662f\u7b80\u8981\u8bf4\u660e:"}),"\n",(0,d.jsxs)(e.table,{children:[(0,d.jsx)(e.thead,{children:(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.th,{children:"\u6a21\u5757ID"}),(0,d.jsx)(e.th,{children:"\u6a21\u5757\u540d\u79f0"}),(0,d.jsx)(e.th,{children:"\u6a21\u5757\u8bf4\u660e"})]})}),(0,d.jsxs)(e.tbody,{children:[(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"37"}),(0,d.jsx)(e.td,{children:"Encoder"}),(0,d.jsx)(e.td,{children:"\u65e0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"38"}),(0,d.jsx)(e.td,{children:"Connector"}),(0,d.jsx)(e.td,{children:"\u65e0"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"36"}),(0,d.jsx)(e.td,{children:"CRTC"}),(0,d.jsx)(e.td,{children:"\u5206\u8fa8\u7387\u652f\u6301\uff1a1080x1920"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"31"}),(0,d.jsx)(e.td,{children:"video\u56fe\u5c42"}),(0,d.jsx)(e.td,{children:"\u989c\u8272\u7a7a\u95f4\u652f\u6301\uff1aNV12\u3001NV21\u3001NV16\u3001NV61"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"32"}),(0,d.jsx)(e.td,{children:"OSD\u56fe\u5c42"}),(0,d.jsx)(e.td,{children:"\u989c\u8272\u7a7a\u95f4\u652f\u6301\uff1aAR24\u3001AR12\u3001AR15\u3001RG24\u3001RG16"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"33"}),(0,d.jsx)(e.td,{children:"OSD\u56fe\u5c42"}),(0,d.jsx)(e.td,{children:"\u989c\u8272\u7a7a\u95f4\u652f\u6301\uff1aAR24\u3001AR12\u3001AR15\u3001RG24\u3001RG16"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"34"}),(0,d.jsx)(e.td,{children:"OSD\u56fe\u5c42"}),(0,d.jsx)(e.td,{children:"\u989c\u8272\u7a7a\u95f4\u652f\u6301\uff1aAR24\u3001AR12\u3001AR15\u3001RG24\u3001RG16"})]}),(0,d.jsxs)(e.tr,{children:[(0,d.jsx)(e.td,{children:"35"}),(0,d.jsx)(e.td,{children:"OSD\u56fe\u5c42"}),(0,d.jsx)(e.td,{children:"\u989c\u8272\u7a7a\u95f4\u652f\u6301\uff1aAR24\u3001AR12\u3001AR15\u3001RG24\u3001RG16"})]})]})]}),"\n",(0,d.jsx)(e.p,{children:"AR24\u8868\u793aARGB8888"}),"\n",(0,d.jsx)(e.p,{children:"AR12\u8868\u793aARGB4444"}),"\n",(0,d.jsx)(e.p,{children:"AR15\u8868\u793aARGB1555"}),"\n",(0,d.jsx)(e.p,{children:"RG24\u8868\u793aRGB888"}),"\n",(0,d.jsx)(e.p,{children:"RG16\u8868\u793aRGB565"}),"\n",(0,d.jsx)(e.h3,{id:"22-video\u56fe\u5c42\u8f93\u51fasmpte\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3anv12",children:"2.2 video\u56fe\u5c42\u8f93\u51fasmpte\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aNV12"}),"\n",(0,d.jsx)(e.p,{children:"\u5177\u4f53\u6307\u4ee4\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sh",children:"modetest -M canaan-drm -D 0 -a -s 38@36:1080x1920-30 -P 31@36:1080x1920@NV12 -v -F smpte\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4e0b\u56fe\u6240\u793a\u4e3aLCD\u663e\u793a\u5185\u5bb9\uff1a"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{alt:"\u663e\u793a\u5185\u5bb9",src:r(88601).A+"",width:"704",height:"395"})}),"\n",(0,d.jsx)(e.h3,{id:"23-osd\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3aar24\u5373argb8888",children:"2.3 OSD\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aAR24\uff0c\u5373ARGB8888"}),"\n",(0,d.jsx)(e.p,{children:"\u5177\u4f53\u6307\u4ee4\u5982\u4e0b"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sh",children:"modetest -M canaan-drm -D 0 -a -s 38@36:1080x1920-30 -P 32@36:1080x1920@AR24 -v -F tiles\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4e0b\u56fe\u6240\u793a\u4e3aLCD\u663e\u793a\u5185\u5bb9\uff1a"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{alt:"\u663e\u793a\u5185\u5bb9",src:r(99864).A+"",width:"777",height:"440"})}),"\n",(0,d.jsx)(e.h3,{id:"24-osd\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\u989c\u8272\u7a7a\u95f4\u4e3arg16\u5373rgb565",children:"2.4 OSD\u56fe\u5c42\u8f93\u51fatiles\u5f69\u6761\uff0c\u989c\u8272\u7a7a\u95f4\u4e3aRG16\uff0c\u5373RGB565"}),"\n",(0,d.jsx)(e.p,{children:"\u5177\u4f53\u6307\u4ee4\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-sh",children:"modetest -M canaan-drm -D 0 -a -s 38@36:1080x1920-30 -P 32@36:1080x1920@RG16 -v -F tiles\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4e0b\u56fe\u6240\u793a\u4e3aLCD\u663e\u793a\u5185\u5bb9\uff1a"}),"\n",(0,d.jsx)(e.p,{children:(0,d.jsx)(e.img,{alt:"\u663e\u793a\u5185\u5bb9",src:r(23995).A+"",width:"746",height:"434"})}),"\n",(0,d.jsx)(e.h2,{id:"3-drm-api\u4ecb\u7ecd",children:"3. DRM API\u4ecb\u7ecd"}),"\n",(0,d.jsx)(e.h3,{id:"31-\u6253\u5f00drm\u8bbe\u5907",children:"3.1 \u6253\u5f00DRM\u8bbe\u5907"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    fd = open("/dev/dri/card0", O_RDWR | O_CLOEXEC);\n    if (fd < 0) {\n        fprintf(stderr, "open card0 error \\n");\n        return -1;\n    }\n\n'})}),"\n",(0,d.jsx)(e.h3,{id:"32-\u68c0\u7d22drm\u8d44\u6e90",children:"3.2 \u68c0\u7d22DRM\u8d44\u6e90"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:"drmModeResPtr drmModeGetResources(int fd);\n\ntypedef struct _drmModeRes {\n\n        int count_fbs;\n        uint32_t *fbs;\n\n        int count_crtcs;\n        uint32_t *crtcs;\n\n        int count_connectors;\n        uint32_t *connectors;\n\n        int count_encoders;\n        uint32_t *encoders;\n\n        uint32_t min_width, max_width;\n        uint32_t min_height, max_height;\n} drmModeRes, *drmModeResPtr;\n\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    res = drmModeGetResources(fd);\n    if (res == NULL) {\n        fprintf(stderr, "drmModeGetResources error \\n");\n        return -1;\n    }\n    conn_id = res->connectors[0];\n    crtc_id = res->crtcs[0];\n\n'})}),"\n",(0,d.jsx)(e.h3,{id:"33-\u4f7f\u80fd\u6216\u8005\u7981\u6b62drm\u76f8\u5173\u7279\u6027",children:"3.3 \u4f7f\u80fd\u6216\u8005\u7981\u6b62DRM\u76f8\u5173\u7279\u6027"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:"int drmSetClientCap(int fd, uint64_t capability, uint64_t value);\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    ret = drmSetClientCap(fd, DRM_CLIENT_CAP_UNIVERSAL_PLANES, 1);\n    if (ret) {\n        fprintf(stderr, "drmSetClientCap DRM_CLIENT_CAP_UNIVERSAL_PLANES error \\n");\n        return -1;\n    }\n\n    ret = drmSetClientCap(fd, DRM_CLIENT_CAP_ATOMIC, 1);\n    if (ret) {\n        fprintf(stderr, "drmSetClientCap DRM_CLIENT_CAP_ATOMIC error \\n");\n        return -1;\n    }\n'})}),"\n",(0,d.jsx)(e.h3,{id:"34-\u68c0\u7d22\u56fe\u5c42\u8d44\u6e90",children:"3.4 \u68c0\u7d22\u56fe\u5c42\u8d44\u6e90"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:"drmModePlaneResPtr drmModeGetPlaneResources(int fd);\n\ntypedef struct _drmModePlaneRes {\n        uint32_t count_planes;\n        uint32_t *planes;\n} drmModePlaneRes, *drmModePlaneResPtr;\n\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    plane_res = drmModeGetPlaneResources(fd);\n    if (plane_res == NULL) {\n        fprintf(stderr, "drmModeGetPlaneResources error \\n");\n        return -1;\n    }\n    plane_id = plane_res->planes[1];\n\n'})}),"\n",(0,d.jsx)(e.p,{children:"K230 DRM\u4e2d\uff0c\u56fe\u5c42\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,d.jsx)(e.p,{children:"plane_res->planes[0] \u8868\u793aVideo\u5c42"}),"\n",(0,d.jsx)(e.p,{children:"plane_res->planes[1] ~ plane_res->planes[4] \u8868\u793aOSD\u5c42"}),"\n",(0,d.jsx)(e.h3,{id:"35-\u83b7\u5f97connector",children:"3.5 \u83b7\u5f97Connector"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:"drmModeConnectorPtr drmModeGetConnector(int fd, uint32_t connector_id);\n\ntypedef struct _drmModeConnector {\n        uint32_t connector_id;\n        uint32_t encoder_id; /**< Encoder currently connected to */\n        uint32_t connector_type;\n        uint32_t connector_type_id;\n        drmModeConnection connection;\n        uint32_t mmWidth, mmHeight; /**< HxW in millimeters */\n        drmModeSubPixel subpixel;\n\n        int count_modes;\n        drmModeModeInfoPtr modes;\n\n        int count_props;\n        uint32_t *props; /**< List of property ids */\n        uint64_t *prop_values; /**< List of property values */\n\n        int count_encoders;\n        uint32_t *encoders; /**< List of encoder ids */\n} drmModeConnector, *drmModeConnectorPtr;\n\n"})}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    conn = drmModeGetConnector(fd, conn_id);\n    if (conn == NULL) {\n        fprintf(stderr, "drmModeGetConnector error \\n");\n        return -1;\n    }\n\n'})}),"\n",(0,d.jsx)(e.h3,{id:"36-\u7533\u8bf7drm-dumb\u7f13\u51b2\u533a",children:"3.6 \u7533\u8bf7DRM DUMB\u7f13\u51b2\u533a"}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:'    creq.width = 1080;\n    creq.height = 1920;\n    creq.bpp = 32;\n    creq.fourcc = DRM_FORMAT_ARGB8888;\n    ret = drmIoctl(fd, DRM_IOCTL_MODE_CREATE_DUMB, &creq);\n    if (ret < 0) {\n        fprintf(stderr, "cannot create dumb buffer (%d): %m\\n",\n            errno);\n        return -errno;\n    }\n\n'})}),"\n",(0,d.jsx)(e.h3,{id:"37-\u63d0\u4ea4drm\u8bf7\u6c42",children:"3.7 \u63d0\u4ea4DRM\u8bf7\u6c42"}),"\n",(0,d.jsx)(e.p,{children:"\u4ee3\u7801\u8c03\u7528\u5b9e\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,d.jsx)(e.pre,{children:(0,d.jsx)(e.code,{className:"language-c",children:"int drmModeAtomicCommit(int fd,\n                   drmModeAtomicReqPtr req,\n                   uint32_t flags,\n                   void *user_data);\n\n"})}),"\n",(0,d.jsx)(e.h2,{id:"4-\u6ce8\u610f\u4e8b\u9879",children:"4. \u6ce8\u610f\u4e8b\u9879"}),"\n",(0,d.jsxs)(e.ol,{children:["\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:"K230 DRM\u5f00\u53d1\u6d4b\u8bd5\u4f9d\u8d56LCD\u5c4f\u5e55"}),"\n"]}),"\n",(0,d.jsxs)(e.li,{children:["\n",(0,d.jsx)(e.p,{children:"K230 DRM\u5185\u90e8\u5404\u4e2a\u6a21\u5757ID\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684\uff0c\u8bf7\u6839\u636e\u5404\u6a21\u5757\u5b9e\u9645ID\u8fdb\u884c\u5f00\u53d1\u548c\u6d4b\u8bd5"}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,d.jsx)(e,{...n,children:(0,d.jsx)(o,{...n})}):o(n)}},99864:(n,e,r)=>{r.d(e,{A:()=>d});const d=r.p+"assets/images/modetest_osd_ar24_tiles-9dbad73f07d67d5beb18c75670804f94.png"},23995:(n,e,r)=>{r.d(e,{A:()=>d});const d=r.p+"assets/images/modetest_osd_rg16_tiles-fee529114973753d4527fe05d493e0d5.png"},88601:(n,e,r)=>{r.d(e,{A:()=>d});const d=r.p+"assets/images/modetest_video_nv12_smpte-1dcde30a5dbabf568885b14c4662644f.png"},28453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>l});var d=r(96540);const s={},t=d.createContext(s);function i(n){const e=d.useContext(t);return d.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:i(n.components),d.createElement(t.Provider,{value:e},n.children)}}}]);