<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CanaanK230/part6/K230nncaseDeveloperGuide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">K230 nncase开发指南 | 正点原子</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tm330075395.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tm330075395.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tm330075395.github.io/docs/CanaanK230/part6/K230nncaseDeveloperGuide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="K230 nncase开发指南 | 正点原子"><meta data-rh="true" name="description" content="1. 概述"><meta data-rh="true" property="og:description" content="1. 概述"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tm330075395.github.io/docs/CanaanK230/part6/K230nncaseDeveloperGuide"><link data-rh="true" rel="alternate" href="https://tm330075395.github.io/docs/CanaanK230/part6/K230nncaseDeveloperGuide" hreflang="en"><link data-rh="true" rel="alternate" href="https://tm330075395.github.io/docs/CanaanK230/part6/K230nncaseDeveloperGuide" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="正点原子 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="正点原子 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.ce37c9a8.css">
<script src="/assets/js/runtime~main.fcaa3de9.js" defer="defer"></script>
<script src="/assets/js/main.252b8acf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/CanaanK230/Userdoc">CanMV-K230教程</a><a href="http://www.alientek.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">正点原子官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="http://www.openedv.com/forum.php" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">论坛<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tm330075395/tm330075395.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CanaanK230/Userdoc">文档阅读指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/1开发板上手指南-1">1.开发板上手指南</a><button aria-label="Expand sidebar category &#x27;1.开发板上手指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/2开发环境搭建指南-1">2.开发环境搭建指南</a><button aria-label="Expand sidebar category &#x27;2.开发环境搭建指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/3嵌入式应用开发指南-1">3.嵌入式应用开发指南</a><button aria-label="Expand sidebar category &#x27;3.嵌入式应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/4ai应用开发指南-1">4.AI应用开发指南</a><button aria-label="Expand sidebar category &#x27;4.AI应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/5micropython应用开发指南-1">5.MicroPython应用开发指南</a><button aria-label="Expand sidebar category &#x27;5.MicroPython应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/6系统开发指南-1">6.系统开发指南</a><button aria-label="Collapse sidebar category &#x27;6.系统开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230RVVoptimizationperformance">K230 RVV优化性能说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230MemoryOptimizationGuide">K230 内存优化指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230MemoryAnalysisGuide">K230 内存分析指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230LaunchtheOptimizationGuide">K230 启动优化指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230IntroductiontotheuseofSharefsintheBigandSmallCoreCommunication">K230大小核通讯Sharefs使用简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230OpenBLASDeveloperGuide">K230 OpenBLAS开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230OpenCVDeveloperGuide">K230 OpenCV开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230CameraSensorAdaptationGuide">K230 Camera Sensor适配指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230PowerManagementAdaptationGuide">K230_功耗管理适配指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230VICAPSENSORParameterpartitionreference">K230 VICAP SENSOR 参数分区参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230LCDAdaptationGuide">K230 LCD适配指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230PMUUserGuide">K230 PMU使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230SDKIoTWiFiAiW4211LV10Directionsforuse">K230 SDK IoT WiFi AiW4211LV10使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230SDKIoTWiFiAiW4211LV10DriverDevelopmentGuide">K230 SDK IoT WiFi AiW4211LV10驱动开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CanaanK230/part6/K230nncaseDeveloperGuide">K230 nncase开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230SteckupdatedtheEncasRuntimeLibraryGuide">K230 SDK 更新nncase运行时库指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230debianubuntuillustrate">K230 debian ubuntu 说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230SDKBurntoolDirectionsforuse">K230 SDK Burntool使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230SDKDewarpDirectionsforuse">K230 SDK Dewarp 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230ISPImageTuningGuide">K230 ISP图像调优指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230ISPInitializationConfigurationGuide">K230 ISP初始化配置指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part6/K230ISPTuningToolDirectionsforuse">K230 ISP Tuning Tool使用指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/7sdk-api参考指南-1">7.SDK API参考指南</a><button aria-label="Expand sidebar category &#x27;7.SDK API参考指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/8常见问题-1">8.常见问题</a><button aria-label="Expand sidebar category &#x27;8.常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/6系统开发指南-1"><span itemprop="name">6.系统开发指南</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">K230 nncase开发指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>K230 nncase开发指南</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-概述">1. 概述<a href="#1-概述" class="hash-link" aria-label="Direct link to 1. 概述" title="Direct link to 1. 概述">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-什么是nncase">1.1 什么是nncase<a href="#11-什么是nncase" class="hash-link" aria-label="Direct link to 1.1 什么是nncase" title="Direct link to 1.1 什么是nncase">​</a></h3>
<p>nncase是一个为 AI 加速器设计的神经网络编译器, 目前支持的 target有cpu/K210/K510/K230等.</p>
<p>nncase提供的功能</p>
<ul>
<li>支持多输入多输出网络，支持多分支结构</li>
<li>静态内存分配，不需要堆内存</li>
<li>算子合并和优化</li>
<li>支持 float 和uint8/int8量化推理</li>
<li>支持训练后量化，使用浮点模型和量化校准集</li>
<li>平坦模型，支持零拷贝加载</li>
</ul>
<p>nncase支持的神经网络模型格式</p>
<ul>
<li>tflite</li>
<li>onnx</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-nncase架构">1.2 nncase架构<a href="#12-nncase架构" class="hash-link" aria-label="Direct link to 1.2 nncase架构" title="Direct link to 1.2 nncase架构">​</a></h3>
<p><img decoding="async" loading="lazy" alt="nncase架构" src="/assets/images/185762ac17039d6c4961faa2fba0d66e-70391ad602c2659081de0c06ff3ae6d1.png" width="1281" height="1509" class="img_ev3q"></p>
<p>nncase软件栈包括compiler和runtime两部分。</p>
<p>Compiler: 用于在PC上编译神经网络模型，最终生成kmodel文件。主要包括importer, IR, Evaluator, Quantize, Transform优化, Tiling, Partition, Schedule, Codegen等模块。</p>
<ul>
<li>Importer: 将其它神经网络框架的模型导入到nncase中</li>
<li>IR: 中间表示, 分为importer导入的Neutral IR(设备无关)和Neutral IR经lowering转换生成的Target IR(设备相关)</li>
<li>Evaluator: Evaluator提供IR的解释执行能力，常被用于Constant Folding/PTQ Calibration等场景</li>
<li>Transform: 用于IR转换和图的遍历优化等</li>
<li>Quantize: 训练后量化, 对要量化的tensor加入量化标记, 根据输入的校正集, 调用 Evaluator进行解释执行, 收集tensor的数据范围, 插入量化/反量化结点, 最后优化消除不必要的量化/反量化结点等</li>
<li>Tiling: 受限于NPU较低的存储器容量，需要将大块计算进行拆分. 另外, 计算存在大量数据复用时选择Tiling参数会对时延和带宽产生影响</li>
<li>Partition: 将图按ModuleType进行切分, 切分后的每个子图会对应RuntimeModule, 不同类型的RuntimeModule对应不同的Device(cpu/K230)</li>
<li>Schedule: 根据优化后图中的数据依赖关系生成计算顺序并分配Buffer</li>
<li>Codegen: 对每个子图分别调用ModuleType对应的codegen，生成RuntimeModule</li>
</ul>
<p>Runtime: 集成于用户App， 提供加载kmodel/设置输入数据/KPU执行/获取输出数据等功能.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-开发环境">1.3 开发环境<a href="#13-开发环境" class="hash-link" aria-label="Direct link to 1.3 开发环境" title="Direct link to 1.3 开发环境">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="131-操作系统">1.3.1 操作系统<a href="#131-操作系统" class="hash-link" aria-label="Direct link to 1.3.1 操作系统" title="Direct link to 1.3.1 操作系统">​</a></h4>
<p>支持的操作系统包括Ubuntu 18.04/Ubuntu 20.04</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="132-软件环境">1.3.2 软件环境<a href="#132-软件环境" class="hash-link" aria-label="Direct link to 1.3.2 软件环境" title="Direct link to 1.3.2 软件环境">​</a></h4>
<table><thead><tr><th>序号</th><th>软件</th><th>版本号</th></tr></thead><tbody><tr><td>1</td><td>python</td><td>3.6/3.7/3.8/3.9/3.10</td></tr><tr><td>2</td><td>pip</td><td>&gt;=20.3</td></tr><tr><td>3</td><td>numpy</td><td>1.19.5</td></tr><tr><td>4</td><td>onnx</td><td>1.9.0</td></tr><tr><td>5</td><td>onnx-simplifier</td><td>0.3.6</td></tr><tr><td>6</td><td>Onnxoptimizer</td><td>0.2.6</td></tr><tr><td>7</td><td>Onnxruntime</td><td>1.8.0</td></tr><tr><td>8</td><td>dotnet-runtime</td><td>7.0</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="133-硬件环境">1.3.3 硬件环境<a href="#133-硬件环境" class="hash-link" aria-label="Direct link to 1.3.3 硬件环境" title="Direct link to 1.3.3 硬件环境">​</a></h4>
<p>K230 evb</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-编译模型apispython">2. 编译模型APIs(Python)<a href="#2-编译模型apispython" class="hash-link" aria-label="Direct link to 2. 编译模型APIs(Python)" title="Direct link to 2. 编译 模型APIs(Python)">​</a></h2>
<p>nncase提供了Python APIs, 用于在PC上编译神经网络模型</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-支持的算子">2.1 支持的算子<a href="#21-支持的算子" class="hash-link" aria-label="Direct link to 2.1 支持的算子" title="Direct link to 2.1 支持的算子">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-tflite算子">2.1.1 tflite算子<a href="#211-tflite算子" class="hash-link" aria-label="Direct link to 2.1.1 tflite算子" title="Direct link to 2.1.1 tflite算子">​</a></h4>
<table><thead><tr><th>Operator</th><th>Is Supported</th></tr></thead><tbody><tr><td>ABS</td><td>Yes</td></tr><tr><td>ADD</td><td>Yes</td></tr><tr><td>ARG_MAX</td><td>Yes</td></tr><tr><td>ARG_MIN</td><td>Yes</td></tr><tr><td>AVERAGE_POOL_2D</td><td>Yes</td></tr><tr><td>BATCH_MATMUL</td><td>Yes</td></tr><tr><td>CAST</td><td>Yes</td></tr><tr><td>CEIL</td><td>Yes</td></tr><tr><td>CONCATENATION</td><td>Yes</td></tr><tr><td>CONV_2D</td><td>Yes</td></tr><tr><td>COS</td><td>Yes</td></tr><tr><td>CUSTOM</td><td>Yes</td></tr><tr><td>DEPTHWISE_CONV_2D</td><td>Yes</td></tr><tr><td>DIV</td><td>Yes</td></tr><tr><td>EQUAL</td><td>Yes</td></tr><tr><td>EXP</td><td>Yes</td></tr><tr><td>EXPAND_DIMS</td><td>Yes</td></tr><tr><td>FLOOR</td><td>Yes</td></tr><tr><td>FLOOR_DIV</td><td>Yes</td></tr><tr><td>FLOOR_MOD</td><td>Yes</td></tr><tr><td>FULLY_CONNECTED</td><td>Yes</td></tr><tr><td>GREATER</td><td>Yes</td></tr><tr><td>GREATER_EQUAL</td><td>Yes</td></tr><tr><td>L2_NORMALIZATION</td><td>Yes</td></tr><tr><td>LEAKY_RELU</td><td>Yes</td></tr><tr><td>LESS</td><td>Yes</td></tr><tr><td>LESS_EQUAL</td><td>Yes</td></tr><tr><td>LOG</td><td>Yes</td></tr><tr><td>LOGISTIC</td><td>Yes</td></tr><tr><td>MAX_POOL_2D</td><td>Yes</td></tr><tr><td>MAXIMUM</td><td>Yes</td></tr><tr><td>MEAN</td><td>Yes</td></tr><tr><td>MINIMUM</td><td>Yes</td></tr><tr><td>MUL</td><td>Yes</td></tr><tr><td>NEG</td><td>Yes</td></tr><tr><td>NOT_EQUAL</td><td>Yes</td></tr><tr><td>PAD</td><td>Yes</td></tr><tr><td>PADV2</td><td>Yes</td></tr><tr><td>MIRROR_PAD</td><td>Yes</td></tr><tr><td>PACK</td><td>Yes</td></tr><tr><td>POW</td><td>Yes</td></tr><tr><td>REDUCE_MAX</td><td>Yes</td></tr><tr><td>REDUCE_MIN</td><td>Yes</td></tr><tr><td>REDUCE_PROD</td><td>Yes</td></tr><tr><td>RELU</td><td>Yes</td></tr><tr><td>PRELU</td><td>Yes</td></tr><tr><td>RELU6</td><td>Yes</td></tr><tr><td>RESHAPE</td><td>Yes</td></tr><tr><td>RESIZE_BILINEAR</td><td>Yes</td></tr><tr><td>RESIZE_NEAREST_NEIGHBOR</td><td>Yes</td></tr><tr><td>ROUND</td><td>Yes</td></tr><tr><td>RSQRT</td><td>Yes</td></tr><tr><td>SHAPE</td><td>Yes</td></tr><tr><td>SIN</td><td>Yes</td></tr><tr><td>SLICE</td><td>Yes</td></tr><tr><td>SOFTMAX</td><td>Yes</td></tr><tr><td>SPACE_TO_BATCH_ND</td><td>Yes</td></tr><tr><td>SQUEEZE</td><td>Yes</td></tr><tr><td>BATCH_TO_SPACE_ND</td><td>Yes</td></tr><tr><td>STRIDED_SLICE</td><td>Yes</td></tr><tr><td>SQRT</td><td>Yes</td></tr><tr><td>SQUARE</td><td>Yes</td></tr><tr><td>SUB</td><td>Yes</td></tr><tr><td>SUM</td><td>Yes</td></tr><tr><td>TANH</td><td>Yes</td></tr><tr><td>TILE</td><td>Yes</td></tr><tr><td>TRANSPOSE</td><td>Yes</td></tr><tr><td>TRANSPOSE_CONV</td><td>Yes</td></tr><tr><td>QUANTIZE</td><td>Yes</td></tr><tr><td>FAKE_QUANT</td><td>Yes</td></tr><tr><td>DEQUANTIZE</td><td>Yes</td></tr><tr><td>GATHER</td><td>Yes</td></tr><tr><td>GATHER_ND</td><td>Yes</td></tr><tr><td>ONE_HOT</td><td>Yes</td></tr><tr><td>SQUARED_DIFFERENCE</td><td>Yes</td></tr><tr><td>LOG_SOFTMAX</td><td>Yes</td></tr><tr><td>SPLIT</td><td>Yes</td></tr><tr><td>HARD_SWISH</td><td>Yes</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-onnx算子">2.1.2 onnx算子<a href="#212-onnx算子" class="hash-link" aria-label="Direct link to 2.1.2 onnx算子" title="Direct link to 2.1.2 onnx算子">​</a></h4>
<table><thead><tr><th>Operator</th><th>Is Supported</th></tr></thead><tbody><tr><td>Abs</td><td>Yes</td></tr><tr><td>Acos</td><td>Yes</td></tr><tr><td>Acosh</td><td>Yes</td></tr><tr><td>And</td><td>Yes</td></tr><tr><td>ArgMax</td><td>Yes</td></tr><tr><td>ArgMin</td><td>Yes</td></tr><tr><td>Asin</td><td>Yes</td></tr><tr><td>Asinh</td><td>Yes</td></tr><tr><td>Add</td><td>Yes</td></tr><tr><td>AveragePool</td><td>Yes</td></tr><tr><td>BatchNormalization</td><td>Yes</td></tr><tr><td>Cast</td><td>Yes</td></tr><tr><td>Ceil</td><td>Yes</td></tr><tr><td>Celu</td><td>Yes</td></tr><tr><td>Clip</td><td>Yes</td></tr><tr><td>Compress</td><td>Yes</td></tr><tr><td>Concat</td><td>Yes</td></tr><tr><td>Constant</td><td>Yes</td></tr><tr><td>ConstantOfShape</td><td>Yes</td></tr><tr><td>Conv</td><td>Yes</td></tr><tr><td>ConvTranspose</td><td>Yes</td></tr><tr><td>Cos</td><td>Yes</td></tr><tr><td>Cosh</td><td>Yes</td></tr><tr><td>CumSum</td><td>Yes</td></tr><tr><td>DepthToSpace</td><td>Yes</td></tr><tr><td>DequantizeLinear</td><td>Yes</td></tr><tr><td>Div</td><td>Yes</td></tr><tr><td>Dropout</td><td>Yes</td></tr><tr><td>Elu</td><td>Yes</td></tr><tr><td>Exp</td><td>Yes</td></tr><tr><td>Expand</td><td>Yes</td></tr><tr><td>Equal</td><td>Yes</td></tr><tr><td>Erf</td><td>Yes</td></tr><tr><td>Flatten</td><td>Yes</td></tr><tr><td>Floor</td><td>Yes</td></tr><tr><td>Gather</td><td>Yes</td></tr><tr><td>GatherElements</td><td>Yes</td></tr><tr><td>GatherND</td><td>Yes</td></tr><tr><td>Gemm</td><td>Yes</td></tr><tr><td>GlobalAveragePool</td><td>Yes</td></tr><tr><td>GlobalMaxPool</td><td>Yes</td></tr><tr><td>Greater</td><td>Yes</td></tr><tr><td>GreaterOrEqual</td><td>Yes</td></tr><tr><td>GRU</td><td>Yes</td></tr><tr><td>Hardmax</td><td>Yes</td></tr><tr><td>HardSigmoid</td><td>Yes</td></tr><tr><td>HardSwish</td><td>Yes</td></tr><tr><td>Identity</td><td>Yes</td></tr><tr><td>InstanceNormalization</td><td>Yes</td></tr><tr><td>LayerNormalization</td><td>Yes</td></tr><tr><td>LpNormalization</td><td>Yes</td></tr><tr><td>LeakyRelu</td><td>Yes</td></tr><tr><td>Less</td><td>Yes</td></tr><tr><td>LessOrEqual</td><td>Yes</td></tr><tr><td>Log</td><td>Yes</td></tr><tr><td>LogSoftmax</td><td>Yes</td></tr><tr><td>LRN</td><td>Yes</td></tr><tr><td>LSTM</td><td>Yes</td></tr><tr><td>MatMul</td><td>Yes</td></tr><tr><td>MaxPool</td><td>Yes</td></tr><tr><td>Max</td><td>Yes</td></tr><tr><td>Min</td><td>Yes</td></tr><tr><td>Mul</td><td>Yes</td></tr><tr><td>Neg</td><td>Yes</td></tr><tr><td>Not</td><td>Yes</td></tr><tr><td>OneHot</td><td>Yes</td></tr><tr><td>Pad</td><td>Yes</td></tr><tr><td>Pow</td><td>Yes</td></tr><tr><td>PRelu</td><td>Yes</td></tr><tr><td>QuantizeLinear</td><td>Yes</td></tr><tr><td>RandomNormal</td><td>Yes</td></tr><tr><td>RandomNormalLike</td><td>Yes</td></tr><tr><td>RandomUniform</td><td>Yes</td></tr><tr><td>RandomUniformLike</td><td>Yes</td></tr><tr><td>ReduceL1</td><td>Yes</td></tr><tr><td>ReduceL2</td><td>Yes</td></tr><tr><td>ReduceLogSum</td><td>Yes</td></tr><tr><td>ReduceLogSumExp</td><td>Yes</td></tr><tr><td>ReduceMax</td><td>Yes</td></tr><tr><td>ReduceMean</td><td>Yes</td></tr><tr><td>ReduceMin</td><td>Yes</td></tr><tr><td>ReduceProd</td><td>Yes</td></tr><tr><td>ReduceSum</td><td>Yes</td></tr><tr><td>ReduceSumSquare</td><td>Yes</td></tr><tr><td>Relu</td><td>Yes</td></tr><tr><td>Reshape</td><td>Yes</td></tr><tr><td>Resize</td><td>Yes</td></tr><tr><td>ReverseSequence</td><td>Yes</td></tr><tr><td>RoiAlign</td><td>Yes</td></tr><tr><td>Round</td><td>Yes</td></tr><tr><td>Rsqrt</td><td>Yes</td></tr><tr><td>Selu</td><td>Yes</td></tr><tr><td>Shape</td><td>Yes</td></tr><tr><td>Sign</td><td>Yes</td></tr><tr><td>Sin</td><td>Yes</td></tr><tr><td>Sinh</td><td>Yes</td></tr><tr><td>Sigmoid</td><td>Yes</td></tr><tr><td>Size</td><td>Yes</td></tr><tr><td>Slice</td><td>Yes</td></tr><tr><td>Softmax</td><td>Yes</td></tr><tr><td>Softplus</td><td>Yes</td></tr><tr><td>Softsign</td><td>Yes</td></tr><tr><td>SpaceToDepth</td><td>Yes</td></tr><tr><td>Split</td><td>Yes</td></tr><tr><td>Sqrt</td><td>Yes</td></tr><tr><td>Squeeze</td><td>Yes</td></tr><tr><td>Sub</td><td>Yes</td></tr><tr><td>Sum</td><td>Yes</td></tr><tr><td>Tanh</td><td>Yes</td></tr><tr><td>Tile</td><td>Yes</td></tr><tr><td>TopK</td><td>Yes</td></tr><tr><td>Transpose</td><td>Yes</td></tr><tr><td>Trilu</td><td>Yes</td></tr><tr><td>ThresholdedRelu</td><td>Yes</td></tr><tr><td>Upsample</td><td>Yes</td></tr><tr><td>Unsqueeze</td><td>Yes</td></tr><tr><td>Where</td><td>Yes</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-apis">2.2 APIs<a href="#22-apis" class="hash-link" aria-label="Direct link to 2.2 APIs" title="Direct link to 2.2 APIs">​</a></h3>
<p>目前编译模型APIs支持tflite/onnx等格式的深度学习模型。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-compileoptions">2.2.1 CompileOptions<a href="#221-compileoptions" class="hash-link" aria-label="Direct link to 2.2.1 CompileOptions" title="Direct link to 2.2.1 CompileOptions">​</a></h4>
<p>【描述】</p>
<p>CompileOptions类, 用于配置nncase编译选项，各属性说明如下</p>
<table><thead><tr><th>属性名称</th><th>类型</th><th>是否必须</th><th>描述</th></tr></thead><tbody><tr><td>target</td><td>string</td><td>是</td><td>指定编译目标, 如’cpu’, ‘k230’</td></tr><tr><td>dump_ir</td><td>bool</td><td>否</td><td>指定是否dump IR, 默认为False</td></tr><tr><td>dump_asm</td><td>bool</td><td>否</td><td>指定是否dump asm汇编文件, 默认为False</td></tr><tr><td>dump_dir</td><td>string</td><td>否</td><td>前面指定dump_ir等开关后, 这里指定dump的目录, 默认为””</td></tr><tr><td>input_file</td><td>string</td><td>否</td><td>onnx模型超过2GB时，用于指定参数文件路径，默认为””</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>preprocess</td><td>bool</td><td>否</td><td>是否开启前处理，默认为False。以下参数仅在 <code>preprocess=True</code>时生效</td></tr><tr><td>input_type</td><td>string</td><td>否</td><td>开启前处理时指定输入数据类型，默认为”float”。当 <code>preprocess</code>为 <code>True</code>时，必须指定为”uint8”或者”float32”</td></tr><tr><td>input_shape</td><td>list[int]</td><td>否</td><td>开启前处理时指定输入数据的shape，默认为[]。当 <code>preprocess</code>为 <code>True</code>时，必须指定</td></tr><tr><td>input_range</td><td>list[float]</td><td>否</td><td>开启前处理时指定输入数据反量化后的浮点数范围，默认为[ ]。当 <code>preprocess</code>为 <code>True</code>且 <code>input_type</code>为 <code>uint8</code>时，必须指定</td></tr><tr><td>input_layout</td><td>string</td><td>否</td><td>指定输入数据的layout，默认为””</td></tr><tr><td>swapRB</td><td>bool</td><td>否</td><td>是否在 <code>channel</code>维度反转数据，默认为False</td></tr><tr><td>mean</td><td>list[float]</td><td>否</td><td>前处理标准化参数均值，默认为[0,0,0]</td></tr><tr><td>std</td><td>list[float]</td><td>否</td><td>前处理标准化参数方差，默认为[1,1,1]</td></tr><tr><td>letterbox_value</td><td>float</td><td>否</td><td>指定前处理letterbox的填充值，默认为0</td></tr><tr><td>output_layout</td><td>string</td><td>否</td><td>指定输出数据的layout, 默认为””</td></tr><tr><td></td><td></td><td></td><td></td></tr><tr><td>shape_bucket_enable</td><td>bool</td><td>是</td><td>是否开启ShapeBucket功能，默认为False。在 <code>dump_ir=True</code>时生效</td></tr><tr><td>shape_bucket_range_info</td><td>Dict[str, [int, int]]</td><td>是</td><td>每个输入shape维度信息中的变量的范围，最小值必须大于等于1</td></tr><tr><td>shape_bucket_segments_count</td><td>int</td><td>是</td><td>输入变量的范围划分为几段</td></tr><tr><td>shape_bucket_fix_var_map</td><td>Dict[str, int]</td><td>否</td><td>固定shape维度信息中的变量为特定的值</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2211-前处理流程说明">2.2.1.1 前处理流程说明<a href="#2211-前处理流程说明" class="hash-link" aria-label="Direct link to 2.2.1.1 前处理流程说明" title="Direct link to 2.2.1.1 前处理流程说明">​</a></h5>
<p>目前暂不支持自定义前处理顺序，可以根据以下流程示意图，选择所需要的前处理参数进行配置。</p>
<p><img decoding="async" loading="lazy" alt="image-20240722090355852" src="/assets/images/image-20240722090355852-9079f93d3141fb6f5e57ce93a48d2fc5.png" width="768" height="2346" class="img_ev3q"></p>
<p>参数说明：</p>
<ol>
<li>
<p><code>input_range</code>为输入数据类型为定点时，反量化后的浮点数范围。</p>
<p>a. 输入数据类型为uint8，range为[0,255]，<code>input_range</code>为[0,255]，则反量化的作用只是进行类型转化，将uint8的数据转化为float32，<code>mean</code>和 <code>std</code>参数仍然按照[0,255]的数据进行指定。</p>
<p>b. 输入数据类型为uint8，range为[0,255]，<code>input_range</code>为[0,1]，则反量化会将定点数转化为浮点数[0,1]，<code>mean</code>和 <code>std</code>参数需要按照0~1的数据进行指定。</p>
<p><img decoding="async" loading="lazy" alt="image-20240722090502269" src="/assets/images/image-20240722090502269-61285da6cf7adec94861a7d29e48a815.png" width="1006" height="431" class="img_ev3q"></p>
</li>
<li>
<p><code>input_shape</code>为输入数据的shape，layout为 <code>input_layout</code>，现在支持字符串（<code>&quot;NHWC&quot;</code>、<code>&quot;NCHW&quot;</code>）和index两种方式作为 <code>input_layout</code>，并且支持非4D的数据处理。 当按照字符串形式配置 <code>input_layout</code>时，表示输入数据的layout；当按照index形式配置<code>input_layout</code>时，表示输入数据会按照当前配置的 <code>input_layout</code>进行数据转置，即 <code>input_layout</code>为 <code>Transpose</code>的 <code>perm</code>参数。</p>
</li>
</ol>
<p><img decoding="async" loading="lazy" alt="image-20240722090529929" src="/assets/images/image-20240722090529929-e8dbffbcc063a6fbbe94570fe9d9a98c.png" width="1036" height="398" class="img_ev3q"></p>
<p><code>output_layout</code>同理，如下图所示。</p>
<p><img decoding="async" loading="lazy" alt="image-20240722090551002" src="/assets/images/image-20240722090551002-73a7795449dcd6a9003b2398e3bd60d5.png" width="1020" height="385" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2212-动态shape参数说明">2.2.1.2 动态shape参数说明<a href="#2212-动态shape参数说明" class="hash-link" aria-label="Direct link to 2.2.1.2 动态shape参数说明" title="Direct link to 2.2.1.2 动态shape参数说明">​</a></h5>
<p>ShapeBucket是针对动态shape的一种解决方案，会根据输入长度的范围以及指定的段的数量来对动态shape进行优化。该功能默认为false，需要打开对应的option才能生效，除了指定对应的字段信息，其他流程与编译静态模型没有区别。</p>
<ul>
<li>onnx</li>
</ul>
<p>在模型的shape中会有些维度为变量名字，这里以一个onnx模型的输入为例</p>
<blockquote>
<p>tokens: int64[batch_size, tgt_seq_len] step: float32[seq_len, batch_size]</p>
</blockquote>
<p>shape的维度信息中存在seq_len，tgt_seq_len，batch_size这三个变量。 首先是batch_size，虽然是变量的但实际应用的时候固定为3，因此在<strong>fix_var_map</strong>中添加batch_size = 3，在运行的时候会将这个维度固定为3。 seq_len，tgt_seq_len两个是实际会发生改变的，因此需要配置这两个变量的实际范围，也就是<strong>range_info</strong>的信息。<strong>segments_count</strong>是实际分段的数量，会根据范围等分为几份，对应的编译时间也会相应增加几倍。</p>
<p>以下为对应的编译参数示例：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compile_options = nncase.CompileOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_enable = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_range_info = {&quot;seq_len&quot;: [1, 100], &quot;tgt_seq_len&quot;: [1, 100]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_segments_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_fix_var_map = {&quot;batch_size&quot;: 3}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>tflite</li>
</ul>
<p>tflite的模型与onnx不同，shape上暂未标注维度的名称，目前只支持输入中具有一个维度是动态的，并且名称统一配置为-1，配置方式如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compile_options = nncase.CompileOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_enable = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_range_info = {&quot;-1&quot;:[1, 100]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_segments_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_fix_var_map = {&quot;batch_size&quot; : 3}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置完这些选项后整个编译的流程和静态shape一致。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2213-参数配置示例">2.2.1.3 参数配置示例<a href="#2213-参数配置示例" class="hash-link" aria-label="Direct link to 2.2.1.3 参数配置示例" title="Direct link to 2.2.1.3 参数配置示例">​</a></h5>
<p>实例化CompileOptions，配置各属性的值。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compile_options = nncase.CompileOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.target = &quot;cpu&quot; #&quot;k230&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.dump_ir = True  # if False, will not dump the compile-time result.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.dump_asm = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.dump_dir = &quot;dump_path&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.input_file = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># preprocess args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.preprocess = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if compile_options.preprocess:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_type = &quot;uint8&quot;  # &quot;uint8&quot; &quot;float32&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_shape = [1,224,320,3]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_range = [0,1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_layout = &quot;NHWC&quot; # &quot;NHWC&quot; ”NCHW“</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.swapRB = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.mean = [0,0,0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.std = [1,1,1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.letterbox_value = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.output_layout = &quot;NHWC&quot; # &quot;NHWC&quot; &quot;NCHW&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Dynamic shape args</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_options.shape_bucket_enable = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if compile_options.shape_bucket_enable:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.shape_bucket_range_info = {&quot;seq_len&quot;: [1, 100], &quot;tgt_seq_len&quot;: [1, 100]}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.shape_bucket_segments_count = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.shape_bucket_fix_var_map = {&quot;batch_size&quot;: 3}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-importoptions">2.2.2 ImportOptions<a href="#222-importoptions" class="hash-link" aria-label="Direct link to 2.2.2 ImportOptions" title="Direct link to 2.2.2 ImportOptions">​</a></h4>
<p>【描述】</p>
<p>ImportOptions类, 用于配置nncase导入选项</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class ImportOptions:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<p>实例化ImportOptions, 配置各属性的值</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#import_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import_options = nncase.ImportOptions()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="223-ptqtensoroptions">2.2.3 PTQTensorOptions<a href="#223-ptqtensoroptions" class="hash-link" aria-label="Direct link to 2.2.3 PTQTensorOptions" title="Direct link to 2.2.3 PTQTensorOptions">​</a></h4>
<p>【描述】</p>
<p>PTQTensorOptions类, 用于配置nncase PTQ选项</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>calibrate_method</td><td>string</td><td>否</td></tr><tr><td>samples_count</td><td>int</td><td>否</td></tr><tr><td>finetune_weights_method</td><td>string</td><td>否</td></tr><tr><td>quant_type</td><td>string</td><td>否</td></tr><tr><td>w_quant_type</td><td>string</td><td>否</td></tr><tr><td></td><td></td><td></td></tr><tr><td>quant_scheme</td><td>string</td><td>否</td></tr><tr><td>quant_scheme_strict_mode</td><td>bool</td><td>否</td></tr><tr><td>export_quant_scheme</td><td>bool</td><td>否</td></tr><tr><td>export_weight_range_by_channel</td><td>bool</td><td>否</td></tr></tbody></table>
<ul>
<li>混合量化参数说明<!-- -->
<ul>
<li>quant_scheme：导入量化参数配置文件的路径</li>
<li>quant_scheme_strict_mode：是否严格按照quant_scheme执行量化</li>
<li>export_quant_scheme：是否导出量化参数配置文件</li>
<li>export_weight_range_by_channel：是否导出 <code>bychannel</code>形式的weights量化参数，为了保证量化效果，该参数建议设置为 <code>True</code></li>
</ul>
</li>
</ul>
<p>具体使用流程见 <a href="https://github.com/kendryte/nncase/blob/release/2.0/docs/MixQuant.md" target="_blank" rel="noopener noreferrer">MixQuant说明</a></p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ptq_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options = nncase.PTQTensorOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.samples_count = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.finetune_weights_method = &quot;NoFineTuneWeights&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.quant_type = &quot;uint8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.w_quant_type = &quot;uint8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.quant_scheme = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.quant_scheme_strict_mode = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.export_quant_scheme = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.export_weight_range_by_channel = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler.use_ptq(ptq_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="224-set_tensor_data">2.2.4 set_tensor_data<a href="#224-set_tensor_data" class="hash-link" aria-label="Direct link to 2.2.4 set_tensor_data" title="Direct link to 2.2.4 set_tensor_data">​</a></h4>
<p>【描述】</p>
<p>设置tensor数据</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def set_tensor_data(self, data: List[List[np.ndarray]]) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reshape_data = list(map(list, zip(*data)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.cali_data = [RuntimeTensor.from_numpy(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            d) for d in itertools.chain.from_iterable(reshape_data)]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>data</td><td>List[List[np.ndarray]</td><td>读取的校准数据</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ptq_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options = nncase.PTQTensorOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.samples_count = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler.use_ptq(ptq_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="225-compiler">2.2.5 Compiler<a href="#225-compiler" class="hash-link" aria-label="Direct link to 2.2.5 Compiler" title="Direct link to 2.2.5 Compiler">​</a></h4>
<p>【描述】</p>
<p>Compiler类, 用于编译神经网络模型</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Compiler:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _target: _nncase.Target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _session: _nncase.CompileSession</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _compiler: _nncase.Compiler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _compile_options: _nncase.CompileOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _quantize_options: _nncase.QuantizeOptions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _module: IRModule</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="226-import_tflite">2.2.6 import_tflite<a href="#226-import_tflite" class="hash-link" aria-label="Direct link to 2.2.6 import_tflite" title="Direct link to 2.2.6 import_tflite">​</a></h4>
<p>【描述】</p>
<p>导入tflite模型</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def import_tflite(self, model_content: bytes, options: ImportOptions) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self._compile_options.input_format = &quot;tflite&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self._import_module(model_content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>model_content</td><td>byte[]</td><td>读取的模型内容</td></tr><tr><td>import_options</td><td>ImportOptions</td><td>导入选项</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model_content = read_model_file(model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler.import_tflite(model_content, import_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="227-import_onnx">2.2.7 import_onnx<a href="#227-import_onnx" class="hash-link" aria-label="Direct link to 2.2.7 import_onnx" title="Direct link to 2.2.7 import_onnx">​</a></h4>
<p>【描述】</p>
<p>导入onnx模型</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def import_onnx(self, model_content: bytes, options: ImportOptions) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self._compile_options.input_format = &quot;onnx&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self._import_module(model_content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>model_content</td><td>byte[]</td><td>读取的模型内容</td></tr><tr><td>import_options</td><td>ImportOptions</td><td>导入选项</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">model_content = read_model_file(model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compiler.import_onnx(model_content, import_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="228-use_ptq">2.2.8 use_ptq<a href="#228-use_ptq" class="hash-link" aria-label="Direct link to 2.2.8 use_ptq" title="Direct link to 2.2.8 use_ptq">​</a></h4>
<p>【描述】</p>
<p>设置PTQ配置选项.</p>
<ul>
<li>K230默认必须使用量化。</li>
</ul>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use_ptq(ptq_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>ptq_options</td><td>PTQTensorOptions</td><td>PTQ配置选项</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compiler.use_ptq(ptq_options)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="229-compile">2.2.9 compile<a href="#229-compile" class="hash-link" aria-label="Direct link to 2.2.9 compile" title="Direct link to 2.2.9 compile">​</a></h4>
<p>【描述】</p>
<p>编译神经网络模型</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compile()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">compiler.compile()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2210-gencode_tobytes">2.2.10 gencode_tobytes<a href="#2210-gencode_tobytes" class="hash-link" aria-label="Direct link to 2.2.10 gencode_tobytes" title="Direct link to 2.2.10 gencode_tobytes">​</a></h4>
<p>【描述】</p>
<p>生成kmodel字节流</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gencode_tobytes()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bytes[]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kmodel = compiler.gencode_tobytes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">with open(os.path.join(infer_dir, &#x27;test.kmodel&#x27;), &#x27;wb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    f.write(kmodel)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-示例">2.3 示例<a href="#23-示例" class="hash-link" aria-label="Direct link to 2.3 示例" title="Direct link to 2.3 示例">​</a></h3>
<p>下面示例中使用到的模型和python编译脚本</p>
<ul>
<li>原始模型文件位于/path/to/k230_sdk/src/big/nncase/examples/models目录</li>
<li>python编译脚本位于/path/to/k230_sdk/src/big/nncase/examples/scripts目录</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="231-编译tflite模型">2.3.1 编译tflite模型<a href="#231-编译tflite模型" class="hash-link" aria-label="Direct link to 2.3.1 编译tflite模型" title="Direct link to 2.3.1 编译tflite模型">​</a></h4>
<p>mbv2_tflite.py脚本如下</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from PIL import Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import nncase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def read_model_file(model_file):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(model_file, &#x27;rb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model_content = f.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return model_content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def generate_data(shape, batch, calib_dir):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(batch):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert i &lt; len(img_paths), &quot;calibration images not enough.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = Image.open(img_paths[i]).convert(&#x27;RGB&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = np.asarray(img_data, dtype=np.uint8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = np.transpose(img_data, (2, 0, 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data.append([img_data[np.newaxis, ...]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser = argparse.ArgumentParser(prog=&quot;nncase&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--target&quot;, type=str, help=&#x27;target to run&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--model&quot;, type=str, help=&#x27;model file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--dataset&quot;, type=str, help=&#x27;calibration_dataset&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = parser.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_shape = [1, 3, 224, 224]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dir = &#x27;tmp/mbv2_tflite&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compile_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options = nncase.CompileOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.target = args.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.preprocess = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.swapRB = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_shape = input_shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_type = &#x27;uint8&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_range = [0, 255]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.mean = [127.5, 127.5, 127.5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.std = [127.5, 127.5, 127.5]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_layout = &#x27;NCHW&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_ir = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_asm = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_dir = dump_dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compiler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler = nncase.Compiler(compile_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_content = read_model_file(args.model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import_options = nncase.ImportOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.import_tflite(model_content, import_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ptq_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options = nncase.PTQTensorOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options.samples_count = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.use_ptq(ptq_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.compile()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kmodel = compiler.gencode_tobytes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(os.path.join(dump_dir, &#x27;test.kmodel&#x27;), &#x27;wb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f.write(kmodel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行如下命令即可编译mobilenetv2的tflite模型, target为k230</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@c285a41a7243:/mnt/# cd src/big/nncase/examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@c285a41a7243:/mnt/src/big/nncase/examples# python3 ./scripts/mbv2_tflite.py --target k230 --model models/mbv2.tflite --dataset calibration_dataset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="232-编译onnx模型">2.3.2 编译onnx模型<a href="#232-编译onnx模型" class="hash-link" aria-label="Direct link to 2.3.2 编译onnx模型" title="Direct link to 2.3.2 编译onnx模型">​</a></h4>
<p>针对onnx模型, 建议先使用<a href="https://github.com/daquexian/onnx-simplifier" target="_blank" rel="noopener noreferrer">ONNX Simplifier</a>进行简化, 然后再使用nncase编译.</p>
<p>yolov5s_onnx.py 脚本如下</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from PIL import Image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import onnxsim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import onnx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import nncase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def parse_model_input_output(model_file):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onnx_model = onnx.load(model_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_all = [node.name for node in onnx_model.graph.input]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_initializer = [node.name for node in onnx_model.graph.initializer]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_names = list(set(input_all) - set(input_initializer))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_tensors = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node for node in onnx_model.graph.input if node.name in input_names]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inputs = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for _, e in enumerate(input_tensors):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        onnx_type = e.type.tensor_type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_dict = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_dict[&#x27;name&#x27;] = e.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_dict[&#x27;dtype&#x27;] = onnx.mapping.TENSOR_TYPE_TO_NP_TYPE[onnx_type.elem_type]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_dict[&#x27;shape&#x27;] = [(i.dim_value if i.dim_value != 0 else d) for i, d in zip(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            onnx_type.shape.dim, [1, 3, 224, 224])]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inputs.append(input_dict)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return onnx_model, inputs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def onnx_simplify(model_file, dump_dir):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onnx_model, inputs = parse_model_input_output(model_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onnx_model = onnx.shape_inference.infer_shapes(onnx_model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_shapes = {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for input in inputs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        input_shapes[input[&#x27;name&#x27;]] = input[&#x27;shape&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onnx_model, check = onnxsim.simplify(onnx_model, input_shapes=input_shapes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    assert check, &quot;Simplified ONNX model could not be validated&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_file = os.path.join(dump_dir, &#x27;simplified.onnx&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    onnx.save_model(onnx_model, model_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return model_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def read_model_file(model_file):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(model_file, &#x27;rb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model_content = f.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return model_content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def generate_data_ramdom(shape, batch):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(batch):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data.append([np.random.randint(0, 256, shape).astype(np.uint8)])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def generate_data(shape, batch, calib_dir):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    img_paths = [os.path.join(calib_dir, p) for p in os.listdir(calib_dir)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(batch):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert i &lt; len(img_paths), &quot;calibration images not enough.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = Image.open(img_paths[i]).convert(&#x27;RGB&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = img_data.resize((shape[3], shape[2]), Image.BILINEAR)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = np.asarray(img_data, dtype=np.uint8)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        img_data = np.transpose(img_data, (2, 0, 1))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data.append([img_data[np.newaxis, ...]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser = argparse.ArgumentParser(prog=&quot;nncase&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--target&quot;, type=str, help=&#x27;target to run&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--model&quot;, type=str, help=&#x27;model file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--dataset&quot;, type=str, help=&#x27;calibration_dataset&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = parser.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_shape = [1, 3, 320, 320]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dump_dir = &#x27;tmp/yolov5s_onnx&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not os.path.exists(dump_dir):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os.makedirs(dump_dir)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # onnx simplify</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_file = onnx_simplify(args.model, dump_dir)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compile_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options = nncase.CompileOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.target = args.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.preprocess = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.swapRB = False</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_shape = input_shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_type = &#x27;uint8&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_range = [0, 255]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.mean = [0, 0, 0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.std = [255, 255, 255]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.input_layout = &#x27;NCHW&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.output_layout = &#x27;NCHW&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_ir = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_asm = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compile_options.dump_dir = dump_dir</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compiler</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler = nncase.Compiler(compile_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # import</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_content = read_model_file(model_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    import_options = nncase.ImportOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.import_onnx(model_content, import_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # ptq_options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options = nncase.PTQTensorOptions()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options.samples_count = 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ptq_options.set_tensor_data(generate_data(input_shape, ptq_options.samples_count, args.dataset))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.use_ptq(ptq_options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compiler.compile()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kmodel = compiler.gencode_tobytes()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(os.path.join(dump_dir, &#x27;test.kmodel&#x27;), &#x27;wb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        f.write(kmodel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行如下命令即可编译onnx模型, target为k230</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@c285a41a7243:/mnt/# cd src/big/nncase/examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@c285a41a7243: /mnt/src/big/nncase/examples # python3 ./scripts/yolov5s_onnx.py --target k230 --model models/yolov5s.onnx --dataset calibration_dataset</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-模拟器apispython">3. 模拟器APIs(Python)<a href="#3-模拟器apispython" class="hash-link" aria-label="Direct link to 3. 模拟器APIs(Python)" title="Direct link to 3. 模拟器APIs(Python)">​</a></h2>
<p>除了编译模型APIs, nncase还提供了推理模型的APIs, 在PC上可推理编译模型生成的kmodel, 用来验证nncase推理结果和相应深度学习框架的runtime的结果是否一致等.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-apis">3.1 APIs<a href="#31-apis" class="hash-link" aria-label="Direct link to 3.1 APIs" title="Direct link to 3.1 APIs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-memoryrange">3.1.1 MemoryRange<a href="#311-memoryrange" class="hash-link" aria-label="Direct link to 3.1.1 MemoryRange" title="Direct link to 3.1.1 MemoryRange">​</a></h4>
<p>【描述】</p>
<p>MemoryRange类, 用于表示内存范围</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">py::class_&lt;memory_range&gt;(m, &quot;MemoryRange&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_readwrite(&quot;location&quot;, &amp;memory_range::memory_location)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_property(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;dtype&quot;, [](const memory_range &amp;range) { return to_dtype(range.datatype); },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [](memory_range &amp;range, py::object dtype) { range.datatype = from_dtype(py::dtype::from_args(dtype)); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_readwrite(&quot;start&quot;, &amp;memory_range::start)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_readwrite(&quot;size&quot;, &amp;memory_range::size);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【属性】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>location</td><td>int</td><td>内存位置, 0表示input, 1表示output, 2表示rdata, 3表示data, 4表示shared_data</td></tr><tr><td>dtype</td><td>python数据类型</td><td>数据类型</td></tr><tr><td>start</td><td>int</td><td>内存起始地址</td></tr><tr><td>Size</td><td>int</td><td>内存大小</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mr = nncase.MemoryRange()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-runtimetensor">3.1.2 RuntimeTensor<a href="#312-runtimetensor" class="hash-link" aria-label="Direct link to 3.1.2 RuntimeTensor" title="Direct link to 3.1.2 RuntimeTensor">​</a></h4>
<p>【描述】</p>
<p>RuntimeTensor类, 用于表示运行时tensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">py::class_&lt;runtime_tensor&gt;(m, &quot;RuntimeTensor&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_static(&quot;from_numpy&quot;, [](py::array arr) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto src_buffer = arr.request();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto datatype = from_dtype(arr.dtype());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto tensor = host_runtime_tensor::create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            datatype,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            to_rt_shape(src_buffer.shape),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            to_rt_strides(src_buffer.itemsize, src_buffer.strides),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            gsl::make_span(reinterpret_cast&lt;gsl::byte *&gt;(src_buffer.ptr), src_buffer.size * src_buffer.itemsize),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [=](gsl::byte *) { arr.dec_ref(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          .unwrap_or_throw();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        arr.inc_ref();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return tensor;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;copy_to&quot;, [](runtime_tensor &amp;from, runtime_tensor &amp;to) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        from.copy_to(to).unwrap_or_throw();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;to_numpy&quot;, [](runtime_tensor &amp;tensor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto host = tensor.as_host().unwrap_or_throw();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto src_map = std::move(hrt::map(host, hrt::map_read).unwrap_or_throw());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto src_buffer = src_map.buffer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return py::array(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            to_dtype(tensor.datatype()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            tensor.shape(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            to_py_strides(runtime::get_bytes(tensor.datatype()), tensor.strides()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            src_buffer.data());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_property_readonly(&quot;dtype&quot;, [](runtime_tensor &amp;tensor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return to_dtype(tensor.datatype());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_property_readonly(&quot;shape&quot;, [](runtime_tensor &amp;tensor) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return to_py_shape(tensor.shape());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【属性】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>dtype</td><td>python数据类型</td><td>Tensor的数据类型</td></tr><tr><td>shape</td><td>list</td><td>tensor的形状</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="313-from_numpy">3.1.3 from_numpy<a href="#313-from_numpy" class="hash-link" aria-label="Direct link to 3.1.3 from_numpy" title="Direct link to 3.1.3 from_numpy">​</a></h4>
<p>【描述】</p>
<p>从numpy.ndarray构造RuntimeTensor对象</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from_numpy(py::array arr)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>Arr</td><td>numpy.ndarray</td><td>numpy.ndarray对象</td></tr></tbody></table>
<p>【返回值】</p>
<p>RuntimeTensor</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tensor = nncase.RuntimeTensor.from_numpy(self.inputs[i][&#x27;data&#x27;])</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="314-copy_to">3.1.4 copy_to<a href="#314-copy_to" class="hash-link" aria-label="Direct link to 3.1.4 copy_to" title="Direct link to 3.1.4 copy_to">​</a></h4>
<p>【描述】</p>
<p>拷贝RuntimeTensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">copy_to(RuntimeTensor to)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>to</td><td>RuntimeTensor</td><td>RuntimeTensor对象</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim.get_output_tensor(i).copy_to(to)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="315-to_numpy">3.1.5 to_numpy<a href="#315-to_numpy" class="hash-link" aria-label="Direct link to 3.1.5 to_numpy" title="Direct link to 3.1.5 to_numpy">​</a></h4>
<p>【描述】</p>
<p>将RuntimeTensor转换为numpy.ndarray对象</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">to_numpy()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<p>numpy.ndarray对象</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">arr = sim.get_output_tensor(i).to_numpy()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="316-simulator">3.1.6 Simulator<a href="#316-simulator" class="hash-link" aria-label="Direct link to 3.1.6 Simulator" title="Direct link to 3.1.6 Simulator">​</a></h4>
<p>【描述】</p>
<p>Simulator类, 用于在PC上推理kmodel</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">py::class_&lt;interpreter&gt;(m, &quot;Simulator&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(py::init())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;load_model&quot;, [](interpreter &amp;interp, gsl::span&lt;const gsl::byte&gt; buffer) { interp.load_model(buffer).unwrap_or_throw(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_property_readonly(&quot;inputs_size&quot;, &amp;interpreter::inputs_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def_property_readonly(&quot;outputs_size&quot;, &amp;interpreter::outputs_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;get_input_desc&quot;, &amp;interpreter::input_desc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;get_output_desc&quot;, &amp;interpreter::output_desc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;get_input_tensor&quot;, [](interpreter &amp;interp, size_t index) { return interp.input_tensor(index).unwrap_or_throw(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;set_input_tensor&quot;, [](interpreter &amp;interp, size_t index, runtime_tensor tensor) { return interp.input_tensor(index, tensor).unwrap_or_throw(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;get_output_tensor&quot;, [](interpreter &amp;interp, size_t index) { return interp.output_tensor(index).unwrap_or_throw(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;set_output_tensor&quot;, [](interpreter &amp;interp, size_t index, runtime_tensor tensor) { return interp.output_tensor(index, tensor).unwrap_or_throw(); })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .def(&quot;run&quot;, [](interpreter &amp;interp) { interp.run().unwrap_or_throw(); });</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【属性】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>inputs_size</td><td>int</td><td>输入个数</td></tr><tr><td>outputs_size</td><td>int</td><td>输出个数</td></tr></tbody></table>
<p> 【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim = nncase.Simulator()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="317-load_model">3.1.7 load_model<a href="#317-load_model" class="hash-link" aria-label="Direct link to 3.1.7 load_model" title="Direct link to 3.1.7 load_model">​</a></h4>
<p>【描述】</p>
<p>加载kmodel</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">load_model(model_content)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>model_content</td><td>byte[]</td><td>kmodel字节流</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim.load_model(kmodel)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="318-get_input_desc">3.1.8 get_input_desc<a href="#318-get_input_desc" class="hash-link" aria-label="Direct link to 3.1.8 get_input_desc" title="Direct link to 3.1.8 get_input_desc">​</a></h4>
<p>【描述】</p>
<p>获取指定索引的输入的描述信息</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">get_input_desc(index)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输入的索引</td></tr></tbody></table>
<p>【返回值】</p>
<p>MemoryRange</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input_desc_0 = sim.get_input_desc(0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="319-get_output_desc">3.1.9 get_output_desc<a href="#319-get_output_desc" class="hash-link" aria-label="Direct link to 3.1.9 get_output_desc" title="Direct link to 3.1.9 get_output_desc">​</a></h4>
<p>【描述】</p>
<p>获取指定索引的输出的描述信息</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">get_output_desc(index)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输出的索引</td></tr></tbody></table>
<p>【返回值】</p>
<p>MemoryRange</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output_desc_0 = sim.get_output_desc(0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3110-get_input_tensor">3.1.10 get_input_tensor<a href="#3110-get_input_tensor" class="hash-link" aria-label="Direct link to 3.1.10 get_input_tensor" title="Direct link to 3.1.10 get_input_tensor">​</a></h4>
<p>【描述】</p>
<p>获取指定索引的输入的RuntimeTensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">get_input_tensor(index)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输入tensor的索引</td></tr></tbody></table>
<p>【返回值】</p>
<p>RuntimeTensor</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">input_tensor_0 = sim.get_input_tensor(0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3111-set_input_tensor">3.1.11 set_input_tensor<a href="#3111-set_input_tensor" class="hash-link" aria-label="Direct link to 3.1.11 set_input_tensor" title="Direct link to 3.1.11 set_input_tensor">​</a></h4>
<p>【描述】</p>
<p>设置指定索引的输入的RuntimeTensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set_input_tensor(index, tensor)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输入tensor的索引</td></tr><tr><td>tensor</td><td>RuntimeTensor</td><td>输入tensor</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(self.inputs[0][&#x27;data&#x27;]))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3112-get_output_tensor">3.1.12 get_output_tensor<a href="#3112-get_output_tensor" class="hash-link" aria-label="Direct link to 3.1.12 get_output_tensor" title="Direct link to 3.1.12 get_output_tensor">​</a></h4>
<p>【描述】</p>
<p>获取指定索引的输出的RuntimeTensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">get_output_tensor(index)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输出tensor的索引</td></tr></tbody></table>
<p>【返回值】</p>
<p>RuntimeTensor</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output_arr_0 = sim.get_output_tensor(0).to_numpy()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3113-set_output_tensor">3.1.13 set_output_tensor<a href="#3113-set_output_tensor" class="hash-link" aria-label="Direct link to 3.1.13 set_output_tensor" title="Direct link to 3.1.13 set_output_tensor">​</a></h4>
<p>【描述】</p>
<p>设置指定索引的输出的RuntimeTensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set_output_tensor(index, tensor)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>int</td><td>输出tensor的索引</td></tr><tr><td>tensor</td><td>RuntimeTensor</td><td>输出tensor</td></tr></tbody></table>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim.set_output_tensor(0, tensor)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3114-run">3.1.14 run<a href="#3114-run" class="hash-link" aria-label="Direct link to 3.1.14 run" title="Direct link to 3.1.14 run">​</a></h4>
<p>【描述】</p>
<p>运行kmodel推理</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sim.run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-示例">3.2 示例<a href="#32-示例" class="hash-link" aria-label="Direct link to 3.2 示例" title="Direct link to 3.2 示例">​</a></h3>
<p><strong>前置条件</strong>: yolov5s_onnx.py脚本已编译过yolov5s.onnx模型</p>
<p>yolov5s_onnx_simu.py位于/path/to/k230_sdk/src/big/nncase/examples/scripts子目录， 内容如下</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import numpy as np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import onnx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import onnxruntime as ort</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import nncase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def read_model_file(model_file):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    with open(model_file, &#x27;rb&#x27;) as f:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model_content = f.read()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return model_content</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def cosine(gt, pred):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (gt @ pred) / (np.linalg.norm(gt, 2) * np.linalg.norm(pred, 2))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def main():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser = argparse.ArgumentParser(prog=&quot;nncase&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--model&quot;, type=str, help=&#x27;original model file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--model_input&quot;, type=str, help=&#x27;input bin file for original model&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--kmodel&quot;, type=str, help=&#x27;kmodel file&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--kmodel_input&quot;, type=str, help=&#x27;input bin file for kmodel&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = parser.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # cpu inference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ort_session = ort.InferenceSession(args.model)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    output_names = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_outputs = ort_session.get_outputs()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(len(model_outputs)):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        output_names.append(model_outputs[i].name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_input = ort_session.get_inputs()[0]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_input_name = model_input.name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_input_type = np.float32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_input_shape = model_input.shape</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_input_data = np.fromfile(args.model_input, model_input_type).reshape(model_input_shape)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu_results = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cpu_results = ort_session.run(output_names, { model_input_name : model_input_data })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # create simulator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sim = nncase.Simulator()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # read kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kmodel = read_model_file(args.kmodel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # load kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sim.load_model(kmodel)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # read input.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # input_tensor=sim.get_input_tensor(0).to_numpy()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dtype = sim.get_input_desc(0).dtype</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input = np.fromfile(args.kmodel_input, dtype).reshape([1, 3, 320, 320])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # set input for simulator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sim.set_input_tensor(0, nncase.RuntimeTensor.from_numpy(input))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # simulator inference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nncase_results = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sim.run()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(sim.outputs_size):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nncase_result = sim.get_output_tensor(i).to_numpy()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        nncase_results.append(copy.deepcopy(nncase_result))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # compare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for i in range(sim.outputs_size):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cos = cosine(np.reshape(nncase_results[i], (-1)), np.reshape(cpu_results[i], (-1)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;output {0} cosine similarity : {1}&#x27;.format(i, cos))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &#x27;__main__&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    main()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>执行推理脚本</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@5f718e19f8a7:/mnt/# cd src/big/nncase/examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5f718e19f8a7:/mnt/src/big/nncase/examples # export PATH=$PATH:/usr/local/lib/python3.8/dist-packages/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@5f718e19f8a7:/mnt/src/big/nncase/examples # python3 scripts/yolov5s_onnx_simu.py --model models/yolov5s.onnx --model_input object_detect/data/input_fp32.bin --kmodel tmp/yolov5s_onnx/test.kmodel --kmodel_input object_detect/data/input_uint8.bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>nncase simulator和cpu推理结果对比如下</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">output 0 cosine similarity : 0.9997244477272034</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output 1 cosine similarity : 0.999757707118988</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">output 2 cosine similarity : 0.9997308850288391</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-kpu运行时apisc">4. KPU运行时APIs(C++)<a href="#4-kpu运行时apisc" class="hash-link" aria-label="Direct link to 4. KPU运行时APIs(C++)" title="Direct link to 4. KPU运行时APIs(C++)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-简介">4.1 简介<a href="#41-简介" class="hash-link" aria-label="Direct link to 4.1 简介" title="Direct link to 4.1 简介">​</a></h3>
<p>KPU运行时APIs用于在AI设备加载kmodel，设置输入数据，执行kpu/cpu计算， 获取输出数据等.</p>
<p>目前只提供C++ APIs, 相关的头文件和静态库在/path/to/k230_sdk/src/big/nncase/riscv64目录下.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree -L 3 riscv64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">riscv64/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── gsl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── gsl-lite.hpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── nncase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   │   └── nncase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── libfunctional_k230.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── libnncase.rt_modules.k230.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── libNncase.Runtime.Native.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── rvvlib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── k230_math.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── nms.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── rvv_math.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── librvv.a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8 directories, 8 files</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-apis">4.2 APIs<a href="#42-apis" class="hash-link" aria-label="Direct link to 4.2 APIs" title="Direct link to 4.2 APIs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-hrtcreate">4.2.1 hrt::create<a href="#421-hrtcreate" class="hash-link" aria-label="Direct link to 4.2.1 hrt::create" title="Direct link to 4.2.1 hrt::create">​</a></h4>
<p>【描述】</p>
<p>创建runtime_tensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1) NNCASE_API result&lt;runtime_tensor&gt; create(typecode_t datatype, dims_t shape, memory_pool_t pool = pool_shared_first) noexcept;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) NNCASE_API result&lt;runtime_tensor&gt; create(typecode_t datatype, dims_t shape, gsl::span&lt;gsl::byte&gt; data, bool copy,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       memory_pool_t pool = pool_shared_first) noexcept;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(3)NNCASE_API result&lt;runtime_tensor&gt;create(typecode_t datatype, dims_t shape, strides_t strides, gsl::span&lt;gsl::byte&gt; data, bool copy, memory_pool_t pool = pool_shared_first, uintptr_t physical_address = 0) noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>datatype</td><td>typecode_t</td><td>数据类型, 如dt_float32, dt_uint8等</td></tr><tr><td>shape</td><td>dims_t</td><td>tensor的形状</td></tr><tr><td>data</td><td><code>gsl::span&lt;gsl::byte&gt;</code></td><td>用户态数据buffer</td></tr><tr><td>copy</td><td>bool</td><td>是否拷贝</td></tr><tr><td>pool</td><td>memory_pool_t</td><td>内存池类型, 默认值为pool_shared_first</td></tr><tr><td>physical_address</td><td>uintptr_t</td><td>用户指定buffer的物理地址</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;runtime_tensor&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// create input tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto input_desc = interp.input_desc(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto input_shape = interp.input_shape(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto input_tensor = host_runtime_tensor::create(input_desc.datatype, input_shape, hrt::pool_shared).expect(&quot;cannot create input tensor&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-hrtsync">4.2.2 hrt::sync<a href="#422-hrtsync" class="hash-link" aria-label="Direct link to 4.2.2 hrt::sync" title="Direct link to 4.2.2 hrt::sync">​</a></h4>
<p>【描述】</p>
<p>同步tensor的cache。</p>
<ul>
<li>对用户的输入数据， 需要调用 此接口的sync_write_back确保数据已刷入ddr.</li>
<li>对gnne/ai2d计算后输出数据，默认gnne/ai2d runtime已做了sync_invalidate处理。</li>
</ul>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NNCASE_API result&lt;void&gt; sync(runtime_tensor &amp;tensor, sync_op_t op, bool force = false) noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>tensor</td><td>runtime_tensor</td><td>要操作的tensor</td></tr><tr><td>op</td><td>sync_op_t</td><td>sync_invalidate(将tensor的cache invalidate)或sync_write_back(将tensor的cache写入ddr)</td></tr><tr><td>force</td><td>bool</td><td>是否强制执行</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect(&quot;sync write_back failed&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="423-interpreterload_model">4.2.3 interpreter::load_model<a href="#423-interpreterload_model" class="hash-link" aria-label="Direct link to 4.2.3 interpreter::load_model" title="Direct link to 4.2.3 interpreter::load_model">​</a></h4>
<p>【描述】</p>
<p>加载kmodel模型</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">NNCASE_NODISCARD result&lt;void&gt; load_model(gsl::span&lt;const gsl::byte&gt; buffer) noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>buffer</td><td><code>gsl::span &lt;const gsl::byte&gt;</code></td><td>kmodel buffer</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">interpreter interp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto model = read_binary_file&lt;unsigned char&gt;(kmodel);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interp.load_model({(const gsl::byte *)model.data(), model.size()}).expect(&quot;cannot load model.&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="424-interpreterinputs_size">4.2.4 interpreter::inputs_size<a href="#424-interpreterinputs_size" class="hash-link" aria-label="Direct link to 4.2.4 interpreter::inputs_size" title="Direct link to 4.2.4 interpreter::inputs_size">​</a></h4>
<p>【描述】</p>
<p>获取模型输入的个数</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">size_t inputs_size() const noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">size_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auto inputs_size = interp.inputs_size();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="425-interpreteroutputs_size">4.2.5 interpreter::outputs_size<a href="#425-interpreteroutputs_size" class="hash-link" aria-label="Direct link to 4.2.5 interpreter::outputs_size" title="Direct link to 4.2.5 interpreter::outputs_size">​</a></h4>
<p>【描述】</p>
<p>获取模型输出的个数</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">size_t outputs_size() const noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">size_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auto outputs_size = interp.outputs_size();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="426-interpreter-input_shape">4.2.6 interpreter:: input_shape<a href="#426-interpreter-input_shape" class="hash-link" aria-label="Direct link to 4.2.6 interpreter:: input_shape" title="Direct link to 4.2.6 interpreter:: input_shape">​</a></h4>
<p>【描述】</p>
<p>获取模型指定输入的形状</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const runtime_shape_t &amp;input_shape(size_t index) const noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>size_t</td><td>输入的索引</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">runtime_shape_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auto shape = interp.input_shape(0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="427-interpreter-output_shape">4.2.7 interpreter:: output_shape<a href="#427-interpreter-output_shape" class="hash-link" aria-label="Direct link to 4.2.7 interpreter:: output_shape" title="Direct link to 4.2.7 interpreter:: output_shape">​</a></h4>
<p>【描述】</p>
<p>获取模型指定输出的形状</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">const runtime_shape_t &amp;output_shape(size_t index) const noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>size_t</td><td>输出的索引</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">runtime_shape_t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">auto shape = interp.output_shape(0);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="428-interpreter-input_tensor">4.2.8 interpreter:: input_tensor<a href="#428-interpreter-input_tensor" class="hash-link" aria-label="Direct link to 4.2.8 interpreter:: input_tensor" title="Direct link to 4.2.8 interpreter:: input_tensor">​</a></h4>
<p>【描述】</p>
<p>获取/设置指定索引的输入 tensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1) result&lt;runtime_tensor&gt; input_tensor(size_t index) noexcept;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) result&lt;void&gt; input_tensor(size_t index, runtime_tensor tensor) noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>size_t</td><td>输入的索引</td></tr><tr><td>tensor</td><td>runtime_tensor</td><td>输入对应的runtime tensor</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1) result&lt;runtime_tensor&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) result&lt;void&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">【示例】</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// set input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interp.input_tensor(0, input_tensor).expect(&quot;cannot set input tensor&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="429-interpreter-output_tensor">4.2.9 interpreter:: output_tensor<a href="#429-interpreter-output_tensor" class="hash-link" aria-label="Direct link to 4.2.9 interpreter:: output_tensor" title="Direct link to 4.2.9 interpreter:: output_tensor">​</a></h4>
<p>【描述】</p>
<p>获取/设置指定索引的输出tensor</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1) result&lt;runtime_tensor&gt; output_tensor(size_t index) noexcept;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) result&lt;void&gt; output_tensor(size_t index, runtime_tensor tensor) noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>index</td><td>size_t</td><td>输出的索引</td></tr><tr><td>tensor</td><td>runtime_tensor</td><td>输出对应的runtime tensor</td></tr></tbody></table>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(1) result&lt;runtime_tensor&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(2) result&lt;void&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// get output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto output_tensor = interp.output_tensor(0).expect(&quot;cannot get output tensor&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4210-interpreter-run">4.2.10 interpreter:: run<a href="#4210-interpreter-run" class="hash-link" aria-label="Direct link to 4.2.10 interpreter:: run" title="Direct link to 4.2.10 interpreter:: run">​</a></h4>
<p>【描述】</p>
<p>执行kpu计算</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt; run() noexcept;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<p>返回<code>result &lt;void&gt;</code></p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interp.run().expect(&quot;error occurred in running model&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-示例">4.3 示例<a href="#43-示例" class="hash-link" aria-label="Direct link to 4.3 示例" title="Direct link to 4.3 示例">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;chrono&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;fstream&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;iostream&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;nncase/runtime/interpreter.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;nncase/runtime/runtime_op_utility.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define USE_OPENCV 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define preprocess 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if USE_OPENCV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;opencv2/highgui.hpp&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;opencv2/imgcodecs.hpp&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;opencv2/imgproc.hpp&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace nncase;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace nncase::runtime;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace nncase::runtime::detail;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define INTPUT_HEIGHT 224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define INTPUT_WIDTH 224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define INTPUT_CHANNELS 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;class T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::vector&lt;T&gt; read_binary_file(const std::string &amp;file_name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::ifstream ifs(file_name, std::ios::binary);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.seekg(0, ifs.end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_t len = ifs.tellg();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;T&gt; vec(len / sizeof(T), 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.seekg(0, ifs.beg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.read(reinterpret_cast&lt;char *&gt;(vec.data()), len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return vec;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void read_binary_file(const char *file_name, char *buffer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::ifstream ifs(file_name, std::ios::binary);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.seekg(0, ifs.end);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_t len = ifs.tellg();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.seekg(0, ifs.beg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.read(buffer, len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ifs.close();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static std::vector&lt;std::string&gt; read_txt_file(const char *file_name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;std::string&gt; vec;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vec.reserve(1024);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::ifstream fp(file_name);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::string label;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while (getline(fp, label))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec.push_back(label);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return vec;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">template&lt;typename T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int softmax(const T* src, T* dst, int length)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const T alpha = *std::max_element(src, src + length);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    T denominator{ 0 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; length; ++i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dst[i] = std::exp(src[i] - alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        denominator += dst[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (int i = 0; i &lt; length; ++i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dst[i] /= denominator;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if USE_OPENCV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::vector&lt;uint8_t&gt; hwc2chw(cv::Mat &amp;img)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;uint8_t&gt; vec;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;cv::Mat&gt; rgbChannels(3);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv::split(img, rgbChannels);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (auto i = 0; i &lt; rgbChannels.size(); i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::vector&lt;uint8_t&gt; data = std::vector&lt;uint8_t&gt;(rgbChannels[i].reshape(1, 1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vec.insert(vec.end(), data.begin(), data.end());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return vec;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int inference(const char *kmodel_file, const char *image_file, const char *label_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // load kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interpreter interp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 从内存加载kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto kmodel = read_binary_file&lt;unsigned char&gt;(kmodel_file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interp.load_model({ (const gsl::byte *)kmodel.data(), kmodel.size() }).expect(&quot;cannot load kmodel.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 从文件流加载kmodel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::ifstream ifs(kmodel_file, std::ios::binary);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interp.load_model(ifs).expect(&quot;cannot load kmodel&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // create input tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto input_desc = interp.input_desc(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto input_shape = interp.input_shape(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto input_tensor = host_runtime_tensor::create(input_desc.datatype, input_shape, hrt::pool_shared).expect(&quot;cannot create input tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interp.input_tensor(0, input_tensor).expect(&quot;cannot set input tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // create output tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // auto output_desc = interp.output_desc(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // auto output_shape = interp.output_shape(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // auto output_tensor = host_runtime_tensor::create(output_desc.datatype, output_shape, hrt::pool_shared).expect(&quot;cannot create output tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // interp.output_tensor(0, output_tensor).expect(&quot;cannot set output tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // set input data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto dst = input_tensor.impl()-&gt;to_host().unwrap()-&gt;buffer().as_host().unwrap().map(map_access_::map_write).unwrap().buffer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#if USE_OPENCV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv::Mat img = cv::imread(image_file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv::resize(img, img, cv::Size(INTPUT_WIDTH, INTPUT_HEIGHT), cv::INTER_NEAREST);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto input_vec = hwc2chw(img);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    memcpy(reinterpret_cast&lt;char *&gt;(dst.data()), input_vec.data(), input_vec.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_binary_file(image_file, reinterpret_cast&lt;char *&gt;(dst.data()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hrt::sync(input_tensor, sync_op_t::sync_write_back, true).expect(&quot;sync write_back failed&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_t counter = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto start = std::chrono::steady_clock::now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (size_t c = 0; c &lt; counter; c++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interp.run().expect(&quot;error occurred in running model&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto stop = std::chrono::steady_clock::now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double duration = std::chrono::duration&lt;double, std::milli&gt;(stop - start).count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::cout &lt;&lt; &quot;interp.run() took: &quot; &lt;&lt; duration / counter &lt;&lt; &quot; ms&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // get output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto output_tensor = interp.output_tensor(0).expect(&quot;cannot set output tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dst = output_tensor.impl()-&gt;to_host().unwrap()-&gt;buffer().as_host().unwrap().map(map_access_::map_read).unwrap().buffer();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float *output_data = reinterpret_cast&lt;float *&gt;(dst.data());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto out_shape = interp.output_shape(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto size = compute_size(out_shape);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // postprogress softmax by cpu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;float&gt; softmax_vec(size, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto buf = softmax_vec.data();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    softmax(output_data, buf, size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto it = std::max_element(buf, buf + size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    size_t idx = it - buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // load label</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto labels = read_txt_file(label_file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::cout &lt;&lt; &quot;image classify result: &quot; &lt;&lt; labels[idx] &lt;&lt; &quot;(&quot; &lt;&lt; *it &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char *argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::cout &lt;&lt; &quot;case &quot; &lt;&lt; argv[0] &lt;&lt; &quot; built at &quot; &lt;&lt; __DATE__ &lt;&lt; &quot; &quot; &lt;&lt; __TIME__ &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (argc != 4)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::cerr &lt;&lt; &quot;Usage: &quot; &lt;&lt; argv[0] &lt;&lt; &quot; &lt;kmodel&gt; &lt;image&gt; &lt;label&gt;&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = inference(argv[1], argv[2], argv[3]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::cerr &lt;&lt; &quot;inference failed: ret = &quot; &lt;&lt; ret &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-ai2d-运行时apisc">5. AI2D 运行时APIs(C++)<a href="#5-ai2d-运行时apisc" class="hash-link" aria-label="Direct link to 5. AI2D 运行时APIs(C++)" title="Direct link to 5. AI2D 运行时APIs(C++)">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-简介">5.1 简介<a href="#51-简介" class="hash-link" aria-label="Direct link to 5.1 简介" title="Direct link to 5.1 简介">​</a></h3>
<p>AI2D运行时APIs用于在AI设备配置AI2D的参数，生成相关寄存器配置，执行AI2D计算等。请在使用前阅读最后一部分<a href="https://developer.canaan-creative.com/k230/zh/dev/01_software/board/ai/K230_nncase_%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97.html#id24" target="_blank" rel="noopener noreferrer">注意事项</a>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="511-支持的格式转换">5.1.1 支持的格式转换<a href="#511-支持的格式转换" class="hash-link" aria-label="Direct link to 5.1.1 支  持的格式转换" title="Direct link to 5.1.1 支持的格式转换">​</a></h4>
<table><thead><tr><th>输入格式</th><th>输出格式</th><th>备注</th></tr></thead><tbody><tr><td>YUV420_NV12</td><td>RGB_planar/YUV420_NV12</td><td></td></tr><tr><td>YUV420_NV21</td><td>RGB_planar/YUV420_NV21</td><td></td></tr><tr><td>YUV420_I420</td><td>RGB_planar/YUV420_I420</td><td></td></tr><tr><td>YUV400</td><td>YUV400</td><td></td></tr><tr><td>NCHW(RGB_planar)</td><td>NCHW(RGB_planar)</td><td></td></tr><tr><td>RGB_packed</td><td>RGB_planar/RGB_packed</td><td></td></tr><tr><td>RAW16</td><td>RAW16/8</td><td>深度图，执行shift操作</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="512-功能描述">5.1.2 功能描述<a href="#512-功能描述" class="hash-link" aria-label="Direct link to 5.1.2 功能描述" title="Direct link to 5.1.2 功能描述">​</a></h4>
<table><thead><tr><th>功能</th><th>描述</th><th>备注</th></tr></thead><tbody><tr><td>仿射变换</td><td>支持输入格式YUV420、YUV400、RGB（planar/packed） 支持深度图RAW16格式 支持输出格式YUV400、RGB、深度图</td><td></td></tr><tr><td>Crop/Resize/Padding</td><td>支持输入YUV420、YUV400、RGB 支持深度图RAW16格式 Resize支持中间NCHW的排列格式 支持输出格式YUV420、YUV400、RGB</td><td>只支持padding常数</td></tr><tr><td>Shift</td><td>支持输入格式Raw16 支持输出格式Raw8</td><td></td></tr><tr><td>符号位</td><td>支持有符号和无符号输入</td><td></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-apis">5.2 APIs<a href="#52-apis" class="hash-link" aria-label="Direct link to 5.2 APIs" title="Direct link to 5.2 APIs">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="521-ai2d_format">5.2.1 ai2d_format<a href="#521-ai2d_format" class="hash-link" aria-label="Direct link to 5.2.1 ai2d_format" title="Direct link to 5.2.1 ai2d_format">​</a></h4>
<p>【描述】</p>
<p>ai2d_format用于配置输入输出的可选数据格 式.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum class ai2d_format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    YUV420_NV12 = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    YUV420_NV21 = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    YUV420_I420 = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NCHW_FMT = 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RGB_packed = 4,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RAW16 = 5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="522-ai2d_interp_method">5.2.2 ai2d_interp_method<a href="#522-ai2d_interp_method" class="hash-link" aria-label="Direct link to 5.2.2 ai2d_interp_method" title="Direct link to 5.2.2 ai2d_interp_method">​</a></h4>
<p>【描述】</p>
<p>ai2d_interp_method用于配置可选的插值方式.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> enum class ai2d_interp_method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tf_nearest = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tf_bilinear = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2_nearest = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cv2_bilinear = 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="523-ai2d_interp_mode">5.2.3 ai2d_interp_mode<a href="#523-ai2d_interp_mode" class="hash-link" aria-label="Direct link to 5.2.3 ai2d_interp_mode" title="Direct link to 5.2.3 ai2d_interp_mode">​</a></h4>
<p>【描述】</p>
<p>ai2d_interp_mode 用于配置可选的插值模式.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum class ai2d_interp_mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    none = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    align_corner = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    half_pixel = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="524-ai2d_pad_mode">5.2.4 ai2d_pad_mode<a href="#524-ai2d_pad_mode" class="hash-link" aria-label="Direct link to 5.2.4 ai2d_pad_mode" title="Direct link to 5.2.4 ai2d_pad_mode">​</a></h4>
<p>【描述】</p>
<p>ai2d_pad_mode用于配置可选的padding 模式， 目前只支持常数padding.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum class ai2d_pad_mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    constant = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copy = 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mirror = 2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="525-ai2d_datatype_t">5.2.5 ai2d_datatype_t<a href="#525-ai2d_datatype_t" class="hash-link" aria-label="Direct link to 5.2.5 ai2d_datatype_t" title="Direct link to 5.2.5 ai2d_datatype_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_datatype_t 用于设置AI2D计算过程中的数据类型.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_datatype_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_format src_format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_format dst_format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datatype_t src_type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    datatype_t dst_type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_data_loc src_loc = ai2d_data_loc::ddr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_data_loc dst_loc = ai2d_data_loc::ddr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>src_format</td><td>ai2d_format</td><td>输入数据格式</td></tr><tr><td>dst_format</td><td>ai2d_format</td><td>输出数据格式</td></tr><tr><td>src_type</td><td>datatype_t</td><td>输入数据类型</td></tr><tr><td>dst_type</td><td>datatype_t</td><td>输出数据类型</td></tr><tr><td>src_loc</td><td>ai2d_data_loc</td><td>输入数据位置，默认ddr</td></tr><tr><td>dst_loc</td><td>ai2d_data_loc</td><td>输出数据位置，默认ddr</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_datatype_t ai2d_dtype { ai2d_format::RAW16, ai2d_format::NCHW_FMT, datatype_t::dt_uint16, datatype_t::dt_uint8 };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="526-ai2d_crop_param_t">5.2.6 ai2d_crop_param_t<a href="#526-ai2d_crop_param_t" class="hash-link" aria-label="Direct link to 5.2.6 ai2d_crop_param_t" title="Direct link to 5.2.6 ai2d_crop_param_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_crop_param_t用于配置crop相关的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_crop_param_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool crop_flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t start_x = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t start_y = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t width = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t height = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>crop_flag</td><td>bool</td><td>是否开启crop功能</td></tr><tr><td>start_x</td><td>int</td><td>宽度方向的起始像素</td></tr><tr><td>start_y</td><td>int</td><td>高度方向的起始像素</td></tr><tr><td>width</td><td>int</td><td>宽度方向的crop长度</td></tr><tr><td>height</td><td>int</td><td>高度方向的crop长度</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_crop_param_t crop_param { true, 40, 30, 400, 600 };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="527-ai2d_shift_param_t">5.2.7 ai2d_shift_param_t<a href="#527-ai2d_shift_param_t" class="hash-link" aria-label="Direct link to 5.2.7 ai2d_shift_param_t" title="Direct link to 5.2.7 ai2d_shift_param_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_shift_param_t用于配置shift相关的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_shift_param_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool shift_flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t shift_val = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>shift_flag</td><td>bool</td><td>是否开启shift功能</td></tr><tr><td>shift_val</td><td>int</td><td>右移的比特数</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_shift_param_t shift_param { true, 2 };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="528-ai2d_pad_param_t">5.2.8 ai2d_pad_param_t<a href="#528-ai2d_pad_param_t" class="hash-link" aria-label="Direct link to 5.2.8 ai2d_pad_param_t" title="Direct link to 5.2.8 ai2d_pad_param_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_pad_param_t 用于配置pad相关的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_pad_param_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool pad_flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runtime_paddings_t paddings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_pad_mode pad_mode = ai2d_pad_mode::constant;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;int32_t&gt; pad_val; // by channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>pad_flag</td><td>bool</td><td>是否开启pad功能</td></tr><tr><td>paddings</td><td>runtime_paddings_t</td><td>各个维度的padding, shape=<code>[4, 2]</code>，分别表示dim0到dim4的前后padding的个数，其中dim0/dim1固定配置<!-- -->0</td></tr><tr><td>pad_mode</td><td>ai2d_pad_mode</td><td>padding模式，只支持constant padding</td></tr><tr><td>pad_val</td><td><code>std::vector&lt;int32_t&gt;</code></td><td>每个channel的padding value</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_pad_param_t pad_param { false, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 60, 60 } }, ai2d_pad_mode::constant, { 255 } };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="529-ai2d_resize_param_t">5.2.9 ai2d_resize_param_t<a href="#529-ai2d_resize_param_t" class="hash-link" aria-label="Direct link to 5.2.9 ai2d_resize_param_t" title="Direct link to 5.2.9 ai2d_resize_param_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_resize_param_t 用于配置resize相关的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_resize_param_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool resize_flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_interp_method interp_method = ai2d_interp_method::tf_bilinear;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_interp_mode interp_mode = ai2d_interp_mode::none;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>resize_flag</td><td>bool</td><td>是否开启resize功能</td></tr><tr><td>interp_method</td><td>ai2d_interp_method</td><td>resize插值方法</td></tr><tr><td>interp_mode</td><td>ai2d_interp_mode</td><td>resize模式</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_resize_param_t resize_param { true, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5210-ai2d_affine_param_t">5.2.10 ai2d_affine_param_t<a href="#5210-ai2d_affine_param_t" class="hash-link" aria-label="Direct link to 5.2.10 ai2d_affine_param_t" title="Direct link to 5.2.10 ai2d_affine_param_t">​</a></h4>
<p>【描述】</p>
<p>ai2d_affine_param_t 用于配置affine相关的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct ai2d_affine_param_t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool affine_flag = false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_interp_method interp_method = ai2d_interp_method::cv2_bilinear;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t cord_round = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t bound_ind = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int32_t bound_val = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32_t bound_smooth = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::vector&lt;float&gt; M;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>affine_flag</td><td>bool</td><td>是否开启affine功能</td></tr><tr><td>interp_method</td><td>ai2d_interp_method</td><td>Affine采用的插值方法</td></tr><tr><td>cord_round</td><td>uint32_t</td><td>整数边界0或者1</td></tr><tr><td>bound_ind</td><td>uint32_t</td><td>边界像素模式0或者1</td></tr><tr><td>bound_val</td><td>uint32_t</td><td>边界填充值</td></tr><tr><td>bound_smooth</td><td>uint32_t</td><td>边界平滑0或者1</td></tr><tr><td>M</td><td><code>std::vector&lt;float&gt;</code></td><td>仿射变换矩阵对应的vector，仿射变换为$<code>Y=[a_0, a_1; a_2, a_3] \cdot X + [b_0, b_1] $, 则 $ M={a_0,a_1,b_0,a_2,a_3,b_1} </code>$</td></tr></tbody></table>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_affine_param_t affine_param { true, ai2d_interp_method::cv2_bilinear, 0, 0, 127, 1, { 0.5, 0.1, 0.0, 0.1, 0.5, 0.0 } };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5211-ai2d_builder-ai2d_builder">5.2.11 ai2d_builder:: ai2d_builder<a href="#5211-ai2d_builder-ai2d_builder" class="hash-link" aria-label="Direct link to 5.2.11 ai2d_builder:: ai2d_builder" title="Direct link to 5.2.11 ai2d_builder:: ai2d_builder">​</a></h4>
<p>【描述】</p>
<p>ai2d_builder的构造函数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_builder(dims_t &amp;input_shape, dims_t &amp;output_shape, ai2d_datatype_t ai2d_dtype, ai2d_crop_param_t crop_param, ai2d_shift_param_t shift_param, ai2d_pad_param_t pad_param, ai2d_resize_param_t resize_param, ai2d_affine_param_t affine_param);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>input_shape</td><td>dims_t</td><td>输入形状</td></tr><tr><td>output_shape</td><td>dims_t</td><td>输出形状</td></tr><tr><td>ai2d_dtype</td><td>ai2d_datatype_t</td><td>ai2d数据类型</td></tr><tr><td>crop_param</td><td>ai2d_crop_param_t</td><td>crop相关参数</td></tr><tr><td>shift_param</td><td>ai2d_shift_param_t</td><td>shift相关参数</td></tr><tr><td>pad_param</td><td>ai2d_pad_param_t</td><td>pad相关参数</td></tr><tr><td>resize_param</td><td>ai2d_resize_param_t</td><td>resize相关参数</td></tr><tr><td>affine_param</td><td>ai2d_affine_param_t</td><td>affine相关参数</td></tr></tbody></table>
<p>【返回值 】</p>
<p>无</p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dims_t in_shape { 1, ai2d_input_c_, ai2d_input_h_, ai2d_input_w_ };          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">auto out_span = ai2d_out_tensor_.shape();                                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dims_t out_shape { out_span.begin(), out_span.end() };                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_datatype_t ai2d_dtype { ai2d_format::NCHW_FMT, ai2d_format::NCHW_FMT, typecode_t::dt_uint8, typecode_t::dt_uint8 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_crop_param_t crop_param { false, 0, 0, 0, 0 };                          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_shift_param_t shift_param { false, 0 };                                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_pad_param_t pad_param { true, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 70, 70 } }, ai2d_pad_mode::constant, { 0, 0, 0 } };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_resize_param_t resize_param { true, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_affine_param_t affine_param { false };                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_builder_.reset(new ai2d_builder(in_shape, out_shape, ai2d_dtype, crop_param, shift_param, pad_param, resize_param, affine_param));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5212-ai2d_builder-build_schedule">5.2.12 ai2d_builder:: build_schedule<a href="#5212-ai2d_builder-build_schedule" class="hash-link" aria-label="Direct link to 5.2.12 ai2d_builder:: build_schedule" title="Direct link to 5.2.12 ai2d_builder:: build_schedule">​</a></h4>
<p>【描述】</p>
<p>生成AI2D计算需要的参数.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt; build_schedule();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<p>无</p>
<p>【返回值】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_builder_-&gt;build_schedule();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5213-ai2d_builder-invoke">5.2.13 ai2d_builder:: invoke<a href="#5213-ai2d_builder-invoke" class="hash-link" aria-label="Direct link to 5.2.13 ai2d_builder:: invoke" title="Direct link to 5.2.13 ai2d_builder:: invoke">​</a></h4>
<p>【描述】</p>
<p>配置寄存器并启动AI2D的计算.</p>
<p>【定义】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">result&lt;void&gt; invoke(runtime_tensor &amp;input, runtime_tensor &amp;output);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>名称</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>input</td><td>runtime_tensor</td><td>输入tensor</td></tr><tr><td>output</td><td>runtime_tensor</td><td>输出tensor</td></tr></tbody></table>
<p>【返回值 】</p>
<p><code>result&lt;void&gt;</code></p>
<p>【示例】</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// run ai2d                                                                  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai2d_builder_-&gt;invoke(ai2d_in_tensor, ai2d_out_tensor_).expect(&quot;error occurred in ai2d running&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-示例">5.3 示例<a href="#53-示例" class="hash-link" aria-label="Direct link to 5.3 示例" title="Direct link to 5.3 示例">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static void test_pad_mini_test(const char *gmodel_file, const char *expect_file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // input tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dims_t in_shape { 1, 100, 150, 3 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto in_tensor = host_runtime_tensor::create(dt_uint8, in_shape, hrt::pool_shared).expect(&quot;cannot create input tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto mapped_in_buf = std::move(hrt::map(in_tensor, map_access_t::map_write).unwrap());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    read_binary_file(gmodel_file, reinterpret_cast&lt;char *&gt;(mapped_in_buf.buffer().data()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapped_in_buf.unmap().expect(&quot;unmap input tensor failed&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hrt::sync(in_tensor, sync_op_t::sync_write_back, true).expect(&quot;write back input failed&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // output tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dims_t out_shape { 1, 100, 160, 3 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto out_tensor = host_runtime_tensor::create(dt_uint8, out_shape, hrt::pool_shared).expect(&quot;cannot create output tensor&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // config ai2d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_datatype_t ai2d_dtype { ai2d_format::RGB_packed, ai2d_format::RGB_packed, dt_uint8, dt_uint8 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_crop_param_t crop_param { false, 0, 0, 0, 0 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_shift_param_t shift_param { false, 0 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_pad_param_t pad_param { true, { { 0, 0 }, { 0, 0 }, { 0, 0 }, { 10, 0 } }, ai2d_pad_mode::constant, { 255, 10, 5 } };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_resize_param_t resize_param { false, ai2d_interp_method::tf_bilinear, ai2d_interp_mode::half_pixel };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_affine_param_t affine_param { false };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // run</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai2d_builder builder { in_shape, out_shape, ai2d_dtype, crop_param, shift_param, pad_param, resize_param, affine_param };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto start = std::chrono::steady_clock::now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.build_schedule().expect(&quot;error occurred in ai2d build_schedule&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    builder.invoke(in_tensor, out_tensor).expect(&quot;error occurred in ai2d invoke&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto stop = std::chrono::steady_clock::now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    double duration = std::chrono::duration&lt;double, std::milli&gt;(stop - start).count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std::cout &lt;&lt; &quot;ai2d run: duration = &quot; &lt;&lt; duration &lt;&lt; &quot; ms, fps = &quot; &lt;&lt; 1000 / duration &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // compare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto mapped_out_buf = std::move(hrt::map(out_tensor, map_access_t::map_read).unwrap());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto actual = mapped_out_buf.buffer().data();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto expected = read_binary_file&lt;unsigned char&gt;(expect_file);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = memcmp(reinterpret_cast&lt;void *&gt;(actual), reinterpret_cast&lt;void *&gt;(expected.data()), expected.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!ret)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::cout &lt;&lt; &quot;compare output succeed!&quot; &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        auto cos = cosine(reinterpret_cast&lt;const uint8_t *&gt;(actual), reinterpret_cast&lt;const uint8_t *&gt;(expected.data()), expected.size());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::cerr &lt;&lt; &quot;compare output failed: cosine similarity = &quot; &lt;&lt; cos &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-注意事项">5.4 注意事项<a href="#54-注意事项" class="hash-link" aria-label="Direct link to 5.4 注意事项" title="Direct link to 5.4 注意事项">​</a></h3>
<ol>
<li>Affine和Resize功能是互斥的，不能同时开启</li>
<li>Shift功能的输入格式只能是Raw16</li>
<li>Pad value是按通道配置的，对应的list元素个数要与channel数相等</li>
<li>当前版本中，当只需要AI2D的一个功能时，其他参数也需要配置，flag置为false即可，其他字段不用配置。</li>
<li>当配置了多个功能时，执行顺序是Crop-&gt;Shift-&gt;Resize/Affine-&gt;Pad, 配置参数时注意要匹配。</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part6/15_K230nncaseDeveloperGuide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CanaanK230/part6/K230SDKIoTWiFiAiW4211LV10DriverDevelopmentGuide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">K230 SDK IoT WiFi AiW4211LV10驱动开发指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CanaanK230/part6/K230SteckupdatedtheEncasRuntimeLibraryGuide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">K230 SDK 更新nncase运行时库指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-概述" class="table-of-contents__link toc-highlight">1. 概述</a><ul><li><a href="#11-什么是nncase" class="table-of-contents__link toc-highlight">1.1 什么是nncase</a></li><li><a href="#12-nncase架构" class="table-of-contents__link toc-highlight">1.2 nncase架构</a></li><li><a href="#13-开发环境" class="table-of-contents__link toc-highlight">1.3 开发环境</a></li></ul></li><li><a href="#2-编译模型apispython" class="table-of-contents__link toc-highlight">2. 编译模型APIs(Python)</a><ul><li><a href="#21-支持的算子" class="table-of-contents__link toc-highlight">2.1 支持的算子</a></li><li><a href="#22-apis" class="table-of-contents__link toc-highlight">2.2 APIs</a></li><li><a href="#23-示例" class="table-of-contents__link toc-highlight">2.3 示例</a></li></ul></li><li><a href="#3-模拟器apispython" class="table-of-contents__link toc-highlight">3. 模拟器APIs(Python)</a><ul><li><a href="#31-apis" class="table-of-contents__link toc-highlight">3.1 APIs</a></li><li><a href="#32-示例" class="table-of-contents__link toc-highlight">3.2 示例</a></li></ul></li><li><a href="#4-kpu运行时apisc" class="table-of-contents__link toc-highlight">4. KPU运行时APIs(C++)</a><ul><li><a href="#41-简介" class="table-of-contents__link toc-highlight">4.1 简介</a></li><li><a href="#42-apis" class="table-of-contents__link toc-highlight">4.2 APIs</a></li><li><a href="#43-示例" class="table-of-contents__link toc-highlight">4.3 示例</a></li></ul></li><li><a href="#5-ai2d-运行时apisc" class="table-of-contents__link toc-highlight">5. AI2D 运行时APIs(C++)</a><ul><li><a href="#51-简介" class="table-of-contents__link toc-highlight">5.1 简介</a></li><li><a href="#52-apis" class="table-of-contents__link toc-highlight">5.2 APIs</a></li><li><a href="#53-示例" class="table-of-contents__link toc-highlight">5.3 示例</a></li><li><a href="#54-注意事项" class="table-of-contents__link toc-highlight">5.4 注意事项</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>