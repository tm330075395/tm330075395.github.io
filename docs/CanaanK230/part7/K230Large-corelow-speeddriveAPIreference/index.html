<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-CanaanK230/part7/K230Large-corelow-speeddriveAPIreference" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">K230大核低速驱动API参考 | 正点原子</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://tm330075395.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://tm330075395.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://tm330075395.github.io/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="K230大核低速驱动API参考 | 正点原子"><meta data-rh="true" name="description" content="1 概述"><meta data-rh="true" property="og:description" content="1 概述"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tm330075395.github.io/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference"><link data-rh="true" rel="alternate" href="https://tm330075395.github.io/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference" hreflang="en"><link data-rh="true" rel="alternate" href="https://tm330075395.github.io/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="正点原子 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="正点原子 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.ce37c9a8.css">
<script src="/assets/js/runtime~main.fcaa3de9.js" defer="defer"></script>
<script src="/assets/js/main.252b8acf.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a class="navbar__item navbar__link" href="/docs/intro">Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/CanaanK230/Userdoc">CanMV-K230教程</a><a href="http://www.alientek.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">正点原子官网<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="http://www.openedv.com/forum.php" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">论坛<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/tm330075395/tm330075395.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CanaanK230/Userdoc">文档阅读指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/1开发板上手指南-1">1.开发板上手指南</a><button aria-label="Expand sidebar category &#x27;1.开发板上手指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/2开发环境搭建指南-1">2.开发环境搭建指南</a><button aria-label="Expand sidebar category &#x27;2.开发环境搭建指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/3嵌入式应用开发指南-1">3.嵌入式应用开发指南</a><button aria-label="Expand sidebar category &#x27;3.嵌入式应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/4ai应用开发指南-1">4.AI应用开发指南</a><button aria-label="Expand sidebar category &#x27;4.AI应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/5micropython应用开发指南-1">5.MicroPython应用开发指南</a><button aria-label="Expand sidebar category &#x27;5.MicroPython应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/6系统开发指南-1">6.系统开发指南</a><button aria-label="Expand sidebar category &#x27;6.系统开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/7sdk-api参考指南-1">7.SDK API参考指南</a><button aria-label="Collapse sidebar category &#x27;7.SDK API参考指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230Inter-corecommunicationAPIreference">K230核间通讯API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230ThesystemcontrolstheMAPIreference">K230系统控制MAPI参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230MultimediaMiddlewareAPIReference">K230 中间件API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230DMAAPIreference">K230 DMA API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230DPUAPIreference">K230 DPU API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230FFTAPIreference">K230 FFT API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230GPUAPIreference">K230 GPU API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230SHA256APIreference">K230 SHA256 API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230VICAPAPIreference">K230 VICAP API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230VICAPSENSORParameterpartitionreference">K230 VICAP SENSOR 参数分区参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230systemcontrolAPIreference">K230系统控制API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230VideocodecAPIreference">K230视频编解码API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230VideooutputAPIreference">K230视频输出API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230AudioAPIreference">K230音频API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230DRMUserGuide">K230 DRM使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/CanaanK230/part7/K230Large-corelow-speeddriveAPIreference">K230大核低速驱动API参考</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/CanaanK230/part7/K230ReferenceAPIsmall-coreLinuxdrivers">K230小核Linux驱动API参考</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/8常见问题-1">8.常见问题</a><button aria-label="Expand sidebar category &#x27;8.常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/7sdk-api参考指南-1"><span itemprop="name">7.SDK API参考指南</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">K230大核低速驱动API参考</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>K230大核低速驱动API参考</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-概述">1 概述<a href="#1-概述" class="hash-link" aria-label="Direct link to 1 概述" title="Direct link to 1 概述">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-概述">1.1 概述<a href="#11-概述" class="hash-link" aria-label="Direct link to 1.1 概述" title="Direct link to 1.1 概述">​</a></h3>
<p>UART：</p>
<p>通用异步收发器，该总线双向通信，可以实现全双工传输和接收。在嵌入式设计中，UART用来与PC进行通信，包括与监控调试器和其它器件，如EEPROM通信。</p>
<p>I2C：</p>
<p>由Philips公司（2006年迁移到NXP）在1980年代初开发的一种简单、双线双向的同步串行总线，它利用一根时钟线和一根数据线在连接总线的两个器件之间进行信息的传递，为设备之间数据交换提供了一种简单高效的方法。每个连接到总线上的器件都有唯一的地址，任何器件既可以作为主机也可以作为从机，但同一时刻只允许有一个主机。</p>
<p>GPIO：</p>
<p>（general porpose intput output）通用输入输出端口的简称。可以通过软件控制其输出和输入，通俗来说就是常用引脚，可以控制引脚的高低电平，对其进行读取或者写入。</p>
<p>Hard-lock：</p>
<p>嘉楠自研模块，用于同核不通进程间或异核之间对共享资源的互斥而实现的硬件互斥锁，可用于对共享资源的互斥使用。</p>
<p>ADC：</p>
<p>ADC 即模拟数字转换器（Analog-to-digital converter），是指将连续变化的模拟信号转换为离散的数字信号的器件。真实世界的模拟信号，例如温度、压力、声音或者图像等，需要转换成更容易储存、处理和发射的数字形式。模数转换器可以实现这个功能，在各种不同的产品中都可以找到它的身影。</p>
<p>WDT：
WDT 是watchdog的简称，本质上是一个定时器，软件程序需要每隔一段时间喂一次狗，如果WDT超时则可以产生一个中断信号或复位信号到CPU，由此通过软硬件结合的方式防止程序运行异常而不复位。</p>
<p>OTP：
OTP 主要用于存储安全敏感的机密信息，例如 bootrom 的固件信息、加解密密钥、签名信息以及用户自己定义的安全信息等。OTP 集成在安全模块 PUF 中，为整个 SoC 提供安全存储功能，保护根密钥和启动代码等关键数据不被攻击者破坏。大核侧 OTP 驱动主要提供读、写两种功能，可读区域为包括生产信息在内的 24Kbits 空间；写区域为 OTP 的最后 512 bytes 空间。</p>
<p>TS：
K230 TS（Temperature Sensor），自研温度传感器，采用 TSMC 12nm 工艺。TS 的应用场景是降频。大核侧 TS 驱动主要提供读功能，在读 TS 之前，首先需要配置 TS 寄存器使能信号、输出模式，然后才能读出芯片的结温。另外，TS 寄存器每 2.6s 读取一次芯片结温。</p>
<p>PWM：是一种对模拟信号电平进行数字编码的方法，通过不同频率的脉冲使用方波的占空比用来对一个具体模拟信号的电平进行编码，使输出端得到一系列幅值相等的脉冲，用这些脉冲来代替所需要波形的设备。</p>
<p>RTC：实时时钟可以提供精确的实时时间，它可以用于产生年、月、日、时、分、秒、星期等信息。</p>
<p>TIMER(HWTIMER)：通过内部计数器模块对内外部脉冲信号进行计数，可以工作在定时器模式和计数器模式。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-功能描述">1.2 功能描述<a href="#12-功能描述" class="hash-link" aria-label="Direct link to 1.2 功能描述" title="Direct link to 1.2 功能描述">​</a></h3>
<p>UART驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="图形用户界面 描述已自动生成" src="/assets/images/4c13711677925f891f88c5f3451b1630-4aadbdf27b90dc46ac894bc3c1d6fbb9.png" width="1091" height="353" class="img_ev3q"></p>
<p>I2C驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="图形用户界面, Teams 描述已自动生成" src="/assets/images/d57457f620fd3083c6a6da9f4da78a1e-b835061dd446efc690db1c4b519a69b0.png" width="1009" height="528" class="img_ev3q"></p>
<p>GPIO驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="图形用户界面, 应用程序 描述已自动生成" src="/assets/images/56a2648fb35340c3f3ab275da91b1247-c9cfb0bc99275c1e4524112700d3ad01.png" width="978" height="596" class="img_ev3q"></p>
<p>Hard-lock驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="图片包含 应用程序 描述已自动生成" src="/assets/images/8dab3c90fd04037c474ffe4dcb6ebcad-ae0a32ad30c4b194b2e7b6e2d80eb5f9.png" width="737" height="929" class="img_ev3q"></p>
<p>adc 驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="图示 描述已自动生成" src="/assets/images/fd9ce5570d02a5a3248c036db4bf4ca2-b533887afc77b5e36182168b3e64ee5d.png" width="602" height="1082" class="img_ev3q"></p>
<p>将 adc 硬件抽象为一个设备，设备包含六个通道。支持采样电压范围为 0V~1.8V，浮动范围为 5mv。</p>
<p>WDT 驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="wdt_driver_model" src="/assets/images/wdt_driver_model-e5b0e3b5dd0660310fa546a78512e92d.png" width="1331" height="251" class="img_ev3q"></p>
<p>OTP 驱动结构如下图：</p>
<p><img decoding="async" loading="lazy" alt="otp" src="/assets/images/otp_rtt-374bc315a4b18c4090c7483eb9af9855.png" width="2426" height="2259" class="img_ev3q"></p>
<p>TS 驱动结构如下图所示：</p>
<p><img decoding="async" loading="lazy" alt="tsensor" src="/assets/images/ts_rtt-c9ce87b9b5001cd06e048d1cc747d5db.png" width="2426" height="2259" class="img_ev3q"></p>
<p>PWM 驱动结构如下图所示：</p>
<p><img decoding="async" loading="lazy" alt="pwm" src="/assets/images/pwm-driver-9ff9d0545436236aa15e893d7c16eed8.png" width="921" height="587" class="img_ev3q"></p>
<p>RTC 驱动结构如下图所示：</p>
<p><img decoding="async" loading="lazy" alt="rtc" src="/assets/images/rtc-driver-bd61afcf3d28a4dda9bc306532c03db8.png" width="1001" height="241" class="img_ev3q"></p>
<p>TIMER 驱动结构如下图所示：</p>
<p><img decoding="async" loading="lazy" alt="timer" src="/assets/images/timer-driver-b07e3b6a554878e4321703144b70109c.png" width="1071" height="341" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-驱动api使用方法">1.3 驱动API使用方法<a href="#13-驱动api使用方法" class="hash-link" aria-label="Direct link to 1.3 驱动API使用方法" title="Direct link to 1.3 驱动API使用方法">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="131-uart">1.3.1 UART<a href="#131-uart" class="hash-link" aria-label="Direct link to 1.3.1 UART" title="Direct link to 1.3.1 UART">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="内核态程序使用uart">内核态程序使用uart<a href="#内核态程序使用uart" class="hash-link" aria-label="Direct link to 内核态程序使用uart" title="Direct link to 内核态程序使用uart">​</a></h5>
<ol>
<li>通过设备节点找到设备句柄。</li>
</ol>
<p><code>uart_dev = rt_device_find(“uart”)</code></p>
<ol>
<li>以中断接收及轮询发送模式打开串口设备</li>
</ol>
<p><code>rt_device_open(uart_dev, RT_DEVICE_FLAG_INT_RX)</code></p>
<ol>
<li>设置接收回调函数</li>
</ol>
<p><code>rt_device_set_rx_indicate(uart_dev,call_back)</code></p>
<ol>
<li>发送字符串</li>
</ol>
<p><code>rt_device_write(uart_dev, 0, str, (sizeof(str) - 1))</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="132-i2c">1.3.2 I2C<a href="#132-i2c" class="hash-link" aria-label="Direct link to 1.3.2 I2C" title="Direct link to 1.3.2 I2C">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="内核态程序使用i2c">内核态程序使用i2c<a href="#内核态程序使用i2c" class="hash-link" aria-label="Direct link to 内核态程序使用i2c" title="Direct link to 内核态程序使用i2c">​</a></h5>
<ol>
<li>通过总线名找到总线句柄</li>
</ol>
<p><code>i2c_bus = rt_i2c_bus_device_find(I2C_NAME)</code></p>
<ol>
<li>构建message</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct rt_i2c_msg msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgs.addr = CHIP_ADDRESS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgs.flags = RT_I2C_WR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgs.buf = buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msgs.len = 2;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>传输</li>
</ol>
<p><code>rt_i2c_transfer(bus, &amp;msgs, 1)</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="133-gpio">1.3.3 GPIO<a href="#133-gpio" class="hash-link" aria-label="Direct link to 1.3.3 GPIO" title="Direct link to 1.3.3 GPIO">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="内核态程序使用gpio">内核态程序使用gpio<a href="#内核态程序使用gpio" class="hash-link" aria-label="Direct link to 内核态程序使用gpio" title="Direct link to 内核态程序使用gpio">​</a></h5>
<ol>
<li>包含头文件</li>
</ol>
<p><code>#include &quot;drv_gpio.h&quot;</code></p>
<ol>
<li>设置关键输入输出模式</li>
</ol>
<p><code>kd_pin_mode(LED_PIN_NUM1, GPIO_DM_OUTPUT)</code>
<code>kd_pin_mode(KEY1_PIN_NUM, GPIO_DM_INPUT)</code></p>
<ol>
<li>设置高低电平</li>
</ol>
<p><code>kd_pin_write(LED_PIN_NUM1, GPIO_PV_LOW)</code>
<code>kd_pin_write(LED_PIN_NUM1, GPIO_PV_HIGH)</code></p>
<ol>
<li>读取电平</li>
</ol>
<p><code>kd_pin_read(KEY1_PIN_NUM)</code></p>
<ol>
<li>设置中断方式，绑定中断函数</li>
</ol>
<p><code>kd_pin_attach_irq(KEY1_PIN_NUM,GPIO_PE_FALLING, key_irq, RT_NULL)</code></p>
<ol>
<li>中断使能</li>
</ol>
<p><code>kd_pin_irq_enable(KEY1_PIN_NUM, KD_GPIO_IRQ_ENABLE)</code></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="用户态程序使用gpio仅读写">用户态程序使用gpio(仅读写)<a href="#用户态程序使用gpio仅读写" class="hash-link" aria-label="Direct link to 用户态程序使用gpio(仅读写)" title="Direct link to 用户态程序使用gpio(仅读写)">​</a></h5>
<ol>
<li>打开设备</li>
</ol>
<p><code>gpio_fd = open(&quot;/dev/gpio&quot;, O_RDWR)</code></p>
<ol>
<li>配置输入输出模式</li>
</ol>
<p><code>ioctl(fd, GPIO_DM_OUTPUT, &amp;mode33)</code></p>
<ol>
<li>输出高低电平</li>
</ol>
<p><code>ioctl(fd, GPIO_WRITE_HIGH, &amp;mode33)</code></p>
<ol>
<li>读取电平</li>
</ol>
<p><code>ioctl(fd, GPIO_READ_VALUE, &amp;mode27)</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="134-hard-lock">1.3.4 Hard-lock<a href="#134-hard-lock" class="hash-link" aria-label="Direct link to 1.3.4 Hard-lock" title="Direct link to 1.3.4 Hard-lock">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="内核态使用hard-lock">内核态使用hard-lock<a href="#内核态使用hard-lock" class="hash-link" aria-label="Direct link to 内核态使用hard-lock" title="Direct link to 内核态使用hard-lock">​</a></h5>
<ol>
<li>包含头文件</li>
</ol>
<p><code>#include &quot;drv_hardlock.h&quot;</code></p>
<ol>
<li>申请使用锁</li>
</ol>
<p><code>kd_request_lock(rt_uint32_t num)</code></p>
<ol>
<li>释放锁</li>
</ol>
<p><code>kd_hardlock_unlock(rt_uint32_t num)</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="135-adc">1.3.5 ADC<a href="#135-adc" class="hash-link" aria-label="Direct link to 1.3.5 ADC" title="Direct link to 1.3.5 ADC">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1351-用户态-msh-使用-adc">1.3.5.1 用户态 msh 使用 adc<a href="#1351-用户态-msh-使用-adc" class="hash-link" aria-label="Direct link to 1.3.5.1 用户态 msh 使用 adc" title="Direct link to 1.3.5.1 用户态 msh 使用 adc">​</a></h5>
<p>用户通过 msh 来获取 adc 采样值的步骤如下：</p>
<ol>
<li>在使用设备前，需要先查找设备是否存在，可以使用命令 adc probe 后面跟注册的 ADC 设备的名称。如下所示；</li>
</ol>
<p><code>msh /&gt;adc probe adc</code>
<code>probe adc success</code></p>
<ol>
<li>使能设备的某个通道可以使用命令 adc enable 后面跟通道号；</li>
</ol>
<p><code>msh /&gt;adc enable 0</code>
<code>adc channel 0 enables success</code></p>
<ol>
<li>读取 ADC 设备某个通道的数据可以使用命令 adc read 后面跟通道号；</li>
</ol>
<p><code>msh /&gt;adc read 0</code>
<code>adc channel 0 read value is 0x00000796</code></p>
<ol>
<li>关闭设备的某个通道可以使用命令 adc enable 后面跟通道号；</li>
</ol>
<p><code>msh /&gt;adc disable 0</code>
<code>adc channel 0 disable success</code></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1352-用户态程序使用-adc">1.3.5.2 用户态程序使用 adc<a href="#1352-用户态程序使用-adc" class="hash-link" aria-label="Direct link to 1.3.5.2 用户态程序使用 adc" title="Direct link to 1.3.5.2 用户态程序使用 adc">​</a></h5>
<p>用户态程序中获取 adc 采样值的步骤如下：</p>
<ol>
<li>rt_device_find 查找 adc 设备。如下所示：</li>
</ol>
<p><code>rt_device_t adc_dev;</code>
<code>adc_dev = rt_device_find(&quot;adc&quot;);</code></p>
<ol>
<li>通过设备句柄打开 adc 设备。如下所示：</li>
</ol>
<p><code>ret = rt_device_open(adc_dev, RT_DEVICE_OFLAG_RDWR);</code></p>
<ol>
<li>通过设备句柄使能 adc 设备的某个通道。如下所示：</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t *p;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t channel = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p = (uint32_t *)(intptr_t)channel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret = rt_device_control(adc_dev, 0, (void *)p);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>通过设备句柄从 adc 读取数据。如下所示：</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t channel = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t reg_value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_device_read(adc_dev, channel, (void *)&amp;reg_value, sizeof(unsigned int));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol>
<li>当不再使用 adc 的某个通道时，通过设备句柄失能 adc 设备的某个通道；</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t *p;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint32_t channel = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p = (uint32_t *)(intptr_t)channel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret = rt_device_control(adc_dev, 0, (void *)p);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1353-内核态程序使用-adc">1.3.5.3 内核态程序使用 adc<a href="#1353-内核态程序使用-adc" class="hash-link" aria-label="Direct link to 1.3.5.3 内核态程序使用 adc" title="Direct link to 1.3.5.3 内核态程序使用 adc">​</a></h5>
<ol>
<li>查找 adc 设备</li>
</ol>
<p>应用程序根据 adc 设备名称获取设备句柄，进而可以操作 adc 设备，查找设备函数如下所示：</p>
<p><code>rt_device_t rt_device_find(const char* name);</code></p>
<ol>
<li>使能 adc 通道</li>
</ol>
<p><code>rt_err_t rt_adc_enable(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<ol>
<li>读取 adc 通道采样值</li>
</ol>
<p><code>rt_uint32_t rt_adc_read(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<ol>
<li>关闭 adc 通道</li>
</ol>
<p><code>rt_err_t rt_adc_disable(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="136-wdt">1.3.6 WDT<a href="#136-wdt" class="hash-link" aria-label="Direct link to 1.3.6 WDT" title="Direct link to 1.3.6 WDT">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1361-用户态程序使用wdt">1.3.6.1 用户态程序使用WDT<a href="#1361-用户态程序使用wdt" class="hash-link" aria-label="Direct link to 1.3.6.1 用户态程序使用WDT" title="Direct link to 1.3.6.1 用户态程序使用WDT">​</a></h5>
<ol>
<li>打开设备节点</li>
</ol>
<p><code>open(WDT_DEVICE_NAME, O_RDWR);</code></p>
<ol>
<li>设置超时时间</li>
</ol>
<p><code>ioctl(wdt_fd, CTRL_WDT_SET_TIMEOUT, &amp;timeout);</code></p>
<ol>
<li>启动看门狗计时</li>
</ol>
<p><code>ioctl(wdt_fd, CTRL_WDT_START, NULL);</code></p>
<ol>
<li>喂狗</li>
</ol>
<p><code>ioctl(wdt_fd, CTRL_WDT_KEEPALIVE, NULL)</code></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1362-内核态程序使用wdt">1.3.6.2 内核态程序使用WDT<a href="#1362-内核态程序使用wdt" class="hash-link" aria-label="Direct link to 1.3.6.2 内核态程序使用WDT" title="Direct link to 1.3.6.2 内核态程序使用WDT">​</a></h5>
<ol>
<li>获取设备句柄</li>
</ol>
<p><code>wdt_dev = rt_device_find(WDT_DEVICE_NAME);</code></p>
<ol>
<li>初始化设备</li>
</ol>
<p><code>rt_device_init(wdt_dev);</code></p>
<ol>
<li>设置超时时间</li>
</ol>
<p><code>rt_device_control(wdt_dev, KD_DEVICE_CTRL_WDT_SET_TIMEOUT, &amp;timeout);</code></p>
<ol>
<li>启动看门狗计时</li>
</ol>
<p><code>rt_device_control(wdt_dev, KD_DEVICE_CTRL_WDT_START, RT_NULL);</code></p>
<ol>
<li>喂狗</li>
</ol>
<p><code>rt_device_control(wdt_dev, KD_DEVICE_CTRL_WDT_KEEPALIVE, RT_NULL);</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="137-otp">1.3.7 OTP<a href="#137-otp" class="hash-link" aria-label="Direct link to 1.3.7 OTP" title="Direct link to 1.3.7 OTP">​</a></h4>
<p>大核侧 OTP 驱动可以支持被内核态其它驱动调用、用户态应用程序调用等场景，下面，将分别介绍这两种应用场景下 OTP 驱动的使用方法、注意事项。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1371-用户态程序使用-otp">1.3.7.1 用户态程序使用 OTP<a href="#1371-用户态程序使用-otp" class="hash-link" aria-label="Direct link to 1.3.7.1 用户态程序使用 OTP" title="Direct link to 1.3.7.1 用户态程序 使用 OTP">​</a></h5>
<p>在 rt-smart 中，应用程序通过 I/O 设备管理接口来访问硬件设备，当实现对应的设备驱动之后，应用程序就可以访问该硬件。Rt-smart 用户层通过操作 <code>/dev/otp</code> 来访问 OTP 硬件，用户态应用程序使用 OTP 时，可以通过 open、read、write 等操作来访问 otp 设备。用户态应用程序使用 OTP 的具体操作如下：</p>
<ol>
<li>添加头文件 <code>rtdevice.h</code>；</li>
<li>应用程序根据设备名称获取设备句柄；</li>
<li>获得设备句柄之后，应用程序可以打开设备；</li>
<li>初始化参数，包括偏移量、缓冲区、大小；</li>
<li>通过设备句柄和参数值从 OTP 设备中读取/写入数据；</li>
<li>利用设备句柄关闭设备。</li>
</ol>
<p>其中，snippet 代码如下所示：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;rtdevice.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;rtthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 查找设备，获取句柄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">otp_dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“otp”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  打开设备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_OFLAG_RDWR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 初始化读参数并从OTP空间读值，参数分别代表读取OTP的偏移量、要读取的字节长度、缓冲区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain">  size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xC00</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">768</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 初始化写参数并写入OTP空间，参数分别代表写入OTP的偏移量、写入的字节长度、要写入的值</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xff11ff11</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 关闭设备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rt_device_close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1372-内核态程序使用-otp">1.3.7.2 内核态程序使用 OTP<a href="#1372-内核态程序使用-otp" class="hash-link" aria-label="Direct link to 1.3.7.2 内核态程序使用 OTP" title="Direct link to 1.3.7.2 内核态程序使用 OTP">​</a></h5>
<p>在rt-smart中，内核态其它驱动程序想要读写 OTP 空间时，只需要调用 OTP 驱动提供的接口即可。具体的步骤如下所示：</p>
<ol>
<li>添加头文件 <code>drv_otp.h</code>；</li>
<li>根据设备名称获取设备句柄；</li>
<li>初始化参数，包括偏移量、缓冲区、大小；</li>
<li>通过设备句柄和参数值从 OTP 设备中读取/写入数据；<!-- -->
<ul>
<li>otp_device_read</li>
<li>otp_device_write</li>
</ul>
</li>
</ol>
<p>其中，snippet 代码如下所示：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">drv_otp</span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 获取句柄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">otp_dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“otp”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 从(otp_read_base + 0x0)地址处读取0xC00字节的数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain">  size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xC00</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">768</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">otp_device_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buf</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 向(otp_write_base + 0x0)地址处写 0xff11ff11</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x4</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xff11ff11</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">otp_device_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">otp_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1373-注意事项">1.3.7.3 注意事项<a href="#1373-注意事项" class="hash-link" aria-label="Direct link to 1.3.7.3 注意事项" title="Direct link to 1.3.7.3 注意事项">​</a></h5>
<p>在使用读写 API 的时候，需要注意以下几个关键点：</p>
<ul>
<li>危险操作：OTP 空间为一次可编程的区域，bit 位一旦由0写为1，便不能恢复；</li>
<li>读写偏移量：读操作和写操作的基地址是不同的，OTP 区域的可读空间范围为<code>(otp_read_base + 0x0)~(otp_read_base + 0xc00)</code>，可写空间的长度为<code>(otp_write_base + 0x0)~(otp_write_base + 0x200)</code>;</li>
<li>读写size：size 是4的倍数。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="138-ts">1.3.8 TS<a href="#138-ts" class="hash-link" aria-label="Direct link to 1.3.8 TS" title="Direct link to 1.3.8 TS">​</a></h4>
<p>大核侧 TS 驱动可以支持被内核态其它驱动调用、用户态应用程序调用等场景，下面，将分别介绍这两种应用场景下 TS 驱动的使用方法、注意事项。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1381-用户态程序使用-ts">1.3.8.1 用户态程序使用 TS<a href="#1381-用户态程序使用-ts" class="hash-link" aria-label="Direct link to 1.3.8.1 用户态程序使用 TS" title="Direct link to 1.3.8.1 用户态程序使用 TS">​</a></h5>
<p>在 rt-smart 中，应用程序通过 I/O 设备管理接口来访问硬件设备，当实现对应的设备驱动之后，应用程序就可以访问该硬件。Rt-smart 用户层通过操作 <code>/dev/ts</code> 来访问 TS 硬件，用户态应用程序使用 TS 时，可以通过 <code>open</code>、<code>read</code>、<code>close</code> 等操作来访问 ts 设备。用户态应用程序使用 TS 的具体操作如下：</p>
<ol>
<li>添加头文件 <code>rtdevice.h</code>；</li>
<li>应用程序根据设备名称获取设备句柄；</li>
<li>获得设备句柄之后，应用程序可以打开设备；</li>
<li>初始化参数，包括偏移量、缓冲区、大小；</li>
<li>通过设备句柄和参数值从 TS 设备中读取数据；</li>
<li>利用设备句柄关闭设备。</li>
</ol>
<p>其中，snippet 代码如下所示：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;rtdevice.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;rtthread.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 查找设备，获取句柄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“ts”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//  打开设备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_OFLAG_RDWR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 初始化读参数并从TS设备中读值，参数分别代表读取TS的偏移量、要读取的字节长度、缓冲区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain">  size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_read</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">double</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_val </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xfff</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">usleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2600000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_val </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    temp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1e-10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.01472</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.10063</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.36150</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7.10128</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3565.87</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ts_val: 0x%x, TS = %lf C\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ts_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> temp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 关闭 设备</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rt_device_close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1382-内核态程序使用-ts">1.3.8.2 内核态程序使用 TS<a href="#1382-内核态程序使用-ts" class="hash-link" aria-label="Direct link to 1.3.8.2 内核态程序使用 TS" title="Direct link to 1.3.8.2 内核态程序使用 TS">​</a></h5>
<p>在rt-smart中，内核态其它驱动程序想要读芯片结温时，只需要调用 TS 驱动提供的接口即可。具体的步骤如下所示：</p>
<ol>
<li>添加头文件 <code>drv_ts.h</code>；</li>
<li>根据设备名称获取设备句柄；</li>
<li>初始化参数，包括偏移量、缓冲区、大小；</li>
<li>通过设备句柄和参数值从 TS 设备中读取温度数据；<!-- -->
<ul>
<li>ts_device_read</li>
</ul>
</li>
</ol>
<p>其中，snippet 代码如下所示：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">drv_ts</span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">h</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 查找设备，获取句柄</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ts_dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“ts”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// 初始化读参数并从TS设备中读值，参数分别代表读取TS的偏移量、要读取的字节长度、缓冲区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> pos </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain">  size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0x0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ts_device_read</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pos</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1383-注意事项">1.3.8.3 注意事项<a href="#1383-注意事项" class="hash-link" aria-label="Direct link to 1.3.8.3 注意事项" title="Direct link to 1.3.8.3 注意事项">​</a></h5>
<p>在调用API读TS温度的时候，需要注意以下几个关键点：</p>
<ul>
<li>TS 驱动会读取 tsensor 寄存器，将寄存器的值返回，但是寄存器的值并不是真正的温度值，需要用数学公式做相应的转换，详细的公式信息如下:</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// code为读取TS寄存器的值保留12位得到的结果，temp为芯片结温</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ts_val </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xfff</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">temp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1e-10</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.01472</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-6</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.10063</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.36150</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e-3</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">pow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7.10128</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> code </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3565.87</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="139-pwm">1.3.9 PWM<a href="#139-pwm" class="hash-link" aria-label="Direct link to 1.3.9 PWM" title="Direct link to 1.3.9 PWM">​</a></h4>
<p>目前PWM驱动仅提供了从内核态的调用方法，使用方法如下：</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1391-内核态程序使用pwm">1.3.9.1 内核态程序使用PWM<a href="#1391-内核态程序使用pwm" class="hash-link" aria-label="Direct link to 1.3.9.1 内核态程序使用PWM" title="Direct link to 1.3.9.1 内核态程序使用PWM">​</a></h5>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pwm_demo</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm_dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">rt_device_pwm</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">)</span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">PWM_DEV_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 设置PWM周期和脉冲宽度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">/* PWM周期, 单位为纳秒ns */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pulse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">/* PWM正脉冲宽度值, 单位为纳秒ns */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> period</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pulse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pulse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> period</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pulse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    period </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pulse </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">75000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> period</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pulse</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 使能设备，同一路pwm的不同channel仅需任意channel使能一次 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_enable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_enable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">sleep</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* disable 时同理 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_disable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_pwm_disable</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pwm_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> PWM_DEV_CHANNEL_4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1392-finsh命令使用pwm">1.3.9.2 FinSH命令使用PWM<a href="#1392-finsh命令使用pwm" class="hash-link" aria-label="Direct link to 1.3.9.2 FinSH命令使用PWM" title="Direct link to 1.3.9.2 FinSH命令使用PWM">​</a></h5>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">设置 PWM 设备的某个通道的周期和占空比</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msh /&gt;pwm_set pwm1 1 500000 5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">使能 PWM 设备的某个通道</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msh /&gt;pwm_enable pwm1 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">关闭 PWM 设备的某个通道</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msh /&gt;pwm_disable pwm1 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="1393-注意事项">1.3.9.3 注意事项<a href="#1393-注意事项" class="hash-link" aria-label="Direct link to 1.3.9.3 注意事项" title="Direct link to 1.3.9.3 注意事项">​</a></h5>
<p>K230共有6个PWM通道，其中channel 0 ~ 2（pwm 0 ~ 2）同属一路PWM，channel 3 ~ 5（pwm 3 ~ 5）通属一路PWM，在同时使用多通道PWM时，同属一路的PWM，仅需任意使能其中一个channel即可。
如 <a href="#1391-%E5%86%85%E6%A0%B8%E6%80%81%E7%A8%8B%E5%BA%8F%E4%BD%BF%E7%94%A8pwm">1.3.9.1</a> 中的示例，channel3和channel4仅使能了channel4，此时channel3也被使能。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1310-rtc">1.3.10 RTC<a href="#1310-rtc" class="hash-link" aria-label="Direct link to 1.3.10 RTC" title="Direct link to 1.3.10 RTC">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="13101-内核态使用rtc">1.3.10.1 内核态使用RTC<a href="#13101-内核态使用rtc" class="hash-link" aria-label="Direct link to 1.3.10.1 内核态使用RTC" title="Direct link to 1.3.10.1 内核态使用RTC">​</a></h5>
<p>RTC驱动提供了内核态的调用方法，使用方法如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token class-name">time_t</span><span class="token plain"> now</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">rt_device_t</span><span class="token plain"> device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RT_NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RTC_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">set_date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2024</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//设置日期</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">set_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//设置时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RT_NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//获取当前时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ctime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//打印</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_thread_mdelay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果要使用K230 RTC的中断功能，请参考以下示例：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">user_alarm_callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;[ user alarm callback function. ]\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">alarm_rtc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">time_t</span><span class="token plain"> now</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">uint32_t</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">tm</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rt_device_t</span><span class="token plain"> dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RT_NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">rt_alarm</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> alarm </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RT_NULL</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">kd_alarm_setup</span><span class="token plain"> setup</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RTC_NAME</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set_date</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">2024</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">set_time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RT_NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">gmtime_r</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">,</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">p_tm</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flag </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> RTC_INT_TICK_SECOND</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//秒级tick中断，每秒钟都会触发，请参考宏定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_year </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_year</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_mon </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_mon</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_mday </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_mday</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_wday </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_wday</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_hour </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_hour</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_min </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_min</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_sec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> p_tm</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tm_sec</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_CTRL_RTC_SET_CALLBACK</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_alarm_callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//set rtc interrupt callback</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_CTRL_RTC_SET_ALARM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">setup</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">//set alarm time</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        now </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">time</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">RT_NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;%s\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ctime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">now</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_thread_mdelay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_CTRL_RTC_STOP_ALARM</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//close interrupt</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="13102-注意事项">1.3.10.2 注意事项<a href="#13102-注意事项" class="hash-link" aria-label="Direct link to 1.3.10.2 注意事项" title="Direct link to 1.3.10.2 注意事项">​</a></h5>
<p>使用K230的RTC模块时，必须在芯片上电时激活PMU(请参考PMU相关文档)，否则RTC无法工作。</p>
<p>以 《K230-USIP-EVB-LP3-V1.1》为例，需要将J1区域的排针io13 io14连接后上电。</p>
<p>K230的RTC支持两种中断模式：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">1、alarm中断(定时中断)，在定时时间到时只产生一次中断。最大精度：秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2、tick中断(周期中断)，如每秒钟，每分钟，每小时，每天等都会产生中断。最大精度：1/64秒</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1311-timer">1.3.11 TIMER<a href="#1311-timer" class="hash-link" aria-label="Direct link to 1.3.11 TIMER" title="Direct link to 1.3.11 TIMER">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="13111-内核态使用timer">1.3.11.1 内核态使用TIMER<a href="#13111-内核态使用timer" class="hash-link" aria-label="Direct link to 1.3.11.1 内核态使用TIMER" title="Direct link to 1.3.11.1 内核态使用TIMER">​</a></h5>
<p>TIMER驱动提供了内核态的调用方法，使用方法如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">rt_err_t</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">tmr_timeout_cb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">rt_device_t</span><span class="token plain"> dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">rt_size_t</span><span class="token plain"> size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hwtimer timeout callback fucntion @tick\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> RT_EOK</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 以下示例代码略去了函数调用的错误检查，仅供参考。*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">test_hwtimer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rt_hwtimerval_t</span><span class="token plain"> timerval</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rt_hwtimer_mode_t</span><span class="token plain"> mode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rt_size_t</span><span class="token plain"> tsize</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token class-name">rt_uint32_t</span><span class="token plain"> freq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">/* 计数频率 可选 12.5M 25M 50M 100M*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tmr_dev_0 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hwtimer0&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tmr_dev_1 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">rt_device_find</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;hwtimer1&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_OFLAG_RDWR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> RT_DEVICE_OFLAG_RDWR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 将 freq 所表示的计数频率向timer设置 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> HWTIMER_CTRL_FREQ_SET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">freq</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* freq 不设置则驱动使用默认的计数频率 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 绑定中断回调函数 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_set_rx_indicate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmr_timeout_cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_set_rx_indicate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tmr_timeout_cb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">usec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tsize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> HWTIMER_MODE_ONESHOT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> HWTIMER_CTRL_MODE_SET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 将计数时间向timer设置 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tsize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">usec </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tsize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> HWTIMER_MODE_ONESHOT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_control</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> HWTIMER_CTRL_MODE_SET</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mode</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">rt_device_write</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> tsize</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 获取当前计数值 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_device_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Read timer0: Sec = %d, Usec = %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">usec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_device_read</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmr_dev_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timerval</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_kprintf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Read timer1: Sec = %d, Usec = %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sec</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timerval</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">usec</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">rt_thread_mdelay</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="13112-注意事项">1.3.11.2 注意事项<a href="#13112-注意事项" class="hash-link" aria-label="Direct link to 1.3.11.2 注意事项" title="Direct link to 1.3.11.2 注意事项">​</a></h5>
<p>设置freq计数频率时，只有12.5M 25M 50M 100M可供选择，不可设置其他数值，freq越大计数精度越高。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-api-参考">2. API 参考<a href="#2-api-参考" class="hash-link" aria-label="Direct link to 2. API 参考" title="Direct link to 2. API 参考">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-内核态-api">2.1 内核态 API<a href="#21-内核态-api" class="hash-link" aria-label="Direct link to 2.1 内核态 API" title="Direct link to 2.1 内核态 API">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-uart">2.1.1 UART<a href="#211-uart" class="hash-link" aria-label="Direct link to 2.1.1 UART" title="Direct link to 2.1.1 UART">​</a></h4>
<p>UART模块提供以下API：</p>
<ul>
<li><a href="#2111-rt_serial_init">rt_serial_init</a></li>
<li><a href="#2112-rt_serial_open">rt_serial_open</a></li>
<li><a href="#2113-rt_serial_close">rt_serial_close</a></li>
<li><a href="#2114-rt_serial_read">rt_serial_read</a></li>
<li><a href="#2115-rt_serial_write">rt_serial_write</a></li>
<li><a href="#2116-rt_serial_control">rt_serial_control</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2111-rt_serial_init">2.1.1.1 rt_serial_init<a href="#2111-rt_serial_init" class="hash-link" aria-label="Direct link to 2.1.1.1 rt_serial_init" title="Direct link to 2.1.1.1 rt_serial_init">​</a></h5>
<p>【描述】</p>
<p>初始化一个串口设备。</p>
<p>【语法】</p>
<p><code>rt_serial_init(struct rt_device *dev)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名 称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>其他</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2112-rt_serial_open">2.1.1.2 rt_serial_open<a href="#2112-rt_serial_open" class="hash-link" aria-label="Direct link to 2.1.1.2 rt_serial_open" title="Direct link to 2.1.1.2 rt_serial_open">​</a></h5>
<p>【描述】</p>
<p>打开一个串口设备。</p>
<p>【语法】</p>
<p><code>rt_serial_open(struct rt_device *dev, rt_uint16_t oflag)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>oflag</td><td><code>RT_DEVICE_FLAG_INT_RX RT_DEVICE_FLAG_DMA_RX</code> <code>RT_DEVICE_FLAG_INT_TX</code> <code>RT_DEVICE_FLAG_DMA_TX</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>-RT_EIO</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2113-rt_serial_close">2.1.1.3 rt_serial_close<a href="#2113-rt_serial_close" class="hash-link" aria-label="Direct link to 2.1.1.3 rt_serial_close" title="Direct link to 2.1.1.3 rt_serial_close">​</a></h5>
<p>【描述】</p>
<p>关闭一个串口设备。</p>
<p>【语法】</p>
<p><code>rt_serial_close(struct rt_device *dev)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>其他</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2114-rt_serial_read">2.1.1.4 rt_serial_read<a href="#2114-rt_serial_read" class="hash-link" aria-label="Direct link to 2.1.1.4 rt_serial_read" title="Direct link to 2.1.1.4 rt_serial_read">​</a></h5>
<p>【描述】</p>
<p>读取串口数据。</p>
<p>【语法】</p>
<p><code>rt_serial_read(struct rt_device *dev, rt_off_t pos, void *buffer, rt_size_t size)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>偏移，设0即可</td><td>输入</td></tr><tr><td>buffer</td><td>用于装载数据的指针</td><td>输入</td></tr><tr><td>size</td><td>要读取的大小</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_size_t</td><td>读取到的字节数</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2115-rt_serial_write">2.1.1.5 rt_serial_write<a href="#2115-rt_serial_write" class="hash-link" aria-label="Direct link to 2.1.1.5 rt_serial_write" title="Direct link to 2.1.1.5 rt_serial_write">​</a></h5>
<p>【描述】</p>
<p>发送串口数据。</p>
<p>【语法】</p>
<p><code>rt_serial_write(struct rt_device *dev, rt_off_t pos, void *buffer, rt_size_t size)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>偏移，设0即可</td><td>输入</td></tr><tr><td>buffer</td><td>将要写入数据的指针</td><td>输入</td></tr><tr><td>size</td><td>要写入的大小</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_size_t</td><td>写入的字节数</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2116-rt_serial_control">2.1.1.6 rt_serial_control<a href="#2116-rt_serial_control" class="hash-link" aria-label="Direct link to 2.1.1.6 rt_serial_control" title="Direct link to 2.1.1.6 rt_serial_control">​</a></h5>
<p>【描述】</p>
<p>通过控制接口，应用程序可以对串口设备进行配置，如波特率、数据位、校验位、接收缓冲区大小、停止位等参数的修改。</p>
<p>【语法】</p>
<p><code>rt_serial_control(struct rt_device *dev, int cmd, void *args)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>cmd</td><td>命令控制字，可取值：<code>RT_DEVICE_CTRL_CONFIG</code></td><td>输入</td></tr><tr><td>args</td><td>控制的参数，可取类型： <code>struct serial_configure</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>函数执行成功</td></tr><tr><td>-RT_ENOSYS</td><td>执行失败，dev 为空</td></tr><tr><td>其他</td><td>执行失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<p>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></p>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-i2c">2.1.2 I2C<a href="#212-i2c" class="hash-link" aria-label="Direct link to 2.1.2 I2C" title="Direct link to 2.1.2 I2C">​</a></h4>
<p>I2C模块提供以下API：</p>
<ul>
<li><a href="#2121-rt_i2c_bus_device_find">rt_i2c_bus_device_find</a></li>
<li><a href="#2122-rt_i2c_master_send">rt_i2c_master_send</a></li>
<li><a href="#2123-rt_i2c_master_recv">rt_i2c_master_recv</a></li>
<li><a href="#2124-rt_i2c_transfer">rt_i2c_transfer</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2121-rt_i2c_bus_device_find">2.1.2.1 rt_i2c_bus_device_find<a href="#2121-rt_i2c_bus_device_find" class="hash-link" aria-label="Direct link to 2.1.2.1 rt_i2c_bus_device_find" title="Direct link to 2.1.2.1 rt_i2c_bus_device_find">​</a></h5>
<p>【描述】</p>
<p>查找i2c总线。</p>
<p>【语法】</p>
<p><code>rt_i2c_bus_device_find(const char *bus_name)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>bus_name</td><td>I2C总线名字</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_i2c_bus_device*</td><td>函数执行成功，返回总线句柄</td></tr><tr><td>RT_NULL</td><td>总线不存在</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2122-rt_i2c_master_send">2.1.2.2 rt_i2c_master_send<a href="#2122-rt_i2c_master_send" class="hash-link" aria-label="Direct link to 2.1.2.2 rt_i2c_master_send" title="Direct link to 2.1.2.2 rt_i2c_master_send">​</a></h5>
<p>【描述】</p>
<p>向 I2C 从设备发送数据。</p>
<p>【语法】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rt_i2c_master_send(struct rt_i2c_bus_device *bus,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint16_t addr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint16_t flags,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const rt_uint8_t *buf,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint32_t count);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>bus</td><td>I2c总线句柄</td><td>输入</td></tr><tr><td>addr</td><td>I2C 从设备地址</td><td>输入</td></tr><tr><td>flags</td><td>标志位，可为<code>RT_I2C_WR RT_I2C_RD</code>及之外的其他标志位，可以进行 `</td><td>` 操作</td></tr><tr><td>buf</td><td>待发送数据数据缓冲区</td><td>输入</td></tr><tr><td>count</td><td>待发送数据大小（单位：字节）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>正值</td><td>成功，返回发送的字节数</td></tr><tr><td>负值</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2123-rt_i2c_master_recv">2.1.2.3 rt_i2c_master_recv<a href="#2123-rt_i2c_master_recv" class="hash-link" aria-label="Direct link to 2.1.2.3 rt_i2c_master_recv" title="Direct link to 2.1.2.3 rt_i2c_master_recv">​</a></h5>
<p>【描述】</p>
<p>向 I2C 从设备发送数据。</p>
<p>【语法】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rt_i2c_master_recv(struct rt_i2c_bus_device *bus,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint16_t addr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint16_t flags,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint8_t *buf,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint32_t count)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>bus</td><td>I2c总线句柄</td><td>输入</td></tr><tr><td>addr</td><td>I2C 从设备地址</td><td>输入</td></tr><tr><td>flags</td><td>标志位，可为<code>RT_I2C_WR</code> <code>RT_I2C_RD</code>及之外的其他标志位，可以进行 `</td><td>` 操作</td></tr><tr><td>buf</td><td>接收数据数据缓冲区</td><td>输入</td></tr><tr><td>count</td><td>接收数据大小（单位：字节）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>正值</td><td>成功，返回接收到的字节数</td></tr><tr><td>负值</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2124-rt_i2c_transfer">2.1.2.4 rt_i2c_transfer<a href="#2124-rt_i2c_transfer" class="hash-link" aria-label="Direct link to 2.1.2.4 rt_i2c_transfer" title="Direct link to 2.1.2.4 rt_i2c_transfer">​</a></h5>
<p>【描述】</p>
<p>向 I2C 从设备发送数据。</p>
<p>【语法】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rt_i2c_transfer(struct rt_i2c_bus_device *bus,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct rt_i2c_msg msgs[],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rt_uint32_t num)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>bus</td><td>I2c总线句柄</td><td>输入</td></tr><tr><td>msg</td><td>待传输的消息数组指针</td><td>输入</td></tr><tr><td>num</td><td>消息数组的元素个数</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>失败，总线不支持的操作</td></tr><tr><td>正值</td><td>成功，返回传输msg的数量</td></tr><tr><td>-RT_EIO</td><td>传输失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<p>头文件：<code>drivers/i2c.h</code></p>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-gpio">2.1.3 GPIO<a href="#213-gpio" class="hash-link" aria-label="Direct link to 2.1.3 GPIO" title="Direct link to 2.1.3 GPIO">​</a></h4>
<p>GPIO模块提供以下API：</p>
<ul>
<li><a href="#2131-kd_pin_mode">kd_pin_mode</a></li>
<li><a href="#2132-kd_pin_write">kd_pin_write</a></li>
<li><a href="#2133-kd_pin_read">kd_pin_read</a></li>
<li><a href="#2134-kd_pin_attach_irq">kd_pin_attach_irq</a></li>
<li><a href="#2135-kd_pin_detach_irq">kd_pin_detach_irq</a></li>
<li><a href="#2136-kd_pin_irq_enable">kd_pin_irq_enable</a></li>
<li><a href="#2137-gpio_device_ioctl">gpio_device_ioctl</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2131-kd_pin_mode">2.1.3.1 kd_pin_mode<a href="#2131-kd_pin_mode" class="hash-link" aria-label="Direct link to 2.1.3.1 kd_pin_mode" title="Direct link to 2.1.3.1 kd_pin_mode">​</a></h5>
<p>【描述】</p>
<p>设置gpio管脚输入输出模式。</p>
<p>【语法】</p>
<p><code>kd_pin_mode(rt_base_t pin, rt_base_t mode)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr><tr><td>mode</td><td>模式。<code>GPIO_DM_INPUT</code>、<code>GPIO_DM_INPUT_PULL_DOWN</code>、<code>GPIO_DM_INPUT_PULL_UP</code>、<code>GPIO_DM_OUTPUT</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>其他</td><td>失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2132-kd_pin_write">2.1.3.2 kd_pin_write<a href="#2132-kd_pin_write" class="hash-link" aria-label="Direct link to 2.1.3.2 kd_pin_write" title="Direct link to 2.1.3.2 kd_pin_write">​</a></h5>
<p>【描述】</p>
<p>设置gpio管脚电平。</p>
<p>【语法】</p>
<p><code>kd_pin_write(rt_base_t pin, rt_base_t value)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr><tr><td>value</td><td>电平状态。<code>GPIO_PV_LOW</code>、<code>GPIO_PV_HIGH</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>无返回值</td><td></td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2133-kd_pin_read">2.1.3.3 kd_pin_read<a href="#2133-kd_pin_read" class="hash-link" aria-label="Direct link to 2.1.3.3 kd_pin_read" title="Direct link to 2.1.3.3 kd_pin_read">​</a></h5>
<p>【描述】</p>
<p>设置gpio管脚电平。</p>
<p>【语法】</p>
<p><code>kd_pin_read(rt_base_t pin)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>管脚当前状态低电平</td></tr><tr><td>1</td><td>管脚当前电平状态高电平</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2134-kd_pin_attach_irq">2.1.3.4 kd_pin_attach_irq<a href="#2134-kd_pin_attach_irq" class="hash-link" aria-label="Direct link to 2.1.3.4 kd_pin_attach_irq" title="Direct link to 2.1.3.4 kd_pin_attach_irq">​</a></h5>
<p>【描述】</p>
<p>绑定管脚中断函数以及设置中断方式。</p>
<p>【语法】</p>
<p><code>kd_pin_attach_irq(rt_int32_t pin,rt_uint32_t mode, void (*hdr)(void *args), void *args)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr><tr><td>mode</td><td>中断方式。 <code>GPIO_PE_RISING</code>、 <code>GPIO_PE_FALLING</code>、 <code>GPIO_PE_BOTH</code>、 <code>GPIO_PE_HIGH</code>、 <code>GPIO_PE_LOW</code></td><td>输入</td></tr><tr><td>hdr</td><td>中断回调函数，由用户设置</td><td>输入</td></tr><tr><td>args</td><td>中断回调函数的参数，可以为RT_NULL</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>绑定成功</td></tr><tr><td>错误码</td><td>绑定失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2135-kd_pin_detach_irq">2.1.3.5 kd_pin_detach_irq<a href="#2135-kd_pin_detach_irq" class="hash-link" aria-label="Direct link to 2.1.3.5 kd_pin_detach_irq" title="Direct link to 2.1.3.5 kd_pin_detach_irq">​</a></h5>
<p>【描述】</p>
<p>解除管脚中断函数的绑定，并禁止gpio管脚的中断使能。</p>
<p>【语法】</p>
<p><code>kd_pin_detach_irq(rt_int32_t pin)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>管脚编号</td><td>解除成功</td></tr><tr><td>错误码</td><td>解除失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2136-kd_pin_irq_enable">2.1.3.6 kd_pin_irq_enable<a href="#2136-kd_pin_irq_enable" class="hash-link" aria-label="Direct link to 2.1.3.6 kd_pin_irq_enable" title="Direct link to 2.1.3.6 kd_pin_irq_enable">​</a></h5>
<p>【描述】</p>
<p>gpio管脚的中断使能。</p>
<p>【语法】</p>
<p><code>kd_pin_irq_enable(rt_base_t pin, rt_uint32_t enabled)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>pin</td><td>gpio编号</td><td>输入</td></tr><tr><td>enabled</td><td>是否使能。<code>True/false</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>使能成功</td></tr><tr><td>错误码</td><td>使能失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2137-gpio_device_ioctl">2.1.3.7 gpio_device_ioctl<a href="#2137-gpio_device_ioctl" class="hash-link" aria-label="Direct link to 2.1.3.7 gpio_device_ioctl" title="Direct link to 2.1.3.7 gpio_device_ioctl">​</a></h5>
<p>【描述】</p>
<p>gpio功能控制。</p>
<p>【语法】</p>
<p><code>gpio_device_ioctl(rt_device_t dev, int cmd, void *args)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>gpio句柄</td><td>输入</td></tr><tr><td>cmd</td><td>控制命令。 <code>KD_GPIO_DM_OUTPUT</code>、 <code>KD_GPIO_DM_INPUT</code>、 <code>KD_GPIO_DM_INPUT_PULL_UP</code>、 <code>KD_GPIO_DM_INPUT_PULL_DOWN</code>、 <code>KD_GPIO_WRITE_LOW</code>、 <code>KD_GPIO_WRITE_HIGH</code>、 <code>KD_GPIO_READ_VALUE</code></td><td>输入</td></tr><tr><td>args</td><td>用于从用户传下来的数据结构指针，数据结构中应包含管脚编号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<p>头文件：<code>drv_gpio.h</code></p>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="214-hard-lock">2.1.4 Hard-lock<a href="#214-hard-lock" class="hash-link" aria-label="Direct link to 2.1.4 Hard-lock" title="Direct link to 2.1.4 Hard-lock">​</a></h4>
<p>Hard-lock模块提供以下API：</p>
<ul>
<li><a href="#2141-kd_request_lock">kd_request_lock</a></li>
<li><a href="#2142-kd_hardlock_lock">kd_hardlock_lock</a></li>
<li><a href="#2143-kd_hardlock_unlock">kd_hardlock_unlock</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2141-kd_request_lock">2.1.4.1 kd_request_lock<a href="#2141-kd_request_lock" class="hash-link" aria-label="Direct link to 2.1.4.1 kd_request_lock" title="Direct link to 2.1.4.1 kd_request_lock">​</a></h5>
<p>【描述】</p>
<p>申请使用锁。</p>
<p>【语法】</p>
<p><code>kd_request_lock(rt_uint32_t num)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>num</td><td>锁编号。0~127</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>申请成功</td></tr><tr><td>-1</td><td>申请失败</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2142-kd_hardlock_lock">2.1.4.2 kd_hardlock_lock<a href="#2142-kd_hardlock_lock" class="hash-link" aria-label="Direct link to 2.1.4.2 kd_hardlock_lock" title="Direct link to 2.1.4.2 kd_hardlock_lock">​</a></h5>
<p>【描述】</p>
<p>加锁。</p>
<p>【语法】</p>
<p><code>kd_hardlock_lock (rt_uint32_t num)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>num</td><td>锁编号。0~127</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>加锁成功</td></tr><tr><td>-1</td><td>锁正在加锁状态，本次无法加锁</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2143-kd_hardlock_unlock">2.1.4.3 kd_hardlock_unlock<a href="#2143-kd_hardlock_unlock" class="hash-link" aria-label="Direct link to 2.1.4.3 kd_hardlock_unlock" title="Direct link to 2.1.4.3 kd_hardlock_unlock">​</a></h5>
<p>【描述】</p>
<p>加锁。</p>
<p>【语法】</p>
<p><code>kd_hardlock_unlock (rt_uint32_t num)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>num</td><td>锁编号。0~127</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>无返回值</td><td></td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<p>头文件：<code>drv_hardlock.h</code></p>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="215-adc">2.1.5 ADC<a href="#215-adc" class="hash-link" aria-label="Direct link to 2.1.5 ADC" title="Direct link to 2.1.5 ADC">​</a></h4>
<p>ADC 模块提供以下API：</p>
<ul>
<li><a href="#2151-rt_device_find">rt_device_find</a></li>
<li><a href="#2152-rt_adc_enable">rt_adc_enable</a></li>
<li><a href="#2153-rt_adc_read">rt_adc_read</a></li>
<li><a href="#2154-rt_adc_disable">rt_adc_disable</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2151-rt_device_find">2.1.5.1 rt_device_find<a href="#2151-rt_device_find" class="hash-link" aria-label="Direct link to 2.1.5.1 rt_device_find" title="Direct link to 2.1.5.1 rt_device_find">​</a></h5>
<p>【描述】</p>
<p>应用程序根据 ADC 设备名称获取设备句柄，进而可以操作 ADC 设备。</p>
<p>【语法】</p>
<p><code>rt_device_t rt_device_find(const char* name);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>name</td><td>adc 设备名称</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>设备句柄</td><td>查找到对应设备将返回相应的设备句柄</td></tr><tr><td>RT_NULL</td><td>没有找到设备</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无  。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2152-rt_adc_enable">2.1.5.2 rt_adc_enable<a href="#2152-rt_adc_enable" class="hash-link" aria-label="Direct link to 2.1.5.2 rt_adc_enable" title="Direct link to 2.1.5.2 rt_adc_enable">​</a></h5>
<p>【描述】</p>
<p>在读取 adc 设备数据前需要先使能设备，通过此函数使能 adc。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_adc_enable(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>adc 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>adc 通道</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>-RT_ENOSYS</td><td>失败，设备操作方法为空</td></tr><tr><td>其他错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2153-rt_adc_read">2.1.5.3 rt_adc_read<a href="#2153-rt_adc_read" class="hash-link" aria-label="Direct link to 2.1.5.3 rt_adc_read" title="Direct link to 2.1.5.3 rt_adc_read">​</a></h5>
<p>【描述】</p>
<p>读取 adc 通道采样值可通过此函数完成。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_adc_read(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>adc 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>adc 通道</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>读取的数值</td><td>读取的数值</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2154-rt_adc_disable">2.1.5.4 rt_adc_disable<a href="#2154-rt_adc_disable" class="hash-link" aria-label="Direct link to 2.1.5.4 rt_adc_disable" title="Direct link to 2.1.5.4 rt_adc_disable">​</a></h5>
<p>【描述】</p>
<p>关闭 adc 通道可通过此函数完成。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_adc_disable(rt_adc_device_t dev, rt_uint32_t channel);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>adc 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>adc 通道</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>-RT_ENOSYS</td><td>失败，设备操作方法为空</td></tr><tr><td>其他错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="216-wdt">2.1.6 WDT<a href="#216-wdt" class="hash-link" aria-label="Direct link to 2.1.6 WDT" title="Direct link to 2.1.6 WDT">​</a></h4>
<p>WDT 模块提供以下API：</p>
<ul>
<li><a href="#2161-rt_device_find">rt_device_find</a></li>
<li><a href="#2162-rt_device_init">rt_device_init</a></li>
<li><a href="#2163-rt_device_control">rt_device_control</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2161-rt_device_find">2.1.6.1 rt_device_find<a href="#2161-rt_device_find" class="hash-link" aria-label="Direct link to 2.1.6.1 rt_device_find" title="Direct link to 2.1.6.1 rt_device_find">​</a></h5>
<p>【描述】</p>
<p>应用程序根据 WDT 设备名称获取设备句柄，进而可以操作 WDT 设备。</p>
<p>【语法】</p>
<p><code>rt_device_t rt_device_find(const char* name);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>name</td><td>wdt 设备名称</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>设备句柄</td><td>查找到对应设备将返回相应的设备句柄</td></tr><tr><td>RT_NULL</td><td>没有找到设备</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2162-rt_device_init">2.1.6.2 rt_device_init<a href="#2162-rt_device_init" class="hash-link" aria-label="Direct link to 2.1.6.2 rt_device_init" title="Direct link to 2.1.6.2 rt_device_init">​</a></h5>
<p>【描述】</p>
<p>初始化 WDT 设备，主要是对<code>timeout table</code>的初始化。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_init(rt_device_t dev)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>wdt 设备句柄</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>初始化成功</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文 件：<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2163-rt_device_control">2.1.6.3 rt_device_control<a href="#2163-rt_device_control" class="hash-link" aria-label="Direct link to 2.1.6.3 rt_device_control" title="Direct link to 2.1.6.3 rt_device_control">​</a></h5>
<p>【描述】</p>
<p>功能型函数，根据传入cmd不同可以向下调用不同功能，类似用户层ioctl的功能。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_control(rt_device_t dev, int cmd, void *arg)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>wdt 设备句柄</td><td>输入</td></tr><tr><td>cmd</td><td>wdt contrl函数宏定义</td><td>输入</td></tr><tr><td>arg</td><td>传入的数据的指针</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>功能调用成功</td></tr><tr><td>RT_EINVAL</td><td>传入cmd无效</td></tr><tr><td>RT_ENOSYS</td><td>驱动无contrl接口</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="217-otp">2.1.7 OTP<a href="#217-otp" class="hash-link" aria-label="Direct link to 2.1.7 OTP" title="Direct link to 2.1.7 OTP">​</a></h4>
<p>大核 rt-smart 中，OTP 模块主要提供了以下 API：</p>
<ul>
<li><a href="#2171-otp_device_read">otp_device_read</a></li>
<li><a href="#2172-otp_device_write">otp_device_write</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2171-otp_device_read">2.1.7.1 otp_device_read<a href="#2171-otp_device_read" class="hash-link" aria-label="Direct link to 2.1.7.1 otp_device_read" title="Direct link to 2.1.7.1 otp_device_read">​</a></h5>
<p>【描述】</p>
<p>读 OTP 空间，可读范围：偏移量 0x0~0xbfc，size 为 0xc00。</p>
<p>【语法】</p>
<p>otp_device_read(rt_device_t dev, rt_off_t pos, void *buffer, rt_size_t size);</p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>要读取地址的偏移量</td><td>输入</td></tr><tr><td>buffer</td><td>内存缓冲区指针，读取的数据将会被保存在缓冲区中</td><td>输出</td></tr><tr><td>size</td><td>读取数据的大小（byte）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>读到数据的实际大小</td><td>以字节 byte 为单位</td></tr><tr><td>0</td><td>读取失败，参考错误码定义</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：drv_otp.h</li>
<li>库文件：无</li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2172-otp_device_write">2.1.7.2 otp_device_write<a href="#2172-otp_device_write" class="hash-link" aria-label="Direct link to 2.1.7.2 otp_device_write" title="Direct link to 2.1.7.2 otp_device_write">​</a></h5>
<p>【描述】</p>
<p>写 OTP 空间，可写范围：偏移量 0x0~0x1fc，size 为 0x200。</p>
<p>【语法】</p>
<p>otp_device_write(rt_device_t dev, rt_off_t pos, const void *buffer, rt_size_t size);</p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>要写入数据的偏移量</td><td>输入</td></tr><tr><td>buffer</td><td>内存缓冲区指针，放置要写入的数据</td><td>输出</td></tr><tr><td>size</td><td>吸入数  据的大小（byte）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>写入数据的实际大小</td><td>以字节 byte 为单位</td></tr><tr><td>0</td><td>写入失败，参考错误码定义</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：drv_otp.h</li>
<li>库文件：无</li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="218-ts">2.1.8 TS<a href="#218-ts" class="hash-link" aria-label="Direct link to 2.1.8 TS" title="Direct link to 2.1.8 TS">​</a></h4>
<p>大核 rt-smart 中，TS 模块主要提供了以下 API：</p>
<ul>
<li><a href="#2181-ts_device_read">ts_device_read</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2181-ts_device_read">2.1.8.1 ts_device_read<a href="#2181-ts_device_read" class="hash-link" aria-label="Direct link to 2.1.8.1 ts_device_read" title="Direct link to 2.1.8.1 ts_device_read">​</a></h5>
<p>【描述】</p>
<p>读芯片结温。</p>
<p>【语法】</p>
<p>ts_device_read(rt_device_t dev, rt_off_t pos, void *buffer, rt_size_t size);</p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>要读取地址的偏移量，设置为0</td><td>输入</td></tr><tr><td>buffer</td><td>内存缓冲区指针，读取的数据将会被保存在缓冲区中</td><td>输出</td></tr><tr><td>size</td><td>读取数据的大小（byte），设置为0</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>读到数据的实际大小</td><td>以字节 byte 为单位</td></tr><tr><td>0</td><td>读取失败，参考错误码定义</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需  求】</p>
<ul>
<li>头文件：drv_ts.h</li>
<li>库文件：无</li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="219-pwm">2.1.9 PWM<a href="#219-pwm" class="hash-link" aria-label="Direct link to 2.1.9 PWM" title="Direct link to 2.1.9 PWM">​</a></h4>
<p>PWM模块提供以下内核态API：</p>
<ul>
<li><a href="#2191-rt_pwm_set">rt_pwm_set</a></li>
<li><a href="#2192-rt_pwm_enable">rt_pwm_enable</a></li>
<li><a href="#2193-rt_pwm_disable">rt_pwm_disable</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2191-rt_pwm_set">2.1.9.1 rt_pwm_set<a href="#2191-rt_pwm_set" class="hash-link" aria-label="Direct link to 2.1.9.1 rt_pwm_set" title="Direct link to 2.1.9.1 rt_pwm_set">​</a></h5>
<p>【描述】</p>
<p>设置PWM设备的周期和正脉冲宽度。</p>
<p>【语法】</p>
<p><code>rt_pwm_set(struct rt_device_pwm *device, int channel, rt_uint32_t period, rt_uint32_t pulse)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>device</td><td>PWM 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>pwm通道号</td><td>输入</td></tr><tr><td>period</td><td>pwm周期(ns)</td><td>输入</td></tr><tr><td>pulse</td><td>pwm正脉冲宽度(ns)</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功</td></tr><tr><td>-RT_EIO</td><td>device 为空</td></tr><tr><td>-RT_ENOSYS</td><td>设备操作方法为空</td></tr><tr><td>其他错误码</td><td>执行失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>drivers/rt_drv_pwm.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2192-rt_pwm_enable">2.1.9.2 rt_pwm_enable<a href="#2192-rt_pwm_enable" class="hash-link" aria-label="Direct link to 2.1.9.2 rt_pwm_enable" title="Direct link to 2.1.9.2 rt_pwm_enable">​</a></h5>
<p>【描述】</p>
<p>使能 PWM 设备。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_pwm_enable(struct rt_device_pwm *device, int channel);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>device</td><td>PWM 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>pwm通道号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>设备使能成功</td></tr><tr><td>-RT_ENOSYS</td><td>设备操作方法为空</td></tr><tr><td>其他错误码</td><td>设备使能失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>drivers/rt_drv_pwm.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2193-rt_pwm_disable">2.1.9.3 rt_pwm_disable<a href="#2193-rt_pwm_disable" class="hash-link" aria-label="Direct link to 2.1.9.3 rt_pwm_disable" title="Direct link to 2.1.9.3 rt_pwm_disable">​</a></h5>
<p>【描述】</p>
<p>关闭 PWM 设备对应通道。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_pwm_disable(struct rt_device_pwm *device, int channel);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>device</td><td>PWM 设备句柄</td><td>输入</td></tr><tr><td>channel</td><td>pwm通道号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>设备关闭成功</td></tr><tr><td>-RT_EIO</td><td>设备句柄为空</td></tr><tr><td>其他错误码</td><td>设备关闭失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>drivers/rt_drv_pwm.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2110-rtc">2.1.10 RTC<a href="#2110-rtc" class="hash-link" aria-label="Direct link to 2.1.10 RTC" title="Direct link to 2.1.10 RTC">​</a></h4>
<p>PWM模块提供以下内核态API：</p>
<ul>
<li><a href="#21101-set_date">set_date</a></li>
<li><a href="#21102-set_time">set_time</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="21101-set_date">2.1.10.1 set_date<a href="#21101-set_date" class="hash-link" aria-label="Direct link to 2.1.10.1 set_date" title="Direct link to 2.1.10.1 set_date">​</a></h5>
<p>【描述】</p>
<p>设置日期，年、月、日。</p>
<p>【语法】</p>
<p><code>rt_err_t set_date(rt_uint32_t year, rt_uint32_t month, rt_uint32_t day)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>year</td><td>待设置的年份</td><td>输入</td></tr><tr><td>month</td><td>待设置的月份</td><td>输入</td></tr><tr><td>day</td><td>待设置的日</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>设置成功</td></tr><tr><td>-RT_ERROR</td><td>失败，没有找到 rtc 设备</td></tr><tr><td>其他错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>time.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="21102-set_time">2.1.10.2 set_time<a href="#21102-set_time" class="hash-link" aria-label="Direct link to 2.1.10.2 set_time" title="Direct link to 2.1.10.2 set_time">​</a></h5>
<p>【描述】</p>
<p>设置日期，年、月、日。</p>
<p> 【语法】</p>
<p><code>rt_err_t set_time(rt_uint32_t hour, rt_uint32_t minute, rt_uint32_t second)</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>hour</td><td>待设置的时</td><td>输入</td></tr><tr><td>minute</td><td>待设置的分</td><td>输入</td></tr><tr><td>second</td><td>待设置的秒</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>设置成功</td></tr><tr><td>-RT_ERROR</td><td>失败，没有找到 rtc 设备</td></tr><tr><td>其他错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>time.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2111-timer">2.1.11 TIMER<a href="#2111-timer" class="hash-link" aria-label="Direct link to 2.1.11 TIMER" title="Direct link to 2.1.11 TIMER">​</a></h4>
<p>TIMER模块提供以下内核态API：</p>
<ul>
<li><code>rt_device_open</code></li>
<li><code>rt_device_control</code></li>
<li><a href="#21111-rt_device_set_rx_indicate">rt_device_set_rx_indicate</a></li>
<li><code>rt_device_read</code></li>
<li><code>rt_device_write</code></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="21111-rt_device_set_rx_indicate">2.1.11.1 rt_device_set_rx_indicate<a href="#21111-rt_device_set_rx_indicate" class="hash-link" aria-label="Direct link to 2.1.11.1 rt_device_set_rx_indicate" title="Direct link to 2.1.11.1 rt_device_set_rx_indicate">​</a></h5>
<p>【描述】</p>
<p>设置回调函数，用于device接收到数据时调用。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_set_rx_indicate(rt_device_t dev, rt_err_t (*rx_ind)(rt_device_t dev, rt_size_t size))</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输  出</th></tr></thead><tbody><tr><td>dev</td><td>打开的设备句柄</td><td>输入</td></tr><tr><td>*rx_ind</td><td>回调函数指针</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>设置成功</td></tr><tr><td>其他错误码</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-用户态-api">2.2 用户态 API<a href="#22-用户态-api" class="hash-link" aria-label="Direct link to 2.2 用户态 API" title="Direct link to 2.2 用户态 API">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-adc">2.2.1 ADC<a href="#221-adc" class="hash-link" aria-label="Direct link to 2.2.1 ADC" title="Direct link to 2.2.1 ADC">​</a></h4>
<p>ADC 模块在用户态提供以下API：</p>
<ul>
<li><a href="#2211-rt_device_find">rt_device_find</a></li>
<li><a href="#2212-rt_device_open">rt_device_open</a></li>
<li><a href="#2213-rt_device_control">rt_device_control</a></li>
<li><a href="#2214-rt_device_read">rt_device_read</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2211-rt_device_find">2.2.1.1 rt_device_find<a href="#2211-rt_device_find" class="hash-link" aria-label="Direct link to 2.2.1.1 rt_device_find" title="Direct link to 2.2.1.1 rt_device_find">​</a></h5>
<p>【描述】</p>
<p>查找设备。该函数通过指定的名称查找设备。应用程序根据设备名称获取设备句柄，进而可以操作设备。</p>
<p>【语法】</p>
<p><code>rt_device_t rt_device_find(const char *name);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>name</td><td>设备的名称。</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_device_t</td><td>成功返回设备句柄</td></tr><tr><td>RT_NULL</td><td>失败返回 RT_NULL</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2212-rt_device_open">2.2.1.2 rt_device_open<a href="#2212-rt_device_open" class="hash-link" aria-label="Direct link to 2.2.1.2 rt_device_open" title="Direct link to 2.2.1.2 rt_device_open">​</a></h5>
<p>【描述】</p>
<p>打开设备。通过设备句柄，应用程序可以打开和关闭设备，打开设备时会检测设备是否已经初始化，没有初始化则会默认调用初始化接口初始化设备。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_open(rt_device_t dev, rt_uint16_t oflag);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>oflag</td><td>设备的打开模式标志位，支持 <code>RT_DEVICE_FLAG_RDWR</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功返回 RT_EOK</td></tr><tr><td>rt 错误码</td><td>失败返回错误码</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2213-rt_device_control">2.2.1.3 rt_device_control<a href="#2213-rt_device_control" class="hash-link" aria-label="Direct link to 2.2.1.3 rt_device_control" title="Direct link to 2.2.1.3 rt_device_control"> ​</a></h5>
<p>【描述】</p>
<p>该函数将在设备上执行各种控制功能，通过此函数使能 adc 设备的某个通道。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_control(rt_device_t dev, int cmd, void *arg);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>cmd</td><td>命令控制字，这个参数通常是与设备驱动程序相关。0 代表使能 adc 对应通道，1 代表关闭 adc 对应通道</td><td>输入</td></tr><tr><td>arg</td><td>控制命令相关的参数。这里对应 adc 通道号</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功返回 RT_EOK</td></tr><tr><td>rt 错误码</td><td>失败返回错误码</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<ul>
<li>应该使用 1.2.2 节中第三部分示例代码传入通道号。</li>
</ul>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2214-rt_device_read">2.2.1.4 rt_device_read<a href="#2214-rt_device_read" class="hash-link" aria-label="Direct link to 2.2.1.4 rt_device_read" title="Direct link to 2.2.1.4 rt_device_read">​</a></h5>
<p>【描述】</p>
<p>该函数将从设备读取数据。参数为 adc 设备句柄时，该函数将读取 adc 通道的采样值。</p>
<p>【语法】</p>
<p><code>rt_size_t rt_device_read(rt_device_t dev, rt_off_t pos, void *buffer, rt_size_t size);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄。在这里使用获取的 adc 设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>读取的偏移量。在这里对应通道号</td><td>输入</td></tr><tr><td>buffer</td><td>用于保存读取数据的数据缓冲区。在这里应该使用一个 32 位无符号数</td><td>输出</td></tr><tr><td>size</td><td>缓冲区的大小。在这里应该为 4 字节</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_size_t</td><td>成功则返回实际读取的大小，如果是字符设备，返回大小以字节为单位，如果是块设备，返回的大小以块为单位</td></tr><tr><td>buffer</td><td>用户保存读取数据的数据缓冲区。在这里是 adc 通道的采样值</td></tr><tr><td>0</td><td>失败则返回 0</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-wdt">2.2.2 WDT<a href="#222-wdt" class="hash-link" aria-label="Direct link to 2.2.2 WDT" title="Direct link to 2.2.2 WDT">​</a></h4>
<p>WDT 模块在用户态可以使用posix接口：</p>
<ul>
<li><a href="#2221-open">open</a></li>
<li><a href="#2222-ioctl">ioctl</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2221-open">2.2.2.1 open<a href="#2221-open" class="hash-link" aria-label="Direct link to 2.2.2.1 open" title="Direct link to 2.2.2.1 open">​</a></h5>
<p>【描述】</p>
<p>从用户态打开设备节点。</p>
<p>语法】</p>
<p><code>int open(const char *file, int flags, ...);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>file</td><td>设备节点路径</td><td>输入</td></tr><tr><td>flags</td><td>模式 <code>O_RDONLY</code> <code>O_WRONLY</code> <code>O_RDWR</code>等</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>大于0</td><td>成功则返回打开的设备节点描述符</td></tr><tr><td>小于0</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>fcntl.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2222-ioctl">2.2.2.2 ioctl<a href="#2222-ioctl" class="hash-link" aria-label="Direct link to 2.2.2.2 ioctl" title="Direct link to 2.2.2.2 ioctl">​</a></h5>
<p>【描述】</p>
<p>通过传入不同的参数调用驱动的不同功能。</p>
<p>语法】</p>
<p><code>int ioctl(int fildes, int cmd, ...);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>fildes</td><td>设备描述符</td><td>输入</td></tr><tr><td>cmd</td><td>命令</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>成功</td></tr><tr><td>非0</td><td>失败</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>sys/ioctl.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="223-otp">2.2.3 OTP<a href="#223-otp" class="hash-link" aria-label="Direct link to 2.2.3 OTP" title="Direct link to 2.2.3 OTP">​</a></h4>
<p>OTP 模块在用户态提供以下API：</p>
<ul>
<li><a href="#2231-rt_device_find">rt_device_find</a></li>
<li><a href="#2232-rt_device_open">rt_device_open</a></li>
<li><a href="#2233-rt_device_read">rt_device_read</a></li>
<li><a href="#2234-rt_device_write">rt_device_write</a></li>
<li><a href="#2235-rt_device_close">rt_device_close</a></li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2231-rt_device_find">2.2.3.1 rt_device_find<a href="#2231-rt_device_find" class="hash-link" aria-label="Direct link to 2.2.3.1 rt_device_find" title="Direct link to 2.2.3.1 rt_device_find">​</a></h5>
<p>【描述】</p>
<p>查找设备。该函数通过指定的名称查找设备。应用程序根据设备名称获取设备句柄，进而可以操作设备。</p>
<p>【语法】</p>
<p><code>rt_device_t rt_device_find(const char *name);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>name</td><td>设备的名称。</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_device_t</td><td>成功返回设备句柄</td></tr><tr><td>RT_NULL</td><td>失败返回 RT_NULL</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无。</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2232-rt_device_open">2.2.3.2 rt_device_open<a href="#2232-rt_device_open" class="hash-link" aria-label="Direct link to 2.2.3.2 rt_device_open" title="Direct link to 2.2.3.2 rt_device_open">​</a></h5>
<p>【描述】</p>
<p>打开设备。通过设备句柄，应用程序可以打开和关闭设备，打开设备时会检测设备是否已经初始化，没有初始化则会默认调用初始化接口初始化设备。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_open(rt_device_t dev, rt_uint16_t oflag);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄</td><td>输入</td></tr><tr><td>oflag</td><td>设备的打开模式标志位，支持 <code>RT_DEVICE_FLAG_RDWR</code></td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>成功返回 RT_EOK</td></tr><tr><td>rt 错误码</td><td>失败返回错误码</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2233-rt_device_read">2.2.3.3 rt_device_read<a href="#2233-rt_device_read" class="hash-link" aria-label="Direct link to 2.2.3.3 rt_device_read" title="Direct link to 2.2.3.3 rt_device_read">​</a></h5>
<p>【描述】</p>
<p>从 OTP 设备中读取数据，可读范围：偏移量 0x0~0xbfc，size 为 0xc00。</p>
<p>【语法】</p>
<p><code>rt_size_t rt_device_read(rt_device_t dev, rt_off_t pos, void *buffer, rt_size_t size);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄。在这里使用获取的 otp 设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>读取的偏移量。在这里对应要读取地址的偏移量</td><td>输入</td></tr><tr><td>buffer</td><td>用于保存读取数据的数据缓冲区。在这里应该使用一个 32 位无符号数</td><td>输出</td></tr><tr><td>size</td><td>缓冲区的大小。在这里对应读取数据的大小（bytes）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_size_t</td><td>成功则返回实际读取的大小，以字节为单位</td></tr><tr><td>0</td><td>失败则返回 0</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2234-rt_device_write">2.2.3.4 rt_device_write<a href="#2234-rt_device_write" class="hash-link" aria-label="Direct link to 2.2.3.4 rt_device_write" title="Direct link to 2.2.3.4 rt_device_write">​</a></h5>
<p>【描述】</p>
<p>向 OTP 设备中写入数据，可写范围：偏移量 0x0~0x1fc，size 为 0x200。</p>
<p>【语法】</p>
<p><code>rt_size_t otp_device_write(rt_device_t dev, rt_off_t pos, const void *buffer, rt_size_t size);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄。在这里使用获取的 otp 设备句柄</td><td>输入</td></tr><tr><td>pos</td><td>偏移量。在这里对应要写入数据的偏移量</td><td>输入</td></tr><tr><td>buffer</td><td>用于保存读取数据的数据缓冲区。放置要写入的数据</td><td>输出</td></tr><tr><td>size</td><td>缓冲区的大小。在这里对应写入数据的大小（bytes）</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_size_t</td><td>成功则返回实际写入数据的大小，以字节为单位</td></tr><tr><td>0</td><td>失败则返回 0</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2235-rt_device_close">2.2.3.5 rt_device_close<a href="#2235-rt_device_close" class="hash-link" aria-label="Direct link to 2.2.3.5 rt_device_close" title="Direct link to 2.2.3.5 rt_device_close">​</a></h5>
<p>【描述】</p>
<p>关闭设备。</p>
<p>【语法】</p>
<p><code>rt_err_t rt_device_close(rt_device_t dev);</code></p>
<p>【参数】</p>
<table><thead><tr><th>参数名称</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>dev</td><td>设备句柄。在这里使用获取的 otp 设备句柄</td><td>输入</td></tr></tbody></table>
<p>【返回值】</p>
<table><thead><tr><th>返回值</th><th>描述</th></tr></thead><tbody><tr><td>rt_err_t</td><td>成功则关闭设备</td></tr><tr><td>错误码</td><td>失败则返回错误码</td></tr></tbody></table>
<p>【芯片差异】</p>
<p>无</p>
<p>【需求】</p>
<ul>
<li>头文件：<code>rtdevice.h</code>、<code>rtthread.h</code></li>
</ul>
<p>【注意】</p>
<p>无</p>
<p>【举例】</p>
<p>无</p>
<p>【相关主题】</p>
<p>无</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="224-ts">2.2.4 TS<a href="#224-ts" class="hash-link" aria-label="Direct link to 2.2.4 TS" title="Direct link to 2.2.4 TS">​</a></h4>
<p>TS 模块在用户态提供以下 API，这些 API 跟 OTP 提供的 API 保持一致，请参考 <a href="#223-otp">OTP</a> 中对于用户态 API 的介绍。</p>
<ul>
<li>rt_device_find</li>
<li>rt_device_open</li>
<li>rt_device_read</li>
<li>rt_device_close</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-数据类型">3. 数据类型<a href="#3-数据类型" class="hash-link" aria-label="Direct link to 3. 数据类型" title="Direct link to 3. 数据类型">​</a></h2>
<p>UART模块使用到的数据类型：未定义私有数据类型</p>
<p>I2C模块使用到的数据类型：未定义私有数据类型</p>
<p>ADC 模块使用到的数据类型：未定义私有数据类型</p>
<p>GPIO模块使用到的数据类型：</p>
<ul>
<li><a href="#31-struct-rt_device_gpio">struct rt_device_gpio</a></li>
</ul>
<p>ADC 模块使用到的数据类型：未定义私有数据类型</p>
<p>Hard-lock模块使用到的数据类型：</p>
<ul>
<li><a href="#32-device_hardlock">struct device_hardlock</a></li>
</ul>
<p>WDT 模块使用到的数据类型：未定义私有数据类型</p>
<p>OTP 模块使用到的数据类型：未定义私有数据类型</p>
<p>TS 模块使用到的数据类型：未定义私有数据类型</p>
<p>PWM 模块使用到的数据类型：未定义私有数据类型</p>
<p>RTC 模块使用到的数据类型：</p>
<ul>
<li><a href="#33-struct-kd_alarm_setup">struct kd_alarm_setup</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-struct-rt_device_gpio">3.1 struct rt_device_gpio<a href="#31-struct-rt_device_gpio" class="hash-link" aria-label="Direct link to 3.1 struct rt_device_gpio" title="Direct link to 3.1 struct rt_device_gpio">​</a></h3>
<p>【说明】</p>
<p>用户传进来的gpio管脚和读取管脚时用于装载返回值的集合。</p>
<p>【定义】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct rt_device_gpio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rt_uint16_t pin; //管脚标号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rt_uint16_t value; //读管脚电平时用于装载读回的电平值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【注意事项】</p>
<p>无</p>
<p>【相关数据类型及接 口】</p>
<p>无</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-device_hardlock">3.2 device_hardlock<a href="#32-device_hardlock" class="hash-link" aria-label="Direct link to 3.2 device_hardlock" title="Direct link to 3.2 device_hardlock">​</a></h3>
<p>【说明】</p>
<p>驱动中对hardlock设备的抽象。</p>
<p>【定义】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct device_hardlock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volatile void *hw_base; // 模块内核基地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    char used[HARDLOCK_MAX]; //用于标志锁是否被使用，申请时会将对应编号置1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【注意事项】</p>
<p>无</p>
<p>【相关数据类型及接口】</p>
<p>无</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-struct-kd_alarm_setup">3.3 struct kd_alarm_setup<a href="#33-struct-kd_alarm_setup" class="hash-link" aria-label="Direct link to 3.3 struct kd_alarm_setup" title="Direct link to 3.3 struct kd_alarm_setup">​</a></h3>
<p>【说明】</p>
<p>在配置RTC中断时，将中断类型和定时时间一同向下注册进驱动中。</p>
<p>【定义】</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct kd_alarm_setup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rt_uint32_t flag;  /* alarm flag */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct tm tm;     /* when will the alarm wake up user */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>【注意事项】</p>
<p>无</p>
<p>【相关数据类型及接口】</p>
<p>无</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-错误码">4. 错误码<a href="#4-错 误码" class="hash-link" aria-label="Direct link to 4. 错误码" title="Direct link to 4. 错误码">​</a></h2>
<table><thead><tr><th>错误代码</th><th>宏定义</th><th>描述</th></tr></thead><tbody><tr><td>RT_EOK</td><td>0</td><td>成功</td></tr><tr><td>RT_ERROR</td><td>1</td><td>发生了错误</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-计算公式">5. 计算公式<a href="#5-计算公式" class="hash-link" aria-label="Direct link to 5. 计算公式" title="Direct link to 5. 计算公式">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-adc-计算公式">5.1 ADC 计算公式<a href="#51-adc-计算公式" class="hash-link" aria-label="Direct link to 5.1 ADC 计算公式" title="Direct link to 5.1 ADC 计算公式">​</a></h3>
<p>adc 硬件参考电压为 1.8V，12 bit 数字信号输出，受噪声干扰有效位为 10 bit。通过 API 获取 adc 采样电压值以后，转换为实际电压值的计算公式如下：</p>
<p>例如，在 msh 获取 adc 的采样值为 0x713，即 1811 时，实际电压值为：</p>
<p>V~1.8V，浮动范围为 5mv。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-wdt超时时间计算公式">5.2 WDT超时时间计算公式<a href="#52-wdt超时时间计算公式" class="hash-link" aria-label="Direct link to 5.2 WDT超时时间计算公式" title="Direct link to 5.2 WDT超时时间计算公式">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">value = clock * timeout;   timeout：用户设置的超时时间，单位是：秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">log2(value) = ret + 16;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret = log2(value) - 16;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>ret就是最终将要配置到wdt模块的超时时间值。</p>
<p>用户并不需要关心超时时间如何计算，计算过程已经在驱动中实现，当用户调用ioctl或rt_device_control配置超时时间时，驱动将会找到一个最接近用户设置的时间的值配置进wdt模块。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CanaanK230/part7/16_K230Large-corelow-speeddriveAPIreference.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/CanaanK230/part7/K230DRMUserGuide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">K230 DRM使用指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/CanaanK230/part7/K230ReferenceAPIsmall-coreLinuxdrivers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">K230小核Linux驱动API参考</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-概述" class="table-of-contents__link toc-highlight">1 概述</a><ul><li><a href="#11-概述" class="table-of-contents__link toc-highlight">1.1 概述</a></li><li><a href="#12-功能描述" class="table-of-contents__link toc-highlight">1.2 功能描述</a></li><li><a href="#13-驱动api使用方法" class="table-of-contents__link toc-highlight">1.3 驱动API使用方法</a></li></ul></li><li><a href="#2-api-参考" class="table-of-contents__link toc-highlight">2. API 参考</a><ul><li><a href="#21-内核态-api" class="table-of-contents__link toc-highlight">2.1 内核态 API</a></li><li><a href="#22-用户态-api" class="table-of-contents__link toc-highlight">2.2 用户态 API</a></li></ul></li><li><a href="#3-数据类型" class="table-of-contents__link toc-highlight">3. 数据类型</a><ul><li><a href="#31-struct-rt_device_gpio" class="table-of-contents__link toc-highlight">3.1 struct rt_device_gpio</a></li><li><a href="#32-device_hardlock" class="table-of-contents__link toc-highlight">3.2 device_hardlock</a></li><li><a href="#33-struct-kd_alarm_setup" class="table-of-contents__link toc-highlight">3.3 struct kd_alarm_setup</a></li></ul></li><li><a href="#4-错误码" class="table-of-contents__link toc-highlight">4. 错误码</a></li><li><a href="#5-计算公式" class="table-of-contents__link toc-highlight">5. 计算公式</a><ul><li><a href="#51-adc-计算公式" class="table-of-contents__link toc-highlight">5.1 ADC 计算公式</a></li><li><a href="#52-wdt超时时间计算公式" class="table-of-contents__link toc-highlight">5.2 WDT超时时间计算公式</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>